# ุฅุตูุงุญ ูุดููุฉ ุงูุชุจููุจุงุช ุงููุชุนุฏุฏุฉ - ููุฎุต ุงูุชุบููุฑุงุช

**ุงูุชุงุฑูุฎ:** 31 ููุงูุฑ 2026  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ

---

## ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1. โ ุฎุทุฃ Context: `useAuth must be used within AuthProvider`
**ุงูุณุจุจ:** 
- ูู ูุถุน ุงูุชุทููุฑ (dev)ุ ุนูุฏ ูุชุญ ุชุจููุจุงุช ูุชุนุฏุฏุฉ ูุน HMR ูุดุทุ ูุญุฏุซ ุชูุฑุงุฑ (duplication) ูู modules
- ููุชูู ุงูุฃูุฑ ุจูุณุฎุชูู ูู `AuthContext` ูุญููุชูู ูู ููุณ ุงูุตูุญุฉ
- `AuthProvider` ูู ูุณุฎุฉ ู `useAuth` ูู ูุณุฎุฉ ุฃุฎุฑู

**ุงูุญู:**
- ุชุญุฏูุซ `RouteErrorBoundary` ููุชุนุฑู ุนูู ุฃุฎุทุงุก Context ูู HMR errors
- ุนูุฏ ุญุฏูุซ ุงูุฎุทุฃุ ูุชู reload ุชููุงุฆู ููุตูุญุฉ ุจุฏูุงู ูู ุงูุจูุงุก ูู ุญุงูุฉ ููุณูุฑุฉ

### 2. ๐ ุชุฌููุฏ/ุชููู ุงูุชุจููุจุฉ ุงูุฌุฏูุฏุฉ
**ุงูุณุจุจ:**
- ุนูุฏ ูุชุญ ุชุจููุจุฉ ุฌุฏูุฏุฉุ ูุงู ุงููุธุงู ูุฑุณู **ูู ุจูุงูุงุช React Query cache** ูู ุงูุชุจููุจุงุช ุงููุฏููุฉ
- ุฅุฑุณุงู ูุฆุงุช ุฃู ุขูุงู ุงูุงุณุชุนูุงูุงุช ุนุจุฑ `BroadcastChannel` ูุณุจุจ:
  - ุถุบุท ูุจูุฑ ุนูู ุงูู main thread
  - ุชุฌููุฏ ูุงุฌูุฉ ุงููุณุชุฎุฏู
  - ุชุทุจูู ููุณ ุงูุชุญุฏูุซ ูุฑุชูู (ูุฑุฉ ูู `advancedTabSync` ููุฑุฉ ูู `App.tsx`)

**ุงูุญู:**
- **ุชุนุทูู ุฅุฑุณุงู ุจูุงูุงุช ุงููุงุด ุจูู ุงูุชุจููุจุงุช**
- ูู ุชุจููุจุฉ ุชุฌูุจ ุจูุงูุงุชูุง ุงูุฎุงุตุฉ ุชููุงุฆูุงู ุนุจุฑ:
  - `refetchOnWindowFocus: true` (ููุฌูุฏ ุจุงููุนู)
  - `staleTime: 1 minute` (ููุฌูุฏ ุจุงููุนู)
- ูุจูู ููุท ุนูู **Invalidate** (ุฅุดุนุงุฑ ุงูุชุจููุจุงุช ุงูุฃุฎุฑู ุจุฅุนุงุฏุฉ ุฌูุจ ุงูุจูุงูุงุช)

### 3. ๐ ููุงุชูุญ ุชููู Supabase ุบูุฑ ุตุญูุญุฉ
**ุงูุณุจุจ:**
- `AuthContext` ูุงู ูุจุญุซ ุนู `supabase.auth.token`
- ุงูููุชุงุญ ุงูุตุญูุญ ูู `sb-{projectRef}-auth-token`
- ูุฐุง ูุณุจุจ ุนุฏู ูุฒุงููุฉ ุตุญูุญุฉ ูุชุณุฌูู ุงูุฏุฎูู/ุงูุฎุฑูุฌ ุจูู ุงูุชุจููุจุงุช

**ุงูุญู:**
- ุชุญุฏูุซ `AuthContext` ููุจุญุซ ุนู ุฃู ููุชุงุญ ูุจุฏุฃ ุจู `sb-` ูููุชูู ุจู `-auth-token`
- ุงูุขู ุงููุฒุงููุฉ ุจูู ุงูุชุจููุจุงุช ุชุนูู ุจุดูู ุตุญูุญ

---

## ุงููููุงุช ุงููุนุฏูุฉ

### 1. `src/components/common/RouteErrorBoundary.tsx`
```typescript
// ุฅุถุงูุฉ ุงูุชุนุฑู ุนูู ุฃุฎุทุงุก Context ูู HMR errors
if (message.includes('must be used within') || message.includes('useauth must be used')) {
  return 'hmr_error'; // ุณูุนูู reload ุชููุงุฆู
}
```

### 2. `src/App.tsx`
```typescript
// ุชุนุทูู ุฅุฑุณุงู ุงููุงุด ุงููุงูู
const unsubscribeSyncRequest = advancedTabSync.onSyncRequest(() => {
  console.log('Sync request received (cache sync disabled for performance)');
  // ุงูุชุจููุจุฉ ุงูุฌุฏูุฏุฉ ุณุชุฌูุจ ุงูุจูุงูุงุช ุชููุงุฆูุงู
});

// ุชุญููู DATA_UPDATE ูู ูุณุฎ ุงูุจูุงูุงุช ุฅูู Invalidate
const unsubscribeDataSync = advancedTabSync.onDataUpdate((message) => {
  queryClient.invalidateQueries({ queryKey: message.queryKey });
});
```

### 3. `src/contexts/AuthContext.tsx`
```typescript
// ุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูุตุญูุญ ูุชููู Supabase
const hasToken = keys.some(key => key.startsWith('sb-') && key.includes('-auth-token'));

// ุงูุงุณุชูุงุน ููููุชุงุญ ุงูุตุญูุญ
if (e.key && e.key.startsWith('sb-') && e.key.includes('-auth-token')) {
  // ูุฒุงููุฉ ุชุณุฌูู ุงูุฏุฎูู/ุงูุฎุฑูุฌ
}
```

### 4. `src/utils/advancedTabSync.ts`
```typescript
// ุชุนุทูู ุฅุฑุณุงู ุงููุงุด
private handleSyncRequest() {
  console.log('Sync request (cache sync disabled)');
  // ูู ุชุจููุจุฉ ุชุฌูุจ ุจูุงูุงุชูุง
}

// ุชุญููู DATA_UPDATE ุฅูู Invalidate
private handleDataUpdate(message) {
  this.queryClient.invalidateQueries({ queryKey: message.queryKey });
}
```

---

## ุงููุชูุฌุฉ ุงููุชููุนุฉ

### โ ูู ูุถุน ุงูุชุทููุฑ (Development)
- ุนูุฏ ุญุฏูุซ ุฎุทุฃ Contextุ ูุชู reload ุชููุงุฆู
- ูุง ูุฒูุฏ ูู ุงูุดุงุดุฉ ุงูููุณูุฑุฉ
- HMR ูุนูู ุจุดูู ุทุจูุนู

### โ ูู ุงูุฅูุชุงุฌ (Production)
- ูุชุญ ุชุจููุจุงุช ูุชุนุฏุฏุฉ ูุนูู ุจุณูุงุณุฉ
- ูุง ุชุฌููุฏ ุฃู ุชููู
- ูู ุชุจููุจุฉ ุชุฌูุจ ุจูุงูุงุชูุง ุจุณุฑุนุฉ
- ุงููุฒุงููุฉ ุจูู ุงูุชุจููุจุงุช ุชุนูู ุนุจุฑ Invalidate ููุท

### โ ูุฒุงููุฉ ุงููุตุงุฏูุฉ
- ุชุณุฌูู ุงูุฏุฎูู ูู ุชุจููุจุฉ ูุธูุฑ ูู ุฌููุน ุงูุชุจููุจุงุช
- ุชุณุฌูู ุงูุฎุฑูุฌ ูู ุชุจููุจุฉ ูุณุฌู ุฎุฑูุฌ ุฌููุน ุงูุชุจููุจุงุช
- ุงุณุชุฎุฏุงู ุงูููุงุชูุญ ุงูุตุญูุญุฉ ูู Supabase

---

## ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูู 1: ูุชุญ ุชุจููุจุชูู ูู Dev
1. ุงูุชุญ ุงูุชุทุจูู ูู ุชุจููุจุฉ
2. ุงูุชุญ ุชุจููุจุฉ ุฌุฏูุฏุฉ
3. **ุงููุชูุฌุฉ:** ููุง ุงูุชุจููุจุชูู ุชุนููุงู ุจุฏูู ุชุฌููุฏ
4. ุฅุฐุง ุญุฏุซ ุฎุทุฃ Contextุ reload ุชููุงุฆู

### ุณููุงุฑูู 2: ูุชุญ ุชุจููุจุชูู ูู Production
1. ุงูุชุญ ุงูุชุทุจูู ูู ุชุจููุจุฉ
2. ุชุตูุญ ูุฌูุจ ุจูุงูุงุช
3. ุงูุชุญ ุชุจููุจุฉ ุฌุฏูุฏุฉ
4. **ุงููุชูุฌุฉ:** ุงูุชุจููุจุฉ ุงูุฌุฏูุฏุฉ ุชุฌูุจ ุจูุงูุงุชูุง ุจุณุฑุนุฉ ุจุฏูู ุชุฌููุฏ

### ุณููุงุฑูู 3: ูุฒุงููุฉ ุชุณุฌูู ุงูุฏุฎูู/ุงูุฎุฑูุฌ
1. ุงูุชุญ ุชุจููุจุชูู
2. ุณุฌู ุฏุฎูู ูู ุชุจููุจุฉ ูุงุญุฏุฉ
3. **ุงููุชูุฌุฉ:** ุงูุชุจููุจุฉ ุงูุฃุฎุฑู ุชุชุนุฑู ุนูู ุชุณุฌูู ุงูุฏุฎูู ุชููุงุฆูุงู
4. ุณุฌู ุฎุฑูุฌ ูู ุชุจููุจุฉ
5. **ุงููุชูุฌุฉ:** ุงูุชุจููุจุฉ ุงูุฃุฎุฑู ุชุณุฌู ุฎุฑูุฌ ุชููุงุฆูุงู

---

## ููุงุญุธุงุช ูููุฉ

### ๐ฏ ุงูููุณูุฉ ุงูุฌุฏูุฏุฉ
- **ูู ุชุจููุจุฉ ูุณุชููุฉ** - ุชุฌูุจ ุจูุงูุงุชูุง ุงูุฎุงุตุฉ
- **ูุง ููู ุจูุงูุงุช ุซูููุฉ** - ููุท ุฅุดุนุงุฑุงุช ุฎูููุฉ (Invalidate)
- **React Query ูุชููู ุงููุฒุงููุฉ** - ุนุจุฑ `refetchOnWindowFocus`

### โก ุงูุฃุฏุงุก
- ุชุญููู ุฃุณุฑุน ููุชุจููุจุงุช ุงูุฌุฏูุฏุฉ
- ูุง ุถุบุท ุนูู ุงูู main thread
- ุงุณุชููุงู ุฃูู ููุฐุงูุฑุฉ

### ๐ ุงูุฃูุงู
- ุงุณุชุฎุฏุงู ููุงุชูุญ Supabase ุงูุตุญูุญุฉ
- ูุฒุงููุฉ ุขููุฉ ูููุตุงุฏูุฉ
- ูุง ุชุณุฑูุจ ููุจูุงูุงุช ุจูู ุงูุชุจููุจุงุช

---

## ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ

### ูู Dev:
- ุงูุณุญ cache ุงููุชุตูุญ (`Ctrl+Shift+Delete`)
- ุฃุนุฏ ุชุดุบูู dev server (`npm run dev`)
- ุงุณุชุฎุฏู ุชุจููุจ ูุงุญุฏ ุฃุซูุงุก ุงูุชุทููุฑ

### ูู Production:
- ุชุฃูุฏ ูู ุฃู Build ุฌุฏูุฏ (`npm run build:ci`)
- ุงูุณุญ Service Worker cache
- Hard refresh (`Ctrl+Shift+R`)

---

## ุงูุฎูุงุตุฉ

ุชู ุญู ูุดููุฉ ุงูุชุจููุจุงุช ุงููุชุนุฏุฏุฉ ุจู **ุชุจุณูุท ุงููุฒุงููุฉ** ู **ุฅุฒุงูุฉ ููู ุงูุจูุงูุงุช ุงูุซูููุฉ**. ุงููุธุงู ุงูุขู:
- โ ูุฏุนู ุชุจููุจุงุช ูุชุนุฏุฏุฉ ุจุฏูู ุชุฌููุฏ
- โ ูุชุนุงูู ูุน ุฃุฎุทุงุก HMR ุจุดูู ุตุญูุญ
- โ ูุฒุงูู ุงููุตุงุฏูุฉ ุจุดูู ููุซูู
- โ ุฃุณุฑุน ูุฃุฎู ุนูู ุงูุฃุฏุงุก
