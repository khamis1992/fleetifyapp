# دليل استكشاف أخطاء إضافة العملاء وإصلاحها

## نظرة عامة
يحتوي هذا الدليل على حلول شاملة لجميع المشاكل الشائعة التي قد تواجهها عند محاولة إضافة عميل جديد في نظام Fleetify.

## المشاكل الشائعة والحلول

### 1. خطأ "لا يمكن تحديد الشركة"

**الأعراض:**
- رسالة خطأ: "لا يمكن تحديد الشركة. يرجى التأكد من أن لديك ملف شخصي صحيح مع شركة مرتبطة"

**الأسباب المحتملة:**
- المستخدم ليس مرتبط بأي شركة
- الملف الشخصي للمستخدم غير مكتمل
- مشكلة في بيانات المستخدم

**الحلول:**
1. **للمستخدمين العاديين:**
   - تواصل مع مدير الشركة لربط حسابك بالشركة
   - تأكد من اكتمال الملف الشخصي

2. **لمديري الشركات:**
   - تحقق من أن الشركة مسجلة بشكل صحيح في النظام
   - تأكد من ربط الموظفين بالشركة من خلال صفحة إدارة الموظفين

3. **للمديرين العامين:**
   - يجب اختيار الشركة من القائمة المنسدلة قبل إضافة العميل

### 2. خطأ "ليس لديك الصلاحية المطلوبة"

**الأعراض:**
- رسالة خطأ: "ليس لديك الصلاحية المطلوبة لإضافة العملاء"

**الأسباب:**
- المستخدم لا يملك الدور المناسب

**الحلول:**
- يجب أن يكون لديك أحد الأدوار التالية:
  - `super_admin` (مدير عام)
  - `company_admin` (مدير شركة)
  - `manager` (مدير)
  - `sales_agent` (مندوب مبيعات)

- **للحصول على الصلاحيات:**
  1. تواصل مع مدير الشركة لتعيينك بالدور المناسب
  2. أو تواصل مع المدير العام إذا كنت مدير شركة

### 3. أخطاء التحقق من البيانات

**الأعراض:**
- رسائل خطأ مثل "الاسم الأول مطلوب" أو "رقم الهاتف غير صحيح"

**الحلول:**
1. **للعملاء الأفراد:**
   - الاسم الأول مطلوب (حرفين على الأقل)
   - الاسم الأخير مطلوب (حرفين على الأقل)
   - رقم الهاتف مطلوب (8-15 رقم)

2. **للعملاء الشركات:**
   - اسم الشركة مطلوب (3 أحرف على الأقل)
   - رقم الهاتف مطلوب

3. **تنسيق البيانات:**
   - رقم الهاتف: +965 XXXXXXXX
   - البريد الإلكتروني: صيغة صحيحة (example@domain.com)
   - رقم الهوية المدنية: 12 رقم بالضبط
   - الحد الائتماني: رقم موجب أو صفر

### 4. أخطاء قاعدة البيانات

**الأعراض:**
- رسائل خطأ تتعلق بقاعدة البيانات
- فشل في حفظ البيانات

**أكواد الأخطاء الشائعة:**
- `PGRST301`: مشكلة في الصلاحيات
- `PGRST116`: الشركة غير موجودة
- أخطاء "duplicate": بيانات مكررة
- أخطاء "foreign key": مرجع غير صحيح

**الحلول:**
1. **للأخطاء الأمنية (PGRST301):**
   - تحقق من صلاحياتك
   - تأكد من ربطك بالشركة الصحيحة

2. **للشركة غير الموجودة (PGRST116):**
   - تواصل مع المدير العام فوراً
   - قد تحتاج إعادة تسجيل الشركة

3. **للبيانات المكررة:**
   - تحقق من عدم وجود عميل آخر بنفس رقم الهاتف
   - تحقق من رقم الهوية المدنية

### 5. مشاكل الاتصال

**الأعراض:**
- فشل في تحميل البيانات
- انقطاع الاتصال

**الحلول:**
1. تحقق من اتصال الإنترنت
2. أعد تحميل الصفحة
3. تواصل مع الدعم التقني إذا استمرت المشكلة

## خطوات التشخيص

### الخطوة 1: استخدام أداة التشخيص المدمجة
1. اذهب إلى صفحة العملاء
2. اضغط على زر "تشخيص المشاكل"
3. انتظر انتهاء عملية التشخيص
4. راجع النتائج والتوصيات

### الخطوة 2: التحقق اليدوي
1. **تحقق من معلومات المستخدم:**
   - هل أنت مسجل دخول؟
   - هل لديك ملف شخصي مكتمل؟
   - ما هي أدوارك في النظام؟

2. **تحقق من بيانات الشركة:**
   - هل أنت مرتبط بشركة؟
   - هل الشركة نشطة؟
   - هل لديك الصلاحيات في هذه الشركة؟

3. **تحقق من البيانات المدخلة:**
   - هل جميع الحقول المطلوبة مملوءة؟
   - هل تنسيق البيانات صحيح؟
   - هل هناك أحرف خاصة غير مقبولة؟

### الخطوة 3: اختبار الحلول
1. اتبع الحلول المقترحة حسب نوع المشكلة
2. أعد المحاولة
3. إذا استمرت المشكلة، انتقل للخطوة التالية

## المشاكل المتقدمة

### مشكلة الحساب المالي للعميل
في بعض الحالات، قد ينشأ العميل بنجاح لكن يفشل إنشاء الحساب المالي.

**الحل:**
- هذا لا يؤثر على إنشاء العميل
- الحساب المالي سيُنشأ تلقائياً في المرة القادمة
- يمكن إنشاؤه يدوياً من صفحة دليل الحسابات

### مشاكل الأداء
إذا كان النظام بطيء:

**الحلول:**
1. امسح ذاكرة التخزين المؤقت للمتصفح
2. أغلق التبويبات غير الضرورية
3. تحقق من سرعة الإنترنت
4. استخدم متصفح محدث

## جهات الاتصال للدعم

### المستوى الأول - مدير الشركة
- مشاكل الصلاحيات
- ربط الموظفين بالشركة
- إدارة الأدوار

### المستوى الثاني - المدير العام
- مشاكل الشركات
- مشاكل قاعدة البيانات
- إعدادات النظام

### المستوى الثالث - الدعم التقني
- مشاكل الأداء
- أخطاء النظام
- مشاكل الاتصال

## رسائل الخطأ الشائعة ومعانيها

| رسالة الخطأ | المعنى | الحل |
|-------------|--------|------|
| "كونك مدير عام، يجب عليك اختيار شركة" | المدير العام لم يختر شركة | اختر شركة من القائمة المنسدلة |
| "الاسم الأول مطلوب" | حقل الاسم الأول فارغ | أدخل الاسم الأول |
| "رقم الهاتف غير صحيح" | تنسيق رقم الهاتف خاطئ | استخدم التنسيق: +965 XXXXXXXX |
| "عنوان البريد الإلكتروني غير صحيح" | تنسيق البريد الإلكتروني خاطئ | تحقق من صيغة البريد الإلكتروني |
| "يوجد عميل آخر بنفس البيانات" | بيانات مكررة | تحقق من رقم الهاتف أو الهوية |

## نصائح لتجنب المشاكل

1. **تأكد من اكتمال البيانات قبل الحفظ**
2. **استخدم تنسيق صحيح للأرقام والإيميلات**
3. **تحقق من صلاحياتك قبل البدء**
4. **احفظ نسخة احتياطية من البيانات المهمة**
5. **اتبع معايير إدخال البيانات المحددة**
6. **تواصل مع الإدارة عند الشك**

## سجل التحديثات

### الإصدار 1.2 (2025-01-26)
- إضافة نظام تشخيص شامل
- تحسين معالجة الأخطاء
- إضافة التحقق من البيانات المحسن
- تحسين رسائل الخطأ

### الإصدار 1.1
- إضافة دعم للمديرين العامين
- تحسين واجهة المستخدم
- إصلاح مشاكل الصلاحيات

### الإصدار 1.0
- النسخة الأولى من نظام العملاء 