# ูุธุงู ุฑุจุท ุงููุฏููุนุงุช ุจุงูุนููุฏ ุงููุญุณู

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุดุงูู ูุฑุจุท ุงููุฏููุนุงุช ุจุงูุนููุฏ ูุฏุนู ุฑูุน ุงูุจูุงูุงุช ูู ุงูุฌุฏุงูู ุงูุฎุงุฑุฌูุฉ (ูุซู Excel) ูุฑุจุทูุง ุชููุงุฆูุงู ุจุงูุนููุฏ ุงูููุฌูุฏุฉ ูู ุงููุธุงู. ูููุฑ ุงููุธุงู ูุงุฌูุงุช ูุชูุฏูุฉ ูููุนุงููุฉ ูุงูุชุญูู ูุงูุฅุฏุงุฑุฉ.

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### ๐ ุงูุฑุจุท ุงูุฐูู ููุนููุฏ
- **ุงูุจุญุซ ูุชุนุฏุฏ ุงููุนุงููุฑ**: ูุฏุนู ุงูุจุญุซ ุจุฑูู ุงูุงุชูุงููุฉุ ุฑูู ุงูุนูุฏุ ููุนูููุงุช ุงูุนููู
- **ูุธุงู ุงูุซูุฉ**: ุชูููู ุฏูุฉ ุงูุฑุจุท ุจูุณุจ ูุฆููุฉ (0-100%)
- **ุงูุฑุจุท ุงูุชููุงุฆู**: ุฑุจุท ุงููุฏููุนุงุช ุนุงููุฉ ุงูุซูุฉ ุชููุงุฆูุงู
- **ุงูุชุญูู ุงูุฐูู**: ูุญุต ุดุงูู ููุจูุงูุงุช ูุจู ุงูุฑุจุท

### ๐ ูุงุฌูุงุช ูุชูุฏูุฉ
- **ุฑูุน ูุญุณู**: ูุงุฌูุฉ ุชูุงุนููุฉ ูุฑูุน ูููุงุช CSV ูุน ูุนุงููุฉ ููุฑูุฉ
- **ููุญุฉ ุชุญูู ุดุงููุฉ**: ุนุฑุถ ุฅุญุตุงุฆูุงุช ูุฅุฏุงุฑุฉ ุงููุฏููุนุงุช ุงููุฑุจูุทุฉ ูุบูุฑ ุงููุฑุจูุทุฉ
- **ูุธุงู ุงูุชุญุฐูุฑุงุช**: ุชูุจููุงุช ุฐููุฉ ูููุดุงูู ุงููุญุชููุฉ
- **ุชูุงุฑูุฑ ุชูุตูููุฉ**: ุชุญููู ุดุงูู ูุนูููุงุช ุงูุฑุจุท

### ๐ก๏ธ ูุธุงู ุงูุชุญูู ูุงูุฃูุงู
- **ุงูุชุญูู ูุชุนุฏุฏ ุงููุณุชููุงุช**: ุฃุณุงุณูุ ููุงุณูุ ูุตุงุฑู
- **ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ**: ุชุตููู ุงููุฎุงุทุฑ (ููุฎูุถุ ูุชูุณุทุ ุนุงููุ ุญุฑุฌ)
- **ุชุชุจุน ุงูุนูููุงุช**: ุชุณุฌูู ุฌููุน ูุญุงููุงุช ุงูุฑุจุท
- **ุตูุงุญูุงุช ุงููุณุชุฎุฏููู**: ุชุญูู ุฏููู ูู ุงููุตูู

## ุงูุจููุฉ ุงูุชูููุฉ

### ุงููููุงุช ุงูุฃุณุงุณูุฉ

#### 1. Backend/Database
```
supabase/migrations/20250115120000_enhance_payments_contract_linking.sql
```
- ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ ูุฌุฏูู ุงููุฏููุนุงุช
- ุฅูุดุงุก ุฌุฏูู ุชุชุจุน ูุญุงููุงุช ุงูุฑุจุท
- ุฏูุงู ุงูุจุญุซ ุงูุฐูู ูุงูุฅุญุตุงุฆูุงุช
- ููุงุฑุณ ูุญุณูุฉ ููุฃุฏุงุก

#### 2. Hooks/Logic
```
src/hooks/usePaymentsCSVUpload.ts          # ุฑูุน ูุชุญููู ุงููุฏููุนุงุช
src/hooks/usePaymentContractLinking.ts     # ุฅุฏุงุฑุฉ ุนูููุงุช ุงูุฑุจุท
src/utils/paymentContractValidation.ts     # ูุธุงู ุงูุชุญูู ูุงูุชุญุฐูุฑุงุช
```

#### 3. Components/UI
```
src/components/finance/EnhancedPaymentsCSVUpload.tsx    # ูุงุฌูุฉ ุงูุฑูุน ุงููุญุณูุฉ
src/components/finance/LinkedPaymentsDashboard.tsx      # ููุญุฉ ุชุญูู ุงูุฑุจุท
```

### ุงูุญููู ุงูุฌุฏูุฏุฉ ูู ุฌุฏูู ุงููุฏููุนุงุช

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|--------|--------|
| `agreement_number` | VARCHAR(100) | ุฑูู ุงูุงุชูุงููุฉ ููุง ูุธูุฑ ูู ุงููุซุงุฆู |
| `due_date` | DATE | ุชุงุฑูุฎ ุงุณุชุญูุงู ุงูุฏูุนุฉ |
| `original_due_date` | DATE | ุชุงุฑูุฎ ุงูุงุณุชุญูุงู ุงูุฃุตูู |
| `late_fine_days_overdue` | INTEGER | ุนุฏุฏ ุฃูุงู ุงูุชุฃุฎูุฑ |
| `reconciliation_status` | VARCHAR(50) | ุญุงูุฉ ุงูุชุณููุฉ |
| `description_type` | VARCHAR(100) | ููุน ูุตู ุงูุฏูุนุฉ |

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฑูุน ุงููุฏููุนุงุช ูู ููู Excel/CSV

```typescript
// ุงุณุชุฎุฏุงู ุงููุงุฌูุฉ ุงููุญุณูุฉ
<EnhancedPaymentsCSVUpload
  open={showDialog}
  onOpenChange={setShowDialog}
  onUploadComplete={handleComplete}
/>
```

**ุงูุญููู ุงููุทููุจุฉ ูู ุงูููู:**
- `payment_date`: ุชุงุฑูุฎ ุงูุฏูุน
- `amount`: ุงููุจูุบ
- `agreement_number`: ุฑูู ุงูุงุชูุงููุฉ (ููู ููุฑุจุท)

**ุงูุญููู ุงูุงุฎุชูุงุฑูุฉ:**
- `contract_number`: ุฑูู ุงูุนูุฏ
- `due_date`: ุชุงุฑูุฎ ุงูุงุณุชุญูุงู
- `late_fine_days_overdue`: ุฃูุงู ุงูุชุฃุฎูุฑ
- `description`: ูุตู ุงูุฏูุนุฉ
- `customer_name`: ุงุณู ุงูุนููู

### 2. ุฅุนุฏุงุฏุงุช ุงูุฑุจุท

```typescript
const linkingSettings = {
  autoLink: true,           // ุงูุฑุจุท ุงูุชููุงุฆู
  minConfidence: 0.8,       // ุงูุญุฏ ุงูุฃุฏูู ููุซูุฉ (80%)
  strictMatching: false,    // ุงูุชุทุงุจู ุงูุตุงุฑู
  searchMethods: {
    byAgreementNumber: true,  // ุงูุจุญุซ ุจุฑูู ุงูุงุชูุงููุฉ
    byContractNumber: true,   // ุงูุจุญุซ ุจุฑูู ุงูุนูุฏ
    byCustomerInfo: false     // ุงูุจุญุซ ุจูุนูููุงุช ุงูุนููู
  },
  validationLevel: 'standard' // ูุณุชูู ุงูุชุญูู
};
```

### 3. ุงุณุชุฎุฏุงู ููุญุฉ ุงูุชุญูู

```typescript
// ุนุฑุถ ููุญุฉ ุชุญูู ุงูุฑุจุท
<LinkedPaymentsDashboard />
```

**ุงูููุฒุงุช ุงููุชุงุญุฉ:**
- ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุฑุจุท
- ุฅุฏุงุฑุฉ ุงููุฏููุนุงุช ุงููุฑุจูุทุฉ ูุบูุฑ ุงููุฑุจูุทุฉ
- ุงูุฑุจุท ุงูุชููุงุฆู ุงููุชูุฏู
- ุงูุจุญุซ ูุงูุชุตููุฉ
- ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ

### 4. ุงูุจุญุซ ุงูุฐูู ุนู ุงูุนููุฏ

```typescript
const { searchPotentialContracts } = usePaymentContractLinking();

const contracts = await searchPotentialContracts({
  agreement_number: "LTO2024177",
  contract_number: "CON-001",
  customer_id: "uuid-here"
});
```

### 5. ุงูุชุญูู ูู ุตุญุฉ ุงูุฑุจุท

```typescript
const validation = PaymentContractValidator.generateLinkingReport(
  paymentData,
  contractData,
  linkingAttempt
);

console.log(validation.overallAssessment.riskLevel); // 'low' | 'medium' | 'high' | 'critical'
console.log(validation.linkingQuality.confidence);   // 0.0 - 1.0
```

## ูุซุงู ุนููู: ุฑูุน ุงูุฌุฏูู ุงููุฑููุน

ุจูุงุกู ุนูู ุงูุฌุฏูู ุงููุฑููุน ูู ุงูุทูุจุ ุฅููู ููููุฉ ุฅุนุฏุงุฏ ุงูููู:

### ุชูุณูู ููู CSV ุงููุทููุจ:

```csv
agreement_number,amount,payment_date,due_date,late_fine_days_overdue,description,type,payment_status
LTO2024177,1780,2024-07-01,2024-07-01,0,JULY RENT INCOME,INCOME,completed
LTO2024247,1800,2024-09-01,2024-09-01,4,september INCOME,INCOME,completed
MR202476,2100,2024-05-01,2024-05-01,0,May Rent INCOME,INCOME,completed
```

### ุฎุทูุงุช ุงูุฑูุน:

1. **ุชุญุถูุฑ ุงูููู**: ุชุฃูุฏ ูู ูุฌูุฏ ุงูุญููู ุงููุทููุจุฉ
2. **ุฑูุน ุงูููู**: ุงุณุชุฎุฏู ูุงุฌูุฉ ุงูุฑูุน ุงููุญุณูุฉ
3. **ูุนุงููุฉ ุงูุจูุงูุงุช**: ุฑุงุฌุน ุงููุชุงุฆุฌ ูุงูุชุญุฐูุฑุงุช
4. **ุชุฃููุฏ ุงูุฑุจุท**: ุงุฎุชุฑ ุงููุฏููุนุงุช ููุฑุจุท
5. **ูุฑุงุฌุนุฉ ุงููุชุงุฆุฌ**: ุชุญูู ูู ูุฌุงุญ ุงูุนูููุฉ

## ุงูุฏูุงู ุงููุณุงุนุฏุฉ

### ุฏูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ุงูุจุญุซ ุงูุฐูู ุนู ุงูุนููุฏ
SELECT * FROM find_contract_by_identifiers(
  'company-uuid',
  'LTO2024177',    -- ุฑูู ุงูุงุชูุงููุฉ
  'CON-001',       -- ุฑูู ุงูุนูุฏ
  'customer-uuid'  -- ูุนุฑู ุงูุนููู
);

-- ุฅุญุตุงุฆูุงุช ุงูุฑุจุท
SELECT * FROM get_payment_linking_stats('company-uuid');
```

### ุฏูุงู JavaScript

```typescript
// ุชุญููู ุจูุงูุงุช ุงูุฏูุนุฉ
const analysis = await analyzePaymentData(csvData);

// ุงูุจุญุซ ุนู ุนููุฏ ูุญุชููุฉ
const contracts = await searchPotentialContracts(paymentData);

// ุฑุจุท ุฏูุนุฉ ุจุนูุฏ
await linkPaymentToContract.mutateAsync({
  paymentId: 'payment-uuid',
  contractId: 'contract-uuid',
  linkingMethod: 'agreement_number',
  confidence: 0.95
});
```

## ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### 1. ุนุฏู ุงูุนุซูุฑ ุนูู ุงูุนูุฏ
```
ุงูุณุจุจ: ุฑูู ุงูุงุชูุงููุฉ ุบูุฑ ููุฌูุฏ ุฃู ุบูุฑ ุตุญูุญ
ุงูุญู: ุชุญูู ูู ุตุญุฉ ุฑูู ุงูุงุชูุงููุฉ ุฃู ุฃูุดุฆ ุงูุนูุฏ ุฃููุงู
```

### 2. ุชุถุงุฑุจ ูู ุงููุจุงูุบ
```
ุงูุณุจุจ: ุงููุจูุบ ุงููุฏููุน ุฃูุจุฑ ูู ุฑุตูุฏ ุงูุนูุฏ
ุงูุญู: ุฑุงุฌุน ุฑุตูุฏ ุงูุนูุฏ ุฃู ุตุญุญ ูุจูุบ ุงูุฏูุนุฉ
```

### 3. ุชุถุงุฑุจ ูู ุงูุชูุงุฑูุฎ
```
ุงูุณุจุจ: ุชุงุฑูุฎ ุงูุฏูุนุฉ ุจุนุฏ ุงูุชูุงุก ุงูุนูุฏ
ุงูุญู: ุชุญูู ูู ุชูุงุฑูุฎ ุงูุนูุฏ ุฃู ุงูุฏูุนุฉ
```

### 4. ูุณุชูู ุซูุฉ ููุฎูุถ
```
ุงูุณุจุจ: ุนุฏู ุชุทุงุจู ุฏููู ูู ุงูุจูุงูุงุช
ุงูุญู: ุฑุงุฌุน ุงูุจูุงูุงุช ูุฏููุงู ุฃู ุญุณู ูุนุงููุฑ ุงูุจุญุซ
```

## ุงูุฃุฏุงุก ูุงูุชุญุณูู

### ุงูููุงุฑุณ ุงููุถุงูุฉ
- `idx_payments_agreement_number`: ููุจุญุซ ุจุฑูู ุงูุงุชูุงููุฉ
- `idx_payments_due_date`: ููุจุญุซ ุจุชุงุฑูุฎ ุงูุงุณุชุญูุงู
- `idx_payments_reconciliation_status`: ูุชุตููุฉ ุญุงูุฉ ุงูุชุณููุฉ

### ูุตุงุฆุญ ุงูุฃุฏุงุก
- ุงุณุชุฎุฏู ุงูุฑุจุท ุงูุชููุงุฆู ูููุฏููุนุงุช ุนุงููุฉ ุงูุซูุฉ
- ุฑุงุฌุน ุงููุฏููุนุงุช ููุฎูุถุฉ ุงูุซูุฉ ูุฏููุงู
- ุญุฏุซ ุจูุงูุงุช ุงูุนููุฏ ุจุงูุชุธุงู
- ุงุณุชุฎุฏู ุงูุจุญุซ ุงููุชูุฏู ููุญุงูุงุช ุงููุนูุฏุฉ

## ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### ุตูุงุญูุงุช ุงููุตูู
- **ุงููุดุงูุฏุฉ**: ุฌููุน ุงููุณุชุฎุฏููู
- **ุงูุฑุจุท**: ุงููุญุงุณุจูู ูุงููุฏุฑุงุก
- **ุงูุฅุฏุงุฑุฉ**: ูุฏุฑุงุก ุงูุดุฑูุฉ ูุงููุดุฑููู ุงูุนุงููู

### ุชุชุจุน ุงูุนูููุงุช
ุฌููุน ุนูููุงุช ุงูุฑุจุท ูุณุฌูุฉ ูู ุฌุฏูู `payment_contract_linking_attempts` ูุน:
- ูุนุฑู ุงููุณุชุฎุฏู
- ุชุงุฑูุฎ ูููุช ุงูุนูููุฉ
- ุทุฑููุฉ ุงูุฑุจุท ุงููุณุชุฎุฏูุฉ
- ูุณุชูู ุงูุซูุฉ
- ุงูุนููุฏ ุงููุญุชููุฉ

## ุงูุชุทููุฑ ุงููุณุชูุจูู

### ููุฒุงุช ูุฎุทุทุฉ
- [ ] ุฑุจุท ูุชุนุฏุฏ ุงูุนููุฏ ููุฏูุนุฉ ุงููุงุญุฏุฉ
- [ ] ุชุนูู ุขูู ูุชุญุณูู ุฏูุฉ ุงูุฑุจุท
- [ ] ุชูุงูู ูุน ุฃูุธูุฉ ูุญุงุณุจูุฉ ุฎุงุฑุฌูุฉ
- [ ] ุชูุงุฑูุฑ ุชุญููููุฉ ูุชูุฏูุฉ
- [ ] ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ูููุฏููุนุงุช ุงููุชุฃุฎุฑุฉ

### ุชุญุณููุงุช ุงูุฃุฏุงุก
- [ ] ุชุฎุฒูู ูุคูุช ููุจุญุซ ุงููุชูุฑุฑ
- [ ] ูุนุงูุฌุฉ ูุชูุงุฒูุฉ ูููููุงุช ุงููุจูุฑุฉ
- [ ] ุถุบุท ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
- [ ] ููุฑุณุฉ ูุชูุฏูุฉ ูููุตูุต

---

## ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ููุญุตูู ุนูู ุงููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงูู:
1. ุฑุงุฌุน ูุฐุง ุงูุฏููู ุฃููุงู
2. ุชุญูู ูู ุณุฌูุงุช ุงููุธุงู
3. ุงุชุตู ุจูุฑูู ุงูุฏุนู ุงูุชููู

**ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ:** 15 ููุงูุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0.0
