# ุฏููู ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุนููุฏ ูุงูุนููุงุก
## Import Customer Contracts Guide

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุณูุฑูุจุช ูููู ุจุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุนููุฏ ูุงูุนููุงุก ูู ููู JSON ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช Supabase.

## ๐ง ุงููุชุทูุจุงุช ุงูุฃูููุฉ

### 1. ุชุซุจูุช ุงูุญุฒู ุงููุทููุจุฉ

```bash
npm install @supabase/supabase-js
npm install --save-dev tsx @types/node
```

### 2. ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ

ุฃูุดุฆ ููู `.env` ูู ุฌุฐุฑ ุงููุดุฑูุน ูุฃุถู:

```env
VITE_SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

**ููุงุญุธุฉ ูููุฉ**: ุงุญุตู ุนูู `Service Role Key` ูู:
1. ุงูุชุญ ููุญุฉ ุชุญูู Supabase
2. ุงุฐูุจ ุฅูู Settings > API
3. ุงูุณุฎ `service_role` key (ููุณ `anon` key)

### 3. ุชุญุฏูุซ ูุนุฑู ุงูุดุฑูุฉ

ุงูุชุญ ููู `scripts/import-customer-contracts.ts` ูุญุฏุซ:

```typescript
const COMPANY_ID = 'YOUR_COMPANY_ID'; // ุถุน ูุนุฑู ุดุฑูุชู ููุง
```

ููุญุตูู ุนูู ูุนุฑู ุงูุดุฑูุฉ:
```sql
-- ูู Supabase SQL Editor
SELECT id, name FROM companies;
```

## ๐ ุชุฌููุฒ ุงูุจูุงูุงุช

ุชุฃูุฏ ูู ุฃู ููู JSON ููุฌูุฏ ูู ุงููุณุงุฑ:
```
.cursor/ุงููุฑูุจุงุช_ูุน_ุงูุนููุงุก (1).json
```

## ๐ ุชุดุบูู ุงูุณูุฑูุจุช

### ุงูุทุฑููุฉ 1: ุจุงุณุชุฎุฏุงู npm script

ุฃุถู ุฅูู `package.json`:

```json
{
  "scripts": {
    "import-contracts": "tsx scripts/import-customer-contracts.ts"
  }
}
```

ุซู ุดุบู:
```bash
npm run import-contracts
```

### ุงูุทุฑููุฉ 2: ูุจุงุดุฑุฉ ุจุงุณุชุฎุฏุงู tsx

```bash
npx tsx scripts/import-customer-contracts.ts
```

### ุงูุทุฑููุฉ 3: ุจุงุณุชุฎุฏุงู Node.js

```bash
node --loader tsx scripts/import-customer-contracts.ts
```

## ๐ ูุงุฐุง ููุนู ุงูุณูุฑูุจุชุ

### 1. ูุฑุงุกุฉ ุงูุจูุงูุงุช
- ููุฑุฃ ููู JSON ููุญูู ุจูุงูุงุช ุงููุฑูุจุงุช ูุงูุนููุงุก

### 2. ูุนุงูุฌุฉ ูู ุณุฌู
ููู ูุฑูุจุฉ ูู ุงูููู:

#### ุฃ. ุงูุจุญุซ ุนู ุงููุฑูุจุฉ
- ูุจุญุซ ูู ุฌุฏูู `vehicles` ุจุงุณุชุฎุฏุงู ุฑูู ุงููุฑูุจุฉ
- ุฅุฐุง ูู ุชูุฌุฏ ุงููุฑูุจุฉุ ูุณุฌู ุฎุทุฃ ููุชุฎุทู ุงูุณุฌู

#### ุจ. ูุนุงูุฌุฉ ุงูุนููู
- ูุจุญุซ ุนู ุงูุนููู ุจุงูุงุณู
- ุฅุฐุง ูู ููุฌุฏุ ููุดุฆ ุนูููุงู ุฌุฏูุฏุงู ุจุงูุจูุงูุงุช ุงููุชููุฑุฉ:
  - ุงูุงุณู ุงูุฃูู ูุงูุฃุฎูุฑ
  - ุฑูู ุงููุงุชู
  - ููุน ุงูุนููู (ูุฑุฏ)

#### ุฌ. ุฅูุดุงุก/ุชุญุฏูุซ ุงูุนูุฏ
- ููุดุฆ ุนูุฏ ุฌุฏูุฏ ุฃู ูุญุฏุซ ุงูููุฌูุฏ:
  - ุฑูู ุงูุนูุฏ: `CNT-[ุฑูู ุงููุฑูุจุฉ]-[ุงูุณูุฉ]`
  - ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ูู ุงูููู
  - ุชุงุฑูุฎ ุงูููุงูุฉ: ุจุนุฏ ุณูุฉ ูู ุงูุจุฏุงูุฉ
  - ุงูุฅูุฌุงุฑ ุงูุดูุฑู
  - ุงูุญุงูุฉ: ูุดุท (active)
  - ุงูููุงุญุธุงุช

### 3. ูุนุงูุฌุฉ ุงูุจูุงูุงุช
- ูุนุงูุฌ ุงูุณุฌูุงุช ุนูู ุฏูุนุงุช (10 ุณุฌูุงุช ููู ุฏูุนุฉ)
- ุชุฃุฎูุฑ 100ms ุจูู ูู ุณุฌู ูุชุฌูุจ rate limits
- ูุณุฌู ุชูุฏู ุงูุนูููุฉ ุจุงูุชูุตูู

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

ุจุนุฏ ุชุดุบูู ุงูุณูุฑูุจุชุ ุณุชุญุตู ุนูู ุชูุฑูุฑ ูุซู:

```
====================================================================
โ ุงูุชููุช ุนูููุฉ ุงูุงุณุชูุฑุงุฏ!
====================================================================

๐ ุงูุฅุญุตุงุฆูุงุช:
   โข ุฅุฌูุงูู ุงูุณุฌูุงุช: 99
   โข ุงููุฑูุจุงุช ุงูููุฌูุฏุฉ: 95
   โข ุงููุฑูุจุงุช ุบูุฑ ุงูููุฌูุฏุฉ: 4
   โข ุงูุนููุงุก ุงูุฌุฏุฏ: 87
   โข ุงูุนููุฏ ุงููููุดุฃุฉ/ุงููุญุฏุซุฉ: 95
   โข ุงูุฃุฎุทุงุก: 4

โ๏ธ  ุงูุฃุฎุทุงุก:
   1. ุงููุฑูุจุฉ 2798: ุงููุฑูุจุฉ ุบูุฑ ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   2. ุงููุฑูุจุฉ 185 485: ูุดู ูู ูุนุงูุฌุฉ ุงูุนููู
   ...
====================================================================
```

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงููุฑูุจุงุช ุบูุฑ ุงูููุฌูุฏุฉ
ุฅุฐุง ูุงูุช ุงููุฑูุจุฉ ุบูุฑ ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ูุฌุจ ุนููู:
- ุฅูุดุงุก ุงููุฑูุจุฉ ุฃููุงู ูู ุงููุธุงู
- ุฃู ุชุญุฏูุซ ุฑูู ุงููุฑูุจุฉ ูู ููู JSON

### 2. ุชูุณููุงุช ุงูุชุงุฑูุฎ
ุงูุณูุฑูุจุช ูุฏุนู ุชูุณููุงุช ูุชุนุฏุฏุฉ:
- `15/4/2025`
- `01-09-2025`
- `2025-01-02 00:00:00`
- `2025-01-02`

### 3. ุฃุฑูุงู ุงูููุงุชู
- ูุถูู ุฑูุฒ ุงูุฏููุฉ (974 ููุทุฑ) ุชููุงุฆูุงู
- ููุธู ุงูุฃุญุฑู ุบูุฑ ุงูุฑูููุฉ

### 4. ุงูููู ุงูุงูุชุฑุงุถูุฉ
ุฅุฐุง ูุงูุช ุจุนุถ ุงูุจูุงูุงุช ููููุฏุฉ:
- ุงูุฅูุฌุงุฑ ุงูุดูุฑู ุงูุงูุชุฑุงุถู: 1500
- ุบุฑุงูุฉ ุงูุชุฃุฎูุฑ: 120 ููู ููู
- ุงูุญุฏ ุงูุฃูุตู ููุบุฑุงูุฉ: 3000
- ููู ุงูุฏูุน: ุงูููู ุงูุฃูู ูู ูู ุดูุฑ

## ๐ ุงูุชุญูู ูู ุงููุชุงุฆุฌ

ุจุนุฏ ุชุดุบูู ุงูุณูุฑูุจุชุ ุชุญูู ูู ุงูุจูุงูุงุช:

```sql
-- ุนุฏุฏ ุงูุนููุฏ ุงูุฌุฏูุฏุฉ
SELECT COUNT(*) as total_contracts
FROM rental_contracts
WHERE company_id = 'YOUR_COMPANY_ID';

-- ุงูุนููุฏ ุญุณุจ ุงูุญุงูุฉ
SELECT status, COUNT(*) as count
FROM rental_contracts
WHERE company_id = 'YOUR_COMPANY_ID'
GROUP BY status;

-- ุงูุนููุงุก ุงูุฌุฏุฏ
SELECT COUNT(*) as new_customers
FROM customers
WHERE company_id = 'YOUR_COMPANY_ID'
  AND created_at > NOW() - INTERVAL '1 hour';
```

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: "Cannot find module @supabase/supabase-js"
```bash
npm install @supabase/supabase-js
```

### ุฎุทุฃ: "VITE_SUPABASE_URL is not defined"
- ุชุฃูุฏ ูู ูุฌูุฏ ููู `.env`
- ุชุฃูุฏ ูู ุตุญุฉ ุงููุชุบูุฑุงุช

### ุฎุทุฃ: "Permission denied"
- ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู `Service Role Key` ูููุณ `anon key`
- ุชุฃูุฏ ูู ูุฌูุฏ ุตูุงุญูุงุช RLS ุนูู ุงูุฌุฏุงูู

### ุฎุทุฃ: "Foreign key violation"
- ุชุฃูุฏ ูู ูุฌูุฏ ุงููุฑูุจุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃููุงู
- ุชุฃูุฏ ูู ุตุญุฉ `COMPANY_ID`

## ๐ ุงูุชุฎุตูุต

### ุชุบููุฑ ุญุฌู ุงูุฏูุนุฉ
```typescript
const BATCH_SIZE = 20; // ุจุฏูุงู ูู 10
```

### ุชุบููุฑ ูุฏุฉ ุงูุนูุฏ
```typescript
// ูู ุฏุงูุฉ createOrUpdateContract
endDate.setFullYear(endDate.getFullYear() + 2); // ุณูุชุงู ุจุฏูุงู ูู ุณูุฉ
```

### ุชุนุฏูู ุงูููู ุงูุงูุชุฑุงุถูุฉ
```typescript
const DEFAULT_MONTHLY_RENT = 2000;
const DEFAULT_LATE_FEE = 150;
const DEFAULT_MAX_LATE_FEE = 4000;
```

## ๐ ุงูุฃูุงู

- **ูุง ุชุดุงุฑู** `Service Role Key` ูุน ุฃุญุฏ
- **ูุง ุชุถู** ููู `.env` ุฅูู Git
- ุชุฃูุฏ ูู `.gitignore` ูุญุชูู ุนูู `.env`

## โ ูุงุฆูุฉ ุงูุชุญูู

ูุจู ุงูุชุดุบูู:
- [ ] ุชุซุจูุช ุงูุญุฒู ุงููุทููุจุฉ
- [ ] ุฅูุดุงุก ููู `.env`
- [ ] ุชุญุฏูุซ `COMPANY_ID`
- [ ] ุงูุชุฃูุฏ ูู ูุฌูุฏ ููู JSON
- [ ] ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุฑูุจุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดุงูู:
1. ุชุญูู ูู ุณุฌูุงุช ุงูุฃุฎุทุงุก ูู ุงููููุณูู
2. ุชุฃูุฏ ูู ุฌููุน ุงููุชุทูุจุงุช ุงูุฃูููุฉ
3. ุฑุงุฌุน ูุณู ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุฃุนูุงู

