# مواصفات نظام إدارة تأجير العقارات

## نظرة عامة

نظام شامل لإدارة العقارات ومالكيها وعقود الإيجار والمدفوعات، مصمم للشركات العاملة في مجال العقارات والإيجار في الكويت.

---

## الوحدات الأساسية

### 1. وحدة العقارات (Properties Module)

#### أنواع العقارات المدعومة
- **السكنية**: شقة، فيلا، مبنى
- **التجارية**: مكتب، محل تجاري
- **الصناعية**: مستودع
- **الأراضي**: أراضي فارغة

#### حالات العقار
- **متاح للإيجار** (available)
- **مؤجر** (rented)
- **للبيع** (for_sale)
- **صيانة** (maintenance)
- **محجوز** (reserved)
- **مباع** (sold)

#### حالة العقار
- **ممتاز** (excellent)
- **جيد جداً** (very_good)
- **جيد** (good)
- **مقبول** (fair)
- **يحتاج تجديد** (needs_renovation)

#### البيانات المطلوبة لكل عقار

##### معلومات أساسية
- **كود العقار**: رقم تعريفي فريد
- **اسم العقار**: باللغتين العربية والإنجليزية
- **وصف العقار**: تفصيلي باللغتين
- **نوع العقار**: من الأنواع المحددة
- **حالة العقار**: من الحالات المحددة
- **حالة العقار**: من حالات الجودة المحددة

##### معلومات الموقع
- **العنوان**: باللغتين العربية والإنجليزية
- **رقم الطابق**: للشقق والمكاتب
- **الإحداثيات الجغرافية**: خط الطول والعرض

##### التفاصيل المادية
- **المساحة بالمتر المربع**: مطلوب
- **عدد الغرف**: للوحدات السكنية
- **عدد الحمامات**: للوحدات السكنية
- **عدد مواقف السيارات**: اختياري
- **إجمالي الطوابق**: للمباني والفلل

##### التفاصيل المالية
- **سعر الإيجار الشهري**: بالدينار الكويتي
- **سعر البيع**: للعقارات المعروضة للبيع
- **العملة**: افتراضياً الدينار الكويتي

##### معلومات إضافية
- **مفروش**: نعم/لا
- **المميزات**: قائمة بالمرافق المتاحة
- **الصور**: مجموعة من صور العقار
- **المستندات**: ملفات مرفقة

##### إدارة العقار
- **معرف المالك**: ربط بجدول ملاك العقارات
- **معرف المدير**: الموظف المسؤول عن العقار

---

### 2. وحدة ملاك العقارات (Property Owners)

#### البيانات المطلوبة لكل مالك

##### معلومات شخصية
- **كود المالك**: رقم تعريفي فريد
- **الاسم الكامل**: باللغتين العربية والإنجليزية
- **الرقم المدني**: مطلوب
- **رقم الهاتف**: للتواصل
- **البريد الإلكتروني**: اختياري
- **العنوان**: باللغتين العربية والإنجليزية

##### معلومات مالية
- **معرف الحساب المحاسبي**: ربط بنظام المحاسبة

##### معلومات النظام
- **تاريخ الإنشاء**: تلقائي
- **تاريخ التحديث**: تلقائي
- **نشط**: حالة المالك في النظام

#### العلاقات
- **العقارات**: قائمة العقارات المملوكة
- **إحصائيات**: عدد العقارات، الإيرادات، إلخ

---

### 3. وحدة عقود الإيجار (Property Contracts)

#### أنواع العقود
- **إيجار شهري**: دفع شهري
- **إيجار ربع سنوي**: دفع كل 3 أشهر
- **إيجار سنوي**: دفع سنوي

#### البيانات المطلوبة لكل عقد

##### معلومات أساسية
- **رقم العقد**: رقم تعريفي فريد
- **معرف العقار**: ربط بجدول العقارات
- **معرف المستأجر**: ربط بجدول العملاء
- **نوع العقد**: من الأنواع المحددة

##### تواريخ العقد
- **تاريخ بداية العقد**: مطلوب
- **تاريخ انتهاء العقد**: اختياري للعقود المفتوحة

##### التفاصيل المالية
- **مبلغ الإيجار**: الأساسي
- **مبلغ التأمين**: العربون المدفوع مقدماً
- **تأمين الضمان**: لتغطية الأضرار
- **مبلغ العمولة**: عمولة الوكالة
- **معدل الغرامة التأخيرية**: نسبة مئوية يومية

##### شروط العقد
- **الشروط**: تفصيلية باللغتين
- **تكرار الدفع**: شهري، ربع سنوي، سنوي
- **يوم الدفع**: اليوم المحدد من الشهر
- **فترة السماح**: عدد الأيام قبل تطبيق الغرامة
- **فترة التجديد**: بالأشهر

##### مسؤوليات وشروط إضافية
- **المرافق مشمولة**: كهرباء، ماء، إنترنت
- **مسؤولية الصيانة**: المالك، المستأجر، مشتركة
- **التأمين مطلوب**: نعم/لا
- **التجديد التلقائي**: نعم/لا
- **العملة**: افتراضياً الدينار الكويتي
- **ملاحظات**: معلومات إضافية

##### حالة العقد
- **مسودة**: تحت الإعداد
- **قيد المراجعة**: ينتظر الموافقة
- **نشط**: ساري المفعول
- **منتهي الصلاحية**: انتهت مدته
- **معلق**: متوقف مؤقتاً
- **ملغي**: تم إلغاؤه
- **مجدد**: تم تجديده

#### العلاقات
- **العقار**: تفاصيل العقار المؤجر
- **المستأجر**: معلومات المستأجر
- **المدفوعات**: قائمة المدفوعات المرتبطة

---

### 4. وحدة المستأجرين (Property Tenants)

#### البيانات المطلوبة لكل مستأجر

##### معلومات شخصية
- **كود المستأجر**: رقم تعريفي فريد
- **الاسم الكامل**: باللغتين العربية والإنجليزية
- **الرقم المدني**: مطلوب
- **رقم الهاتف**: للتواصل
- **البريد الإلكتروني**: اختياري
- **جهة اتصال طوارئ**: اسم ورقم

##### معلومات العمل
- **جهة العمل**: باللغتين
- **المسمى الوظيفي**: اختياري
- **الراتب الشهري**: لتقييم القدرة المالية

##### معلومات مالية
- **معرف الحساب المحاسبي**: ربط بنظام المحاسبة

#### العلاقات
- **العقود**: قائمة العقود المرتبطة بالمستأجر

---

### 5. وحدة المدفوعات (Property Payments)

#### أنواع المدفوعات
- **إيجار**: الدفع الشهري/الدوري
- **تأمين**: العربون المدفوع مقدماً
- **عمولة**: عمولة الوكالة
- **صيانة**: تكاليف الإصلاح
- **غرامة**: غرامات التأخير

#### حالات الدفع
- **معلق**: لم يحن موعد الدفع
- **مدفوع**: تم الدفع
- **متأخر**: تجاوز تاريخ الاستحقاق
- **ملغي**: تم إلغاء الدفع

#### طرق الدفع
- **نقداً**: دفع نقدي
- **تحويل بنكي**: عبر البنك
- **شيك**: شيك بنكي
- **بطاقة**: بطاقة ائتمان/خصم

#### البيانات المطلوبة لكل دفعة
- **رقم الدفعة**: رقم تعريفي فريد
- **معرف العقار**: ربط بالعقار
- **معرف العقد**: ربط بالعقد
- **معرف المستأجر**: ربط بالمستأجر
- **نوع الدفع**: من الأنواع المحددة
- **المبلغ**: قيمة الدفعة
- **تاريخ الاستحقاق**: موعد الدفع المطلوب
- **تاريخ الدفع الفعلي**: عند إتمام الدفع
- **حالة الدفع**: من الحالات المحددة
- **طريقة الدفع**: عند إتمام الدفع
- **رقم المرجع**: للتحويلات والشيكات
- **ملاحظات**: معلومات إضافية

---

## الميزات المتقدمة

### 1. نظام التنبيهات والإنذارات
- **انتهاء العقود**: تنبيه قبل انتهاء العقد
- **المدفوعات المتأخرة**: تنبيه عند تجاوز تاريخ الاستحقاق
- **العقارات الشاغرة**: تنبيه للعقارات غير المؤجرة
- **فرص التجديد**: تنبيه لعقود قابلة للتجديد
- **صيانة مطلوبة**: تنبيهات الصيانة الدورية
- **انتهاء المستندات**: تنبيه انتهاء صلاحية الوثائق

### 2. البحث والفلترة المتقدمة
- **البحث النصي**: في أسماء العقارات والأكواد
- **فلترة حسب النوع**: نوع العقار
- **فلترة حسب الحالة**: حالة العقار
- **فلترة حسب المنطقة**: الموقع الجغرافي
- **فلترة حسب السعر**: نطاق الأسعار
- **فلترة حسب المساحة**: نطاق المساحات
- **فلترة حسب المالك**: ملاك محددين
- **فلترة المفروش**: مفروش أو غير مفروش
- **فلترة المواقف**: وجود مواقف سيارات

### 3. إدارة الصور والمستندات
- **رفع متعدد**: رفع عدة صور دفعة واحدة
- **معاينة فورية**: عرض الصور قبل الحفظ
- **ترتيب الصور**: إعادة ترتيب بالسحب والإفلات
- **أنواع مستندات**: عقود، شهادات، تراخيص
- **صلاحية المستندات**: تتبع تواريخ الانتهاء

### 4. التكامل المحاسبي
- **الربط بنظام المحاسبة**: تكامل كامل مع القيود
- **إنشاء قيود تلقائية**: عند الدفع والإيجار
- **ربط الحسابات**: حسابات ملاك ومستأجرين
- **التقارير المالية**: تقارير الإيرادات والمصروفات

### 5. الإحصائيات والتقارير
- **إحصائيات عامة**: 
  - إجمالي العقارات
  - العقارات المتاحة والمؤجرة
  - العقارات المعروضة للبيع
  - العقارات تحت الصيانة
  
- **الإحصائيات المالية**:
  - إجمالي الإيجار الشهري
  - إجمالي الإيجار السنوي
  - نسبة الإشغال
  - متوسط الإيجار لكل متر مربع
  
- **إحصائيات تفصيلية**:
  - توزيع العقارات حسب النوع
  - توزيع العقارات حسب المنطقة

### 6. حسابات الغرامات المتقدمة
- **حساب ذكي للغرامات**: باستخدام الذكاء الاصطناعي
- **معدل يومي**: 120 دينار كويتي (قابل للتخصيص)
- **حد أقصى شهري**: 3000 دينار كويتي (قابل للتخصيص)
- **تتبع تاريخ المدفوعات**: لحساب فترات التأخير
- **توصيات ذكية**: اقتراحات لمعالجة التأخير

---

## قاعدة البيانات

### الجداول الأساسية

#### 1. properties (العقارات)
```sql
- id: uuid (المعرف الفريد)
- company_id: uuid (معرف الشركة)
- property_code: text (كود العقار)
- property_name: text (اسم العقار)
- property_name_ar: text (اسم العقار بالعربية)
- description: text (الوصف)
- description_ar: text (الوصف بالعربية)
- property_type: text (نوع العقار)
- property_status: text (حالة العقار)
- address: text (العنوان)
- address_ar: text (العنوان بالعربية)
- floor_number: integer (رقم الطابق)
- area_sqm: numeric (المساحة بالمتر المربع)
- bedrooms: integer (عدد الغرف)
- bathrooms: integer (عدد الحمامات)
- parking_spaces: integer (عدد مواقف السيارات)
- total_floors: integer (إجمالي الطوابق)
- rental_price: numeric (سعر الإيجار)
- sale_price: numeric (سعر البيع)
- currency: text (العملة)
- furnished: boolean (مفروش)
- features: jsonb (المميزات)
- location_coordinates: jsonb (الإحداثيات)
- images: text[] (الصور)
- documents: text[] (المستندات)
- owner_id: uuid (معرف المالك)
- manager_id: uuid (معرف المدير)
- created_at: timestamp (تاريخ الإنشاء)
- updated_at: timestamp (تاريخ التحديث)
- created_by: uuid (منشئ السجل)
- is_active: boolean (نشط)
```

#### 2. property_owners (ملاك العقارات)
```sql
- id: uuid (المعرف الفريد)
- company_id: uuid (معرف الشركة)
- owner_code: text (كود المالك)
- full_name: text (الاسم الكامل)
- full_name_ar: text (الاسم الكامل بالعربية)
- civil_id: text (الرقم المدني)
- phone: text (رقم الهاتف)
- email: text (البريد الإلكتروني)
- address: text (العنوان)
- address_ar: text (العنوان بالعربية)
- account_id: uuid (معرف الحساب المحاسبي)
- created_at: timestamp (تاريخ الإنشاء)
- updated_at: timestamp (تاريخ التحديث)
- is_active: boolean (نشط)
```

#### 3. property_contracts (عقود العقارات)
```sql
- id: uuid (المعرف الفريد)
- company_id: uuid (معرف الشركة)
- property_id: uuid (معرف العقار)
- tenant_id: uuid (معرف المستأجر)
- contract_number: text (رقم العقد)
- contract_type: text (نوع العقد)
- start_date: date (تاريخ البداية)
- end_date: date (تاريخ النهاية)
- rental_amount: numeric (مبلغ الإيجار)
- deposit_amount: numeric (مبلغ التأمين)
- security_deposit: numeric (تأمين الضمان)
- commission_amount: numeric (مبلغ العمولة)
- late_fee_rate: numeric (معدل الغرامة)
- terms: text (الشروط)
- terms_ar: text (الشروط بالعربية)
- payment_frequency: text (تكرار الدفع)
- payment_day: integer (يوم الدفع)
- grace_period_days: integer (فترة السماح)
- renewal_period: integer (فترة التجديد)
- status: text (حالة العقد)
- utilities_included: boolean (المرافق مشمولة)
- maintenance_responsibility: text (مسؤولية الصيانة)
- insurance_required: boolean (التأمين مطلوب)
- auto_renewal: boolean (التجديد التلقائي)
- currency: text (العملة)
- notes: text (ملاحظات)
- journal_entry_id: uuid (معرف القيد المحاسبي)
- account_id: uuid (معرف الحساب المحاسبي)
- created_at: timestamp (تاريخ الإنشاء)
- updated_at: timestamp (تاريخ التحديث)
- created_by: uuid (منشئ السجل)
- is_active: boolean (نشط)
```

#### 4. property_payments (مدفوعات العقارات)
```sql
- id: uuid (المعرف الفريد)
- company_id: uuid (معرف الشركة)
- property_contract_id: uuid (معرف عقد العقار)
- payment_number: text (رقم الدفعة)
- payment_type: text (نوع الدفع)
- amount: numeric (المبلغ)
- due_date: date (تاريخ الاستحقاق)
- payment_date: date (تاريخ الدفع)
- status: text (حالة الدفع)
- payment_method: text (طريقة الدفع)
- notes: text (ملاحظات)
- reference_number: text (رقم المرجع)
- journal_entry_id: uuid (معرف القيد المحاسبي)
- created_at: timestamp (تاريخ الإنشاء)
- updated_at: timestamp (تاريخ التحديث)
- created_by: uuid (منشئ السجل)
```

### جداول إضافية

#### 5. advanced_late_fee_calculations (حسابات الغرامات المتقدمة)
```sql
- id: uuid
- payment_id: uuid
- contract_id: uuid
- company_id: uuid
- daily_fine_rate: numeric (المعدل اليومي)
- monthly_cap_amount: numeric (الحد الأقصى الشهري)
- days_overdue: integer (أيام التأخير)
- months_overdue: integer (شهور التأخير)
- original_due_date: date (تاريخ الاستحقاق الأصلي)
- calculation_date: date (تاريخ الحساب)
- raw_daily_fine: numeric (الغرامة اليومية الخام)
- monthly_cap_applied: boolean (تطبيق الحد الأقصى)
- final_fine_amount: numeric (مبلغ الغرامة النهائي)
- ai_recommendations: text[] (توصيات الذكاء الاصطناعي)
- calculation_method: text (طريقة الحساب)
- monthly_breakdown: jsonb (تفصيل شهري)
- payment_history_summary: text (ملخص تاريخ المدفوعات)
- risk_level: text (مستوى المخاطر)
- calculated_by: uuid (محسوب بواسطة)
- created_at: timestamp
- updated_at: timestamp
```

---

## أمان البيانات

### سياسات الأمان على مستوى الصفوف (RLS)
- **العقارات**: المستخدمون يمكنهم رؤية عقارات شركتهم فقط
- **ملاك العقارات**: المستخدمون يمكنهم رؤية ملاك شركتهم فقط
- **العقود**: المستخدمون يمكنهم رؤية عقود شركتهم فقط
- **المدفوعات**: المستخدمون يمكنهم رؤية مدفوعات شركتهم فقط

### صلاحيات المستخدمين
- **المدير العام**: صلاحيات كاملة
- **مدير الشركة**: إدارة بيانات الشركة
- **مدير**: إدارة العقارات والعقود
- **وكيل مبيعات**: عرض وإدارة محدودة

---

## التقنيات المستخدمة

### الواجهة الأمامية
- **React**: مكتبة بناء واجهات المستخدم
- **TypeScript**: للبرمجة المحددة الأنواع
- **Tailwind CSS**: لتنسيق الواجهة
- **React Query**: لإدارة حالة البيانات
- **React Router**: للتنقل بين الصفحات
- **React Hook Form**: لإدارة النماذج
- **Lucide React**: للأيقونات

### قاعدة البيانات
- **Supabase**: قاعدة بيانات PostgreSQL مدارة
- **Row Level Security**: أمان على مستوى الصفوف
- **Real-time subscriptions**: التحديثات الفورية

### الميزات المتقدمة
- **تكامل مع نظام المحاسبة**: ربط كامل مع القيود والحسابات
- **حسابات غرامات ذكية**: باستخدام خوارزميات متقدمة
- **تنبيهات ذكية**: نظام تنبيهات شامل
- **تصدير وطباعة**: تقارير مفصلة

---

## خطة التطوير المستقبلية

### المرحلة الثانية
- **خريطة العقارات**: عرض العقارات على خريطة تفاعلية
- **تطبيق جوال**: للمستأجرين وملاك العقارات
- **نظام حجز**: حجز المعاينات والصيانة

### المرحلة الثالثة
- **ذكاء اصطناعي متقدم**: تقييم العقارات وتوقع الأسعار
- **تكامل مع البنوك**: ربط مباشر مع الحسابات البنكية
- **نظام CRM**: إدارة علاقات العملاء

---

## ملاحظات هامة

1. **اللغة**: النظام يدعم اللغتين العربية والإنجليزية
2. **العملة**: الدينار الكويتي هو العملة الافتراضية
3. **التوقيت**: جميع التواريخ مخزنة بالتوقيت المحلي
4. **الأكواد**: جميع أكواد العقارات والملاك فريدة على مستوى الشركة
5. **الحذف**: الحذف ناعم (soft delete) للحفاظ على سلامة البيانات
6. **الصلاحيات**: نظام صلاحيات متدرج حسب نوع المستخدم
7. **التدقيق**: جميع العمليات مسجلة لأغراض التدقيق
8. **النسخ الاحتياطية**: نظام نسخ احتياطي تلقائي

---

*تم إعداد هذا المستند بناءً على النظام الحالي المطور باستخدام React وSupabase*