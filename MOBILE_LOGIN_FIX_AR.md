# ุฅุตูุงุญ ูุดููุฉ ุชุณุฌูู ุงูุฏุฎูู ูู ุชุทุจูู ุงูุฌูุงู (APK)

## ุงููุดููุฉ ๐ด

ุนูุฏ ุชุซุจูุช ุชุทุจูู ุงูุฌูุงู (APK) ุนูู ุงููุงุชู:
- โ ุชุณุฌูู ุงูุฏุฎูู ููุฌุญ ูู ุงููุฑุฉ ุงูุฃููู
- โ ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู ููุชุญู ูุฑุฉ ุฃุฎุฑูุ ูุทูุจ ุชุณุฌูู ุงูุฏุฎูู ูุฌุฏุฏุงู
- โ ุงูู Session ูุง ูุชู ุญูุธูุง ุจุดูู ุฏุงุฆู

## ุงูุณุจุจ ุงูุฌุฐุฑู ๐

ุงููุดููุฉ ูุงูุช ูู `capacitorStorage.ts`:

### ูุจู ุงูุฅุตูุงุญ โ
```typescript
// ูุงู ูุณุชุฎุฏู prefix ูุฎุชูู ููููุงุชูุญ
const CACHE_PREFIX = '__capacitor_cache_';

getItem(key: string) {
  return localStorage.getItem(CACHE_PREFIX + key); // โ ุฎุทุฃ
}

// Supabase ูุจุญุซ ุนู: 'sb-alaraf-auth-token'
// ููู ุงูููุฏ ูุญูุธ: '__capacitor_cache_sb-alaraf-auth-token'
// ุงููุชูุฌุฉ: Supabase ูุง ูุฌุฏ ุงูู token!
```

### ุจุนุฏ ุงูุฅุตูุงุญ โ
```typescript
// ุชู ุฅุฒุงูุฉ ุงูู prefix ุชูุงูุงู
getItem(key: string) {
  return localStorage.getItem(key); // โ ุตุญูุญ
}

// ุงูุขู Supabase ูุฌุฏ ุงูู token ุจููุณ ุงูุงุณู ุงูุตุญูุญ
```

## ุงูุชุบููุฑุงุช ุงููุทุจูุฉ ๐๏ธ

### 1. ุฅุตูุงุญ `capacitorStorage.ts`
- โ ุฅุฒุงูุฉ `CACHE_PREFIX` ูู ุฌููุน ุงูุนูููุงุช
- โ ุงุณุชุฎุฏุงู ุฃุณูุงุก ุงูููุงุชูุญ ุงูุฃุตููุฉ (ุจุฏูู prefix)
- โ ุฅุถุงูุฉ `waitForSync()` ููุงูุชุธุงุฑ ุญุชู ุชุญููู ุงูุจูุงูุงุช
- โ ุชุญุณูู ุงูู logging ููุชุดุฎูุต

### 2. ุชุญุณูู `AuthContext.tsx`
- โ ุงูุชุธุงุฑ ุชุญููู ุงูุจูุงูุงุช ูู Capacitor Storage ูุจู ุงูุชุญูู ูู ุงูู token
- โ ุฅุถุงูุฉ logs ููุตูุฉ ููุชุทุจููุงุช ุงููุญูููุฉ
- โ ุงูุชุญูู ูู ูุฌูุฏ ุงูู token ูู localStorage ุจุนุฏ ุงูุชุญููู

### 3. ุชุญุณูู `MobileLogin.tsx`
- โ ุงูุชุญูู ูู ุญูุธ ุงูู Session ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
- โ ุฅุถุงูุฉ timeout ููุชุฃูุฏ ูู ุญูุธ ุงูุจูุงูุงุช
- โ ุชุญุณูู ุฑุณุงุฆู ุงูุฎุทุฃ

## ููููุฉ ุงูุงุฎุชุจุงุฑ ๐งช

### 1. ุจูุงุก APK ุฌุฏูุฏ
```bash
npm run build:mobile
npm run android:build
```

### 2. ุชุซุจูุช ุงูุชุทุจูู ุนูู ุงููุงุชู
```bash
adb install android/app/build/outputs/apk/release/app-release.apk
```

### 3. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู
1. ุงูุชุญ ุงูุชุทุจูู
2. ุณุฌู ุงูุฏุฎูู ุจุญุณุงุจ ุตุญูุญ
3. ุฃุบูู ุงูุชุทุจูู ุชูุงูุงู (ูู Recent Apps)
4. ุงูุชุญ ุงูุชุทุจูู ูุฑุฉ ุฃุฎุฑู
5. โ ูุฌุจ ุฃู ุชููู ูุณุฌู ุฏุฎูู ุชููุงุฆูุงู (ุจุฏูู ุทูุจ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู)

### 4. ูุญุต ุงูู Logs
ุงูุชุญ Chrome DevTools ููุชุทุจูู:
```bash
chrome://inspect/#devices
```

ุงุจุญุซ ุนู ูุฐู ุงูุฑุณุงุฆู:
```
โ [CapacitorStorage] Synced key: sb-alaraf-auth-token
โ [AUTH_CONTEXT] Storage sync complete
โ [AUTH_CONTEXT] Token check on native: { foundToken: true }
```

## ุงููุฑู ุงูุฃุณุงุณู ๐

### ูุจู ุงูุฅุตูุงุญ โ
```
Preferences (Native Storage):
  - sb-alaraf-auth-token: "eyJ..."

localStorage (Cache):
  - __capacitor_cache_sb-alaraf-auth-token: "eyJ..."  โ

Supabase ูุจุญุซ ุนู:
  - sb-alaraf-auth-token  โ ูุง ููุฌุฏ!
```

### ุจุนุฏ ุงูุฅุตูุงุญ โ
```
Preferences (Native Storage):
  - sb-alaraf-auth-token: "eyJ..."

localStorage (Cache):
  - sb-alaraf-auth-token: "eyJ..."  โ

Supabase ูุจุญุซ ุนู:
  - sb-alaraf-auth-token  โ ููุฌูุฏ!
```

## ููุงุญุธุงุช ูููุฉ ๐

1. **ุงูุชุทุจูู ุนูู ุงูููุจ**: ูุนูู ุจุดูู ุทุจูุนู (ูุณุชุฎุฏู localStorage ูุจุงุดุฑุฉ)
2. **ุงูุชุทุจูู ุงููุญููู**: ุงูุขู ูุนูู ุจุดูู ุตุญูุญ ูุน Capacitor Storage
3. **ุงูุฃูุงู**: ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ุจุดูู ุขูู ูู Preferences API
4. **ุงูุฃุฏุงุก**: ูุง ููุฌุฏ ุชุฃุซูุฑ ุนูู ุงูุฃุฏุงุก (ุงูุชุญููู ูุชู ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุจุฏุก ุงูุชุทุจูู)

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ๐ง

### ุฅุฐุง ูู ูุนูู ุชุณุฌูู ุงูุฏุฎูู:

1. **ุชุญูู ูู ุงูู Logs**:
   ```bash
   adb logcat | grep -i "capacitor\|auth"
   ```

2. **ุงูุณุญ ุงูุจูุงูุงุช**:
   ```bash
   adb shell pm clear com.alaraf.fleetify
   ```

3. **ุฃุนุฏ ุชุซุจูุช ุงูุชุทุจูู**:
   ```bash
   adb uninstall com.alaraf.fleetify
   adb install android/app/build/outputs/apk/release/app-release.apk
   ```

### ุฅุฐุง ูุงู ุงูู Session ููุชูู ุจุณุฑุนุฉ:

ุชุญูู ูู ุฅุนุฏุงุฏุงุช Supabase:
- Session timeout ูู Dashboard
- RLS policies ุนูู ุฌุฏูู profiles

## ุงูุฎูุงุตุฉ โจ

ุงููุดููุฉ ูุงูุช ุจุณูุทุฉ ููู ูููุฉ:
- **ุงูุณุจุจ**: ุงุณุชุฎุฏุงู prefix ูุฎุชูู ููููุงุชูุญ
- **ุงูุญู**: ุฅุฒุงูุฉ ุงูู prefix ูุงุณุชุฎุฏุงู ุฃุณูุงุก ุงูููุงุชูุญ ุงูุฃุตููุฉ
- **ุงููุชูุฌุฉ**: ุชุณุฌูู ุงูุฏุฎูู ูุนูู ุจุดูู ุฏุงุฆู ูู ุงูุชุทุจูู ุงููุญููู

ุงูุขู ุงูุชุทุจูู ูุนูู ุจุดูู ุตุญูุญ ุนูู:
- โ ุงูููุจ (Chrome, Firefox, Safari)
- โ Android (APK)
- โ iOS (IPA)
