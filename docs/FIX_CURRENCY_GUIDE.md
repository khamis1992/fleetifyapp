# ๐ง ุฏููู ุฅุตูุงุญ ุงูุนููุฉ - ุงูุฑูุงู ุงููุทุฑู (QAR)

## ๐ฏ ุงููุดููุฉ
ุงูุนููุฉ ุงูุฃุณุงุณูุฉ ูุดุฑูุฉ ุงูุนุฑุงู ูู ุงูุฑูุงู ุงููุทุฑู (QAR) ููู ุงููุธุงู ูุนุฑุถ ุนููุฉ ูุฎุชููุฉ ูู ุตูุญุฉ ุฏูุชุฑ ุงูุฃุณุชุงุฐ.

---

## โ ุงูุญู

ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจุงููุงูู! ุฅููู ูุง ุชู ุนููู:

### 1. ุชุญุฏูุซ ููู ุงููุนุงููุฉ HTML โ
ุชู ุชุญุฏูุซ ุฌููุน ุงููุจุงูุบ ูู `journal_entries_tab_1.html` ูู:
- โ `KWD` (ุงูุฏููุงุฑ ุงููููุชู - 3 ููุงุฒู ุนุดุฑูุฉ)
- โ `QAR` (ุงูุฑูุงู ุงููุทุฑู - 2 ููุงุฒู ุนุดุฑูุฉ)

**ุฃูุซูุฉ ุนูู ุงูุชุญุฏูุซ:**
```
ูุจู: 5,000.000 KWD
ุจุนุฏ: 5,000.00 QAR

ูุจู: 2,500.000 KWD  
ุจุนุฏ: 2,500.00 QAR
```

### 2. ุฅูุดุงุก ุณูุฑูุจุช SQL ูุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช โ
ุชู ุฅูุดุงุก ููู `scripts/fix-company-currency.sql` ูุชุญุฏูุซ ุงูุนููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### ุงูุทุฑููุฉ 1: ุชุญุฏูุซ ุงูุนููุฉ ูู Supabase Dashboard (ููุตู ุจูุง)

1. **ุงูุชุญ Supabase Dashboard**
   ```
   https://supabase.com/dashboard
   ```

2. **ุงุฐูุจ ุฅูู SQL Editor**
   - ุงุฎุชุฑ ูุดุฑูุนู
   - ุงุถุบุท ุนูู "SQL Editor" ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ

3. **ููุฐ ุงูุงุณุชุนูุงู ุงูุชุงูู:**
   ```sql
   -- ุชุญุฏูุซ ุดุฑูุฉ ุงูุนุฑุงู ููุฑูุงู ุงููุทุฑู
   UPDATE companies 
   SET currency = 'QAR'
   WHERE name_ar LIKE '%ุงูุนุฑุงู%' 
      OR name LIKE '%Arraf%'
      OR name LIKE '%Al-Arraf%';
   
   -- ุงูุชุญูู ูู ุงูุชุญุฏูุซ
   SELECT id, name, name_ar, currency 
   FROM companies 
   WHERE currency = 'QAR';
   ```

4. **ุงุถุบุท Run**

### ุงูุทุฑููุฉ 2: ุชุญุฏูุซ ุฌููุน ุงูุดุฑูุงุช (ุฅุฐุง ูุงูุช ุฌููุนูุง ุชุณุชุฎุฏู QAR)

```sql
-- ุชุญุฏูุซ ุฌููุน ุงูุดุฑูุงุช ููุฑูุงู ุงููุทุฑู
UPDATE companies SET currency = 'QAR';

-- ุงูุชุญูู
SELECT id, name, currency FROM companies;
```

### ุงูุทุฑููุฉ 3: ุชุญุฏูุซ ุดุฑูุฉ ูุนููุฉ ุจุงููุนุฑู (ID)

```sql
-- ุงุณุชุจุฏู COMPANY_ID ุจุงููุนุฑู ุงููุนูู ููุดุฑูุฉ
UPDATE companies 
SET currency = 'QAR' 
WHERE id = 'COMPANY_ID_HERE';
```

---

## ๐ ุงูุชุญูู ูู ูุฌุงุญ ุงูุชุญุฏูุซ

### 1. ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
-- ุนุฑุถ ุฌููุน ุงูุดุฑูุงุช ูุงูุนููุงุช
SELECT 
  id,
  name,
  name_ar,
  currency,
  created_at,
  updated_at
FROM companies
ORDER BY created_at DESC;
```

### 2. ูุญุต ุงูุชุทุจูู
1. ุดุบูู ุงูุชุทุจูู: `npm run dev`
2. ุงุฐูุจ ุฅูู: `http://localhost:5173/finance/ledger`
3. ูุฌุจ ุฃู ุชุฑู:
   - โ **QAR** ุจุฌุงูุจ ุฌููุน ุงููุจุงูุบ
   - โ **ููุฒูุชุงู ุนุดุฑูุชุงู** ููุท (ูุซุงู: 1,234.56 QAR)

---

## ๐ ูุนูููุงุช ุงูุนููุงุช ุงููุฏุนููุฉ

| ุงูุนููุฉ | ุงูุฑูุฒ | ุงูููุงุฒู ุงูุนุดุฑูุฉ | Locale |
|--------|------|-----------------|--------|
| **ุงูุฑูุงู ุงููุทุฑู** โญ | QAR | 2 | ar-QA |
| ุงูุฏููุงุฑ ุงููููุชู | KWD | 3 | ar-KW |
| ุงูุฑูุงู ุงูุณุนูุฏู | SAR | 2 | ar-SA |
| ุงูุฏุฑูู ุงูุฅูุงุฑุงุชู | AED | 2 | ar-AE |
| ุงูุฑูุงู ุงูุนูุงูู | OMR | 3 | ar-OM |
| ุงูุฏููุงุฑ ุงูุจุญุฑููู | BHD | 3 | ar-BH |
| ุงูุฏููุงุฑ ุงูุฃูุฑููู | USD | 2 | en-US |
| ุงูููุฑู | EUR | 2 | de-DE |

---

## ๐ง ููู ูุนูู ุงููุธุงู

### 1. ุฌูุจ ุงูุนููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```tsx
// ูู useCompanyCurrency.ts
const { data } = useQuery({
  queryKey: ["company-currency", companyId],
  queryFn: async () => {
    const { data } = await supabase
      .from("companies")
      .select("currency")
      .eq("id", companyId)
      .single();
    return { currency: data?.currency || "QAR" };
  }
});
```

### 2. ุชูุณูู ุงููุจุงูุบ
```tsx
// ูู EnhancedJournalEntriesTab.tsx
const { formatCurrency } = useCurrencyFormatter();

// ุนุฑุถ ุงููุจูุบ
{formatCurrency(entry.total_debit, { minimumFractionDigits: 2 })}
// ุงููุชูุฌุฉ: 5,000.00 QAR
```

### 3. ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ
ุฅุฐุง ูู ุชูู ุงูุนููุฉ ูุญุฏุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ุงููุธุงู ุณูุณุชุฎุฏู **QAR** ุงูุชุฑุงุถูุงู.

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ุงูููุงุฒู ุงูุนุดุฑูุฉ

**ุงูุฑูุงู ุงููุทุฑู (QAR):**
- โ ููุฒูุชุงู ุนุดุฑูุชุงู (2 decimal places)
- โ ูุซุงู: `1,234.56 QAR`
- โ **ููุณ** 3 ููุงุฒู: `1,234.567 QAR`

**ุงูุฏููุงุฑ ุงููููุชู (KWD):**
- โ ุซูุงุซ ููุงุฒู ุนุดุฑูุฉ (3 decimal places)
- โ ูุซุงู: `1,234.567 KWD`

### ุงูุชูุณูู ุงูุชููุงุฆู
ุงููุธุงู ูุชุนุฑู ุชููุงุฆูุงู ุนูู ุนุฏุฏ ุงูููุงุฒู ุงูุนุดุฑูุฉ ุงูููุงุณุจุฉ ููู ุนููุฉ ูู ุฎูุงู:
```tsx
// ูู currencyConfig.ts
const getCurrencyConfig = (currency: string) => {
  const configs = {
    QAR: { fractionDigits: 2 },
    KWD: { fractionDigits: 3 },
    SAR: { fractionDigits: 2 },
    // ...
  };
  return configs[currency] || { fractionDigits: 2 };
};
```

---

## ๐ฏ ูุชุงุฆุฌ ูุชููุนุฉ ุจุนุฏ ุงูุชุญุฏูุซ

### ูุจู ุงูุชุญุฏูุซ โ
```
ุฅุฌูุงูู ุงููุฏูู: 5,000.000 KWD
ุฅุฌูุงูู ุงูุฏุงุฆู: 5,000.000 KWD
```

### ุจุนุฏ ุงูุชุญุฏูุซ โ
```
ุฅุฌูุงูู ุงููุฏูู: 5,000.00 QAR
ุฅุฌูุงูู ุงูุฏุงุฆู: 5,000.00 QAR
```

---

## ๐ ุญู ุงููุดุงูู

### ุงููุดููุฉ: ูุง ุชุฒุงู ุงูุนููุฉ KWD
**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชูููุฐ SQL Update ุจูุฌุงุญ
2. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ (Ctrl+F5)
3. ุงูุณุญ ุงูู cache:
   ```tsx
   // ูู Console ุงููุชุตูุญ
   localStorage.clear();
   sessionStorage.clear();
   ```

### ุงููุดููุฉ: ุงูุนููุฉ undefined ุฃู null
**ุงูุญู:**
```sql
-- ุชุญุฏูุซ ุฌููุน ุงูุดุฑูุงุช ุงูุชู ููุณ ููุง ุนููุฉ
UPDATE companies 
SET currency = 'QAR' 
WHERE currency IS NULL 
   OR currency = '';
```

### ุงููุดููุฉ: ุงูุฎุทุฃ "currency not found"
**ุงูุญู:**
ุชุฃูุฏ ูู ุฃู ุนููุฏ `currency` ููุฌูุฏ ูู ุฌุฏูู `companies`:
```sql
-- ุฅุถุงูุฉ ุนููุฏ ุงูุนููุฉ ุฅุฐุง ูู ููู ููุฌูุฏุงู
ALTER TABLE companies 
ADD COLUMN IF NOT EXISTS currency VARCHAR(3) DEFAULT 'QAR';

-- ุชุญุฏูุซ ุฌููุน ุงูููู ุงููุงุฑุบุฉ
UPDATE companies 
SET currency = 'QAR' 
WHERE currency IS NULL;
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู

- [ ] ุชู ุชูููุฐ SQL Update ูู Supabase
- [ ] ุชู ุงูุชุญูู ูู ุฃู `currency = 'QAR'` ูู ุฌุฏูู companies
- [ ] ุชู ุฅุนุงุฏุฉ ุชุญููู ุงูุชุทุจูู
- [ ] ุงูุนููุฉ ุชุธูุฑ ูู QAR ูู ุตูุญุฉ ุฏูุชุฑ ุงูุฃุณุชุงุฐ
- [ ] ุงูููุงุฒู ุงูุนุดุฑูุฉ = 2 (ูููุณ 3)
- [ ] ุฌููุน ุงููุจุงูุบ ุชุนุฑุถ ุจุงูุฑูุงู ุงููุทุฑู

---

## ๐ ุงููููุงุช ุฐุงุช ุงูุนูุงูุฉ

```
fleetifyapp-3/
โโโ scripts/
โ   โโโ fix-company-currency.sql          โ ุณูุฑูุจุช ุงูุชุญุฏูุซ
โ
โโโ src/
โ   โโโ hooks/
โ   โ   โโโ useCompanyCurrency.ts         โ ุฌูุจ ุงูุนููุฉ
โ   โ   โโโ useCurrencyFormatter.ts       โ ุชูุณูู ุงูุนููุฉ
โ   โ
โ   โโโ utils/
โ   โ   โโโ currencyConfig.ts             โ ุฅุนุฏุงุฏุงุช ุงูุนููุงุช
โ   โ
โ   โโโ components/finance/
โ       โโโ EnhancedJournalEntriesTab.tsx โ ุนุฑุถ ุงููููุฏ
โ
โโโ .superdesign/design_iterations/
    โโโ journal_entries_tab_1.html        โ ูุนุงููุฉ ูุญุฏุซุฉ
```

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุจุนุฏ ุชุทุจูู ุงูุชุญุฏูุซุงุช:

โ **ุงูุนููุฉ ุงูุฃุณุงุณูุฉ:** ุงูุฑูุงู ุงููุทุฑู (QAR)  
โ **ุงูููุงุฒู ุงูุนุดุฑูุฉ:** 2 ููุท  
โ **ุงูุชูุณูู:** 1,234.56 QAR  
โ **ุฌููุน ุงูุตูุญุงุช:** ูุญุฏุซุฉ ุชููุงุฆูุงู  
โ **ููู ุงููุนุงููุฉ:** ูุญุฏุซ  

---

**ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจูุฌุงุญ! โจ**

**ุงูุชุงุฑูุฎ:** 29 ููุงูุฑ 2025  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุชุทุจูู

