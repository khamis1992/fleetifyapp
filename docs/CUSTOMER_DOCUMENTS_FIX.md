# ุฅุตูุงุญ ุฎุฏูุฉ ุฑูุน ุงููุณุชูุฏุงุช ููุนููุงุก
## Customer Documents Upload Fix

### ุงููุดููุฉ (Problem)
ุฎุฏูุฉ ุฑูุน ุงููุณุชูุฏุงุช ูู ุตูุญุฉ ุชูุงุตูู ุงูุนููู ูู ุชูู ุชุนูู ูุฃููุง ูุงูุช ูุฌุฑุฏ ูุงุฌูุฉ ูุณุชุฎุฏู ุจุฏูู ุฃู ูุธุงุฆู ูุนููุฉ.

The document upload service in the customer details page was not working because it was just a UI placeholder without any actual functionality.

---

### ุงูุญู (Solution)

ุชู ุชูููุฐ ุญู ุดุงูู ูุชุถูู:

1. **ุฅูุดุงุก ุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช** - `customer_documents` table
2. **ุฅูุดุงุก Hook ูุฎุตุต** - `useCustomerDocuments`
3. **ุชุญุฏูุซ ุตูุญุฉ ุชูุงุตูู ุงูุนููู** - CustomerDetailsPage

---

### ุงููููุงุช ุงูููุดุฃุฉ ูุงููุนุฏูุฉ (Files Created/Modified)

#### 1. ููู ุงูุชุฑุญูู (Database Migration)
๐ `supabase/migrations/20251102000000_create_customer_documents_table.sql`

ูููู ูุฐุง ุงูููู ุจู:
- ุฅูุดุงุก ุฌุฏูู `customer_documents`
- ุฅุถุงูุฉ ุงูููุงุฑุณ ููุฃุฏุงุก
- ุชูุนูู Row Level Security (RLS)
- ุฅูุดุงุก ุณูุงุณุงุช ุงูุฃูุงู
- ุฅูุดุงุก Storage Bucket ูููุณุชูุฏุงุช

**ุงูุฃุนูุฏุฉ ุงูุฑุฆูุณูุฉ:**
- `id` - ูุนุฑู ูุฑูุฏ
- `company_id` - ูุนุฑู ุงูุดุฑูุฉ
- `customer_id` - ูุนุฑู ุงูุนููู
- `document_type` - ููุน ุงููุณุชูุฏ (ูููุฉุ ุฑุฎุตุฉุ ุนูุฏุ ุฅูุฎ)
- `document_name` - ุงุณู ุงูููู
- `file_path` - ูุณุงุฑ ุงูููู ูู Storage
- `file_size` - ุญุฌู ุงูููู
- `mime_type` - ููุน ุงูููู
- `uploaded_by` - ุงููุณุชุฎุฏู ุงูุฐู ุฑูุน ุงูููู
- `notes` - ููุงุญุธุงุช ุงุฎุชูุงุฑูุฉ

#### 2. Hook ููุชุนุงูู ูุน ุงููุณุชูุฏุงุช
๐ `src/hooks/useCustomerDocuments.ts`

**Functions:**
- `useCustomerDocuments(customerId)` - ุฌูุจ ูุณุชูุฏุงุช ุงูุนููู
- `useUploadCustomerDocument()` - ุฑูุน ูุณุชูุฏ ุฌุฏูุฏ
- `useDeleteCustomerDocument()` - ุญุฐู ูุณุชูุฏ
- `useDownloadCustomerDocument()` - ุชุญููู ูุณุชูุฏ

**ููุฒุงุช ุงูุฃูุงู:**
- ุงูุชุญูู ูู ุงููุตุงุฏูุฉ
- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุดุฑูุฉ
- Rollback ุชููุงุฆู ูู ุญุงูุฉ ูุดู ุงูุฑูุน
- ุงูุชุญูู ูู ุญุฌู ุงูููู (ุญุฏ ุฃูุตู 10MB)

#### 3. ุชุญุฏูุซ ุตูุญุฉ ุชูุงุตูู ุงูุนููู
๐ `src/components/customers/CustomerDetailsPage.tsx`

**ุงูุชุญุณููุงุช:**
- ุฅุถุงูุฉ ูุงุฌูุฉ ุฑูุน ุงููุณุชูุฏุงุช ูุน ุงุฎุชูุงุฑ ููุน ุงููุณุชูุฏ
- ุนุฑุถ ูุงุฆูุฉ ุงููุณุชูุฏุงุช ุงููุฑููุนุฉ
- ุฃุฒุฑุงุฑ ุงูุชุญููู ูุงูุญุฐู ููู ูุณุชูุฏ
- ุญุงูุงุช ุงูุชุญููู ูุงูุฃุฎุทุงุก
- ุฑุณุงุฆู ูุฌุงุญ/ูุดู ุจุงููุบุฉ ุงูุนุฑุจูุฉ

---

### ุฎุทูุงุช ุงูุชุดุบูู (Setup Instructions)

#### 1. ุชุดุบูู ุงูุชุฑุญูู (Run Migration)

ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู ุฅูู Supabase:
```bash
npx supabase login
```

ุซู ูู ุจุชุดุบูู ุงูุชุฑุญูู:
```bash
npx supabase db push
```

ุฃู ุฅุฐุง ููุช ุชุณุชุฎุฏู Supabase Dashboard:
1. ุงูุชุญ Project > SQL Editor
2. ุงูุณุฎ ูุญุชูู ููู `20251102000000_create_customer_documents_table.sql`
3. ูู ุจุชุดุบูู SQL

#### 2. ุงูุชุญูู ูู Storage Bucket

ุชุฃูุฏ ูู ุฃู Bucket `customer-documents` ุชู ุฅูุดุงุคู:
1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู Storage
3. ุชุญูู ูู ูุฌูุฏ `customer-documents` bucket
4. ุฅุฐุง ูู ููู ููุฌูุฏุงูุ ูู ุจุฅูุดุงุฆู ูุฏููุงู

---

### ุฃููุงุน ุงููุณุชูุฏุงุช ุงููุฏุนููุฉ (Supported Document Types)

- **ุจุทุงูุฉ ุงููููุฉ** (Identity) - `identity`
- **ุฑุฎุตุฉ ุงูููุงุฏุฉ** (License) - `license`
- **ุนูุฏ** (Contract) - `contract`
- **ูุงุชูุฑุฉ** (Invoice) - `invoice`
- **ุฅูุตุงู** (Receipt) - `receipt`
- **ุชุฃููู** (Insurance) - `insurance`
- **ุฃุฎุฑู** (Other) - `other`

---

### ุตูุบ ุงููููุงุช ุงูููุจููุฉ (Accepted File Formats)

- PDF (`.pdf`)
- JPG/JPEG (`.jpg`, `.jpeg`)
- PNG (`.png`)
- DOC/DOCX (`.doc`, `.docx`)

**ุงูุญุฏ ุงูุฃูุตู ูุญุฌู ุงูููู:** 10 ููุฌุงุจุงูุช

---

### ุงูุงุณุชุฎุฏุงู (Usage)

1. ุงูุชุญ ุตูุญุฉ ุชูุงุตูู ุนููู
2. ุงุฐูุจ ุฅูู ุชุจููุจ "ุงููุณุชูุฏุงุช"
3. ุงุฎุชุฑ ููุน ุงููุณุชูุฏ ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
4. ุงุถุบุท ุนูู "ุงุฎุชุฑ ููู"
5. ุงุฎุชุฑ ุงูููู ูู ุฌูุงุฒู
6. ุณูุชู ุฑูุน ุงูููู ุชููุงุฆูุงู

**ูุญุฐู ูุณุชูุฏ:**
- ุงุถุบุท ุนูู ุฒุฑ "ุญุฐู" ุจุฌุงูุจ ุงููุณุชูุฏ
- ุฃูุฏ ุนูููุฉ ุงูุญุฐู

**ูุชุญููู ูุณุชูุฏ:**
- ุงุถุบุท ุนูู ุฒุฑ "ุชุญููู" ุจุฌุงูุจ ุงููุณุชูุฏ

---

### ุงูุฃูุงู (Security)

**Row Level Security (RLS):**
- ุงููุณุชุฎุฏููู ูููููู ููุท ุงููุตูู ุฅูู ูุณุชูุฏุงุช ุดุฑูุชูู
- ุฌููุน ุงูุนูููุงุช (ูุฑุงุกุฉุ ูุชุงุจุฉุ ุชุญุฏูุซุ ุญุฐู) ูุญููุฉ ุจู RLS

**Storage Policies:**
- ุงููุตูู ูุญุฏูุฏ ูููุณุชุฎุฏููู ุงููุตุงุฏู ุนูููู ููุท
- ูู ูุณุชุฎุฏู ููููู ููุท ุงููุตูู ุฅูู ูููุงุช ุดุฑูุชู

**Validation:**
- ุงูุชุญูู ูู ุญุฌู ุงูููู (ุญุฏ ุฃูุตู 10MB)
- ุงูุชุญูู ูู ููุน ุงูููู
- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู

---

### Rollback ูู ุญุงูุฉ ูุดู ุงูุฑูุน

ุนูููุฉ ุงูุฑูุน ุชุชุจุน ุงุณุชุฑุงุชูุฌูุฉ Database-First:

1. ุฅูุดุงุก ุณุฌู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃููุงู
2. ุฑูุน ุงูููู ุฅูู Storage
3. ุชุญุฏูุซ ุงูุณุฌู ุจูุณุงุฑ ุงูููู

**ูู ุญุงูุฉ ุงููุดู:**
- ุฅุฐุง ูุดู ุฑูุน ุงูููู โ ุญุฐู ุณุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅุฐุง ูุดู ุชุญุฏูุซ ุงูุณุฌู โ ุญุฐู ุงูููู ูุณุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช

ูุฐุง ูุถูู ุนุฏู ูุฌูุฏ ุจูุงูุงุช ูุชููุฉ (orphaned data).

---

### ุงูุงุฎุชุจุงุฑ (Testing)

**ุงุฎุชุจุงุฑ ุฃุณุงุณู:**
1. ุงูุชุญ ุตูุญุฉ ุชูุงุตูู ุนููู
2. ุญุงูู ุฑูุน ูุณุชูุฏ
3. ุชุญูู ูู ุธููุฑ ุงููุณุชูุฏ ูู ุงููุงุฆูุฉ
4. ุญุงูู ุชุญููู ุงููุณุชูุฏ
5. ุญุงูู ุญุฐู ุงููุณุชูุฏ

**ุงุฎุชุจุงุฑ ุญุฏูุฏ ุงูุญุฌู:**
1. ุญุงูู ุฑูุน ููู ุฃูุจุฑ ูู 10MB
2. ูุฌุจ ุฃู ุชุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ

**ุงุฎุชุจุงุฑ ุงูุตูุบ:**
1. ุญุงูู ุฑูุน ููู ุบูุฑ ูุฏุนูู
2. ูุฌุจ ุฃู ูุฑูุถ ุงููุชุตูุญ ุงูููู

---

### ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ ูุญููููุง (Common Issues)

**1. ุฎุทุฃ "ูุนุฑู ุงูุดุฑูุฉ ููููุฏ"**
- ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู
- ุชุญูู ูู ูุฌูุฏ company_id ูู ุฌุฏูู profiles

**2. ุฎุทุฃ "ูุดู ุฑูุน ุงูููู"**
- ุชุญูู ูู ูุฌูุฏ Storage Bucket
- ุชุญูู ูู Storage Policies
- ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช

**3. ุงููุณุชูุฏุงุช ูุง ุชุธูุฑ**
- ุชุญูู ูู RLS Policies
- ุชุญูู ูู company_id ูู ุฌุฏูู customer_documents
- ุงูุชุญ Console ูุฑุคูุฉ ุงูุฃุฎุทุงุก

**4. ุฎุทุฃ "ุญุฌู ุงูููู ูุจูุฑ ุฌุฏุงู"**
- ุงุณุชุฎุฏู ููู ุฃุตุบุฑ ูู 10MB
- ุฃู ูู ุจุถุบุท ุงูููู

---

### ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ (Future Enhancements)

- [ ] ูุนุงููุฉ ุงููุณุชูุฏุงุช ูุจู ุงูุชุญููู
- [ ] ุฏุนู ุงูุณุญุจ ูุงูุฅููุงุช (Drag & Drop)
- [ ] ุฑูุน ูููุงุช ูุชุนุฏุฏุฉ ุฏูุนุฉ ูุงุญุฏุฉ
- [ ] ุชุตููู ุงููุณุชูุฏุงุช ุจูุฌูุฏุงุช
- [ ] ุงูุจุญุซ ูู ุงููุณุชูุฏุงุช
- [ ] ุชูููุนุงุช ุฅููุชุฑูููุฉ
- [ ] ุชุงุฑูุฎ ุงูุชูุงุก ุงููุณุชูุฏุงุช ูุงูุชูุจููุงุช
- [ ] ูุดุงุฑูุฉ ุงููุณุชูุฏุงุช ูุน ุงูุนููุงุก

---

### ุงูููุงุญุธุงุช ุงููููุฉ (Technical Notes)

**Performance:**
- ุงููููุงุช ุชูุฎุฒู ูู Supabase Storage (CDN-backed)
- ุงูุงุณุชุนูุงูุงุช ูุญุณููุฉ ูุน ุงูููุงุฑุณ
- lazy loading ูููุณุชูุฏุงุช

**Database Structure:**
- ุงูุฌุฏูู ูุชูุงูู ูุน ุจุงูู ุงูุฌุฏุงูู ูู ุงููุธุงู
- ุงุณุชุฎุฏุงู UUID ูููุนุฑูุงุช ุงููุฑูุฏุฉ
- ุงูุชูุงุฑูุฎ ุจุตูุบุฉ TIMESTAMPTZ

**React Patterns:**
- ุงุณุชุฎุฏุงู React Query ููุชุฎุฒูู ุงููุคูุช
- Optimistic updates ููุญุฐู
- Error boundaries ููุฃุฎุทุงุก

---

### ุงูุฏุนู (Support)

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงููุ ุชุญูู ูู:
1. Console logs ูู ุงููุชุตูุญ
2. Supabase logs ูู Dashboard
3. Network tab ูู Developer Tools

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2 ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุฅูุชุงุฌ

