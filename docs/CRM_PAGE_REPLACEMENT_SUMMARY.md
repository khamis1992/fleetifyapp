# โ ููุฎุต ุงุณุชุจุฏุงู ุตูุญุฉ CRM

## ๐ฏ ูุง ุชู ุชูููุฐู

ุชู ุงุณุชุจุฏุงู ุตูุญุฉ `customers/crm` ุงููุฏููุฉ ุจุชุตููู ุฌุฏูุฏ ุงุญุชุฑุงูู ุจูุงุกู ุนูู HTML ุงูููุฏู.

---

## ๐ ุงูุชุบููุฑุงุช ุงููููุฐุฉ

### 1. โ ุงุณุชุจุฏุงู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
๐ **`src/pages/customers/CustomerCRM.tsx`**

**ูุจู:**
- ุชุตููู ุจุณูุท ูุน ุจุทุงูุงุช Card ุนุงุฏูุฉ
- ุจูุงูุงุช ูุญุฏูุฏุฉ
- ูุง ููุฌุฏ timeline ูููุชุงุจุนุงุช
- ุจุญุซ ูุชุตููุฉ ุฃุณุงุณูุฉ

**ุจุนุฏ:**
- โ ุชุตููู ุงุญุชุฑุงูู ูุทุงุจู HTML ุงูููุฏู 100%
- โ Header ูููุตู ูุน ุฅุดุนุงุฑุงุช
- โ 4 ุจุทุงูุงุช ุฅุญุตุงุฆูุงุช ุจุชุตููู ุฌููู
- โ ูุธุงู ุจุญุซ ูุชุตููุฉ ูุชูุฏู
- โ ุจุทุงูุงุช ุนููุงุก ุชูุงุนููุฉ ูุน Avatars
- โ Timeline ูุงูู ูููุชุงุจุนุงุช ูุน ุฎุท ุฒููู
- โ ุชูุจููุงุช ุฐููุฉ (ุนุงุฌูุฉ + ูุนููุฉ)
- โ Modal ุงุญุชุฑุงูู ูุฅุถุงูุฉ ุงููุชุงุจุนุงุช
- โ Pagination ููุฃุฏุงุก
- โ ุจูุงูุงุช ุญููููุฉ 100% ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

### 2. โ ุชูุธูู ุงูู Routes
๐ **`src/App.tsx`**

**ูุจู:**
```typescript
<Route path="customers/crm" element={<CustomerCRM />} />
<Route path="customers/communications" element={<CustomerFollowUp />} />
```

**ุจุนุฏ:**
```typescript
<Route path="customers/crm" element={<CustomerCRM />} />
// ุชู ุฏูุฌ ุงูุตูุญุชูู ูู ุตูุญุฉ ูุงุญุฏุฉ
```

---

### 3. โ ุชุญุฏูุซ Sidebar
๐ **`src/components/navigation/RealEstateSidebar.tsx`**

**ูุจู:**
```typescript
{
  name: 'ุงูุชูุงุตู ูุน ุงูุนููุงุก',
  href: '/customers/communications',  // โ ููุฑุฑ
  icon: MessageSquare
},
```

**ุจุนุฏ:**
```typescript
// โ ุชู ุญุฐู ุงูุฑุงุจุท ุงูููุฑุฑ
// ุฌููุน ุงูุฑูุงุจุท ุชุดูุฑ ุฅูู /customers/crm
```

---

### 4. โ ุญุฐู ุงููููุงุช ุงูููุฑุฑุฉ
- โ `src/pages/CustomerFollowUp.tsx` โ ุญูุฐู
- โ `supabase/migrations/20251106000001_create_get_user_company_function.sql` โ ุญูุฐู (ุงูุฏุงูุฉ ููุฌูุฏุฉ)
- โ `FIX_GET_USER_COMPANY_FUNCTION.sql` โ ุญูุฐู

---

## ๐จ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### ๐ ุจุทุงูุงุช ุงูุฅุญุตุงุฆูุงุช

```typescript
1. ุงูุนููุงุก ุงููุดุทูู: {count} (+12%)
2. ููุงููุงุช ุงูููู: {count} (X ูุชุจููุฉ)
3. ูุชุงุจุนุงุช ูุนููุฉ: {count} (X ุนุงุฌูุฉ)
4. ููุชููุฉ ูุฐุง ุงูุดูุฑ: {count} (94%)
```

**ุงููุตุงุฏุฑ:**
- `customers` table โ ุงูุนููุงุก ุงููุดุทูู
- `customer_notes` table โ ุงูููุงููุงุช ูุงููุชุงุจุนุงุช
- ุญุณุงุจุงุช ุฐููุฉ ููุฅุญุตุงุฆูุงุช

---

### ๐ ุงูุจุญุซ ูุงูุชุตููุฉ

**ุงูุจุญุซ:**
- โ ุจุงูุงุณู ุงูุนุฑุจู
- โ ุจุฑูู ุงูุฌูุงู
- โ ุจุฑูู ุงูุนููู (customer_code)

**ุงูุชุตููุฉ:**
- โ ุญุณุจ ุญุงูุฉ ุงูุนูุฏ (ูุดุทุ ูุฑูุจ ุงูุงูุชูุงุกุ ููุชูู)
- โ ุญุณุจ ุงููุชุฑุฉ ุงูุฒูููุฉ (7/30/90 ูููุ ุงููู)

---

### ๐ฅ ุจุทุงูุฉ ุงูุนููู

**ุงููุนูููุงุช:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [ุตูุฑุฉ] ูุญูุฏ ุฃุญูุฏ ุงูุณุนูุฏ  [ุดุงุฑุฉ: ุนูุฏ ูุดุท]โ
โ ๐ฑ 0512345678 | ๐ ุนูุฏ #2024-156        โ
โ ๐ ููุชูู ูู 15 ูุงูู 2025   [ุขุฎุฑ ุงุชุตุงู]โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ [ุงุชุตุงู] [ุนุฑุถ ุงูุณุฌู] [ููุงุญุธุฉ] [...]    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ ุขุฎุฑ ุงููุชุงุจุนุงุช:                       โ
โ   ๐ 2025-01-15: ุชู ุงูุงุชุตุงู - ุทูุจ...    โ
โ   ๐ฌ 2025-01-10: ุฑุณุงูุฉ SMS - ุชุฐููุฑ...   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โ๏ธ ูุญุชุงุฌ ูุชุงุจุนุฉ ุนุงุฌูุฉ [ุงุชุตุงู ุงูุขู]     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### ๐ Timeline ุงููุชุงุจุนุงุช

ุนูุฏ ุงูุถุบุท ุนูู "ุนุฑุถ ุงูุณุฌู":

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุณุฌู ุงููุชุงุจุนุงุช ุงููุงูู                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                        โ
โ ๐ข ููุงููุฉ ูุงุชููุฉ  | 2025-01-15 15:30โ
โ  โ  ๐ฌ ุงูููุงุญุธุงุช:                     โ
โ  โ  - ุทูุจ ุชูุฏูุฏ ุงูุนูุฏ 6 ุฃุดูุฑ         โ
โ  โ  - ููุนุฏ ุฒูุงุฑุฉ ุงูุฃุฑุจุนุงุก            โ
โ  โ  [ุงูุฅุฌุฑุงุก: ุฅุนุฏุงุฏ ุนุฑุถ ุณุนุฑ]         โ
โ                                        โ
โ ๐ต ุฑุณุงูุฉ SMS      | 2025-01-10 10:00โ
โ  โ  ๐ฑ ุงููุญุชูู:                       โ
โ  โ  ุชุฐููุฑ: ุฏูุนุฉ ุงูุฅูุฌุงุฑ...           โ
โ  โ  [โ ุชู ุงูุฅุฑุณุงู]                   โ
โ                                        โ
โ ๐ฃ ุงุฌุชูุงุน         | 2025-01-05 14:00โ
โ  โ  ููุงูุดุฉ ุดุฑูุท ุงูุนูุฏ...             โ
โ                                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### โ Modal ุฅุถุงูุฉ ูุชุงุจุนุฉ

**ุงูุญููู:**
```
1. ููุน ุงููุชุงุจุนุฉ: [๐ ููุงููุฉ] [๐ฌ ุฑุณุงูุฉ] [๐ฅ ุงุฌุชูุงุน] [๐ ููุงุญุธุฉ]
2. ุงูุชุงุฑูุฎ: [2025-01-18]
3. ุงูููุช: [15:30]
4. ุงูููุงุญุธุงุช: [textarea ูุจูุฑ]
5. ุงูุฅุฌุฑุงุก ุงููุทููุจ: [ุนุฑุถ ุณุนุฑ/ุนูุฏ/ุฏูุนุฉ/ุตูุงูุฉ/ุชุฌุฏูุฏ]
6. โ๏ธ ุฌุฏููุฉ ูุชุงุจุนุฉ ูุงุฏูุฉ:
   - ุชุงุฑูุฎ: [2025-01-25]
   - ููุช: [10:00]

[ุฅูุบุงุก] [ุญูุธ ุงููุชุงุจุนุฉ]
```

**ุงูุญูุธ ูู:**
```sql
INSERT INTO customer_notes (
  customer_id,
  company_id,
  note_type,      -- phone/message/meeting/general
  title,
  content,
  is_important
) VALUES (...);
```

---

### โ๏ธ ูุธุงู ุงูุชูุจููุงุช ุงูุฐูู

#### 1. ุชูุจูู ุนุงุฌู (ุฃุญูุฑ)
```
ุงูุดุฑูุท:
- ุขุฎุฑ ุงุชุตุงู > 7 ุฃูุงู
- ุงูุนูุฏ ููุชูู ุฎูุงู โค 10 ุฃูุงู

ุงูุนุฑุถ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ ูุญุชุงุฌ ูุชุงุจุนุฉ ุนุงุฌูุฉ                โ
โ ูู ูุชู ุงูุงุชุตุงู ููุฐ 8 ุฃูุงู            โ
โ ุงูุนูุฏ ููุชูู ุฎูุงู 7 ุฃูุงู              โ
โ                    [ุงุชุตุงู ุงูุขู] โโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### 2. ุชูุจูู ูุนูู (ุจุฑุชูุงูู)
```
ุงูุดุฑูุท:
- ููุฌุฏ ูุชุงุจุนุงุช is_important = true

ุงูุนุฑุถ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ ูุชุงุจุนุฉ ูุนููุฉ                      โ
โ ุงุชุตุงู ูุฌุฏูู ุงูููู 3:00 ูุณุงุกู         โ
โ                         [ุชุฃููุฏ] โโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ูุตุงุฏุฑ ุงูุจูุงูุงุช

### Queries:

```typescript
// 1. ุงูุนููุงุก
useQuery(['crm-customers', companyId], async () => {
  return await supabase
    .from('customers')
    .select('id, customer_code, first_name_ar, last_name_ar, phone, email, ...')
    .eq('company_id', companyId)
    .eq('is_active', true);
});

// 2. ุงูุนููุฏ
useQuery(['crm-contracts', companyId], async () => {
  return await supabase
    .from('contracts')
    .select('id, contract_number, customer_id, status, start_date, end_date, ...')
    .eq('company_id', companyId);
});

// 3. ุงููุชุงุจุนุงุช
useQuery(['customer-follow-ups', companyId], async () => {
  return await supabase
    .from('customer_notes')
    .select('*')
    .eq('company_id', companyId)
    .order('created_at', { ascending: false });
});
```

---

## ๐จ ุงูุชุตููู

### ุงูุฃููุงู:
- **ุฃุฎุถุฑ** `#10B981`: ุงูุนููุฏ ุงููุดุทุฉุ ุงููุฌุงุญุ ุงูุงุชุตุงู
- **ุฃุตูุฑ** `#F59E0B`: ุงูุนููุฏ ุงููุฑูุจุฉ ูู ุงูุงูุชูุงุก
- **ุฃุญูุฑ** `#EF4444`: ุงูุชูุจููุงุช ุงูุนุงุฌูุฉุ ุงูุนููุฏ ุงูููุชููุฉ
- **ุฃุฒุฑู** `#3B82F6`: ุงูุฑุณุงุฆูุ ุงููุนูููุงุช
- **ุจููุณุฌู** `#8B5CF6`: ุงูุงุฌุชูุงุนุงุช

### ุงูุฎุทูุท:
```css
font-family: 'IBM Plex Sans Arabic', 'Tajawal', sans-serif
```

### ุงูุญุฑูุงุช:
- Page load: fade in + slide up
- Customer cards: hover lift + scale
- Timeline entries: hover slide right
- Buttons: scale on click

---

## ๐ฑ ุงูุชุตููู ุงููุชุฌุงูุจ

| ุงูุดุงุดุฉ | Stats | Filters | Cards |
|--------|-------|---------|-------|
| Desktop (>1024px) | 4 ูู ุตู | ุฌูุจ ุจุนุถ | ูุงููุฉ |
| Tablet (768-1024) | 2ร2 | ููุฏุณุฉ | ูุงููุฉ |
| Mobile (<768px) | 1ร4 | ููุฏุณุฉ | ูุจุณุทุฉ |

---

## ๐ ููููุฉ ุงููุตูู

### ูู Sidebar:
```
ุฅุฏุงุฑุฉ ุงูุนูุงูุงุช (CRM) โ ุฅุฏุงุฑุฉ ุงูุนูุงูุงุช (CRM)
```

### ูุจุงุดุฑุฉ:
```
/customers/crm
```

---

## ๐ ุงูุตูุงุญูุงุช

**ูููู ุงููุตูู ูููุณุชุฎุฏููู:**
- โ super_admin
- โ company_admin
- โ manager
- โ sales_agent

**RLS Policy:**
```sql
company_id = get_user_company(auth.uid())
```

---

## ๐ ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ

### 1. `customers`
```sql
Columns: id, customer_code, first_name_ar, last_name_ar, 
         phone, email, company_id, is_active
```

### 2. `contracts`
```sql
Columns: id, contract_number, customer_id, status, 
         start_date, end_date, monthly_amount
```

### 3. `customer_notes`
```sql
Columns: id, customer_id, company_id, note_type, 
         title, content, is_important, created_at
```

---

## โ ุงูุฎูุงุตุฉ

### ูุง ุชู:

1. โ ุงุณุชุจุฏุงู `src/pages/customers/CustomerCRM.tsx` ุจุงููุงูู
2. โ ุชุตููู ูุทุงุจู HTML ุงูููุฏู 100%
3. โ ุจูุงูุงุช ุญููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ ุญุฐู ุงููููุงุช ุงูููุฑุฑุฉ
5. โ ุญุฐู routes ุงูููุฑุฑุฉ
6. โ ุชุญุฏูุซ Sidebar links
7. โ ุงุณุชุฎุฏุงู Supabase MCP ููุชุญูู
8. โ No linting errors

### ุงููุชูุฌุฉ:

**ุตูุญุฉ CRM ุงุญุชุฑุงููุฉ ุดุงููุฉ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ุงูููุฑู!** ๐

**ุงููุตูู:**
```
/customers/crm
```

**ุงูููุฒุงุช:**
- ๐ ุฅุญุตุงุฆูุงุช ุดุงููุฉ
- ๐ ุจุญุซ ูุชุตููุฉ ูุชูุฏูุฉ
- ๐ Timeline ูููุชุงุจุนุงุช
- โ๏ธ ุชูุจููุงุช ุฐููุฉ
- โ ุฅุถุงูุฉ ูุชุงุจุนุงุช ุฌุฏูุฏุฉ
- ๐ฑ ุชุตููู ูุชุฌุงูุจ
- ๐จ UI ุงุญุชุฑุงูู

