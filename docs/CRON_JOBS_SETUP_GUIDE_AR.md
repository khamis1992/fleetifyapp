# โ๏ธ ุฅุนุฏุงุฏ ุงูููุงู ุงููุฌุฏููุฉ ุงูุชููุงุฆูุฉ (Cron Jobs)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ููู SQL ุฌุงูุฒ ููุชูููุฐ ูุญุชูู ุนูู ุฌููุน ุงูููุงู ุงููุฌุฏููุฉ ุงููุทููุจุฉ ูุถูุงู ุนูู ุงููุธุงู ุชููุงุฆูุงู.

## ๐ ุงูููู

**ุงููููุน:** `supabase/migrations/20250127000000_setup_automatic_cron_jobs.sql`

## โ ูุง ูุญุชููู ุงูููู

### 1๏ธโฃ **ุฅูุดุงุก ุงูููุงุชูุฑ ุงูุดูุฑูุฉ**
- **ุงูุชูููุช:** ููู 28 ูู ูู ุดูุฑ ูู ุงูุณุงุนุฉ 9:00 ุตุจุงุญุงู
- **ุงููุธููุฉ:** `run_monthly_invoice_generation()`
- **ุงูุบุฑุถ:** ุฅูุดุงุก ููุงุชูุฑ ูุฌููุน ุงูุนููุฏ ุงููุดุทุฉ ููุดูุฑ ุงููุงุฏู (ุชุงุฑูุฎ ุงูุงุณุชุญูุงู: ููู 1)

### 2๏ธโฃ **ุชุฐููุฑุงุช ุงูุฏูุน ุงูููููุฉ**
- **ุงูุชูููุช:** ููููุงู ูู ุงูุณุงุนุฉ 9:00 ุตุจุงุญุงู
- **ุงููุธููุฉ:** `check_payment_reminders()`
- **ุงูุบุฑุถ:** ุงูุชุญูู ูู ุงูุชุฐููุฑุงุช ุงููุนููุฉ ูุฅุฑุณุงููุง ููุนููุงุก (4 ูุฑุงุญู: -3 ุฃูุงูุ ููู ุงูุงุณุชุญูุงูุ +3 ุฃูุงูุ +10 ุฃูุงู)

### 3๏ธโฃ **ูุนุงูุฌุฉ ุงูููุงุชูุฑ ุงููุชุฃุฎุฑุฉ**
- **ุงูุชูููุช:** ููููุงู ูู ุงูุณุงุนุฉ 9:00 ุตุจุงุญุงู
- **ุงููุธููุฉ:** `process_overdue_invoices()`
- **ุงูุบุฑุถ:** ุญุณุงุจ ูุชุทุจูู ุงูุบุฑุงูุงุช ุนูู ุงูููุงุชูุฑ ุงููุชุฃุฎุฑุฉ

## ๐ ุฎุทูุงุช ุงูุชูููุฐ

### ุงูุฎุทูุฉ 1: ูุชุญ Supabase Dashboard
1. ุณุฌู ุงูุฏุฎูู ุฅูู [Supabase Dashboard](https://app.supabase.com)
2. ุงุฎุชุฑ ุงููุดุฑูุน ุงูุฎุงุต ุจู

### ุงูุฎุทูุฉ 2: ุชูุนูู Extension (ุฅุฐุง ูู ููู ููุนูุงู)
1. ุงุฐูุจ ุฅูู **Database** โ **Extensions**
2. ุงุจุญุซ ุนู `pg_cron`
3. ุฅุฐุง ูู ููู ููุนูุงูุ ุงุถุบุท ุนูู **Enable**

### ุงูุฎุทูุฉ 3: ุชูููุฐ ุงูููู
1. ุงุฐูุจ ุฅูู **SQL Editor**
2. ุงูุณุฎ ูุญุชูู ุงูููู: `supabase/migrations/20250127000000_setup_automatic_cron_jobs.sql`
3. ุงูุตู ุงููุญุชูู ูู SQL Editor
4. ุงุถุบุท ุนูู **Run** ุฃู **Execute**

### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงููุฌุงุญ
ุจุนุฏ ุงูุชูููุฐุ ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ูุฌุงุญ ุชุดูุฑ ุฅูู ุฃู ุงูููุงู ุชู ุฌุฏููุชูุง ุจูุฌุงุญ.

## ๐งช ุงูุงุฎุชุจุงุฑ ุงููุฏูู

ููููู ุงุฎุชุจุงุฑ ุงููุธุงุฆู ูุฏููุงู ูุจู ุงูุงูุชุธุงุฑ ููููุงุนูุฏ ุงููุฌุฏููุฉ:

### ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงูููุงุชูุฑ ุงูุดูุฑูุฉ:
```sql
SELECT * FROM run_monthly_invoice_generation();
```

### ุงุฎุชุจุงุฑ ุงูุชุฐููุฑุงุช:
```sql
SELECT * FROM check_payment_reminders();
```

### ุงุฎุชุจุงุฑ ูุนุงูุฌุฉ ุงููุชุฃุฎุฑุงุช:
```sql
SELECT * FROM process_overdue_invoices();
```

## ๐ ุงูุชุญูู ูู ุงูููุงู ุงููุฌุฏููุฉ

ูุฑุคูุฉ ุฌููุน ุงูููุงู ุงููุฌุฏููุฉ:
```sql
SELECT * FROM cron.job ORDER BY jobname;
```

ูุฑุคูุฉ ุชุงุฑูุฎ ุชูููุฐ ุงูููุงู:
```sql
SELECT * FROM cron.job_run_details 
ORDER BY start_time DESC 
LIMIT 10;
```

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงูุชูููุช (Time Zone)
- ุฌููุน ุงูุฃููุงุช ูู UTC
- ุฅุฐุง ูุงู ุฎุงุฏูู ูุณุชุฎุฏู ุชูููุช ูุฎุชููุ ูุฏ ุชุญุชุงุฌ ูุชุนุฏูู ุงูุฃููุงุช

### 2. ุงูุชุนุฏูู ุนูู ุงูุฌุฏููุฉ
ุฅุฐุง ุฃุฑุฏุช ุชุบููุฑ ููุช ุงูุชูููุฐุ ููููู ุงุณุชุฎุฏุงู:
```sql
-- ุฅูุบุงุก ุงููููุฉ ุงูุญุงููุฉ
SELECT cron.unschedule('monthly-invoice-generation');

-- ุฅุนุงุฏุฉ ุฌุฏููุชูุง ุจููุช ุฌุฏูุฏ
SELECT cron.schedule(
  'monthly-invoice-generation',
  '0 10 28 * *',  -- ุงูุณุงุนุฉ 10 ุตุจุงุญุงู ุจุฏูุงู ูู 9
  $$SELECT run_monthly_invoice_generation()$$
);
```

### 3. ุฅููุงู ูุคูุช
ูุฅููุงู ูููุฉ ูุคูุชุงู:
```sql
SELECT cron.unschedule('monthly-invoice-generation');
```

ูุฅุนุงุฏุฉ ุชูุนูููุงุ ูููุฐ ุงูููู ูุฑุฉ ุฃุฎุฑู.

## ๐ ุงูุฌุฏูู ุงูุฒููู ููุนูููุงุช

```
ููู 28 ูู ุงูุดูุฑ (9:00 ุตุจุงุญุงู)
    โ
ุฅูุดุงุก ููุงุชูุฑ ููุดูุฑ ุงููุงุฏู
    โ
ููู 1 ูู ุงูุดูุฑ (9:00 ุตุจุงุญุงู)
    โ
ุฅุฑุณุงู ุชุฐููุฑุงุช ููู ุงูุงุณุชุญูุงู
ูุนุงูุฌุฉ ุงูููุงุชูุฑ ุงููุชุฃุฎุฑุฉ
    โ
ููููุงู (9:00 ุตุจุงุญุงู)
    โ
ุฅุฑุณุงู ุชุฐููุฑุงุช ุฌุฏูุฏุฉ
ูุนุงูุฌุฉ ุงูููุงุชูุฑ ุงููุชุฃุฎุฑุฉ
```

## โ ุญุงูุฉ ุงููุธุงู ุจุนุฏ ุงูุชูููุฐ

| ุงููููู | ุงูุญุงูุฉ | ุงูุชูุถูุญ |
|--------|--------|---------|
| ุฅูุดุงุก ุงูููุงุชูุฑ | โ ุชููุงุฆู | ูุนูู ููู 28 ูู ูู ุดูุฑ |
| ุงูุชุฐููุฑุงุช | โ ุชููุงุฆู | ูุนูู ููููุงู ุงูุณุงุนุฉ 9 ุตุจุงุญุงู |
| ูุนุงูุฌุฉ ุงููุชุฃุฎุฑุงุช | โ ุชููุงุฆู | ูุนูู ููููุงู ุงูุณุงุนุฉ 9 ุตุจุงุญุงู |
| ูุงุนุฏุฉ ุงูุจูุงูุงุช | โ ุฌุงูุฒ | ุฌููุน ุงููุธุงุฆู ููุฌูุฏุฉ |
| ุงููุงุฌูุฉ ุงูุฃูุงููุฉ | โ ุฌุงูุฒ | ุฌููุน ุงูุตูุญุงุช ููุฌูุฏุฉ |

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ุชุนูู ุงูููุงู ุงููุฌุฏููุฉ
**ุงูุญู:**
1. ุชุญูู ูู ุฃู `pg_cron` extension ููุนูู
2. ุชุญูู ูู ุฃู ุงูููุงู ูุณุฌูุฉ: `SELECT * FROM cron.job;`
3. ุชุญูู ูู ุณุฌูุงุช ุงูุชูููุฐ: `SELECT * FROM cron.job_run_details;`

### ุงููุดููุฉ: ุฃุฎุทุงุก ูู ุงูุชูููุฐ
**ุงูุญู:**
1. ุชุญูู ูู ุฃู ุฌููุน ุงููุธุงุฆู ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุงุฎุชุจุฑ ุงููุธุงุฆู ูุฏููุงู ููุชุฃูุฏ ูู ุนูููุง
3. ุชุญูู ูู ุงูุตูุงุญูุงุช (Permissions)

### ุงููุดููุฉ: ุงูููุงู ุชุนูู ูู ููุช ุฎุงุทุฆ
**ุงูุญู:**
1. ุชุญูู ูู time zone ููุฎุงุฏู
2. ุนุฏูู ุงูุฌุฏููุฉ ุญุณุจ ุงูุชูููุช ุงููุทููุจ

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุฑุงุฌุน ุณุฌูุงุช ุงูุชูููุฐ: `SELECT * FROM cron.job_run_details;`
2. ุงุฎุชุจุฑ ุงููุธุงุฆู ูุฏููุงู ููุชุฃูุฏ ูู ุนูููุง
3. ุชุญูู ูู ูุฌูุฏ ุฌููุน ุงููุธุงุฆู ุงููุทููุจุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

**ููุงุญุธุฉ:** ูุฐุง ุงูููู ุขูู ููุชูููุฐ ุฃูุซุฑ ูู ูุฑุฉ. ุฅุฐุง ูุงู ููุงู ููุงู ููุฌูุฏุฉ ูุณุจูุงูุ ุณูุชู ุฅูุบุงุคูุง ูุฅุนุงุฏุฉ ุฅูุดุงุฆูุง.

