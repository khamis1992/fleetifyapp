# ๐ ุฏููู ุชุญุฏูุซ ุฃุฑูุงู ุงูุนููุฏ

## ๐ฏ **ุงููุฏู:**

ุชุญุฏูุซ ุฃุฑูุงู ุงูุนููุฏ ูู ุงููุธุงู ูุชุทุงุจู ุงูุฃุฑูุงู ุงููุฏููุฉ ูู ููู `agreements_with_details.sql`.

---

## ๐ **ุงูุชุญููู:**

### **ูู ุงูุตูุบุฉ ุงูุฌุฏูุฏุฉ:**
```
CNT-25-0001
CNT-25-0002
CNT-25-0479
CNT-25-0510
```

### **ุฅูู ุงูุตูุบุฉ ุงููุฏููุฉ:**
```
LTO2024139
LTO20249
LTO2024341
MR2024182
```

---

## ๐ง **ููู ูุนูู:**

### **ุงููุทุงุจูุฉ:**
ูุณุชุฎุฏู ููุณ ูุธุงู ุงููุทุงุจูุฉ ุงูุฐูู:
1. โ **ุงุณู ุงูุนููู** (fuzzy matching)
2. โ **ูููุฉ ุงูุฅูุฌุงุฑ** (ยฑ10% ุชุณุงูุญ)
3. โ **ุฑูู ุงูููุญุฉ** (ููุชุฃููุฏ ุงูุฅุถุงูู)

### **ุงูุชุญุฏูุซ:**
```sql
ุฅุฐุง ุชุทุงุจู ุงูุนููู ูุงููููุฉ:
  โ backup: CNT-25-0479 ูู contract_number_history
  โ update: contract_number = 'LTO2024341'
```

---

## โ๏ธ **ุชุญุฐูุฑ ููู:**

### **ูุฐุง ุณูุบููุฑ ุฃุฑูุงู ุงูุนููุฏ ูู:**
```
CNT-25-XXXX  (ุงูุตูุบุฉ ุงูุฌุฏูุฏุฉ)
    โ
LTO2024XXX   (ุงูุตูุบุฉ ุงููุฏููุฉ ูู ุงูููู)
MR2024XXX
Ret-2018XXX
```

### **ุงููุณุฎ ุงูุงุญุชูุงุทู:**
- โ ูุญูุธ ุงูุฃุฑูุงู ุงููุฏููุฉ ูู ุฌุฏูู `contract_number_history`
- โ ูููู ุงูุฑุฌูุน ููุฃุฑูุงู ุงูุณุงุจูุฉ ุฅุฐุง ุงุญุชุฌุช

---

## ๐ **ุงูุงุณุชุฎุฏุงู (2 ุฏูููุฉ):**

### **ุงูููู:**
```
UPDATE_CONTRACT_NUMBERS_TO_OLD_FORMAT.sql
```

**ุงูุฎุทูุงุช:**
1. ุงูุชุญ **Supabase Dashboard** โ **SQL Editor**
2. ุงูุชุญ ุงูููู ูู Cursor
3. **Ctrl+A** โ **Ctrl+C**
4. **Paste** ูู SQL Editor
5. **ุงุถุบุท Run** โ
6. **ุงูุชุธุฑ 1-2 ุฏูููุฉ**

---

## ๐ **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**

```
====================================================================
๐ UPDATING CONTRACT NUMBERS TO MATCH AGREEMENTS FILE
====================================================================
Processing 415 contracts...

   Progress: 50 / 415 processed...
   Progress: 100 / 415 processed...
   Progress: 150 / 415 processed...
   Progress: 200 / 415 processed...
   Progress: 250 / 415 processed...
   Progress: 300 / 415 processed...
   Progress: 350 / 415 processed...
   Progress: 400 / 415 processed...

โ Total contracts updated: 350+

====================================================================
๐ Checking contract numbers:
====================================================================
LTO2024341  | issam abdallah   | 7036 | 1500 | CNT-25-0479
LTO2024139  | issam abdallah   | 7036 | 2100 | CNT-25-0001
LTO20249    | MEHRAN...        | ...  | ...  | CNT-25-0002

๐ Old vs New Contract Numbers:
from_CNT_format | to_old_format  | updated_at
CNT-25-0479     | LTO2024341     | 2025-01-...
CNT-25-0001     | LTO2024139     | 2025-01-...
...
```

---

## โ **ุฃูุซูุฉ ุนูู ุงูุชุญุฏูุซ:**

### **ุนูุฏ 1:**
```
ูุจู:
  contract_number: CNT-25-0479
  ุงูุนููู: issam abdallah
  ุงูุฅูุฌุงุฑ: 1500

ุจุนุฏ:
  contract_number: LTO2024341
  ุงูุนููู: issam abdallah
  ุงูุฅูุฌุงุฑ: 1500
  
ูู contract_number_history:
  old: CNT-25-0479
  new: LTO2024341
```

### **ุนูุฏ 2:**
```
ูุจู:
  contract_number: CNT-25-0001
  ุงูุนููู: issam abdallah
  ุงูุฅูุฌุงุฑ: 2100

ุจุนุฏ:
  contract_number: LTO2024139
  ุงูุนููู: issam abdallah
  ุงูุฅูุฌุงุฑ: 2100
```

---

## ๐ **ููุฑุฌูุน (Rollback):**

ุฅุฐุง ุฃุฑุฏุช ุงูุฑุฌูุน ููุฃุฑูุงู ุงูุฌุฏูุฏุฉ:

```sql
-- Rollback: ุงูุนูุฏุฉ ููุฃุฑูุงู CNT-25-XXXX
UPDATE contracts c
SET 
  contract_number = h.old_contract_number,
  updated_at = NOW()
FROM contract_number_history h
WHERE c.id = h.contract_id
  AND c.company_id = '24bc0b21-4e2d-4413-9842-31719a3669f4';
```

---

## ๐ก **ููุงุญุธุงุช:**

### **ุงูุชุนุงุฑุถุงุช ุงููุญุชููุฉ:**
ุฅุฐุง ุนูุฏุงู ูุฎุชููุงู ูููุง ููุณ ุงูุฑูู ุงููุฏูู:
```
ุงูุนูุฏ A: CNT-25-0001 โ LTO2024139
ุงูุนูุฏ B: CNT-25-0002 โ LTO2024139 (ุชุนุงุฑุถ!)
```

**ุงูุญู:** Script ูุฎุชุงุฑ **ุฃูุถู ูุทุงุจูุฉ** ุจูุงุกู ุนูู:
1. ุชุทุงุจู ุงูุงุณู
2. ุชุทุงุจู ุงููููุฉ
3. ุชุทุงุจู ุงูููุญุฉ

---

## ๐ **ุงููููุงุช:**

| ุงูููู | ุงููุธููุฉ |
|------|---------|
| **UPDATE_CONTRACT_NUMBERS_TO_OLD_FORMAT.sql** | ุชุญุฏูุซ ุงูุฃุฑูุงู |
| CONTRACT_NUMBERS_UPDATE_GUIDE.md | ูุฐุง ุงูุฏููู |

---

## ๐ **ุงุจุฏุฃ ุงูุขู:**

**ุงูุชุญ Supabase ูุดุบูู:**
```
UPDATE_CONTRACT_NUMBERS_TO_OLD_FORMAT.sql
```

**ุจุนุฏ ุฏูููุชูู:**
```
โ 350+ ุนูุฏ ุจุฃุฑูุงู ูุฏููุฉ
โ CNT-25-0479 โ LTO2024341
โ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู contract_number_history
```

---

**ุฌุงูุฒ ููุชุดุบูู!** ๐

