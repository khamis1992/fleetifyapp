# ๐ ุฏููู ุงูุฑุจุท ุงูุชููุงุฆู ุจูู ุงูููุงุชูุฑ ูุงููููุฏ ุงููุญุงุณุจูุฉ

**ุงูุชุงุฑูุฎ:** 6 ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0  
**ูููุญุงุณุจูู ูุงููุฏูุฑูู ุงููุงูููู**

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู **FleetifyApp** ูุญุชูู ุนูู ุขููุฉ ุฐููุฉ **ุชููุงุฆูุฉ ุจุงููุงูู** ูุฅูุดุงุก ุงููููุฏ ุงููุญุงุณุจูุฉ ุนูุฏ ุฅูุดุงุก ุงูููุงุชูุฑ ุฃู ุงุณุชูุงู ุงููุฏููุนุงุช. ูุฐุง ูุถูู:

โ **ุฏูุฉ ูุญุงุณุจูุฉ 100%** - ูุง ุญุงุฌุฉ ูุฅุฏุฎุงู ูุฏูู  
โ **ุชูููุฑ ุงูููุช** - ุงููููุฏ ุชููุดุฃ ุชููุงุฆูุงู ูู ุซูุงูู  
โ **ุนุฏู ุชูุฑุงุฑ ุงูุจูุงูุงุช** - ูู ูุนุงููุฉ ุชูุณุฌู ูุฑุฉ ูุงุญุฏุฉ ููุท  
โ **ุชูุงูู ูุน ุงููุนุงููุฑ ุงููุญุงุณุจูุฉ** - ุงููููุฏ ุตุญูุญุฉ ููุชูุงุฒูุฉ ุฏุงุฆูุงู

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### 1. Database Triggers (ุงููุดุบูุงุช ุงูุชููุงุฆูุฉ)

ุงููุธุงู ูุณุชุฎุฏู **PostgreSQL Triggers** ููุชูููุฐ ุงูุชููุงุฆู:

```sql
-- Trigger 1: ุนูุฏ ุฅูุดุงุก/ุชุญุฏูุซ ุงููุฏููุนุงุช
CREATE TRIGGER trg_payment_journal_entry
AFTER INSERT OR UPDATE OF payment_status ON payments
FOR EACH ROW
EXECUTE FUNCTION create_payment_journal_entry();

-- Trigger 2: ุนูุฏ ุฅูุดุงุก ุงูููุงุชูุฑ
CREATE TRIGGER trg_invoice_journal_entry
AFTER INSERT ON invoices
FOR EACH ROW
EXECUTE FUNCTION create_invoice_journal_entry();
```

**ูุงุฐุง ูุนูู ูุฐุงุ**
- ุนูุฏ ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ ุฃู ุฅููุงู ุฏูุนุฉุ ูุชู **ุชููุงุฆูุงู ูููุฑุงู** ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู ุงูููุงุณุจ
- ูุง ุญุงุฌุฉ ูุฃู ุชุฏุฎู ูุฏูู ูู ุงููุญุงุณุจ
- ุงูููุฏ ูููุดุฃ ุจููุณ ุงููุญุธุฉ ูุจููุณ ุงูุชุงุฑูุฎ

---

## ๐ฐ ุณููุงุฑูู 1: ุฅูุดุงุก ูุงุชูุฑุฉ (Invoice Creation)

### ุงูุชุฏูู ุงูุชููุงุฆู:

```
[ุงููุณุชุฎุฏู ููุดุฆ ูุงุชูุฑุฉ]
         โ
[ุงููุธุงู ูุญูุธ ุงููุงุชูุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช]
         โ
[Trigger ูููุนูู ุชููุงุฆูุงู]
         โ
[create_invoice_journal_entry() ุชูููุฐ]
         โ
[ููุฏ ูุญุงุณุจู ูููุดุฃ ุชููุงุฆูุงู]
         โ
[ุงูููุฏ ููุญูุธ ุจุญุงูุฉ "posted"]
```

### ุงูููุฏ ุงููุญุงุณุจู ุงููุงุชุฌ:

| ุฑูู ุงูุณุทุฑ | ุงูุญุณุงุจ | ุงููุตู | ุงููุฏูู | ุงูุฏุงุฆู |
|-----------|---------|-------|--------|---------|
| 1 | **1201** - ุงููุฏูููู | ูุณุชุญูุงุช ุนูู ุงูุนููุงุก | **ุฅุฌูุงูู ุงููุงุชูุฑุฉ** | - |
| 2 | **4101** - ุงูุฅูุฑุงุฏุงุช | ุฅูุฑุงุฏ ุงูุฎุฏูุงุช | - | **ุงููุจูุบ ูุจู ุงูุถุฑูุจุฉ** |
| 3 | **2201** - ุงูุถุฑุงุฆุจ | ุถุฑูุจุฉ ูุญุตูุฉ | - | **ูุจูุบ ุงูุถุฑูุจุฉ** |

### ูุซุงู ุนููู:

**ูุงุชูุฑุฉ ุฑูู:** INV-2025-001  
**ุงูุชุงุฑูุฎ:** 6 ููููุจุฑ 2025  
**ุงููุจูุบ ุงูุฅุฌูุงูู:** 1,000 ุฑูุงู  
**ุงูุถุฑูุจุฉ (5%):** 50 ุฑูุงู  
**ุงููุจูุบ ุงูุตุงูู:** 950 ุฑูุงู

**ุงูููุฏ ุงููุญุงุณุจู ุงูุชููุงุฆู:**

```
ุฑูู ุงูููุฏ: INV-20251106-abc12345
ุงูุชุงุฑูุฎ: 6 ููููุจุฑ 2025
ุงููุตู: ููุฏ ูุงุชูุฑุฉ: INV-2025-001

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ูู ุญู/ ุงููุฏูููู (1201)          1,000 ุฑูุงู    โ
โ  ุฅูู ุญู/ ุงูุฅูุฑุงุฏุงุช (4101)          950 ุฑูุงู    โ
โ  ุฅูู ุญู/ ุงูุถุฑุงุฆุจ (2201)             50 ุฑูุงู    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุงูููุฏ ุงููุณุคูู:

```sql
CREATE OR REPLACE FUNCTION create_invoice_journal_entry()
RETURNS TRIGGER AS $$
DECLARE
    _entry_number TEXT;
    _journal_id UUID;
    _ar_account_id UUID;      -- 1201: ุงููุฏูููู
    _revenue_account_id UUID;  -- 4101: ุงูุฅูุฑุงุฏุงุช
    _tax_account_id UUID;      -- 2201: ุงูุถุฑุงุฆุจ
BEGIN
    -- ุงูุญุตูู ุนูู ูุนุฑูุงุช ุงูุญุณุงุจุงุช
    SELECT id INTO _ar_account_id
    FROM chart_of_accounts 
    WHERE company_id = NEW.company_id 
    AND account_code = '1201' 
    AND is_active = true;
    
    SELECT id INTO _revenue_account_id
    FROM chart_of_accounts 
    WHERE company_id = NEW.company_id 
    AND account_code = '4101' 
    AND is_active = true;
    
    -- ุฅูุดุงุก ุฑูู ุงูููุฏ
    _entry_number := 'INV-' || TO_CHAR(NEW.invoice_date, 'YYYYMMDD') || '-' || 
                     SUBSTRING(NEW.id::TEXT, 1, 8);
    
    -- ุฅูุดุงุก ุฑุฃุณ ุงูููุฏ
    INSERT INTO journal_entries (
        company_id,
        entry_number,
        entry_date,
        description,
        total_debit,
        total_credit,
        entry_type,
        status,
        source_document_type,
        source_document_id
    ) VALUES (
        NEW.company_id,
        _entry_number,
        NEW.invoice_date,
        'ููุฏ ูุงุชูุฑุฉ: ' || NEW.invoice_number,
        NEW.total_amount,
        NEW.total_amount,
        'automatic',
        'posted',
        'invoice',
        NEW.id
    ) RETURNING id INTO _journal_id;
    
    -- ุงูุณุทุฑ 1: ูุฏูู (ุงููุฏูููู)
    INSERT INTO journal_entry_lines (
        journal_entry_id,
        account_id,
        debit_amount,
        credit_amount,
        description,
        line_order
    ) VALUES (
        _journal_id,
        _ar_account_id,
        NEW.total_amount,
        0,
        'ูุณุชุญูุงุช ุนูู ุงูุนููุงุก',
        1
    );
    
    -- ุงูุณุทุฑ 2: ุฏุงุฆู (ุงูุฅูุฑุงุฏุงุช)
    INSERT INTO journal_entry_lines (
        journal_entry_id,
        account_id,
        debit_amount,
        credit_amount,
        description,
        line_order
    ) VALUES (
        _journal_id,
        _revenue_account_id,
        0,
        NEW.subtotal,
        'ุฅูุฑุงุฏ ุงูุฎุฏูุงุช',
        2
    );
    
    -- ุงูุณุทุฑ 3: ุฏุงุฆู (ุงูุถุฑุงุฆุจ) - ุฅู ูุฌุฏุช
    IF NEW.tax_amount > 0 THEN
        SELECT id INTO _tax_account_id
        FROM chart_of_accounts 
        WHERE company_id = NEW.company_id 
        AND account_code = '2201' 
        AND is_active = true;
        
        IF _tax_account_id IS NOT NULL THEN
            INSERT INTO journal_entry_lines (
                journal_entry_id,
                account_id,
                debit_amount,
                credit_amount,
                description,
                line_order
            ) VALUES (
                _journal_id,
                _tax_account_id,
                0,
                NEW.tax_amount,
                'ุถุฑูุจุฉ ูุญุตูุฉ',
                3
            );
        END IF;
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

---

## ๐ต ุณููุงุฑูู 2: ุงุณุชูุงู ุฏูุนุฉ (Payment Receipt)

### ุงูุชุฏูู ุงูุชููุงุฆู:

```
[ุงูุนููู ูุฏูุน + ุงููุณุชุฎุฏู ูุณุฌู ุงูุฏูุนุฉ]
         โ
[ุงููุธุงู ูุญูุธ ุงูุฏูุนุฉ ุจุญุงูุฉ "completed"]
         โ
[Trigger ูููุนูู ุชููุงุฆูุงู]
         โ
[create_payment_journal_entry() ุชูููุฐ]
         โ
[ุงููุธุงู ูุชุญูู: ูู ุงูุฏูุนุฉ ูุฑุชุจุทุฉ ุจูุงุชูุฑุฉุ]
         โ
    โโโโโโโโโดโโโโโโโโ
    โ ูุนู           โ ูุง
    โ               โ
[ููุฏ ุชุญุตูู]   [ููุฏ ุฅูุฑุงุฏ ูุจุงุดุฑ]
    โ               โ
[ูุฏูู: ููุฏูุฉ]  [ูุฏูู: ููุฏูุฉ]
[ุฏุงุฆู: ูุฏูููู]  [ุฏุงุฆู: ุฅูุฑุงุฏุงุช]
```

### ุงูููุฏ ุงููุญุงุณุจู (ุฏูุนุฉ ูุฑุชุจุทุฉ ุจูุงุชูุฑุฉ):

| ุฑูู ุงูุณุทุฑ | ุงูุญุณุงุจ | ุงููุตู | ุงููุฏูู | ุงูุฏุงุฆู |
|-----------|---------|-------|--------|---------|
| 1 | **1101** - ุงูููุฏูุฉ | ุงุณุชูุงู ููุฏูุฉ | **ูุจูุบ ุงูุฏูุนุฉ** | - |
| 2 | **1201** - ุงููุฏูููู | ุชุญุตูู ูู ุงูุนููุงุก | - | **ูุจูุบ ุงูุฏูุนุฉ** |

### ุงูููุฏ ุงููุญุงุณุจู (ุฏูุนุฉ ุจุฏูู ูุงุชูุฑุฉ):

| ุฑูู ุงูุณุทุฑ | ุงูุญุณุงุจ | ุงููุตู | ุงููุฏูู | ุงูุฏุงุฆู |
|-----------|---------|-------|--------|---------|
| 1 | **1101** - ุงูููุฏูุฉ | ุงุณุชูุงู ููุฏูุฉ | **ูุจูุบ ุงูุฏูุนุฉ** | - |
| 2 | **4101** - ุงูุฅูุฑุงุฏุงุช | ุฅูุฑุงุฏ ูุจุงุดุฑ | - | **ูุจูุบ ุงูุฏูุนุฉ** |

### ูุซุงู ุนููู (ุฏูุนุฉ ูุฑุชุจุทุฉ ุจูุงุชูุฑุฉ):

**ุฑูู ุงูุฏูุนุฉ:** PAY-2025-0123  
**ุงูุชุงุฑูุฎ:** 6 ููููุจุฑ 2025  
**ุงููุจูุบ:** 1,000 ุฑูุงู  
**ูุฑุชุจุทุฉ ุจุงููุงุชูุฑุฉ:** INV-2025-001

**ุงูููุฏ ุงููุญุงุณุจู ุงูุชููุงุฆู:**

```
ุฑูู ุงูููุฏ: PAY-20251106-xyz78901
ุงูุชุงุฑูุฎ: 6 ููููุจุฑ 2025
ุงููุตู: ููุฏ ุงุณุชูุงู ุฏูุนุฉ: PAY-2025-0123

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ูู ุญู/ ุงูููุฏูุฉ (1101)            1,000 ุฑูุงู    โ
โ  ุฅูู ุญู/ ุงููุฏูููู (1201)         1,000 ุฑูุงู    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุงูุชุฃุซูุฑ:**
- โ ุงูููุฏูุฉ ูู ุงูุตูุฏูู/ุงูุจูู ุฒุงุฏุช ุจู 1,000 ุฑูุงู
- โ ุงููุณุชุญูุงุช ุนูู ุงูุนููุงุก ุงูุฎูุถุช ุจู 1,000 ุฑูุงู
- โ ุงููุงุชูุฑุฉ INV-2025-001 ุฃุตุจุญุช ูุฏููุนุฉ

### ุงูููุฏ ุงููุณุคูู:

```sql
CREATE OR REPLACE FUNCTION create_payment_journal_entry()
RETURNS TRIGGER AS $$
DECLARE
    _entry_number TEXT;
    _journal_id UUID;
    _cash_account_id UUID;     -- 1101: ุงูููุฏูุฉ
    _revenue_account_id UUID;  -- 4101: ุงูุฅูุฑุงุฏุงุช
    _ar_account_id UUID;       -- 1201: ุงููุฏูููู
BEGIN
    -- ููุท ููุฏูุนุงุช ุงูููุชููุฉ
    IF NEW.payment_status = 'completed' THEN
        
        -- ุงูุญุตูู ุนูู ูุนุฑูุงุช ุงูุญุณุงุจุงุช
        SELECT id INTO _cash_account_id 
        FROM chart_of_accounts 
        WHERE company_id = NEW.company_id 
        AND account_code = '1101' 
        AND is_active = true;
        
        SELECT id INTO _ar_account_id
        FROM chart_of_accounts 
        WHERE company_id = NEW.company_id 
        AND account_code = '1201' 
        AND is_active = true;
        
        SELECT id INTO _revenue_account_id
        FROM chart_of_accounts 
        WHERE company_id = NEW.company_id 
        AND account_code = '4101' 
        AND is_active = true;
        
        -- ุงูุชุญูู ูู ุชููุฑ ุงูุญุณุงุจ ุงูููุฏู
        IF _cash_account_id IS NULL THEN
            RETURN NEW;
        END IF;
        
        -- ุฅูุดุงุก ุฑูู ุงูููุฏ
        _entry_number := 'PAY-' || TO_CHAR(NEW.payment_date, 'YYYYMMDD') || '-' || 
                         SUBSTRING(NEW.id::TEXT, 1, 8);
        
        -- ุฅูุดุงุก ุฑุฃุณ ุงูููุฏ
        INSERT INTO journal_entries (
            company_id,
            entry_number,
            entry_date,
            description,
            total_debit,
            total_credit,
            entry_type,
            status,
            source_document_type,
            source_document_id
        ) VALUES (
            NEW.company_id,
            _entry_number,
            NEW.payment_date,
            'ููุฏ ุงุณุชูุงู ุฏูุนุฉ: ' || COALESCE(NEW.payment_number, NEW.reference_number, ''),
            NEW.amount,
            NEW.amount,
            'automatic',
            'posted',
            'payment',
            NEW.id
        ) RETURNING id INTO _journal_id;
        
        -- ุงูุณุทุฑ 1: ูุฏูู (ุงูููุฏูุฉ)
        INSERT INTO journal_entry_lines (
            journal_entry_id,
            account_id,
            debit_amount,
            credit_amount,
            description,
            line_order
        ) VALUES (
            _journal_id,
            _cash_account_id,
            NEW.amount,
            0,
            'ุงุณุชูุงู ููุฏูุฉ',
            1
        );
        
        -- ุงูุณุทุฑ 2: ุฏุงุฆู (ุงููุฏูููู ุฃู ุงูุฅูุฑุงุฏุงุช)
        INSERT INTO journal_entry_lines (
            journal_entry_id,
            account_id,
            debit_amount,
            credit_amount,
            description,
            line_order
        ) VALUES (
            _journal_id,
            CASE 
                WHEN NEW.invoice_id IS NOT NULL THEN _ar_account_id 
                ELSE _revenue_account_id 
            END,
            0,
            NEW.amount,
            CASE 
                WHEN NEW.invoice_id IS NOT NULL THEN 'ุชุญุตูู ูู ุงูุนููุงุก' 
                ELSE 'ุฅูุฑุงุฏ ูุจุงุดุฑ' 
            END,
            2
        );
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

---

## ๐ ุงูุฑุจุท ุจูู ุงูููุงุชูุฑ ูุงููููุฏ

### ุทุฑููุฉ ุงูุฑุจุท:

ูู ููุฏ ูุญุงุณุจู ูุญุชูู ุนูู ุญูููู ููุฑุจุท:

1. **`source_document_type`**: ููุน ุงููุณุชูุฏ ุงููุตุฏุฑ
   - `'invoice'` - ูุงุชูุฑุฉ
   - `'payment'` - ุฏูุนุฉ

2. **`source_document_id`**: ูุนุฑู ุงููุณุชูุฏ ุงููุตุฏุฑ (UUID)
   - ุฑุจุท ูุจุงุดุฑ ุจุฌุฏูู `invoices` ุฃู `payments`

### ุงูุงุณุชุนูุงู ููุญุตูู ุนูู ุงูููุฏ ุงููุฑุชุจุท ุจูุงุชูุฑุฉ:

```sql
-- ุงูุญุตูู ุนูู ุงูููุฏ ุงููุญุงุณุจู ุงููุฑุชุจุท ุจูุงุชูุฑุฉ ูุนููุฉ
SELECT 
    je.id,
    je.entry_number,
    je.entry_date,
    je.description,
    je.total_debit,
    je.total_credit,
    je.status
FROM journal_entries je
WHERE je.source_document_type = 'invoice'
  AND je.source_document_id = 'ูุงุชูุฑุฉ_id_ููุง';

-- ุงูุญุตูู ุนูู ุณุทูุฑ ุงูููุฏ
SELECT 
    jel.line_order,
    coa.account_code,
    coa.account_name,
    jel.debit_amount,
    jel.credit_amount,
    jel.description
FROM journal_entry_lines jel
JOIN chart_of_accounts coa ON jel.account_id = coa.id
WHERE jel.journal_entry_id = 'journal_entry_id_ููุง'
ORDER BY jel.line_order;
```

---

## ๐ ุงูุญุณุงุจุงุช ุงููุณุชุฎุฏูุฉ ูู ุงููุธุงู

| ุฑูุฒ ุงูุญุณุงุจ | ุงุณู ุงูุญุณุงุจ | ููุน ุงูุญุณุงุจ | ุงูุงุณุชุฎุฏุงู |
|------------|-------------|------------|-----------|
| **1101** | ุงูููุฏูุฉ / ุงูุตูุฏูู | ุฃุตูู | ุชุณุฌูู ุงุณุชูุงู ุงููููุฏ |
| **1201** | ุงููุฏูููู (ุงูุนููุงุก) | ุฃุตูู | ุชุณุฌูู ุงููุณุชุญูุงุช ุนูู ุงูุนููุงุก |
| **2201** | ุงูุถุฑุงุฆุจ ุงููุณุชุญูุฉ | ุฎุตูู | ุชุณุฌูู ุงูุถุฑุงุฆุจ ุงููุญุตูุฉ |
| **4101** | ุฅูุฑุงุฏุงุช ุงูุฎุฏูุงุช | ุฅูุฑุงุฏุงุช | ุชุณุฌูู ุงูุฅูุฑุงุฏุงุช |

### ุงููุนุงุฏูุฉ ุงููุญุงุณุจูุฉ:

```
ุงูุฃุตูู = ุงูุฎุตูู + ุญููู ุงูููููุฉ

ุงูููุฏูุฉ + ุงููุฏูููู = ุงูุถุฑุงุฆุจ ุงููุณุชุญูุฉ + ุญููู ุงูููููุฉ
(1101)    (1201)         (2201)              (ุฑุฃุณ ุงููุงู + ุงูุฅูุฑุงุฏุงุช - ุงููุตุฑููุงุช)
```

---

## ๐ฏ ุณููุงุฑูููุงุช ุนูููุฉ ูุงููุฉ

### ุณููุงุฑูู 1: ุนูุฏ ุฅูุฌุงุฑ ุณูุงุฑุฉ

**ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุงููุงุชูุฑุฉ**
```
ุงูุนููู: ุฃุญูุฏ ูุญูุฏ
ุงูุฎุฏูุฉ: ุฅูุฌุงุฑ ุณูุงุฑุฉ ุชูููุชุง ูุงูุฑู - ุดูุฑ ููููุจุฑ
ุงููุจูุบ: 3,000 ุฑูุงู
ุงูุถุฑูุจุฉ (5%): 150 ุฑูุงู
ุงูุฅุฌูุงูู: 3,150 ุฑูุงู
```

**ุงูููุฏ ุงููุญุงุณุจู ุงูุชููุงุฆู:**
```
ูู ุญู/ ุงููุฏูููู (1201)           3,150 ุฑูุงู
ุฅูู ุญู/ ุฅูุฑุงุฏุงุช ุงูุชุฃุฌูุฑ (4101)    3,000 ุฑูุงู
ุฅูู ุญู/ ุงูุถุฑุงุฆุจ ุงููุณุชุญูุฉ (2201)    150 ุฑูุงู
```

**ุงูุฎุทูุฉ 2: ุงุณุชูุงู ุงูุฏูุนุฉ**
```
ุงููุจูุบ ุงููุณุชูู: 3,150 ุฑูุงู ููุฏุงู
```

**ุงูููุฏ ุงููุญุงุณุจู ุงูุชููุงุฆู:**
```
ูู ุญู/ ุงูููุฏูุฉ (1101)             3,150 ุฑูุงู
ุฅูู ุญู/ ุงููุฏูููู (1201)          3,150 ุฑูุงู
```

**ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**
- โ ุงูุฅูุฑุงุฏุงุช ุฒุงุฏุช ุจู 3,000 ุฑูุงู
- โ ุงูุถุฑุงุฆุจ ุงููุณุชุญูุฉ ุฒุงุฏุช ุจู 150 ุฑูุงู
- โ ุงูููุฏูุฉ ุฒุงุฏุช ุจู 3,150 ุฑูุงู
- โ ุงููุฏูููู: ุตูุฑ (ุชู ุงูุชุญุตูู ุจุงููุงูู)

---

## ๐ ููู ูุชุญูู ุงููุญุงุณุจ ูู ุงููููุฏุ

### 1. ูู ุตูุญุฉ ุฏูุชุฑ ุงูุฃุณุชุงุฐ (Ledger):

ุงูุชูู ุฅูู: **ุงููุธุงู ุงููุงูู โ ุฏูุชุฑ ุงูุฃุณุชุงุฐ**

- ุณุชุฌุฏ ุฌููุน ุงููููุฏ ูุฑุชุจุฉ ุญุณุจ ุงูุชุงุฑูุฎ
- ูู ููุฏ ูู ููุน `automatic` (ุชููุงุฆู)
- ููููู ุงูุจุญุซ ุจุฑูู ุงููุงุชูุฑุฉ ุฃู ุงูุฏูุนุฉ
- ููููู ุชุตููุฉ ุงููููุฏ ุญุณุจ ุงูููุน

### 2. ูู ุตูุญุฉ ุงูุชูุงุฑูุฑ ุงููุงููุฉ:

ุงูุชูู ุฅูู: **ุงููุธุงู ุงููุงูู โ ุงูุชูุงุฑูุฑ ุงููุงููุฉ โ ููุฒุงู ุงููุฑุงุฌุนุฉ**

- ุณุชุฑู ุฃุฑุตุฏุฉ ุฌููุน ุงูุญุณุงุจุงุช ูุญุฏุซุฉ ุชููุงุฆูุงู
- ููููู ุชุตุฏูุฑ ุงูุชูุฑูุฑ ูู CSV

### 3. ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ:

```sql
-- ุนุฑุถ ุฌููุน ุงููููุฏ ุงูุชููุงุฆูุฉ
SELECT 
    je.entry_number,
    je.entry_date,
    je.description,
    je.total_debit,
    je.total_credit,
    je.source_document_type,
    je.status
FROM journal_entries je
WHERE je.entry_type = 'automatic'
ORDER BY je.entry_date DESC;

-- ุนุฑุถ ุงููููุฏ ุงููุฑุชุจุทุฉ ุจูุงุชูุฑุฉ ูุนููุฉ
SELECT 
    je.entry_number,
    je.entry_date,
    i.invoice_number,
    je.total_debit
FROM journal_entries je
JOIN invoices i ON je.source_document_id = i.id
WHERE je.source_document_type = 'invoice'
  AND i.invoice_number = 'INV-2025-001';
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงููููุฏ ุงูุชููุงุฆูุฉ ูุง ูููู ุชุนุฏูููุง ูุฏููุงู:
- โ ุงููููุฏ ุชููุดุฃ ุจุญุงูุฉ `posted` (ูุฑุญููุฉ)
- โ ูุง ูููู ุชุนุฏูููุง ุฃู ุญุฐููุง ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู
- โ ุฅุฐุง ูุงู ููุงู ุฎุทุฃุ ูุฌุจ ุชุนุฏูู ุงููุงุชูุฑุฉ/ุงูุฏูุนุฉ ุงูุฃุตููุฉ

### 2. ุงูุญุณุงุจุงุช ุงููุทููุจุฉ:
ููู ูุนูู ุงููุธุงู ุงูุชููุงุฆูุ ูุฌุจ ุชููุฑ ุงูุญุณุงุจุงุช ุงูุชุงููุฉ:
- **1101** - ุงูููุฏูุฉ
- **1201** - ุงููุฏูููู
- **4101** - ุงูุฅูุฑุงุฏุงุช
- **2201** - ุงูุถุฑุงุฆุจ (ุงุฎุชูุงุฑู)

ุฅุฐุง ูู ุชูู ููุฌูุฏุฉุ ุงููููุฏ ูู ุชููุดุฃ ุชููุงุฆูุงู.

### 3. ุชูููุช ุฅูุดุงุก ุงููููุฏ:
- **ุงูููุงุชูุฑ**: ููุฑุงู ุนูุฏ ุงูุฅูุดุงุก
- **ุงููุฏููุนุงุช**: ููุท ุนูุฏ ุชุบููุฑ ุงูุญุงูุฉ ุฅูู `completed`

### 4. ุงูุชูุงูู ูุน ุงูุถุฑุงุฆุจ:
- ุฅุฐุง ูุงูุช ุงููุงุชูุฑุฉ ุชุญุชูู ุนูู ุถุฑูุจุฉ (`tax_amount > 0`)ุ ูุชู ุฅูุดุงุก ุณุทุฑ ุฅุถุงูู ููุถุฑุงุฆุจ
- ุฅุฐุง ูู ููู ุญุณุงุจ ุงูุถุฑุงุฆุจ (2201) ููุฌูุฏุงูุ ูุชู ุชุฎุทู ุณุทุฑ ุงูุถุฑูุจุฉ

---

## ๐๏ธ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ูุฅุตูุงุญูุง

### ุงููุดููุฉ: ุงูููุฏ ุงููุญุงุณุจู ูู ูููุดุฃ ุชููุงุฆูุงู

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**

1. **ุงูุญุณุงุจุงุช ุบูุฑ ููุฌูุฏุฉ:**
   ```sql
   -- ุชุญูู ูู ูุฌูุฏ ุงูุญุณุงุจุงุช
   SELECT account_code, account_name, is_active
   FROM chart_of_accounts
   WHERE account_code IN ('1101', '1201', '4101', '2201')
     AND company_id = 'company_id_ููุง';
   ```

2. **ุญุงูุฉ ุงูุฏูุนุฉ ููุณุช `completed`:**
   ```sql
   -- ุชุญูู ูู ุญุงูุฉ ุงูุฏูุนุฉ
   SELECT id, payment_number, payment_status
   FROM payments
   WHERE id = 'payment_id_ููุง';
   ```

3. **ุงูู Trigger ุบูุฑ ููุนูู:**
   ```sql
   -- ุชุญูู ูู ูุฌูุฏ ุงูู Triggers
   SELECT trigger_name, event_manipulation, event_object_table
   FROM information_schema.triggers
   WHERE trigger_schema = 'public'
     AND trigger_name IN ('trg_payment_journal_entry', 'trg_invoice_journal_entry');
   ```

### ุงูุญู:

ุฅุฐุง ูุฌุฏุช ุฃู ุงูู Triggers ุบูุฑ ููุฌูุฏุฉุ ูู ุจุชุดุบูู ูุฐุง ุงูุณูุฑุจุช:

```sql
-- ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูู Triggers
\i supabase/migrations/20250112001000_create_journal_entry_triggers.sql
```

---

## ๐ ุฅุญุตุงุฆูุงุช ุงููููุฏ ุงูุชููุงุฆูุฉ

```sql
-- ุฅุญุตุงุฆูุงุช ุงููููุฏ ุงูุชููุงุฆูุฉ ูู ุดูุฑ ููููุจุฑ 2025
SELECT 
    source_document_type AS 'ููุน ุงููุณุชูุฏ',
    COUNT(*) AS 'ุนุฏุฏ ุงููููุฏ',
    SUM(total_debit) AS 'ุฅุฌูุงูู ุงููุฏูู',
    SUM(total_credit) AS 'ุฅุฌูุงูู ุงูุฏุงุฆู'
FROM journal_entries
WHERE entry_type = 'automatic'
  AND entry_date BETWEEN '2025-11-01' AND '2025-11-30'
GROUP BY source_document_type;

-- ุงููุชูุฌุฉ ุงููุชููุนุฉ:
-- โโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโ
-- โ  ููุน ุงููุณุชูุฏ      โ  ุนุฏุฏ ุงููููุฏ  โ  ุฅุฌูุงูู ุงููุฏูู   โ  ุฅุฌูุงูู ุงูุฏุงุฆู  โ
-- โโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโค
-- โ  invoice          โ    150       โ   450,000.00     โ   450,000.00     โ
-- โ  payment          โ    200       โ   380,000.00     โ   380,000.00     โ
-- โโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุฎูุงุตุฉ ูููุญุงุณุจ

### ูุง ูุฌุจ ุฃู ุชุนุฑูู:

1. โ **ุงููุธุงู ุฐูู ูุชููุงุฆู ุจุงููุงูู**
   - ุงููููุฏ ุชููุดุฃ ุชููุงุฆูุงู ุฏูู ุชุฏุฎู ูุฏูู
   - ุฌููุน ุงููููุฏ ูุชูุงุฒูุฉ ููุชูุงููุฉ ูุน ุงููุนุงููุฑ ุงููุญุงุณุจูุฉ

2. โ **ุงูุฑุจุท ูุญูู ูุดูุงู**
   - ูู ููุฏ ูุฑุชุจุท ุจูุณุชูุฏู ุงูุฃุตูู (ูุงุชูุฑุฉ ุฃู ุฏูุนุฉ)
   - ูููู ุชุชุจุน ุฃู ููุฏ ูุงูุนูุฏุฉ ููุณุชูุฏู ุจุณูููุฉ

3. โ **ูุง ุญุงุฌุฉ ููููู ูู ุงูุฃุฎุทุงุก**
   - ุงููููุฏ ูุญุณูุจุฉ ุจุฏูุฉ ุฑูุงุถูุฉ
   - ุงููุนุงุฏูุฉ ุงููุญุงุณุจูุฉ ูุถูููุฉ ุฏุงุฆูุงู

4. โ **ุงูุชุฑููุฒ ุนูู ุงูุชุญููู ูููุณ ุงูุฅุฏุฎุงู**
   - ูููุฑ ููุชู ููุชุญููู ุงููุงูู
   - ุงููุธุงู ููุชู ุจุงูุฅุฏุฎุงู ูุงูุชุณุฌูู

### ุฏูุฑู ููุญุงุณุจ:

- ๐ **ุงููุฑุงุฌุนุฉ ูุงูุชุฏููู**: ุฑุงุฌุน ุงููููุฏ ุฏูุฑูุงู ููุชุฃูุฏ ูู ุตุญุชูุง
- ๐ **ุงูุชุญููู ุงููุงูู**: ุงุณุชุฎุฏู ุงูุชูุงุฑูุฑ ูุชุญููู ุงูุฃุฏุงุก ุงููุงูู
- ๐ฏ **ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช**: ุงุณุชูุฏ ุนูู ุงูุจูุงูุงุช ุงูุฏูููุฉ ูุงุชุฎุงุฐ ูุฑุงุฑุงุช ูุณุชููุฑุฉ
- ๐ **ุงูุฑูุงุจุฉ**: ุฑุงูุจ ุงูุงุชุฌุงูุงุช ุงููุงููุฉ ูุงูุงูุญุฑุงูุงุช

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ ุฃู ูุฏูู ุงุณุชูุณุงุฑ:
- ๐ง **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**: support@fleetifyapp.com
- ๐ฑ **ุงูุฏุนู ุงูููู**: +965-XXXX-XXXX
- ๐ **ุงููุซุงุฆู**: docs.fleetifyapp.com

---

**ุชู ุฅุนุฏุงุฏู ุจูุงุณุทุฉ:** ูุฑูู FleetifyApp  
**ุขุฎุฑ ุชุญุฏูุซ:** 6 ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0

