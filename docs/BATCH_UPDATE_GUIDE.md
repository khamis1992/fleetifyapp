# ุชุญุฏูุซ ุงูุนููุฏ ุจุทุฑููุฉ ุงูุชุฏุฑูุฌ (Batch Update)

## โ ุงููุดููุฉ
```
Error: SQL query ran into an upstream timeout
```

**ุงูุณุจุจ**: ุชุญุฏูุซ 409 ุนูุฏ ุฏูุนุฉ ูุงุญุฏุฉ ูุณุจุจ timeout ูู Supabase.

**ุงูุญู**: ุชุญุฏูุซ ุงูุนููุฏ ุนูู ุฏูุนุงุช ุตุบูุฑุฉ (batches).

---

## โ ุงูุญููู ุงููุชุงุญุฉ

### ุงูุญู 1: ุณูุฑูุจุช Node.js ุงูุชููุงุฆู (ุงูุฃุณูู) โญ

```bash
node update_contracts_batch.mjs
```

**ุงููููุฒุงุช:**
- โ ุชููุงุฆู ุจุงููุงูู - ูุง ูุญุชุงุฌ ุชุฏุฎู
- โ ูุญุฏุซ 50 ุนูุฏ ูู ุฏูุนุฉ
- โ ููุชุธุฑ ุซุงููุชูู ุจูู ูู ุฏูุนุฉ
- โ ูุนุฑุถ ุงูุชูุฏู ุงููุจุงุดุฑ
- โ ูุชููู ุชููุงุฆูุงู ุนูุฏ ุงูุงูุชูุงุก

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
๐ ุจุฏุก ุงูุชุญุฏูุซ ุงูุชุฏุฑูุฌู...
๐ฆ ุญุฌู ุงูุฏูุนุฉ: 50 ุนูุฏ
โฑ๏ธ  ุงูุงูุชุธุงุฑ ุจูู ุงูุฏูุนุงุช: 2 ุซุงููุฉ

๐ฆ ุงูุฏูุนุฉ 1:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ ุชู ุงูุนุซูุฑ ุนูู 50 ุนูุฏ ููุชุญุฏูุซ...
โ ุชู ุชุญุฏูุซ 50 ุนูุฏ ุจูุฌุงุญ
๐ ุงูุฅุฌูุงูู ุงููุญุฏุซ: 50
๐ ุงููุชุจูู: 359 ุนูุฏ
โณ ุงูุชุธุฑ 2 ุซุงููุฉ ูุจู ุงูุฏูุนุฉ ุงูุชุงููุฉ...

... (ูุณุชูุฑ ุญุชู ููุชูู)

๐ ุงูุชูู ุงูุชุญุฏูุซ ุจูุฌุงุญ!
โ ุฅุฌูุงูู ุงูุนููุฏ ุงููุญุฏุซุฉ: 409
```

---

### ุงูุญู 2: SQL ูุฏูู (ููุฐู 5 ูุฑุงุช)

**ุงูููู:** `.qoder/update_single_batch.sql`

```sql
-- ููุฐ ูุฐุง ุงูุงุณุชุนูุงู 5 ูุฑุงุช (ูู ูุฑุฉ ูุญุฏุซ 100 ุนูุฏ)
UPDATE contracts
SET status = 'cancelled', updated_at = NOW()
WHERE id IN (
    SELECT id FROM contracts 
    WHERE company_id = '24bc0b21-4e2d-4413-9842-31719a3669f4'
      AND status = 'under_review'
    LIMIT 100
);
```

**ุงูุฎุทูุงุช:**
1. ุงูุชุญ Supabase Dashboard โ SQL Editor
2. ุงูุณุฎ ุงูุงุณุชุนูุงู ุฃุนูุงู
3. ุงุถุบุท Run
4. ุงูุชุธุฑ ุซุงููุฉ
5. ูุฑุฑ 4 ูุฑุงุช ุฃุฎุฑู (ุฅุฌูุงูู 5 ูุฑุงุช)

---

### ุงูุญู 3: SQL ูุชูุฏู (ูุณุฎ ููุตู ูุงุญุฏ)

**ุงูููู:** `.qoder/update_contracts_batched.sql`

ูุฐุง ุงูููู ูุญุชูู ุนูู 5 ุฏูุนุงุช ุฌุงูุฒุฉ. ููุท:
1. ุงูุชุญ ุงูููู
2. ุงูุณุฎ ุงููุญุชูู ูุงููุงู
3. ุงูุตูู ูู Supabase SQL Editor
4. ุงุถุบุท Run ูุฑุฉ ูุงุญุฏุฉ

ุณูุชู ุชูููุฐ ุฌููุน ุงูุฏูุนุงุช ุชููุงุฆูุงู!

---

## ๐ ููุงุฑูุฉ ุงูุทุฑู

| ุงูุทุฑููุฉ | ุงูุณูููุฉ | ุงูุณุฑุนุฉ | ุงูุชุญูู | ุงูููุตู ุจู |
|---------|---------|---------|--------|-----------|
| Node.js Script | โญโญโญโญโญ | ูุชูุณุทุฉ | ุชููุงุฆู | โ ูุนู |
| SQL ูุฏูู (5ร) | โญโญโญ | ุณุฑูุนุฉ | ูุฏูู | ุฅุฐุง ูุดู Script |
| SQL ูุชูุฏู | โญโญโญโญ | ุณุฑูุนุฉ | ูุตู ุชููุงุฆู | ุจุฏูู ุฌูุฏ |

---

## โ๏ธ ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ

ุฅุฐุง ูุงุฌูุช ูุดุงููุ ุนุฏูู ูุฐู ุงูููู ูู `update_contracts_batch.mjs`:

```javascript
const BATCH_SIZE = 50;  // ููู ุฅูู 25 ุฅุฐุง ูุงู ุจุทูุก
const DELAY_MS = 2000;  // ุฒุฏ ุฅูู 3000 ุฅุฐุง ูุงู timeout
```

---

## ๐ ุงูุชุญูู ูู ุงูุชูุฏู

ูู ุฃู ููุชุ ููุฐ ูุฐุง ุงูุงุณุชุนูุงู ููุนุฑูุฉ ุงูุนุฏุฏ ุงููุชุจูู:

```sql
SELECT 
    COUNT(*) as remaining,
    'โ ุงููุญุฏุซ: ' || (409 - COUNT(*)) as updated
FROM contracts
WHERE company_id = '24bc0b21-4e2d-4413-9842-31719a3669f4'
  AND status = 'under_review';
```

---

## โฑ๏ธ ุงูููุช ุงููุชููุน

| ุงูุทุฑููุฉ | ุงูููุช |
|---------|-------|
| Node.js Script | 4-5 ุฏูุงุฆู |
| SQL ูุฏูู (5ร) | 2-3 ุฏูุงุฆู |
| SQL ูุชูุฏู | 1-2 ุฏูููุฉ |

---

## ๐ ุงุจุฏุฃ ุงูุขู!

### ุฎูุงุฑ ุณุฑูุน:
```bash
cd c:\Users\khamis\Desktop\fleetifyapp-3
node update_contracts_batch.mjs
```

### ุฎูุงุฑ ูุฏูู:
1. ุงูุชุญ: https://supabase.com/dashboard
2. SQL Editor โ New Query
3. ุงูุณุฎ ูู: `.qoder/update_single_batch.sql`
4. Run ร 5 ูุฑุงุช

---

**ุงูุญุงูุฉ**: โณ ุฌุงูุฒ ููุชูููุฐ  
**ุงูุชูุตูุฉ**: ุงุณุชุฎุฏู `update_contracts_batch.mjs`
