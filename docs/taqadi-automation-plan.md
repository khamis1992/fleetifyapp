# ุฎุทุฉ ุฃุชูุชุฉ ุฑูุน ุงูุฏุนุงูู ุนูู ููุตุฉ ุชูุงุถู

## ูุธุฑุฉ ุนุงูุฉ
ูุฐุง ุงููุณุชูุฏ ูุญุชูู ุนูู ุฎุทุฉ ูุงููุฉ ูุฃุชูุชุฉ ุนูููุฉ ุฑูุน ุงูุฏุนุงูู ุงููุงููููุฉ ุนูู ููุตุฉ ุชูุงุถู ุงูุฅููุชุฑูููุฉ ุจุงุณุชุฎุฏุงู Puppeteer.

---

## 1. ุงูุจูุฆุฉ ุงูุชูููุฉ

### ุงููุชุทูุจุงุช:
- **Node.js** (v18+)
- **Puppeteer** (ุฃุญุฏุซ ุฅุตุฏุงุฑ)
- **ุงููุชุตูุญ:** Chrome/Chromium
- **ุงููููุน:** ูุนูู ูุญููุงู (ุงููุณุชุฎุฏู ูู ูุทุฑ - IP ูุญูู)
- **ุงูุชุญุฏู:** ูููุน ุชูุงุถู ูุฑูุถ VPN ููุชุทูุจ IP ูุทุฑู

### ุงูุญู ุงูููุชุฑุญ:
```javascript
// ุงุณุชุฎุฏุงู User Data Directory ููุงุณุชูุงุฏุฉ ูู ุฌูุณุฉ ุชุณุฌูู ุงูุฏุฎูู ุงูููุฌูุฏุฉ
const browser = await puppeteer.launch({
  headless: false, // ูููุฑุงูุจุฉ ูุงูุชุทููุฑ
  userDataDir: './taqadi-user-data', // ุญูุธ ุงูุฌูุณุฉ
  args: [
    '--no-sandbox',
    '--disable-setuid-sandbox',
    '--disable-blink-features=AutomationControlled'
  ]
});
```

---

## 1.1 ูุจุฏุฃ ุงูุชูููุฐ (ููู)

### ููุงุฐุง ูุง ูุฑุณู โFileโ ูู ุงููุงุฌูุฉ ูุจุงุดุฑุฉุ
- ูููุงุช ุงูุฏุนูู ูู ุตูุญุฉ **ุชุฌููุฒ ุงูุฏุนูู** ูุชู ุชูููุฏูุง **ูู ุงููุชุตูุญ** (PDF/DOCX/ZIP) ุฃู ุชูุฌูุจ ุนุจุฑ ุฑูุงุจุท Storage.
- ูุฐูู ุฃุถูู ุทุฑููุฉ ููุญุตูู ุนูู **ูุณุงุฑุงุช ูููุงุช ุญููููุฉ** ููุฑูุน ูู ุชูุงุถู ูู:
  1. ูุชุญ ุตูุญุฉ Fleetify (ุชุฌููุฒ ุงูุฏุนูู) ุฏุงุฎู ููุณ ูุชุตูุญ Puppeteer.
  2. ุชูุฒูู **ZIP** โุชุญููู ุฌููุน ุงููุณุชูุฏุงุชโ ุฅูู ูุฌูุฏ ูุนุฑูู.
  3. ููู ุถุบุท ZIP ุฅูู ูุฌูุฏ ุนูู (working dir).
  4. ุฑูุน ุงููููุงุช ุฅูู ุชูุงุถู ูู ุงููุฑุต ุนุจุฑ `input[type=file]`.

---

## 2. ูุตุฏุฑ ุงูุจูุงูุงุช

### ูู ุตูุญุฉ "ุชุฌููุฒ ุฏุนูู" (`LawsuitPreparation.tsx`):

```typescript
interface TaqadiData {
  // ูู taqadiData
  caseTitle: string;           // ุนููุงู ุงูุฏุนูู
  facts: string;               // ุงูููุงุฆุน (HTML)
  claims: string;              // ุงูุทูุจุงุช (HTML)
  amount: number;              // ูููุฉ ุงูุฏุนูู ุจุงูุฃุฑูุงู
  amountInWords: string;       // ูููุฉ ุงูุฏุนูู ุจุงููุชุงุจุฉ
  
  // ุจูุงูุงุช ุงูุฃุทุฑุงู
  plaintiff1: {                // ุดุฑูุฉ ุงูุนุฑุงู
    type: 'company';
    name: string;
    commercialRegistration: string;
    address: string;
    phone: string;
    email: string;
    bankDetails: {
      nameAr: string;
      nameEn: string;
      iban: string;
      swift: string;
      address: string;
      country: string;
    };
  };
  
  plaintiff2: {                // ุฎููุณ ุงูุฌุจุฑ
    type: 'individual';
    firstName: string;
    middleName: string;
    lastName: string;
    nationality: string;
    idType: string;
    idNumber: string;
    birthDate: string;
    gender: string;
    phone: string;
    email: string;
    address: string;
    bankDetails: { /* ... */ };
  };
  
  defendant: {                 // ุงูุนููู (ุงููุฏุนู ุนููู)
    type: 'individual';
    firstName: string;
    middleName: string;
    lastName: string;
    nationality: string;
    idType: string;
    idNumber: string;
    phone: string;
    email: string;
    address: string;
  };
  
  // ุงููุณุชูุฏุงุช
  documents: {
    explanatoryMemo: File;     // ุงููุฐูุฑุฉ ุงูุดุงุฑุญุฉ
    lawsuitPetition: File;     // ุตุญููุฉ ุงูุฏุนูู
    rentalContract: File;      // ุนูุฏ ุงูุฅูุฌุงุฑ
    commercialReg: File;       // ุงูุณุฌู ุงูุชุฌุงุฑู
  };
}
```

---

## 2.1 ูุตุฏุฑ ุงููููุงุช (ูู ุตูุญุฉ ุชุฌููุฒ ุงูุฏุนูู) โ ุงููุงูุน ุงููุนูู

### ุชูุฒูู ุงููููุงุช ุงููุชุงุญุฉ (ุญุณุจ `LawsuitPreparation.tsx`)

- **ุงููุฐูุฑุฉ ุงูุดุงุฑุญุฉ**:
  - ุชูุฒูู PDF: `downloadHtmlAsPdf(memoHtmlRef.current, filename)`
  - ุชูุฒูู Word: `downloadHtmlAsDocx(memoHtmlRef.current, filename)`
- **ูุดู ุงููุทุงูุจุงุช ุงููุงููุฉ**: ุชูููุฏ HTML ุฏุงุฎูู (`claimsHtmlRef.current`) ูููุณุชุฎุฏู ุฏุงุฎู ZIP ูููู HTML.
- **ูุณุชูุฏุงุช ุงูุดุฑูุฉ**: ุชูุฌูุจ ูู ุฑูุงุจุท (`doc.file_url`) ูุชูุถุงู ููู ZIP ุจุนุฏ `fetch()`.
- **ุนูุฏ ุงูุฅูุฌุงุฑ**: ููุฌูุจ ูู `contractFileUrl` ูููุถุงู ููู ZIP ุจุนุฏ `fetch()`.
- **Download All ZIP**:
  - ุงุณู ุงูููู: `ุฏุนูู_{customerName}_{contract_number}.zip` (ูุน sanitize)
  - ุงููููุงุช ุฏุงุฎู ZIP (ุฃุณูุงุก ุซุงุจุชุฉ ุชูุฑูุจุงู):
    - `1_ุงููุฐูุฑุฉ_ุงูุดุงุฑุญุฉ.pdf`
    - `2_ูุดู_ุงููุทุงูุจุงุช_ุงููุงููุฉ.html`
    - `5_ุงูุณุฌู_ุงูุชุฌุงุฑู.pdf` (ุฃู ุตูุฑุฉ ุญุณุจ ุงููุตุฏุฑ)
    - `6_ุดูุงุฏุฉ_IBAN.pdf`
    - `7_ุงูุจุทุงูุฉ_ุงูุดุฎุตูุฉ_ููููุซู.pdf`
    - `8_ุนูุฏ_ุงูุฅูุฌุงุฑ.pdf` (ุฃู ุตูุฑุฉ)
    - (ุงุฎุชูุงุฑู) `3_ุจูุงุบ_ุณุฑูุฉ_ุงููุฑูุจุฉ.html`
    - (ุงุฎุชูุงุฑู) `4_ุทูุจ_ุชุญููู_ุงููุฎุงููุงุช.html`

**ุงููุชูุฌุฉ:** ูู ุงูุฃุชูุชุฉุ ุณูุนุชูุฏ ุนูู ุฒุฑ **ุชุญููู ุฌููุน ุงููุณุชูุฏุงุช ZIP** ูู ุตูุญุฉ ุชุฌููุฒ ุงูุฏุนูู ููุญุตูู ุนูู ูููุงุช ุฌุงูุฒุฉ ููุฑูุน.

---

## 3. ูุฑุงุญู ุงูุฃุชูุชุฉ (6 ูุฑุงุญู)

## 3.0 ูุงุนุฏุฉ ุงุฎุชูุงุฑ ุงูู Selectors ูู ุชูุงุถู (Kendo UI)

ุชูุงุถู ูุนุชูุฏ ูุซูุฑุงู ุนูู Kendo UI (ListBox/Combobox). ูุฐูู ูุง ูุนุชูุฏ ุนูู `name=` ุงูุงูุชุฑุงุถูุฉ.

### Strategy (ููุงูู ูุชุบููุฑ ุงููุงุฌูุฉ)
- **ุงูุฃุฒุฑุงุฑ**: XPath ุจุงููุต ุงูุนุฑุจู (ูุซุงู: `//button[contains(.,'ุฅุถุงูุฉ ูุซููุฉ')]`).
- **ุญููู ุงูุฅุฏุฎุงู**: ุงูุฑุจุท ุจุงูู label ุงููุตู ุซู โุฃูุฑุจ inputโ ุจุนุฏู.
- **ููุงุฆู Kendo**:
  1. ุงูุชุญ ุงููุงุฆูุฉ ุจุงูููุฑ ุนูู ุนูุตุฑ ุงูู listbox ุจุฌุงูุจ label.
  2. ุงุฎุชุฑ `li[role="option"]` ุจุงููุต (ูุซุงู: โูุทุฑโ, โุงููุฏุนู ุนูููโ).
- **ุงูุชุญูู ุจุนุฏ ุงูุญูุธ**: ุงูุชุฃูุฏ ุฃู ุงูุตู/ุงููููุฉ ุธูุฑุช ูู ุงูุฌุฏูู ูุจู โุงูุชุงููโ.

> ููุงุญุธุฉ: `:has-text()` ููุณุช CSS ููุงุณูุฉ ูู Puppeteer. ุงุณุชุฎุฏู XPath ุฃู helper functions.

### ุงููุฑุญูุฉ 0: ููุน ุงูุฏุนูู (0%)

**ุงูุฎุทูุงุช:**
1. ุงูุงูุชูุงู ุฅูู ุตูุญุฉ ุฅูุดุงุก ุฏุนูู
2. ุงุฎุชูุงุฑ "ุฏุนูู ูุฏููุฉ"
3. ุงุฎุชูุงุฑ "ุฅูุฌุงุฑ"
4. ุงุฎุชูุงุฑ "ุทุฑุฏ ููุฅุฎูุงู ุจุงูุนูุฏ"
5. ุงูููุฑ ุนูู "ุงูุชุงูู"

**Selectors (ูุซุงู ุนููู ุจููุฌ ุงููุต):**
- ุฒุฑ ุงูุชุงูู: `//a[contains(.,'ุงูุชุงูู')]`
- ุงุฎุชูุงุฑ โุฏุนูู ูุฏููุฉ / ุฅูุฌุงุฑ / ุทุฑุฏ ููุฅุฎูุงู ุจุงูุนูุฏโ: ูุชู ุนุจุฑ ุนูุงุตุฑ Kendo (ูุชุญ ุงููุงุฆูุฉ ุซู ุงุฎุชูุงุฑ option ุจุงููุต).

---

### ุงููุฑุญูุฉ 1: ุชูุงุตูู ุงูุฏุนูู (20%)

**ุงูุฎุทูุงุช:**
1. ููุก "ุนููุงู ุงูุฏุนูู" (`taqadiData.caseTitle`)
2. ููุก "ุงูููุงุฆุน" ูู Rich Text Editor (`taqadiData.facts`)
3. ููุก "ุงูุทูุจุงุช" ูู Rich Text Editor (`taqadiData.claims`)
4. ููุก "ูููุฉ ุงูุฏุนูู" ุจุงูุฃุฑูุงู (`taqadiData.amount`)
5. ููุก "ูููุฉ ุงูุฏุนูู" ุจุงููุชุงุจุฉ (`taqadiData.amountInWords`)
6. ุงูููุฑ ุนูู "ุงูุชุงูู"

**Selectors (ููุฌ labelโinput):**
- ุนููุงู ุงูุฏุนูู: ุงุจุญุซ ุนู label โุนููุงู ุงูุฏุนููโ ุซู ุฃุฏุฎู ุจุงููููุฉ ูู textbox ุจุนุฏู.
- ุงูููุงุฆุน/ุงูุทูุจุงุช: Rich editor ุฏุงุฎู iframe (ูุชู ุชุญุฏูุฏ iframe ุงููุฑูุจ ูู label โุงูููุงุฆุน/ุงูุทูุจุงุชโ).
- ุงูุชุงูู: `//a[contains(.,'ุงูุชุงูู')]`

**ููุงุญุธุฉ ุฎุงุตุฉ - Rich Text Editor:**
```javascript
// ูููุชุงุจุฉ ูู Rich Text Editor (iframe)
async function fillRichTextEditor(page, iframeSelector, htmlContent) {
  const iframe = await page.$(iframeSelector);
  const frame = await iframe.contentFrame();
  
  await frame.evaluate((html) => {
    const editor = document.querySelector('p') || document.body;
    editor.innerHTML = html;
    document.body.dispatchEvent(new Event('input', { bubbles: true }));
    document.body.dispatchEvent(new Event('change', { bubbles: true }));
  }, htmlContent);
}
```

---

### ุงููุฑุญูุฉ 2: ุฃุทุฑุงู ุงูุฏุนูู (40%)

**ุงูุฎุทูุงุช:**

#### ุฃ) ุฅุถุงูุฉ ุดุฑูุฉ ุงูุนุฑุงู (ูุฏุนู - ุชุฑุชูุจ 1):
1. ุงูููุฑ ุนูู "+ ุฅุถุงูุฉ ุทุฑู"
2. ุงุฎุชูุงุฑ "ุชุตููู ุงูุทุฑู": **ุดุฑูุฉ**
3. ุงุฎุชูุงุฑ "ุตูุฉ ุงูุทุฑู": **ูุฏุนู**
4. ุชุนููู "ุงูุชุฑุชูุจ": **1**
5. ููุก ุจูุงูุงุช ุงูุดุฑูุฉ:
   - ุงุณู ุงูุดุฑูุฉ
   - ุงูุณุฌู ุงูุชุฌุงุฑู
   - ุงูุนููุงู
   - ุฑูู ุงููุงุชู
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ุชูุงุตูู ุงูุจูู (IBAN, SWIFT, ุฅูุฎ)
6. ุงูููุฑ ุนูู "ุญูุธ"

#### ุจ) ุฅุถุงูุฉ ุฎููุณ ุงูุฌุจุฑ (ูุฏุนู - ุชุฑุชูุจ 2):
1. ุงูููุฑ ุนูู "+ ุฅุถุงูุฉ ุทุฑู"
2. ุงุฎุชูุงุฑ "ุชุตููู ุงูุทุฑู": **ุดุฎุต ุทุจูุนู**
3. ุงุฎุชูุงุฑ "ุตูุฉ ุงูุทุฑู": **ูุฏุนู**
4. ุชุนููู "ุงูุชุฑุชูุจ": **2**
5. ููุก ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ:
   - ุงูุงุณู ุงูุฃููุ ุงูุซุงููุ ุงูุซุงูุซุ ุงูุนุงุฆูุฉ
   - ุชุงุฑูุฎ ุงููููุงุฏ
   - ุงูููุน (ุฐูุฑ/ุฃูุซู)
   - ุงูุฌูุณูุฉ
   - ููุน ุงูุจุทุงูุฉ
   - ุฑูู ุงูุจุทุงูุฉ
   - ุฑูู ุงููุงุชู
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ุงูุนููุงู
   - ุชูุงุตูู ุงูุจูู
6. ุงูููุฑ ุนูู "ุญูุธ"

#### ุฌ) ุฅุถุงูุฉ ุงูุนููู (ูุฏุนู ุนููู - ุชุฑุชูุจ 1):
1. ุงูููุฑ ุนูู "+ ุฅุถุงูุฉ ุทุฑู"
2. ุงุฎุชูุงุฑ "ุชุตููู ุงูุทุฑู": **ุดุฎุต ุทุจูุนู**
3. ุงุฎุชูุงุฑ "ุตูุฉ ุงูุทุฑู": **ุงููุฏุนู ุนููู**
4. ุชุนููู "ุงูุชุฑุชูุจ": **1**
5. ููุก ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ (ููุณ ุงูุญููู)
6. ุงูููุฑ ุนูู "ุญูุธ"

7. ุงูููุฑ ุนูู "ุงูุชุงูู"

**ููุงุนุฏ ุชุญูู ูุจู โุงูุชุงููโ (ูููุฉ):**
- ูุฌุจ ุถุจุท ุชุฑุชูุจ ุงูุฃุทุฑุงู ููุง ููู (ุญุณุจ ุชุฌุฑุจุชูุง):
  - **ุดุฑูุฉ ุงูุนุฑุงู ูุชุฃุฌูุฑ ุงูุณูุงุฑุงุช** = **1**
  - **ุฎููุณ ุงูุฌุจุฑ** = **2**
  - **ุงููุฏุนู ุนููู** = **1**

**Selectors (XPath/label-based):**
- ุฅุถุงูุฉ ุทุฑู: `//button[contains(.,'ุฅุถุงูุฉ ุทุฑู')]`
- ุญูุธ ุฏุงุฎู ูุงูุฐุฉ ุงูุทุฑู: `//button[contains(.,'ุญูุธ')]`
- ุชุญุฏูุซ ุตู ุทุฑู: ุฑุงุจุท โุชุญุฏูุซโ ุฏุงุฎู ุตู ุงูุงุณู (ุงุณุชุฎุฏู XPath ูุญุชูู ุงุณู ุงูุทุฑู ุซู ุฒุฑ ุงูุชุญุฏูุซ ูู ููุณ ุงูุตู).
- ุชุฑุชูุจ ุญุณุจ ุตุญููุฉ ุงูุฏุนูู: label โุงูุชุฑุชูุจ ุญุณุจ ุตุญููุฉ ุงูุฏุนููโ ุซู input/spinbutton ุงูุชุงูู ููุง.

**ููุงุญุธุฉ ูููุฉ:**
- ูุฌุจ ุงูุงูุชุธุงุฑ ุจุนุฏ ุงูููุฑ ุนูู "ุญูุธ" (3-5 ุซูุงูู) ููุชุฃูุฏ ูู ุญูุธ ุงูุจูุงูุงุช
- ุงูุชุญูู ูู ุธููุฑ ุงูุทุฑู ูู ุงูุฌุฏูู ูุจู ุงููุชุงุจุนุฉ

---

### ุงููุฑุญูุฉ 3: ุงููุณุชูุฏุงุช (60%)

**ุงูุฎุทูุงุช (ุจูุงุกู ุนูู ุงููุงูุน: ุงููููุงุช ูููุง ูู ุตูุญุฉ ุชุฌููุฒ ุงูุฏุนูู):**

#### (A) ุชุฌููุฒ ุงููููุงุช ูู Fleetify (ูุจู ุฑูุนูุง ูู ุชูุงุถู)
1. ุงูุชุญ ุตูุญุฉ ุชุฌููุฒ ุงูุฏุนูู:
   - `http://localhost:8080/legal/lawsuit/prepare/{contractId}`
2. ุงุถุบุท ุฒุฑ **ุชุญููู ุฌููุน ุงููุณุชูุฏุงุช ZIP**.
3. ุงุฌุนู Puppeteer ูุญููู ุงููููุงุช ุฅูู ูุฌูุฏ ุซุงุจุช ูุซู: `./taqadi-work/downloads`
4. ูู ุถุบุท ZIP ุฅูู: `./taqadi-work/cases/{contractId}/`
5. ุฌููุฒ mapping ุจูู ุงููููุงุช ุฏุงุฎู ZIP ูุฃููุงุน ุงููุณุชูุฏุงุช ูู ุชูุงุถู (ุญุณุจ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ูู ุชูุงุถู).

#### (B) ุงูุฑูุน ูู ุชูุงุถู
1. ุงูุชุญ ุชุจููุจ โุงููุณุชูุฏุงุช (60%)โ
2. ุงุถุบุท โุฅุถุงูุฉ ูุซููุฉโ
3. ุงุฎุชุฑ ููุน ุงููุณุชูุฏ ูู ูุงุฆูุฉ Kendo
4. ุงุฑูุน ุงูููู ูู ุงููุฑุต ุนุจุฑ `input[type=file]`
5. ูุฑุฑ ููู ููู ุฅูุฒุงูู
6. ุงุถุบุท โุงูุชุงููโ

**Selectors (XPath/role-based):**
- ุฅุถุงูุฉ ูุซููุฉ: `//button[contains(.,'ุฅุถุงูุฉ ูุซููุฉ')]`
- ุญูู ุงุฎุชูุงุฑ ููุน ุงููุณุชูุฏ: label โุงูููุนโ ุฏุงุฎู ูุงูุฐุฉ ุงูุฅุถุงูุฉ ุซู listbox ุจุนุฏูุง
- ุฑูุน/ุญูุธ ุฏุงุฎู ูุงูุฐุฉ ุงููุซููุฉ: `//button[contains(.,'ุญูุธ') or contains(.,'ุฑูุน')]`
- input file: `//input[@type='file']`

---

### ุงููุฑุญูุฉ 4: ุชูุงุตูู ุงูุฑุณูู (80%)

**ุญุณุจ ุชุฏููู:** ุจุนุฏ ุฑูุน ุงููููุงุช โ โุงูุชุงููโ โ ุชุธูุฑ ุตูุญุฉ ุงูุฑุณูู ุซู โุงูุชุงููโ.

**ุงูุฎุทูุงุช:**
1. ูุฑุงุฌุนุฉ ุงูุฑุณูู/ุงูุชุญูู ุฃููุง ูุญูููุฉ
2. โุงูุชุงููโ

---

### ุงููุฑุญูุฉ 5: ููุฎุต ุงูุฏุนูู (100%)

**ุงูุฎุทูุงุช (ุญุณุจ ุชุฏููู):**
1. ูุฑุงุฌุนุฉ ุงูููุฎุต
2. ุงูุถุบุท ุนูู **ุงุนุชูุงุฏ** ุซู ุชุฃููุฏ (ุฅู ููุฌุฏ)
3. โ ูุชู ุฑูุน ุงูุฏุนูู

---

## 4. ูููู ุงูููุฏ ุงูููุชุฑุญ

```
taqadi-automation/
โโโ src/
โ   โโโ config/
โ   โ   โโโ selectors.ts          # ุฌููุน ุงูู CSS Selectors
โ   โ   โโโ constants.ts          # ุงูุซูุงุจุช ูุงูุฅุนุฏุงุฏุงุช
โ   โโโ services/
โ   โ   โโโ browser.service.ts    # ุฅุฏุงุฑุฉ ุงููุชุตูุญ
โ   โ   โโโ auth.service.ts       # ุงูุชุนุงูู ูุน ุชุณุฌูู ุงูุฏุฎูู
โ   โ   โโโ navigation.service.ts # ุงูุชููู ุจูู ุงูุตูุญุงุช
โ   โโโ stages/
โ   โ   โโโ stage0-case-type.ts   # ููุน ุงูุฏุนูู
โ   โ   โโโ stage1-case-details.ts # ุชูุงุตูู ุงูุฏุนูู
โ   โ   โโโ stage2-parties.ts     # ุฃุทุฑุงู ุงูุฏุนูู
โ   โ   โโโ stage3-documents.ts   # ุงููุณุชูุฏุงุช
โ   โ   โโโ stage4-fees.ts        # ุงูุฑุณูู
โ   โ   โโโ stage5-summary.ts     # ุงูููุฎุต ูุงูุงุนุชูุงุฏ
โ   โโโ utils/
โ   โ   โโโ wait.ts               # ุฏูุงู ุงูุงูุชุธุงุฑ
โ   โ   โโโ retry.ts              # ุฅุนุงุฏุฉ ุงููุญุงููุฉ
โ   โ   โโโ logger.ts             # ุงูุณุฌูุงุช
โ   โโโ index.ts                  # ููุทุฉ ุงูุจุฏุงูุฉ
โโโ data/
โ   โโโ lawsuit-data.json         # ุจูุงูุงุช ุงูุฏุนูู
โโโ logs/
โ   โโโ automation.log            # ุณุฌู ุงูุนูููุงุช
โโโ package.json
```

---

## 5. ูุซุงู ุนูู ุงูููุฏ ุงูุฑุฆูุณู

```typescript
// src/index.ts
import { launchBrowser } from './services/browser.service';
import { fillCaseType } from './stages/stage0-case-type';
import { fillCaseDetails } from './stages/stage1-case-details';
import { fillParties } from './stages/stage2-parties';
import { uploadDocuments } from './stages/stage3-documents';
import { fillFees } from './stages/stage4-fees';
import { submitLawsuit } from './stages/stage5-summary';
import lawsuitData from '../data/lawsuit-data.json';

async function automateTaqadiLawsuit() {
  const browser = await launchBrowser();
  const page = await browser.newPage();
  
  try {
    // ุงูุชููู ุฅูู ุตูุญุฉ ุฅูุดุงุก ุฏุนูู
    await page.goto('https://taqadi.sjc.gov.qa/itc/f/caseinfo/create');
    
    // ุงููุฑุญูุฉ 0: ููุน ุงูุฏุนูู
    console.log('๐ ุงููุฑุญูุฉ 0: ุงุฎุชูุงุฑ ููุน ุงูุฏุนูู...');
    await fillCaseType(page, lawsuitData.caseType);
    
    // ุงููุฑุญูุฉ 1: ุชูุงุตูู ุงูุฏุนูู
    console.log('๐ ุงููุฑุญูุฉ 1: ููุก ุชูุงุตูู ุงูุฏุนูู...');
    await fillCaseDetails(page, lawsuitData.details);
    
    // ุงููุฑุญูุฉ 2: ุฃุทุฑุงู ุงูุฏุนูู
    console.log('๐ฅ ุงููุฑุญูุฉ 2: ุฅุถุงูุฉ ุฃุทุฑุงู ุงูุฏุนูู...');
    await fillParties(page, lawsuitData.parties);
    
    // ุงููุฑุญูุฉ 3: ุงููุณุชูุฏุงุช
    console.log('๐ ุงููุฑุญูุฉ 3: ุฑูุน ุงููุณุชูุฏุงุช...');
    await uploadDocuments(page, lawsuitData.documents);
    
    // ุงููุฑุญูุฉ 4: ุงูุฑุณูู
    console.log('๐ฐ ุงููุฑุญูุฉ 4: ุชูุงุตูู ุงูุฑุณูู...');
    await fillFees(page);
    
    // ุงููุฑุญูุฉ 5: ุงูุงุนุชูุงุฏ
    console.log('โ ุงููุฑุญูุฉ 5: ุงุนุชูุงุฏ ูุฑูุน ุงูุฏุนูู...');
    await submitLawsuit(page);
    
    console.log('๐ ุชู ุฑูุน ุงูุฏุนูู ุจูุฌุงุญ!');
    
  } catch (error) {
    console.error('โ ุญุฏุซ ุฎุทุฃ:', error);
    // ุงูุชูุงุท ุตูุฑุฉ ููุดุงุดุฉ ุนูุฏ ุงูุฎุทุฃ
    await page.screenshot({ path: `logs/error-${Date.now()}.png` });
  } finally {
    await browser.close();
  }
}

// ุชุดุบูู ุงูุฃุชูุชุฉ
automateTaqadiLawsuit();
```

---

## 6. ุงูุชุญุฏูุงุช ูุงูุญููู

### ุงูุชุญุฏู 1: CAPTCHA
**ุงูุญู:** ุงุณุชุฎุฏุงู User Data Directory ููุงุณุชูุงุฏุฉ ูู ุฌูุณุฉ ูุณุฌูุฉ ูุณุจูุงู

### ุงูุชุญุฏู 2: IP Restriction
**ุงูุญู:** ุงูุชุดุบูู ูุญููุงู ูู ูุทุฑ (ุงููุณุชุฎุฏู ููุฌูุฏ ูู ูุทุฑ)

### ุงูุชุญุฏู 3: Rich Text Editor (iframe)
**ุงูุญู:** ุงุณุชุฎุฏุงู `contentFrame()` ูุงููุตูู ุฅูู DOM ุฏุงุฎู ุงูู iframe

### ุงูุชุญุฏู 4: ุงูููุงุฆู ุงูููุณุฏูุฉ (Kendo UI)
**ุงูุญู:** ุงุณุชุฎุฏุงู JavaScript `evaluate()` ููููุฑ ุนูู ุงูุฎูุงุฑุงุช ูุจุงุดุฑุฉ

### ุงูุชุญุฏู 5: ุงูุนูููุงุช ุบูุฑ ุงููุชุฒุงููุฉ (ุญูุธ ุงูุจูุงูุงุช)
**ุงูุญู:** ุงูุงูุชุธุงุฑ ุจุนุฏ ูู ุนูููุฉ ุญูุธ ูุงูุชุญูู ูู ุธููุฑ ุงูุจูุงูุงุช ูู ุงูุฌุฏูู

---

## 7. ุฎุทูุงุช ุงูุชูููุฐ

### ุงููุฑุญูุฉ ุงูุฃููู: ุงูุฅุนุฏุงุฏ (1-2 ููู)
- [ ] ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ
- [ ] ุฅุนุฏุงุฏ ูููู ุงููุดุฑูุน
- [ ] ุฅูุดุงุก ููู ุงูุจูุงูุงุช (lawsuit-data.json)
- [ ] ุชุฌููุฒ User Data Directory

### ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุชุทููุฑ ุงููุฑุงุญู (3-5 ุฃูุงู)
- [ ] ุชุทููุฑ ุงููุฑุญูุฉ 0: ููุน ุงูุฏุนูู
- [ ] ุชุทููุฑ ุงููุฑุญูุฉ 1: ุชูุงุตูู ุงูุฏุนูู
- [ ] ุชุทููุฑ ุงููุฑุญูุฉ 2: ุฃุทุฑุงู ุงูุฏุนูู
- [ ] ุชุทููุฑ ุงููุฑุญูุฉ 3: ุงููุณุชูุฏุงุช
- [ ] ุชุทููุฑ ุงููุฑุญูุฉ 4: ุงูุฑุณูู
- [ ] ุชุทููุฑ ุงููุฑุญูุฉ 5: ุงูุงุนุชูุงุฏ

### ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ุงูุงุฎุชุจุงุฑ (2-3 ุฃูุงู)
- [ ] ุงุฎุชุจุงุฑ ูู ูุฑุญูุฉ ุนูู ุญุฏุฉ
- [ ] ุงุฎุชุจุงุฑ ุงูุนูููุฉ ุงููุงููุฉ
- [ ] ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุงูุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ
- [ ] ุชุญุณูู ุงูุฃุฏุงุก

### ุงููุฑุญูุฉ ุงูุฑุงุจุนุฉ: ุงูุชูุงูู (1-2 ููู)
- [ ] ุฑุจุท ุงูุฃุชูุชุฉ ูุน ุตูุญุฉ "ุชุฌููุฒ ุฏุนูู" ูู FleetifyApp
- [ ] ุฅุถุงูุฉ ุฒุฑ "ุฑูุน ุชููุงุฆู ุฅูู ุชูุงุถู"
- [ ] ุนุฑุถ ุญุงูุฉ ุงูุชูุฏู ูููุณุชุฎุฏู
- [ ] ุญูุธ ุฑูู ุงูุฏุนูู ุจุนุฏ ุงูุฑูุน

---

## 8. ุงูุฑุจุท ูุน FleetifyApp

### ุฅุถุงูุฉ ุฒุฑ ูู ุตูุญุฉ ุชุฌููุฒ ุงูุฏุนูู:

```typescript
// ูู LawsuitPreparation.tsx
const handleAutoSubmitToTaqadi = async () => {
  setIsSubmitting(true);
  
  try {
    // ุงุณุชุฏุนุงุก API ูุญูู ูุดุบู Puppeteer โ ูุฑุณู ููุท contractId ูุฅุนุฏุงุฏุงุช ุงูุชุดุบูู
    // (ุงููููุงุช ุณูุชู ุชูุฒูููุง ูู ุตูุญุฉ ุชุฌููุฒ ุงูุฏุนูู ูู ZIP ุฏุงุฎู Puppeteer)
    const response = await fetch('http://localhost:3001/api/taqadi/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contractId,
        prepareUrl: window.location.href,
        downloadDir: 'taqadi-work/downloads'
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      toast.success(`ุชู ุฑูุน ุงูุฏุนูู ุจูุฌุงุญ! ุฑูู ุงูุฏุนูู: ${result.caseNumber}`);
    }
  } catch (error) {
    toast.error('ูุดู ุฑูุน ุงูุฏุนูู');
  } finally {
    setIsSubmitting(false);
  }
};
```

### ุฅูุดุงุก API ูุญูู (Express):

```typescript
// server/taqadi-api.ts
import express from 'express';
import { automateTaqadiLawsuit } from './taqadi-automation';

const app = express();
app.use(express.json());

app.post('/api/taqadi/submit', async (req, res) => {
  try {
    const { contractId, prepareUrl, downloadDir } = req.body;
    // ุงูุฃุชูุชุฉ:
    // 1) ูุชุญ prepareUrl โ ุชูุฒูู ZIP โ ูููู
    // 2) ูุชุญ ุชูุงุถู โ ุชุนุจุฆุฉ ุงูุญููู ูู taqadiData (ูููุฑุฃ ูู ุงูุตูุญุฉ ุฃู ูู DB) โ ุฑูุน ูููุงุช ูู ุงููุณุงุฑุงุช ุงููุงุชุฌุฉ
    const result = await automateTaqadiLawsuit({ contractId, prepareUrl, downloadDir });
    
    res.json({
      success: true,
      caseNumber: result.caseNumber,
      message: 'ุชู ุฑูุน ุงูุฏุนูู ุจูุฌุงุญ'
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

app.listen(3001, () => {
  console.log('๐ Taqadi Automation API running on port 3001');
});
```

---

## 9. ุงูููุงุญุธุงุช ุงูููุงุฆูุฉ

### โ ุงููุฒุงูุง:
- ุฃุชูุชุฉ ูุงููุฉ ูุนูููุฉ ุฑูุน ุงูุฏุนุงูู
- ุชูููุฑ ุงูููุช ูุงูุฌูุฏ (ูู 30 ุฏูููุฉ ุฅูู 2-3 ุฏูุงุฆู)
- ุชูููู ุงูุฃุฎุทุงุก ุงูุจุดุฑูุฉ
- ุฅููุงููุฉ ุฑูุน ุนุฏุฉ ุฏุนุงูู ุจุดูู ูุชุชุงูู

### โ๏ธ ุงููุฎุงุทุฑ:
- ุชุบููุฑ ูู ูุงุฌูุฉ ูููุน ุชูุงุถู ูุฏ ูุชุทูุจ ุชุญุฏูุซ ุงูู selectors
- ูุดุงูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ูุฏ ุชููู ุงูุนูููุฉ
- ุญุงุฌุฉ ููุฑุงูุจุฉ ุงูุนูููุฉ ูู ุงูุจุฏุงูุฉ ููุชุฃูุฏ ูู ุตุญุชูุง

### ๐ ุงูุฃูุงู:
- ุนุฏู ุญูุธ ุจูุงูุงุช ุญุณุงุณุฉ (ูููุงุช ุงููุฑูุฑ)
- ุงุณุชุฎุฏุงู User Data Directory ุจุดูู ุขูู
- ุชุดููุฑ ุงูุจูุงูุงุช ุงููุฑุณูุฉ ุนุจุฑ API

---

## 10. ุงูุฎูุงุตุฉ

ุงูุฎุทุฉ ุฌุงูุฒุฉ ููุชูููุฐ! ๐

**ุงูุฎุทูุฉ ุงูุชุงููุฉ:**
1. ููุงููุชู ุนูู ุงูุฎุทุฉ
2. ุงูุจุฏุก ูู ุชุทููุฑ ุงููุฑุญูุฉ ุงูุฃููู (ุงูุฅุนุฏุงุฏ)
3. ุงุฎุชุจุงุฑ ูู ูุฑุญูุฉ ุชุฏุฑูุฌูุงู
4. ุงูุชูุงูู ูุน FleetifyApp

**ูู ุฃูุช ูุณุชุนุฏ ููุจุฏุกุ** ๐ช

---

## Review (ูุง ุงูุฐู ุชุบูุฑ ูู ุงูุฎุทุฉ)
- ุชู ุงุณุชุจุฏุงู ุงูู selectors ุงูุงูุชุฑุงุถูุฉ (`name=`) ุจุงุณุชุฑุงุชูุฌูุฉ ูุงูุนูุฉ ูุชูุงุถู (Kendo UI + XPath/label-based).
- ุชู ุชูุถูุญ ุฃู **ูู ุงููููุงุช ุชุฃุชู ูู ุตูุญุฉ ุชุฌููุฒ ุงูุฏุนูู** ูุฃู ุฃูุถู ูุณุงุฑ ููุฃุชูุชุฉ ูู: ุชูุฒูู ZIP โ ูู ุงูุถุบุท โ ุฑูุน ูููุงุช ุงููุฑุต.
- ุชู ุชุญุฏูุซ 80% ู 100% ูุชุทุงุจู ุชุฏููู (ุจุนุฏ ุงููุณุชูุฏุงุช: ุฑุณูู ุซู ููุฎุต ุซู ุงุนุชูุงุฏ).
- ุชู ุชุตุญูุญ ุงูุชูุงูู: ุนุฏู ุฅุฑุณุงู `File` ุนุจุฑ JSONุ ูุงูุงูุชูุงุก ุจุฅุฑุณุงู `contractId/prepareUrl` ููุฃุชูุชุฉ ุงููุญููุฉ.
- ุชูุช ุฅุถุงูุฉ ูุงุนุฏุฉ ุชุญูู ูููุฉ ูุจู โุงูุชุงููโ ูู ุตูุญุฉ ุงูุฃุทุฑุงู (ุงูุชุฑุชูุจ).
