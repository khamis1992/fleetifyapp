# ููุชุฑุญ ุชุญุณูู ุญุงูุงุช ุงูุนููุฏ (Contract Status Improvement Proposal)

## ๐ ุงููุดููุฉ ุงูุญุงููุฉ

### 1. **ุชุถุงุฑุจ ูู ุชุนุฑูู "ุงููุณูุฏุฉ"**
- **ูู ุงูููุชุฑ**: ูุนุฑุถ ููุท ุงูุนููุฏ ุงูุชู `status = 'draft'`
- **ูู ุงูุฅุญุตุงุฆูุงุช**: ูุดูู ุฃูุถุงู ุงูุนููุฏ ุฐุงุช ุงููููุฉ ุตูุฑ (zero amount)
- **ุงููุชูุฌุฉ**: ุนุฏู ุชุทุงุจู ุงูุฃุฑูุงู ุจูู ุงูุฅุญุตุงุฆูุงุช ูุงูููุชุฑ

### 2. **ุงูุนููุฏ ุฐุงุช ุงููููุฉ ุงูุตูุฑูุฉ**
- ููุฌุฏ 33 ุนูุฏ ูู ุงูุฅุญุตุงุฆูุงุช ูู "ูุณูุฏุฉ"
- ุจุนุถูุง ูุฏ ูููู ุนููุฏ ูุนููุฉ ููู ูู ุชูุฏุฎู ูููุชูุง ุจุนุฏ
- ุจุนุถูุง ูุฏ ูููู ุนููุฏ ุงุฎุชุจุงุฑูุฉ ุฃู ุบูุฑ ููุชููุฉ

### 3. **ุญุงูุงุช ุงูุนููุฏ ุงููุชุนุฏุฏุฉ**
- ุจุนุถ ุงูุนููุฏ ููุง ุญุงูุงุช ูุชุนุฏุฏุฉ (ูุซูุงู: ููุบู + ูุถูุฉ ูุงููููุฉ)
- ูุตุนุจ ุชุชุจุน ุงูุนููุฏ ูู ุญุงูุงุช ูุนููุฉ

---

## ๐ก ุงูููุชุฑุญุงุช

### ุงูููุชุฑุญ 1: ุชูุญูุฏ ุชุนุฑูู "ุงููุณูุฏุฉ" โ (ููุชุฑุญ ุฃุณุงุณู)

#### ุงูุญู:
ุฌุนู ุงูููุชุฑ ูุชุทุงุจู ูุน ููุทู ุงูุฅุญุตุงุฆูุงุช

#### ุงูุชูููุฐ:
```typescript
// ูู ููู: src/pages/ContractsRedesigned.tsx
// ุงูุณุทุฑ ~158-161

} else if (activeTab === "draft") {
  // ุชูุญูุฏ ุงูููุทู ูุน ุงูุฅุญุตุงุฆูุงุช
  newFilters.status = "draft";
  newFilters.includeZeroAmount = true; // ุฅุถุงูุฉ ููุชุฑ ููุนููุฏ ุฐุงุช ุงููููุฉ ุตูุฑ
} else if (activeTab === "cancelled") {
```

#### ูู ููู: src/hooks/useContractsData.tsx
```typescript
// ุฅุถุงูุฉ ูุนุงูุฌุฉ ููุนููุฏ ุฐุงุช ุงููููุฉ ุตูุฑ ูู ุงูููุชุฑ
if (filters.includeZeroAmount) {
  // ุชุถููู ุงูุนููุฏ ุงูุชู:
  // 1. status = 'draft' ุฃู
  // 2. ูููุฉ ุตูุฑ ูููุณุช ูู ุญุงูุฉ ููุงุฆูุฉ
  query = query.or(`status.eq.draft,and(contract_amount.eq.0,monthly_amount.eq.0)`);
}
```

#### ุงูููุงุฆุฏ:
- โ ุชุทุงุจู ุงูุฃุฑูุงู ุจูู ุงูุฅุญุตุงุฆูุงุช ูุงูููุชุฑ
- โ ูุถูุญ ุฃูุจุฑ ูููุณุชุฎุฏู
- โ ุณูููุฉ ุงููุตูู ูุฌููุน ุงูุนููุฏ ุบูุฑ ุงูููุชููุฉ

---

### ุงูููุชุฑุญ 2: ุฅุถุงูุฉ ุญุงูุฉ "ุบูุฑ ููุชูู" (Incomplete) ๐

#### ุงูุญู:
ูุตู ุงูุนููุฏ ุฐุงุช ุงููููุฉ ุงูุตูุฑูุฉ ุนู ุงููุณูุฏุงุช ุงูุญููููุฉ

#### ุงูุชูููุฐ:

##### 1. ุฅุถุงูุฉ ุญุงูุฉ ุฌุฏูุฏุฉ ููุนููุฏ:
```sql
-- Migration: add_incomplete_status.sql
ALTER TYPE contract_status ADD VALUE IF NOT EXISTS 'incomplete';

-- ุชุญุฏูุซ ุงูุนููุฏ ุฐุงุช ุงููููุฉ ุตูุฑ
UPDATE contracts 
SET status = 'incomplete' 
WHERE (contract_amount = 0 OR contract_amount IS NULL) 
  AND (monthly_amount = 0 OR monthly_amount IS NULL)
  AND status NOT IN ('cancelled', 'expired', 'suspended', 'active');
```

##### 2. ุฅุถุงูุฉ ููุชุฑ ุฌุฏูุฏ ูู ุงููุงุฌูุฉ:
```typescript
// ูู ContractsRedesigned.tsx
{[
  { id: "all", label: "ุฌููุน ุงูุนููุฏ" },
  { id: "active", label: "ุงููุดุทุฉ" },
  { id: "draft", label: "ูุณูุฏุฉ" },
  { id: "incomplete", label: "ุบูุฑ ููุชูู", icon: AlertTriangle }, // ุฌุฏูุฏ
  { id: "cancelled", label: "ุงูููุบูุฉ" },
  // ...
]}
```

##### 3. ุชุญุฏูุซ ููุทู ุงูุฅุญุตุงุฆูุงุช:
```typescript
const draftContracts = statsContracts.filter((c: any) => c.status === 'draft');
const incompleteContracts = statsContracts.filter((c: any) => 
  c.status === 'incomplete' || isZeroAmount(c)
);
```

#### ุงูููุงุฆุฏ:
- โ ูุตู ูุงุถุญ ุจูู ุงููุณูุฏุงุช ูุงูุนููุฏ ุบูุฑ ุงูููุชููุฉ
- โ ุณูููุฉ ุชุชุจุน ุงูุนููุฏ ุงูุชู ุชุญุชุงุฌ ุฅููุงู ุจูุงูุงุช
- โ ุชูุงุฑูุฑ ุฃุฏู

---

### ุงูููุชุฑุญ 3: ุฅุถุงูุฉ "ุญุงูุฉ ูุฑุนูุฉ" (Sub-Status) ๐

#### ุงูุญู:
ุฅุถุงูุฉ ุญูู `sub_status` ููุนููุฏ ูุชุชุจุน ุงูุญุงูุงุช ุงููุฑุนูุฉ

#### ุงูุชูููุฐ:

##### 1. ุฅุถุงูุฉ ุญูู ุฌุฏูุฏ:
```sql
-- Migration: add_sub_status.sql
ALTER TABLE contracts 
ADD COLUMN IF NOT EXISTS sub_status TEXT;

-- ุฅูุดุงุก enum ููุญุงูุงุช ุงููุฑุนูุฉ
CREATE TYPE contract_sub_status AS ENUM (
  'pending_data',        -- ุจุงูุชุธุงุฑ ุฅุฏุฎุงู ุงูุจูุงูุงุช
  'pending_approval',    -- ุจุงูุชุธุงุฑ ุงูููุงููุฉ
  'pending_signature',   -- ุจุงูุชุธุงุฑ ุงูุชูููุน
  'pending_payment',     -- ุจุงูุชุธุงุฑ ุงูุฏูุนุฉ ุงูุฃููู
  'zero_amount',         -- ูููุฉ ุตูุฑูุฉ (ูุญุชุงุฌ ูุฑุงุฌุนุฉ)
  'test_contract'        -- ุนูุฏ ุชุฌุฑูุจู
);

ALTER TABLE contracts 
ALTER COLUMN sub_status TYPE contract_sub_status 
USING sub_status::contract_sub_status;
```

##### 2. ุชุญุฏูุซ ุงููุงุฌูุฉ:
```typescript
// ุนุฑุถ ุงูุญุงูุฉ ุงููุฑุนูุฉ ูุน ุงูุญุงูุฉ ุงูุฃุณุงุณูุฉ
<StatusBadge 
  status={contract.status} 
  subStatus={contract.sub_status}
  legalStatus={contract.legal_status}
/>
```

#### ุงูููุงุฆุฏ:
- โ ุชูุตูู ุฃูุจุฑ ูุญุงูุฉ ุงูุนูุฏ
- โ ุฅููุงููุฉ ุชุชุจุน ูุฑุงุญู ุงูุนูุฏ ุจุฏูุฉ
- โ ุชูุงุฑูุฑ ุฃูุซุฑ ุชูุตููุงู

---

### ุงูููุชุฑุญ 4: ูุธุงู "ุนูุงูุงุช" (Tags) ููุนููุฏ ๐ท๏ธ

#### ุงูุญู:
ุฅุถุงูุฉ ูุธุงู tags ูุฑู ููุนููุฏ

#### ุงูุชูููุฐ:

##### 1. ุฅูุดุงุก ุฌุฏูู ููุนูุงูุงุช:
```sql
-- Migration: create_contract_tags.sql
CREATE TABLE contract_tags (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name TEXT NOT NULL,
  color TEXT NOT NULL,
  icon TEXT,
  company_id UUID REFERENCES companies(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE contract_tag_assignments (
  contract_id UUID REFERENCES contracts(id) ON DELETE CASCADE,
  tag_id UUID REFERENCES contract_tags(id) ON DELETE CASCADE,
  assigned_at TIMESTAMPTZ DEFAULT NOW(),
  PRIMARY KEY (contract_id, tag_id)
);

-- ุนูุงูุงุช ุงูุชุฑุงุถูุฉ
INSERT INTO contract_tags (name, color, icon) VALUES
  ('ูููุฉ ุตูุฑูุฉ', 'orange', 'alert-triangle'),
  ('ูุญุชุงุฌ ูุฑุงุฌุนุฉ', 'yellow', 'eye'),
  ('ุนูุฏ ุงุฎุชุจุงุฑู', 'purple', 'test-tube'),
  ('ุจุงูุชุธุงุฑ ุจูุงูุงุช', 'blue', 'clock'),
  ('ุฃููููุฉ ุนุงููุฉ', 'red', 'flag');
```

##### 2. ุฅุถุงูุฉ ููุชุฑ ุจุงูุนูุงูุงุช:
```typescript
// ูู ContractsRedesigned.tsx
const [selectedTags, setSelectedTags] = useState<string[]>([]);

// ููุชุฑ ุงูุนููุฏ ุญุณุจ ุงูุนูุงูุงุช
const filteredByTags = contracts.filter(contract => {
  if (selectedTags.length === 0) return true;
  return contract.tags?.some(tag => selectedTags.includes(tag.id));
});
```

#### ุงูููุงุฆุฏ:
- โ ูุฑููุฉ ุนุงููุฉ ูู ุชุตููู ุงูุนููุฏ
- โ ุฅููุงููุฉ ุฅุถุงูุฉ ุนูุงูุงุช ูุฎุตุตุฉ
- โ ููุชุฑุฉ ูุชูุฏูุฉ

---

### ุงูููุชุฑุญ 5: ููุญุฉ "ุงูุนููุฏ ุงูุชู ุชุญุชุงุฌ ุงูุชุจุงู" ๐ฏ

#### ุงูุญู:
ุฅุถุงูุฉ ูุณู ุฎุงุต ููุนููุฏ ุงูุชู ุชุญุชุงุฌ ุฅุฌุฑุงุก

#### ุงูุชูููุฐ:

##### 1. ุฅูุดุงุก ูููู ุฌุฏูุฏ:
```typescript
// src/components/contracts/ContractsNeedingAttention.tsx
export const ContractsNeedingAttention = () => {
  const { contracts } = useContractsData();
  
  const needsAttention = contracts.filter(c => 
    // ุนููุฏ ุฐุงุช ูููุฉ ุตูุฑูุฉ
    (c.contract_amount === 0 && c.monthly_amount === 0) ||
    // ุนููุฏ ุจุฏูู ูุฑูุจุฉ
    !c.vehicle_id ||
    // ุนููุฏ ุจุฏูู ุนููู
    !c.customer_id ||
    // ุนููุฏ ููุชููุฉ ูู ุชูุฌุฏุฏ
    (isExpired(c) && c.status === 'active')
  );
  
  return (
    <Card>
      <CardHeader>
        <CardTitle>ุนููุฏ ุชุญุชุงุฌ ุงูุชุจุงู ({needsAttention.length})</CardTitle>
      </CardHeader>
      <CardContent>
        {needsAttention.map(contract => (
          <ContractAttentionItem key={contract.id} contract={contract} />
        ))}
      </CardContent>
    </Card>
  );
};
```

##### 2. ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช:
```typescript
// ุนุฑุถ ุฅุดุนุงุฑ ูููุณุชุฎุฏู
if (needsAttention.length > 0) {
  toast({
    title: "ุชูุจูู",
    description: `ูุฏูู ${needsAttention.length} ุนูุฏ ูุญุชุงุฌ ุงูุชุจุงูู`,
    action: <Button onClick={() => navigate('/contracts?filter=needs-attention')}>
      ุนุฑุถ
    </Button>
  });
}
```

#### ุงูููุงุฆุฏ:
- โ ุชูุจูู ุงุณุชุจุงูู ูููุณุชุฎุฏู
- โ ุชุญุณูู ุฌูุฏุฉ ุงูุจูุงูุงุช
- โ ุชูููู ุงูุฃุฎุทุงุก

---

## ๐ ููุงุฑูุฉ ุงูููุชุฑุญุงุช

| ุงูููุชุฑุญ | ุงูุณูููุฉ | ุงูุชุฃุซูุฑ | ุงูููุช ุงููุชููุน | ุงูุฃููููุฉ |
|---------|---------|---------|---------------|----------|
| 1. ุชูุญูุฏ ุชุนุฑูู ุงููุณูุฏุฉ | โญโญโญโญโญ | โญโญโญโญ | 1-2 ุณุงุนุฉ | ๐ด ุนุงููุฉ |
| 2. ุญุงูุฉ "ุบูุฑ ููุชูู" | โญโญโญโญ | โญโญโญโญโญ | 3-4 ุณุงุนุงุช | ๐ก ูุชูุณุทุฉ |
| 3. ุญุงูุฉ ูุฑุนูุฉ | โญโญโญ | โญโญโญโญโญ | 4-6 ุณุงุนุงุช | ๐ข ููุฎูุถุฉ |
| 4. ูุธุงู ุงูุนูุงูุงุช | โญโญ | โญโญโญโญโญ | 6-8 ุณุงุนุงุช | ๐ข ููุฎูุถุฉ |
| 5. ููุญุฉ ุงูุงูุชุจุงู | โญโญโญโญ | โญโญโญโญ | 2-3 ุณุงุนุงุช | ๐ก ูุชูุณุทุฉ |

---

## ๐ฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ

### ุงููุฑุญูุฉ ุงูุฃููู (ููุฑูุฉ):
1. **ุชูููุฐ ุงูููุชุฑุญ 1**: ุชูุญูุฏ ุชุนุฑูู ุงููุณูุฏุฉ
   - ุณุฑูุน ูุณูู ุงูุชูููุฐ
   - ูุญู ุงููุดููุฉ ุงูุฃุณุงุณูุฉ
   - ุชุญุณูู ููุฑู ูุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

### ุงููุฑุญูุฉ ุงูุซุงููุฉ (ูุตูุฑุฉ ุงููุฏู):
2. **ุชูููุฐ ุงูููุชุฑุญ 5**: ููุญุฉ ุงูุนููุฏ ุงูุชู ุชุญุชุงุฌ ุงูุชุจุงู
   - ูุณุงุนุฏ ูู ุชุญุณูู ุฌูุฏุฉ ุงูุจูุงูุงุช
   - ูููุน ุงููุดุงูู ุงููุณุชูุจููุฉ

3. **ุชูููุฐ ุงูููุชุฑุญ 2**: ุฅุถุงูุฉ ุญุงูุฉ "ุบูุฑ ููุชูู"
   - ูุตู ูุงุถุญ ุจูู ุฃููุงุน ุงูุนููุฏ
   - ุชุญุณูู ุงูุชูุงุฑูุฑ

### ุงููุฑุญูุฉ ุงูุซุงูุซุฉ (ุทูููุฉ ุงููุฏู):
4. **ุชูููุฐ ุงูููุชุฑุญ 3 ุฃู 4**: ุญุณุจ ุงุญุชูุงุฌุงุช ุงูุนูู
   - ูููุคุณุณุงุช ุงููุจูุฑุฉ: ูุธุงู ุงูุนูุงูุงุช (ุฃูุซุฑ ูุฑููุฉ)
   - ูููุคุณุณุงุช ุงููุชูุณุทุฉ: ุงูุญุงูุฉ ุงููุฑุนูุฉ (ุฃูุซุฑ ุจุณุงุทุฉ)

---

## ๐ ุฎุทุฉ ุงูุชูููุฐ ุงูููุชุฑุญุฉ

### ุงูุฃุณุจูุน 1:
- [ ] ุชูููุฐ ุงูููุชุฑุญ 1 (ุชูุญูุฏ ุชุนุฑูู ุงููุณูุฏุฉ)
- [ ] ุงุฎุชุจุงุฑ ุดุงูู
- [ ] ูุดุฑ ุงูุชุญุฏูุซ

### ุงูุฃุณุจูุน 2:
- [ ] ุชูููุฐ ุงูููุชุฑุญ 5 (ููุญุฉ ุงูุงูุชุจุงู)
- [ ] ุฌูุน ููุงุญุธุงุช ุงููุณุชุฎุฏููู

### ุงูุฃุณุจูุน 3-4:
- [ ] ุชูููุฐ ุงูููุชุฑุญ 2 (ุญุงูุฉ ุบูุฑ ููุชูู)
- [ ] ุชุญุฏูุซ ุงูุชูุงุฑูุฑ
- [ ] ุชุฏุฑูุจ ุงููุณุชุฎุฏููู

### ุงููุณุชูุจู:
- [ ] ุชูููู ุงูุญุงุฌุฉ ููููุชุฑุญุงุช 3 ู 4
- [ ] ุชูููุฐ ุญุณุจ ุงูุฃููููุฉ

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ุงุนุชุจุงุฑุงุช ูููุฉ:
1. **ุงูุชูุงูู ูุน ุงูุจูุงูุงุช ุงูุญุงููุฉ**: ุงูุชุฃูุฏ ูู ุฃู ุฃู ุชุบููุฑ ูุง ูุคุซุฑ ุนูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
2. **ุงูุฃุฏุงุก**: ูุฑุงูุจุฉ ุชุฃุซูุฑ ุงูุชุบููุฑุงุช ุนูู ุฃุฏุงุก ุงููุธุงู
3. **ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู**: ุงูุชุฃูุฏ ูู ุฃู ุงูุชุบููุฑุงุช ุชุญุณู ุงูุชุฌุฑุจุฉ ููุง ุชุนูุฏูุง
4. **ุงูุชูุซูู**: ุชุญุฏูุซ ุงููุซุงุฆู ูุชุฏุฑูุจ ุงููุณุชุฎุฏููู

### ููุงููุณ ุงููุฌุงุญ:
- โ ุชุทุงุจู 100% ุจูู ุงูุฅุญุตุงุฆูุงุช ูุงูููุงุชุฑ
- โ ุชูููู ุนุฏุฏ ุงูุนููุฏ ุฐุงุช ุงูุจูุงูุงุช ุงููุงูุตุฉ ุจูุณุจุฉ 50%
- โ ุชุญุณูู ุฑุถุง ุงููุณุชุฎุฏููู
- โ ุชูููู ููุช ุงูุจุญุซ ุนู ุงูุนููุฏ ุจูุณุจุฉ 30%

---

## ๐ฌ ุงูุฎูุงุตุฉ

ุงููุดููุฉ ุงูุญุงููุฉ ุจุณูุทุฉ ููููู ุญููุง ุจุณุฑุนุฉ ูู ุฎูุงู **ุงูููุชุฑุญ 1**. ููู ููุญุตูู ุนูู ูุธุงู ุฃูุซุฑ ููุฉ ููุฑููุฉุ ูููุตุญ ุจุชูููุฐ ุงูููุชุฑุญุงุช ุงูุฃุฎุฑู ุชุฏุฑูุฌูุงู ุญุณุจ ุงุญุชูุงุฌุงุช ุงูุนูู ูุงูููุงุฑุฏ ุงููุชุงุญุฉ.

**ุงูุฎุทูุฉ ุงูุชุงููุฉ ุงูููุชุฑุญุฉ**: ุชูููุฐ ุงูููุชุฑุญ 1 ููุฑุงู ูุญู ุงููุดููุฉ ุงูุญุงููุฉุ ุซู ุชูููู ุงูุญุงุฌุฉ ููููุชุฑุญุงุช ุงูุฃุฎุฑู ุจูุงุกู ุนูู ููุงุญุธุงุช ุงููุณุชุฎุฏููู.
