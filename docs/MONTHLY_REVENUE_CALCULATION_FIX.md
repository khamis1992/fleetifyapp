# ๐ง ุฅุตูุงุญ ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ

## ๐ ุงููุดููุฉ

ูุงู ุงููุธุงู ูุญุณุจ ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ ุจูุงุกู ุนูู **ุงูุนููุฏ ุงูุชู ุชุจุฏุฃ ูู ุงูุดูุฑ ุงูุญุงูู ููุท**ุ ูููุณ **ุฌููุน ุงูุนููุฏ ุงููุดุทุฉ ูู ุงูุดูุฑ**.

### ุงูููุฏ ุงูุณุงุจู โ

```typescript
// โ ูุฌูุจ ููุท ุงูุนููุฏ ุงูุชู ุชุจุฏุฃ ูู ุฃูู ุงูุดูุฑ ุงูุญุงูู
const { data: monthlyContracts } = await supabase
  .from('contracts')
  .select('monthly_amount, status')
  .eq('company_id', user.profile.company_id)
  .in('status', ['active', 'draft'])
  .gte('start_date', firstDayOfMonth.toISOString().split('T')[0]);
  //     ^^^ ูุฐุง ูุนูู: start_date >= '2025-11-01'
  //     ููุท ุงูุนููุฏ ุงูุฌุฏูุฏุฉ!

monthlyRevenue = monthlyContracts?.reduce((sum, contract) => 
  sum + (contract.monthly_amount || 0), 0) || 0;
```

**ุงููุชูุฌุฉ:** ุฅุฐุง ูุงู ูุฏูู 100 ุนูุฏ ูุดุท ูู ุงูุดูุฑ ุงููุงุถู ู5 ุนููุฏ ุฌุฏูุฏุฉ ูุฐุง ุงูุดูุฑุ ุณูุญุณุจ ููุท ุงูู5 ุนููุฏ ุงูุฌุฏูุฏุฉ! โ

---

## โ ุงูุญู

### ุงูููุทู ุงูุตุญูุญ

ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ = **ูุฌููุน ููู ุงูุฅูุฌุงุฑ ุงูุดูุฑู ูุฌููุน ุงูุนููุฏ ุงููุดุทุฉ ูู ุงูุดูุฑ ุงูุญุงูู**

ุงูุนูุฏ ูููู **ูุดุทุงู ูู ุงูุดูุฑ ุงูุญุงูู** ุฅุฐุง:

1. โ ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุนูุฏ **ูุจู ุฃู ูู** ููุงูุฉ ุงูุดูุฑ ุงูุญุงูู
   - `start_date <= ุขุฎุฑ ููู ูู ุงูุดูุฑ`

2. โ ุงูุนูุฏ **ูู ููุชูู ุจุนุฏ** ุฃู ููุชูู **ุจุนุฏ** ุจุฏุงูุฉ ุงูุดูุฑ
   - `end_date IS NULL` (ุนูุฏ ููุชูุญ)
   - ุฃู `end_date >= ุฃูู ููู ูู ุงูุดูุฑ`

3. โ ุญุงูุฉ ุงูุนูุฏ = `'active'`

### ุงูููุฏ ุงูุฌุฏูุฏ โ

```typescript
// โ ุฌูุจ ุฌููุน ุงูุนููุฏ ุงูุชู ุจุฏุฃุช ูุจู ุฃู ูู ููุงูุฉ ุงูุดูุฑ ุงูุญุงูู
const { data: monthlyContracts } = await supabase
  .from('contracts')
  .select('monthly_amount, status, start_date, end_date')
  .eq('company_id', user.profile.company_id)
  .eq('status', 'active')
  .lte('start_date', lastDayOfMonth.toISOString().split('T')[0]);
  //    ^^^ start_date <= '2025-11-30'
  //    ูุดูู ุฌููุน ุงูุนููุฏ ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ

// โ ุชุตููุฉ ุงูุนููุฏ ุงูุชู ูุง ุชุฒุงู ูุดุทุฉ ูู ุงูุดูุฑ ุงูุญุงูู
const activeInMonth = monthlyContracts?.filter(contract => {
  // ุฅุฐุง ูู ููู ููุงู ุชุงุฑูุฎ ุงูุชูุงุกุ ุงูุนูุฏ ูุดุท
  if (!contract.end_date) return true;
  
  // ุฅุฐุง ูุงู ุชุงุฑูุฎ ุงูุงูุชูุงุก ุจุนุฏ ุฃู ูู ุจุฏุงูุฉ ุงูุดูุฑุ ุงูุนูุฏ ูุดุท
  return new Date(contract.end_date) >= firstDayOfMonth;
  //     end_date >= '2025-11-01'
}) || [];

// โ ุฌูุน ููู ุงูุฅูุฌุงุฑ ุงูุดูุฑู ูุฌููุน ุงูุนููุฏ ุงููุดุทุฉ
monthlyRevenue = activeInMonth.reduce((sum, contract) => 
  sum + (contract.monthly_amount || 0), 0);
```

---

## ๐ ูุซุงู ุชูุถูุญู

### ุงูุณููุงุฑูู

ูููุชุฑุถ ุฃููุง ูู **ููููุจุฑ 2025** ูุงูุดุฑูุฉ ูุฏููุง:

| ุฑูู ุงูุนูุฏ | ุชุงุฑูุฎ ุงูุจุฏุงูุฉ | ุชุงุฑูุฎ ุงูููุงูุฉ | ุงูุฅูุฌุงุฑ ุงูุดูุฑู | ุงูุญุงูุฉ |
|-----------|---------------|---------------|----------------|---------|
| ุนูุฏ #1 | 2025-01-01 | 2026-01-01 | 5,000 ุฑ.ู | active |
| ุนูุฏ #2 | 2025-08-15 | 2025-11-15 | 3,000 ุฑ.ู | active |
| ุนูุฏ #3 | 2025-10-01 | 2026-03-01 | 4,500 ุฑ.ู | active |
| ุนูุฏ #4 | 2025-11-05 | 2026-05-05 | 6,000 ุฑ.ู | active |
| ุนูุฏ #5 | 2025-11-20 | 2026-02-20 | 2,500 ุฑ.ู | active |
| ุนูุฏ #6 | 2024-12-01 | 2025-10-31 | 7,000 ุฑ.ู | active |

### ุงูุญุณุงุจ ุงูุตุญูุญ โ

**ุงูุดูุฑ ุงูุญุงูู: ููููุจุฑ 2025** (2025-11-01 ุฅูู 2025-11-30)

| ุฑูู ุงูุนูุฏ | ูุดุท ูู ููููุจุฑุ | ุงูุณุจุจ | ููุญุณุจุ |
|-----------|----------------|-------|--------|
| ุนูุฏ #1 | โ ูุนู | ุจุฏุฃ ูุจู ููููุจุฑ ูููุชูู ุจุนุฏู | โ 5,000 |
| ุนูุฏ #2 | โ ูุนู | ุจุฏุฃ ูุจู ููููุจุฑ ูููุชูู ูู 15 ููููุจุฑ | โ 3,000 |
| ุนูุฏ #3 | โ ูุนู | ุจุฏุฃ ูู ุฃูุชูุจุฑ ูููุชูู ูู 2026 | โ 4,500 |
| ุนูุฏ #4 | โ ูุนู | ุจุฏุฃ ูู 5 ููููุจุฑ | โ 6,000 |
| ุนูุฏ #5 | โ ูุนู | ุจุฏุฃ ูู 20 ููููุจุฑ | โ 2,500 |
| ุนูุฏ #6 | โ ูุง | ุงูุชูู ูู 31 ุฃูุชูุจุฑ (ูุจู ููููุจุฑ) | โ 0 |

**ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ ูููููุจุฑ:**
```
5,000 + 3,000 + 4,500 + 6,000 + 2,500 = 21,000 ุฑ.ู
```

### ุงูููุงุฑูุฉ ูุน ุงูููุฏ ุงููุฏูู โ

ุงูููุฏ ุงููุฏูู ูุงู ุณูุญุณุจ **ููุท ุงูุนููุฏ #4 ู #5** (ุงูุชู ุจุฏุฃุช ูู ููููุจุฑ):
```
6,000 + 2,500 = 8,500 ุฑ.ู โ
```

**ุงููุฑู:** 12,500 ุฑ.ู ูุงูุต! โ

---

## ๐ ุญุณุงุจ ุงูููุงุฑูุฉ ูุน ุงูุดูุฑ ุงูุณุงุจู

ุชู ุฃูุถุงู ุฅุถุงูุฉ ุญุณุงุจ ุฅูุฑุงุฏุงุช **ุงูุดูุฑ ุงูุณุงุจู** ุจููุณ ุงูููุทู ููููุงุฑูุฉ:

```typescript
// ุญุณุงุจ ุฅูุฑุงุฏุงุช ุงูุดูุฑ ุงูุณุงุจู (ุฃูุชูุจุฑ) ููููุงุฑูุฉ
const { data: prevMonthContracts } = await supabase
  .from('contracts')
  .select('monthly_amount, status, start_date, end_date')
  .eq('company_id', user.profile.company_id)
  .eq('status', 'active')
  .lte('start_date', lastDayOfPrevMonth.toISOString().split('T')[0]);

const activeInPrevMonth = prevMonthContracts?.filter(contract => {
  if (!contract.end_date) return true;
  return new Date(contract.end_date) >= firstDayOfPrevMonth;
}) || [];

previousMonthRevenue = activeInPrevMonth.reduce((sum, contract) => 
  sum + (contract.monthly_amount || 0), 0);
```

**ุงููุชูุฌุฉ:** ุงูุขู ูููู ุญุณุงุจ ูุณุจุฉ ุงูููู/ุงูุชุฑุงุฌุน ุจุฏูุฉ:

```typescript
const revenueChange = monthlyRevenue - previousMonthRevenue;
const revenueChangePercent = previousMonthRevenue > 0
  ? Math.round((revenueChange / previousMonthRevenue) * 100)
  : 0;
```

**ูุซุงู:**
- ุฅูุฑุงุฏุงุช ููููุจุฑ: 21,000 ุฑ.ู
- ุฅูุฑุงุฏุงุช ุฃูุชูุจุฑ: 19,500 ุฑ.ู
- ุงูููู: 1,500 ุฑ.ู
- ูุณุจุฉ ุงูููู: **+7.7%** ๐

---

## ๐ข ููุณ ุงูุชุญุณูู ูุนููุฏ ุงูุนูุงุฑุงุช

ุชู ุชุทุจูู ููุณ ุงูููุทู ุนูู `property_contracts`:

```typescript
// ุญุณุงุจ ุฅุฌูุงูู ุงูุฅูุฌุงุฑ ุงูุดูุฑู ูุนููุฏ ุงูุนูุงุฑุงุช ุงููุดุทุฉ
const { data: propertyContracts } = await supabase
  .from('property_contracts')
  .select('rental_amount, status, start_date, end_date')
  .eq('company_id', user.profile.company_id)
  .eq('status', 'active')
  .lte('start_date', lastDayOfMonth.toISOString().split('T')[0]);

const activeInMonth = propertyContracts?.filter(contract => {
  if (!contract.end_date) return true;
  return new Date(contract.end_date) >= firstDayOfMonth;
}) || [];

propertyRevenue = activeInMonth.reduce((sum, contract) => 
  sum + (contract.rental_amount || 0), 0);

monthlyRevenue += propertyRevenue; // ุฅุถุงูุฉ ุฅูุฑุงุฏุงุช ุงูุนูุงุฑุงุช ููุฅุฌูุงูู
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### `src/hooks/useDashboardStats.ts`

#### ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ:

1. โ **ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ ุงูุตุญูุญ**
   - ุฌูุจ ุฌููุน ุงูุนููุฏ ุงูุชู `start_date <= ุขุฎุฑ ููู ูู ุงูุดูุฑ`
   - ุชุตููุฉ ุงูุนููุฏ ุงููุดุทุฉ (`end_date >= ุฃูู ููู ูู ุงูุดูุฑ` ุฃู `end_date IS NULL`)
   - ุฌูุน `monthly_amount` ูุฌููุน ุงูุนููุฏ ุงููุดุทุฉ

2. โ **ุญุณุงุจ ุฅูุฑุงุฏุงุช ุงูุดูุฑ ุงูุณุงุจู**
   - ููุณ ุงูููุทู ูุญุณุงุจ ุงูุดูุฑ ุงูุณุงุจู
   - ููููุงุฑูุฉ ูุญุณุงุจ ูุณุจุฉ ุงูููู

3. โ **ุฏุนู ุนููุฏ ุงูุนูุงุฑุงุช**
   - ููุณ ุงูููุทู ุงููุทุจู ุนูู `property_contracts`
   - ุฌูุน `rental_amount`

4. โ **ุชุญุณูู ุงูุฃุฏุงุก**
   - ุงุณุชุนูุงูุงุช ูุญุณููุฉ
   - ุชุตููุฉ ุนูู ูุณุชูู JavaScript ููุนููุฏ ุงููุดุทุฉ

---

## ๐ฏ ุงูุชุฃุซูุฑ ุนูู Dashboard

### ูุจู ุงูุฅุตูุงุญ โ

- **ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ**: ุชุนุฑุถ ููุท ุงูุนููุฏ ุงูุฌุฏูุฏุฉ
- **ูุณุจุฉ ุงูููู**: ุบูุฑ ุฏูููุฉ
- **ุงูููุงุฑูุงุช**: ูุถููุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ โ

- **ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ**: ุชุนุฑุถ ุฌููุน ุงูุนููุฏ ุงููุดุทุฉ โ
- **ูุณุจุฉ ุงูููู**: ุฏูููุฉ ููุงูุนูุฉ โ
- **ุงูููุงุฑูุงุช**: ุตุญูุญุฉ ููููุฏุฉ โ

---

## ๐ ููููุฉ ุงูุชุญูู

### 1. ูุญุต ุจูุงูุงุช Dashboard

ุงูุชุญ ุตูุญุฉ Dashboard ูุชุญูู ูู:

```
ุจุทุงูุฉ "ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ":
- ุงููููุฉ ูุฌุจ ุฃู = ูุฌููุน monthly_amount ูุฌููุน ุงูุนููุฏ ุงููุดุทุฉ
- ูุณุจุฉ ุงูุชุบููุฑ ูุฌุจ ุฃู ุชุนูุณ ุงููุฑู ูุน ุงูุดูุฑ ุงูุณุงุจู
```

### 2. ุงุณุชุนูุงู SQL ููุชุญูู ุงููุฏูู

```sql
-- ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ ุงููุนููุฉ (ููููุจุฑ 2025)
SELECT 
  COUNT(*) as active_contracts,
  SUM(monthly_amount) as total_monthly_revenue
FROM contracts
WHERE 
  company_id = 'your-company-id'
  AND status = 'active'
  AND start_date <= '2025-11-30'
  AND (end_date IS NULL OR end_date >= '2025-11-01');
```

### 3. ุงุฎุชุจุงุฑ ุงูุณููุงุฑูููุงุช

- โ ุนูุฏ ุจุฏุฃ ูุจู ุงูุดูุฑ ููุง ูุฒุงู ูุดุท
- โ ุนูุฏ ุจุฏุฃ ูุฐุง ุงูุดูุฑ
- โ ุนูุฏ ููุชูู ูู ููุชุตู ุงูุดูุฑ
- โ ุนูุฏ ุงูุชูู ุงูุดูุฑ ุงููุงุถู (ูุง ููุญุณุจ)
- โ ุนูุฏ ููุชูุญ (ุจุฏูู end_date)

---

## โ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ ููุนูุณ **ุงููููุฉ ุงูุญููููุฉ** ูุฌููุน ุงูุนููุฏ ุงููุดุทุฉ:

1. โ ูุญุณุจ **ุฌููุน ุงูุนููุฏ ุงููุดุทุฉ** ูู ุงูุดูุฑ (ููุณ ููุท ุงูุฌุฏูุฏุฉ)
2. โ ูุณุชุฎุฏู **monthly_amount** (ุงููููุฉ ุงูุดูุฑูุฉ ูููุณ ุงูุฅุฌูุงููุฉ)
3. โ ูุญุณุจ **ุฅูุฑุงุฏุงุช ุงูุดูุฑ ุงูุณุงุจู** ููููุงุฑูุฉ ุงูุฏูููุฉ
4. โ ูุฏุนู **ุนููุฏ ุงููุฑูุจุงุช ูุงูุนูุงุฑุงุช** ูุนุงู
5. โ ูููุฑ **ูุณุจุฉ ููู ุฏูููุฉ** ุจูุงุกู ุนูู ุจูุงูุงุช ุญููููุฉ

ุงูุขู Dashboard ูุนุฑุถ ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ **ุงูุญููููุฉ ูุงูุฏูููุฉ**! ๐

