# 📋 دليل معالجة غرامات التأخير في نظام المدفوعات

## 🎯 نظرة عامة

تم تحسين نظام رفع المدفوعات ليتعامل مع غرامات التأخير بطريقة واضحة ومرنة. هذا الدليل يشرح كيفية استخدام خيارات معالجة الغرامات المختلفة.

## 🔧 خيارات معالجة الغرامات

### ✅ **included** - الغرامة مدمجة
```csv
late_fine_handling: included
```
- **المعنى**: الغرامة مدمجة مع مبلغ الدفعة الأساسي
- **النتيجة**: لن يتم إنشاء دفعة منفصلة للغرامة
- **مثال**: دفعة بمبلغ 1000 د.ك تشمل 50 د.ك غرامة تأخير

### 🔄 **separate** - دفعة منفصلة
```csv
late_fine_handling: separate
```
- **المعنى**: ستنشأ دفعة منفصلة للغرامة
- **النتيجة**: دفعتان في النظام - الأساسية والغرامة
- **مثال**: دفعة 950 د.ك + دفعة غرامة 50 د.ك

### ❌ **waived** - إعفاء من الغرامة
```csv
late_fine_handling: waived
```
- **المعنى**: إعفاء من الغرامة مع ذكر السبب
- **النتيجة**: لن يتم تحصيل الغرامة
- **مثال**: عميل مميز، ظروف خاصة، إعفاء إداري

### ⚠️ **فارغ أو none** - غير محدد
```csv
late_fine_handling: 
# أو
late_fine_handling: none
```
- **المعنى**: طريقة المعالجة غير محددة
- **النتيجة**: سيطلب النظام المراجعة قبل الرفع
- **التحذير**: ⚠️ طريقة المعالجة غير محددة

## 📊 مثال عملي من القالب

```csv
transaction_type,payment_method,payment_date,amount,amount_paid,balance,reference_number,agreement_number,contract_number,customer_name,customer_phone,vendor_name,invoice_number,due_date,original_due_date,late_fine_days_overdue,late_fine_amount,late_fine_handling,late_fine_waiver_reason,payment_status,description,description_type,type,reconciliation_status,notes

receipt,cash,2025-01-19,500.000,500.000,0,CASH-123,LTO2024177,,شركة الخليج للتجارة,,,,,2025-01-19,2025-01-15,4,20.000,separate,تأخير في الدفع,completed,إيجار شهري,INCOME,INCOME,completed,قبض نقدي مع غرامة تأخير منفصلة

receipt,check,2025-01-20,300.000,300.000,0,CHK-456,LTO2024200,,مؤسسة النور,,,,,2025-01-20,2025-01-18,2,10.000,waived,عميل مميز - إعفاء,completed,إيجار أسبوعي,INCOME,INCOME,completed,قبض بشيك مع إعفاء من غرامة التأخير

payment,bank_transfer,2025-01-18,250.000,250.000,0,TRX-777,,,,,مزود الخدمات الدولية,,2025-01-20,2025-01-15,3,15.000,included,تأخير بسيط,completed,خدمات استشارية,EXPENSE,EXPENSE,completed,صرف كامل عبر حوالة بنكية مع غرامة تأخير
```

## 🎨 العرض في واجهة المستخدم

### في مكون المعاينة:
- ✅ **مدمج مع الدفعة** (أخضر)
- 🔄 **دفعة منفصلة** (برتقالي)  
- ❌ **معفى من الغرامة** (أزرق)
- ⚠️ **طريقة المعالجة غير محددة** (أحمر)

### في مكون الرفع:
```
خيارات معالجة الغرامات المتاحة:
✅ included: الغرامة مدمجة مع مبلغ الدفعة الأساسي
🔄 separate: ستنشأ دفعة منفصلة للغرامة  
❌ waived: إعفاء من الغرامة (مع ذكر السبب)
⚠️ فارغ أو none: طريقة المعالجة غير محددة - يجب المراجعة
```

## 🔍 التحقق والتحذيرات

### تحذيرات تظهر للمستخدم:
1. **غرامات غير محددة**: عندما يكون `late_fine_handling` فارغ أو `none`
2. **غرامات بدون مبلغ**: عندما يوجد `late_fine_days_overdue > 0` لكن `late_fine_amount` فارغ
3. **إعفاء بدون سبب**: عندما يكون `late_fine_handling = waived` لكن `late_fine_waiver_reason` فارغ

### قسم شرح الغرامات في المعاينة:
```
تنبيه: وجود غرامات تأخير
يوجد X عنصر يحتوي على غرامات تأخير بإجمالي XXX د.ك

خيارات معالجة الغرامات:
✅ included: الغرامة مدمجة مع مبلغ الدفعة الأساسي
🔄 separate: ستنشأ دفعة منفصلة للغرامة
❌ waived: إعفاء من الغرامة (مع ذكر السبب)  
⚠️ none أو فارغ: طريقة المعالجة غير محددة - يجب المراجعة
```

## 💡 نصائح للاستخدام

### 1. **التخطيط المسبق**
- حدد سياسة الشركة لمعالجة الغرامات قبل الرفع
- استخدم `included` للغرامات البسيطة المدمجة
- استخدم `separate` للغرامات الكبيرة التي تحتاج تتبع منفصل

### 2. **التوثيق**
- اذكر سبب الإعفاء دائماً في `late_fine_waiver_reason`
- استخدم ملاحظات واضحة في عمود `notes`

### 3. **المراجعة**
- راجع جميع الغرامات غير المحددة قبل الرفع
- تأكد من صحة المبالغ والتواريخ

## 🚀 الميزات الجديدة

### 1. **عرض بصري محسن**
- رموز ملونة لكل نوع معالجة
- تحذيرات واضحة للغرامات غير المحددة
- شرح تفصيلي لكل خيار

### 2. **أمثلة في القالب**
- 3 أمثلة مختلفة توضح كل طريقة معالجة
- بيانات واقعية لسهولة الفهم

### 3. **التحقق الذكي**
- اكتشاف الغرامات غير المحددة
- تحذيرات للبيانات الناقصة
- اقتراحات للتحسين

## 📞 الدعم

إذا واجهت أي مشاكل في معالجة الغرامات:

1. **تحقق من القالب**: تأكد من استخدام القالب الصحيح
2. **راجع الأمثلة**: استخدم الأمثلة الموجودة في القالب كمرجع
3. **اقرأ التحذيرات**: انتبه للتحذيرات في مكون المعاينة
4. **استخدم المعاينة**: راجع البيانات قبل الرفع النهائي

---

**تاريخ التحديث**: يناير 2025  
**الإصدار**: 2.0  
**حالة الميزة**: ✅ مكتملة ومفعلة
