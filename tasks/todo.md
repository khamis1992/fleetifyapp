# ุฎุทุฉ ุฑูุน ุงูุฏูุนุงุช ูู ููู JSON

## ๐ ุชุญููู ุงูุจูุงูุงุช

### ุจูุงูุงุช ุงูุฅุฏุฎุงู (JSON):
- **ุนุฏุฏ ุงูุฏูุนุงุช**: ~250 ุฏูุนุฉ
- **ุงูุญููู**: customer_name, vehicle_number, payment_date, amount, month, payment_details, file_source
- **ุงูุดููุฑ**: 7 (ููููู)ุ 8 (ุฃุบุณุทุณ)ุ 9 (ุณุจุชูุจุฑ) 2025

### ุงููุถุน ุงูุญุงูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- **ุดูุฑ 7**: 285 ูุงุชูุฑุฉ ุบูุฑ ูุฏููุนุฉุ 41 ูุฏููุนุฉ
- **ุดูุฑ 8**: 297 ูุงุชูุฑุฉ ุบูุฑ ูุฏููุนุฉุ 39 ูุฏููุนุฉ
- **ุดูุฑ 9**: 300 ูุงุชูุฑุฉ ุบูุฑ ูุฏููุนุฉุ 40 ูุฏููุนุฉ

---

## ๐ ุฎูุงุฑุฒููุฉ ุงููุทุงุจูุฉ

### ุงููุฑุญูุฉ 1: ุงูุจุญุซ ุนู ุงูุนูุฏ
```
1. ุงูุจุญุซ ุจูุงุกู ุนูู ุงุณู ุงูุนููู (ุชุดุงุจู ุฌุฒุฆู ุจุงุณุชุฎุฏุงู SIMILARITY ุฃู LIKE)
2. ุงูุชุญูู ูู ุฑูู ุงููุฑูุจุฉ ูู ุญูู license_plate ุฃู contract_number
3. ุฅุฐุง ูู ููุนุซุฑ ุนูู ุชุทุงุจู โ ุชุณุฌูู ูู ุณุฌู ุงูุฃุฎุทุงุก ูููุฑุงุฌุนุฉ ุงููุฏููุฉ
```

### ุงููุฑุญูุฉ 2: ุงูุจุญุซ ุนู ุงููุงุชูุฑุฉ ุงูููุงุณุจุฉ
```
1. ุงูุจุญุซ ุนู ูุงุชูุฑุฉ ุบูุฑ ูุฏููุนุฉ (unpaid/partial) ููุนูุฏ ุงููุทุงุจู
2. ุงููุงุชูุฑุฉ ูุฌุจ ุฃู ุชููู ููุดูุฑ ุงููุญุฏุฏ (7/8/9) ูู 2025
3. ุงููุจูุบ ูุฌุจ ุฃู ูุชุทุงุจู ุฃู ุฃูู ูู balance_due
```

### ุงููุฑุญูุฉ 3: ุชุณุฌูู ุงูุฏูุนุฉ
```
1. ุฅูุดุงุก ุณุฌู ุฏูุนุฉ ุฌุฏูุฏ ูู ุฌุฏูู payments
2. ุฑุจุท ุงูุฏูุนุฉ ุจู invoice_id ู contract_id ู customer_id
3. ุชุญุฏูุซ ุงููุงุชูุฑุฉ:
   - paid_amount += payment_amount
   - balance_due -= payment_amount
   - payment_status = 'paid' ุฅุฐุง balance_due = 0ุ ูุฅูุง 'partial'
```

---

## โ๏ธ ุงูุชุญุฏูุงุช ูุงูุญููู

### 1. ุฃุณูุงุก ุงูุนููุงุก ุงููุฎุชููุฉ
**ุงููุดููุฉ**: ุงูุฃุณูุงุก ูู JSON ูุฏ ุชุฎุชูู ุนู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุซุงู: "ูุงุฏู ุงูุณุนูุฏ" vs "FADI ALSAEED"

**ุงูุญู**: 
- ุงุณุชุฎุฏุงู pg_trgm ูููุทุงุจูุฉ ุงูุฌุฒุฆูุฉ
- ุงูุจุญุซ ูู first_name_ar + last_name_ar
- ุญุฏ ุฃุฏูู ููุชุดุงุจู: 0.4 (40%)

### 2. ุฑูู ุงููุฑูุจุฉ
**ุงููุดููุฉ**: ูุฏ ูููู ุงูุฑูู ุจุชูุณููุงุช ูุฎุชููุฉ
- ูุซุงู: "185 485" vs "185485"

**ุงูุญู**:
- ุชูุธูู ุงูุฃุฑูุงู ูู ุงููุณุงูุงุช
- ุงูุจุญุซ ูู license_plate ูู ุฌุฏูู contracts

### 3. ุชูุฑุงุฑ ุงูุฏูุนุงุช
**ุงููุดููุฉ**: ููุณ ุงูุฏูุนุฉ ูุฏ ุชุธูุฑ ูู ูููุงุช ูุชุนุฏุฏุฉ

**ุงูุญู**:
- ูุญุต ูุฌูุฏ ุฏูุนุฉ ุจููุณ:
  - customer_id
  - amount
  - payment_date
  - contract_id
- ุฅุฐุง ููุฌุฏุช โ ุชุฎุทู

### 4. ููุงุชูุฑ ุจููุณ ุงูุชุงุฑูุฎ
**ุงููุดููุฉ**: ูุฏ ุชูุฌุฏ ููุงุชูุฑ ูุฏูุนุงุช ุจููุณ ุงูุชุงุฑูุฎ

**ุงูุญู**:
- ุงูุฏูุนุฉ ุชูุฎุตู ูู ุงููุงุชูุฑุฉ ุงูุฃูุฏู ุฃููุงู (FIFO)
- ุงููุงุชูุฑุฉ ูุฌุจ ุฃู ูููู ููุง balance_due > 0

---

## โ ุงูููุงู

- [ ] 1. ุฅูุดุงุก function ูููุทุงุจูุฉ ุงูุฐููุฉ ููุฃุณูุงุก
- [ ] 2. ุชูุธูู ุฃุฑูุงู ุงููุฑูุจุงุช ูุฅูุดุงุก ุฌุฏูู ูุคูุช
- [ ] 3. ูุทุงุจูุฉ ุงูุฏูุนุงุช ูุน ุงูุนููุฏ ูุงูููุงุชูุฑ
- [ ] 4. ุฅุฏุฎุงู ุงูุฏูุนุงุช ูุชุญุฏูุซ ุงูููุงุชูุฑ
- [ ] 5. ุชูุฑูุฑ ุจุงูุฏูุนุงุช ุงูุชู ูู ุชุชุทุงุจู

---

## ๐ ุงุณุชุฑุงุชูุฌูุฉ ุงูุชูููุฐ

### ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุฌุฏูู ูุคูุช ููุฏูุนุงุช
```sql
CREATE TEMP TABLE temp_payments AS
SELECT * FROM json_populate_recordset(...)
```

### ุงูุฎุทูุฉ 2: ุงููุทุงุจูุฉ ูุงูุชุญูู
```sql
-- ุฅูุดุงุก view ูููุทุงุจูุฉ ูุน ุชูุงุตูู
```

### ุงูุฎุทูุฉ 3: ุงูุฅุฏุฎุงู ุงููุนูู
```sql
-- ุฅุฏุฎุงู ุงูุฏูุนุงุช
-- ุชุญุฏูุซ ุงูููุงุชูุฑ
-- ูู transaction ูุงุญุฏุฉ
```

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

1. **ุงูุฏูุนุงุช ุงูููุฑุฑุฉ ูู ุงูููู**: ุจุนุถ ุงูุฏูุนุงุช ุชุธูุฑ ูุฑุชูู (ูู ูููุงุช ูุฎุชููุฉ)
   - ูุฌุจ ุฅุฒุงูุฉ ุงูุชูุฑุงุฑุงุช ูุจู ุงูุฅุฏุฎุงู
   
2. **ุงููุจุงูุบ ุงููุจูุฑุฉ**: ุจุนุถ ุงููุจุงูุบ ูุจูุฑุฉ ุฌุฏุงู (ูุซู 77,456) - ูุฏ ุชููู ุฃุฎุทุงุก
   - ูุฌุจ ูุฑุงุฌุนุฉ ูุฐู ูุฏููุงู

3. **ุงูุฃุณูุงุก ูุน ุนูุงูุงุช**: ุจุนุถ ุงูุฃุณูุงุก ุชุญุชูู ุนูู "*ุญุฌุฒ*" ุฃู "***ูุทููุจุฉ***"
   - ูุฌุจ ุชูุธูู ูุฐู ูุจู ุงููุทุงุจูุฉ

---

## ๐ ุฅุญุตุงุฆูุงุช ูุชููุนุฉ

- ุฅุฌูุงูู ุงูุฏูุนุงุช: ~250
- ุจุนุฏ ุฅุฒุงูุฉ ุงูุชูุฑุงุฑุงุช: ~180-200 (ุชูุฑูุจุงู)
- ูุชููุน ูุทุงุจูุฉ: ~70-80%
- ูููุฑุงุฌุนุฉ ุงููุฏููุฉ: ~20-30%
