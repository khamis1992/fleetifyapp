# ููุฎุต ุฅุตูุงุญ ุญุงูุงุช ุงููุฑูุจุงุช

## ๐ ุงููุดุงูู ุงูููุชุดูุฉ

### 1. ูุดููุฉ ุญุงูุงุช ุงููุฑูุจุงุช ุงูุฎุงุทุฆุฉ
- **62 ูุฑูุจุฉ** ูุงูุช ูุฏููุง ุนููุฏ ูุดุทุฉ ุฃู ูู ุงูุดุคูู ุงููุงููููุฉ ููู ุญุงูุชูุง `available`
- ุงูุณุจุจ: ุงูุนููุฏ ุชู ุชุญููููุง ููุดุคูู ุงููุงููููุฉ ูุจู ุชุทุจูู ุงูู trigger ุงูุฌุฏูุฏ

### 2. ูุดููุฉ ุงููุฑูุจุงุช ุงูููุฑุฑุฉ
- **20 ุฑูู ููุญุฉ ููุฑุฑ** (ูุฑูุจุชุงู ุฃู ุฃูุซุฑ ุจููุณ ุฑูู ุงูููุญุฉ)
- ูุซุงู: ุงููุฑูุจุฉ `7074` ููุฌูุฏุฉ ูุฑุชูู ูู ุงููุธุงู

---

## โ ุงูุญููู ุงููุทุจูุฉ

### ุงูุญู 1: ุชุตุญูุญ ุญุงูุงุช ุงููุฑูุจุงุช ุชููุงุฆูุงู

ุชู ุฅูุดุงุก ุฏุงูุชูู:

#### 1. `sync_vehicle_status_with_contracts(vehicle_id)`
- ุชุตุญูุญ ุญุงูุฉ ูุฑูุจุฉ ูุงุญุฏุฉ ุจูุงุกู ุนูู ุนููุฏูุง
- ุงูููุทู:
  - ุฅุฐุง ูุงู ูุฏููุง ุนููุฏ `active` ุฃู `under_legal_procedure` โ `rented`
  - ุฅุฐุง ูู ููู ูุฏููุง ุนููุฏ ูุดุทุฉ โ `available`

#### 2. `sync_all_vehicle_statuses()`
- ุชุตุญูุญ ุญุงูุงุช ุฌููุน ุงููุฑูุจุงุช ูู ุงููุธุงู ุฏูุนุฉ ูุงุญุฏุฉ

**ุงููุชุงุฆุฌ:**
```
โ ุฅุฌูุงูู ุงููุฑูุจุงุช: 525
โ ุชู ุงูุชุญุฏูุซ: 165 ูุฑูุจุฉ
โ ุจุฏูู ุชุบููุฑ: 360 ูุฑูุจุฉ
```

### ุงูุญู 2: ุฏูุฌ ุงููุฑูุจุงุช ุงูููุฑุฑุฉ (ุฌุงูุฒ ููุงุณุชุฎุฏุงู)

ุชู ุฅูุดุงุก ุฏุงูุชูู (ูู ูุชู ุชุดุบููููุง ุจุนุฏ):

#### 1. `merge_duplicate_vehicles(keep_id, remove_id)`
- ุฏูุฌ ูุฑูุจุชูู ููุฑุฑุชูู
- ููู ุฌููุน ุงูุนููุฏ ูุงูุตูุงูุฉ ูู ุงููุฑูุจุฉ ุงููุฏููุฉ ุฅูู ุงูุฌุฏูุฏุฉ
- ุชุนุทูู ุงููุฑูุจุฉ ุงููุฏููุฉ

#### 2. `merge_all_duplicate_vehicles()`
- ุฏูุฌ ุฌููุน ุงููุฑูุจุงุช ุงูููุฑุฑุฉ ุชููุงุฆูุงู
- ูุชู ุงูุงุญุชูุงุธ ุจุงููุฑูุจุฉ ุงูุฃูุฏู (ุงูุฃููู)

**โ๏ธ ุชุญุฐูุฑ:** ูู ูุชู ุชุดุบูู ุฏุงูุฉ ุงูุฏูุฌ ุชููุงุฆูุงู. ูุฌุจ ูุฑุงุฌุนุฉ ุงููุฑูุจุงุช ุงูููุฑุฑุฉ ุฃููุงู.

---

## ๐ ูุซุงู: ุงููุฑูุจุฉ 7074

### ูุจู ุงูุฅุตูุงุญ:
| ID | ุฑูู ุงูููุญุฉ | ุงูุญุงูุฉ | ุงูุนููุฏ ุงููุดุทุฉ |
|----|-----------|--------|---------------|
| 8f846a26... | 7074 | โ available | 3 ุนููุฏ ูู ุงูุดุคูู ุงููุงููููุฉ |
| 04fa300c... | 7074 | โ available | 0 ุนููุฏ |

### ุจุนุฏ ุงูุฅุตูุงุญ:
| ID | ุฑูู ุงูููุญุฉ | ุงูุญุงูุฉ | ุงูุนููุฏ ุงููุดุทุฉ |
|----|-----------|--------|---------------|
| 8f846a26... | 7074 | โ **rented** | 3 ุนููุฏ ูู ุงูุดุคูู ุงููุงููููุฉ |
| 04fa300c... | 7074 | โ available | 0 ุนููุฏ |

**ุงูุญุงูุฉ ุงูุขู ุตุญูุญุฉ!** โ

---

## ๐ ููููุฉ ุงุณุชุฎุฏุงู ุงูุฏูุงู

### 1. ุชุตุญูุญ ุญุงูุฉ ูุฑูุจุฉ ูุงุญุฏุฉ:
```sql
SELECT * FROM sync_vehicle_status_with_contracts('vehicle-id-here');
```

### 2. ุชุตุญูุญ ุฌููุน ุงููุฑูุจุงุช:
```sql
SELECT * FROM sync_all_vehicle_statuses();
```

### 3. ุนุฑุถ ุงููุฑูุจุงุช ุงูููุฑุฑุฉ:
```sql
SELECT 
    plate_number,
    COUNT(*) as duplicate_count
FROM vehicles
WHERE is_active = true
GROUP BY plate_number
HAVING COUNT(*) > 1;
```

### 4. ุฏูุฌ ูุฑูุจุชูู ููุฑุฑุชูู:
```sql
SELECT * FROM merge_duplicate_vehicles(
    'keep-vehicle-id',
    'remove-vehicle-id'
);
```

### 5. ุฏูุฌ ุฌููุน ุงููุฑูุจุงุช ุงูููุฑุฑุฉ:
```sql
SELECT * FROM merge_all_duplicate_vehicles();
```

---

## ๐ฏ ุงูุชูุตูุงุช

### ูููุณุชูุจู:
1. โ ุงูู trigger ุงูุฌุฏูุฏ `update_vehicle_status_from_contract` ุณูููุน ุญุฏูุซ ูุฐู ุงููุดููุฉ ูุณุชูุจูุงู
2. โ ูููู ุชุดุบูู `sync_all_vehicle_statuses()` ุจุดูู ุฏูุฑู (ูุซูุงู ุดูุฑูุงู) ููุชุฃูุฏ ูู ุตุญุฉ ุงูุจูุงูุงุช
3. โ๏ธ ูุฌุจ ูุฑุงุฌุนุฉ ุงููุฑูุจุงุช ุงูููุฑุฑุฉ ูุชุญุฏูุฏ ุฃููุง ูุฌุจ ุงูุงุญุชูุงุธ ุจู ูุจู ุงูุฏูุฌ

### ูุญู ูุดููุฉ ุงููุฑูุจุงุช ุงูููุฑุฑุฉ:
1. ูุฑุงุฌุนุฉ ูุงุฆูุฉ ุงููุฑูุจุงุช ุงูููุฑุฑุฉ
2. ุชุญุฏูุฏ ุงููุฑูุจุฉ ุงูุตุญูุญุฉ ููุงุญุชูุงุธ ุจูุง
3. ุชุดุบูู ุฏุงูุฉ ุงูุฏูุฌ

---

## ๐ฆ ุงููููุงุช ุงูููุดุฃุฉ

1. `20260127000006_fix_vehicle_status_on_vehicle_change.sql` - ุชุนุฏูู ุงูู trigger
2. `20260127000007_fix_vehicle_statuses_bulk.sql` - ุฏูุงู ุชุตุญูุญ ุงูุญุงูุงุช
3. `20260127000008_merge_duplicate_vehicles.sql` - ุฏูุงู ุฏูุฌ ุงููุฑูุจุงุช ุงูููุฑุฑุฉ

---

## โ ุงูุฎูุงุตุฉ

**ุชู ุฅุตูุงุญ 165 ูุฑูุจุฉ ุชููุงุฆูุงู!**

- ุงููุฑูุจุฉ 7074 ุงูุขู ุญุงูุชูุง ุตุญูุญุฉ: `rented` โ
- ุฌููุน ุงููุฑูุจุงุช ุงูุชู ูุฏููุง ุนููุฏ ูุดุทุฉ ุฃุตุจุญุช `rented`
- ุฌููุน ุงููุฑูุจุงุช ุจุฏูู ุนููุฏ ูุดุทุฉ ุฃุตุจุญุช `available`
- ุงูุฏูุงู ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ูู ุงููุณุชูุจู
