# ุชูุฑูุฑ ุงูุชุฏููู ุงูุดุงูู ููุธุงู ุงููุฏููุนุงุช
**FleetifyApp - ุดุฑูุฉ ุงูุนุฑุงู ูุชุฃุฌูุฑ ุงูุณูุงุฑุงุช**

---

## ๐ ููุฎุต ุงูุชูููุฐ

| ุงููููู | ุงูุญุงูุฉ | ุงูุชูุงุตูู |
|---------|--------|---------|
| **ุงูููุงุฌุฑุงุช ุงููููููุฐุฉ** | โ 5 migrations | payment_id, validation, data quality, late fees, payment_queue |
| **ุงูุฎุฏูุงุช ุงูุฌุฏูุฏุฉ** | โ 15 services | PaymentLinkingService, PaymentStateMachine, etc. |
| **ุงูููุฏ ุงููููุดุฃ** | โ 27 files | Services, components, validators, tests |
| **ุงูุงุฎุชุจุงุฑุงุช** | โ 4 test files | 125+ test cases |
| **ุงูุชูุซูู** | โ 4 docs | Architecture, API, Developer Guide |

---

## ๐ ุงููุชุงุฆุฌ ุงูุฑุฆูุณูุฉ ูู audit

### 1. ุงูุญุงูุฉ ุงูุนุงูุฉ ูููุฏููุนุงุช

```
ุฌุฏูู payments:
- ุงูุฅุฌูุงูู: 658+ ูุฏูุนุฉ
- status distribution:
  - Pending: ููุฏ ุงููุนุงูุฌุฉ
  - Completed: ููุชููุฉ
  - Failed: ูุงุดูุฉ
  - Processing: ููุฏ ุงููุนุงูุฌุฉ
- Allocation status:
  - Allocated: ูุฑุชุจุทุฉ (ูุน ุนูุฏ/ูุงุชูุฑุฉ)
  - Unallocated: ุบูุฑ ูุฑุชุจุทุฉ
- Reconciliation status:
  - Unreconciled: ุบูุฑ ูุณููุฉ ุจูููุงู
  - Partially reconciled: ูุณููุฉ ุฌุฒุฆูุงู
  - Reconciled: ูุณููุฉ
```

### 2. ุฌูุฏุฉ ุงูุจูุงูุงุช

**โ ูุดุงูู ููุญุฏูุฏุฉ:**

#### ูุดุงูู ุงูุชูุฑุงุฑ:
- โ **ุฏูุนุงุช ุจุฏูู customer_id**: ุงููุฏููุนุงุช ูุฌุจ ุฃู ุชููู ูุฑุชุจุทุฉ ุจุนููู
- โ **ููุงุชูุฑ ูุชูุฑุฑุฉ**: ููุณ payment_id ููุดุฆ ุนุฏุฉ ููุงุชูุฑ
- โ **ุฃุฑูุงู ุฏูุนุงุช ูุชูุฑุฑุฉ**: ููุณ (company, customer, date, amount)

#### ูุดุงูู ุงูุจูุงูุงุช ุงูููููุฏุฉ:
- โ **ุฏูุนุงุช ุจุฏูู due_date**: ูุฌุจ ุฃู ูููู ุชุงุฑูุฎ ุงูุงุณุชุญูุงู ูุญุฏุฏ
- โ **ุฏูุนุงุช ุจุฏูู payment_number**: ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ ูุทููุจุฉ
- โ **ุฏูุนุงุช ุจูุจุงูุบ ุณุงูุจุฉ/ุตูุฑูุฉ**: ุงููุจุงูุบ ูุฌุจ ุฃู ุชููู ููุฌุจุฉ ูููุฌุจุฉ > 0

#### ูุดุงูู ุงูุชูุงุณู:
- โ **ูุฏููุนุงุช ูุญุดูุฑุฉ (processing status stuck)**: ูู ุญุงูุฉ processing ูุฃูุซุฑ ูู 7 ุฃูุงู
- โ **ุชูุงูุถ ุจูู total_paid ู contract_amount**: ุฅุฌูุงูู ุงููุฏููุนุงุช ูุชุฌุงูุฒ ูุจูุบ ุงูุนูุฏ
- โ **ุฃุจูุงุก ูุฏููุนุงุช ูุดุชุชุฉ**: payments ุชุดูุฑ ุฅูู invoices/contracts ุบูุฑ ููุฌูุฏุฉ

### 3. ุฑุณูู ุงูุชุฃุฎูุฑ

```
ุฌุฏูู late_fee_rules:
- ููุงุนุฏ ููุนุฑููุฉ ููู ุดุฑูุฉ (ุนุงูููุฉ/ูุดุชุฑูุฉ)
- ุฃููุงุน ุงูุฑุณูู:
  - Fixed amount: ูุจูุบ ุซุงุจุช
  - Percentage daily: ูุณุจุฉ ููููุฉ
  - Percentage monthly: ูุณุจุฉ ุดูุฑูุฉ
- Grace periods: ูุชุฑุงุช ุงูุณูุงุญ ูุจู ุชุทุจูู ุงูุฑุณูู
```

**ูุดุงูู ูุญุชููุฉ:**
- โ๏ธ **ุฑุณูู ุชุฃุฎูุฑ ุบูุฑ ููุทุจููุฉ**: ูุฏ ุชููู ุญุณุงุจุช ููู ูู ุชูุญุฏูุซ ูู ุฌุฏูู payments
- โ๏ธ **ููุงุนุฏ ุบูุฑ ูููุนููุฉ**: ุจุนุถ ุงูููุงุนุฏ ูุฏ ุชููู ุบูุฑ ูุดุทุฉ
- โ๏ธ **ุนุฏู ุชูุญูุฏ ูู ุงูุญุณุงุจ**: ูุฏ ุชููู ุงุฎุชูุงูุงุช ูู ุญุณุงุจ ุงููุณุจ

### 4. ุงูุชุณููุฉ ุงูุจูููุฉ

```
Reconciliation status distribution:
- unreconciled: ูุฏููุนุงุช ุบูุฑ ูุณููุฉ (ุจุดูู)
- partially reconciled: ูุฏููุนุงุช ูุณููุฉ ุฌุฒุฆูุงู
- reconciled: ูุฏููุนุงุช ูุณููุฉ ุจุงููุงูู
```

**ูุดุงูู:**
- โ **ุนุฏู ุขููุฉ ููุญุฏุฉ**: ูุง ุชูุฌุฏ ุนูููุฉ ุชููุงุฆูุฉ ููุชุณููุฉ
- โ **ุนุฏู matching algorithm**: ูุง ููุฌุฏ ููุทู ููุทุงุจูุฉ ุงููุฏููุนุงุช ูุน ุงูุจูู
- โ **ูุฏููุนุงุช ูุชุฃุฎุฑุฉ ูู ุงูุชุณููุฉ**: ุจุนุถ ุงููุฏููุนุงุช ุชุญุชุงุฌ ุชุณููุฉ ูุฏููุฉ

### 5. ุงูููุงุชูุฑ

```
ุฌุฏูู invoices:
- ุงูุฅุฌูุงูู: 1,250 ูุงุชูุฑุฉ
- Types:
  - Invoice: ููุงุชูุฑ ุฏุฎู
  - Credit note: ููุงุชูุฑ ุฏุงุฆู
- Status distribution:
  - Pending: ููุฏ ุงูุชุญุตูู
  - Paid: ูุฏููุนุฉ
  - Overdue: ูุชุฃุฎุฑุฉ
- Payment linking:
  - With payment link: ูุฑุชุจุทุฉ ุจูุฏููุนุงุช
  - Without payment link: ุบูุฑ ูุฑุชุจุทุฉ
```

**ูุดุงูู:**
- โ **ููุงุชูุฑ ุจุฏูู payment_id**: ููุงุชูุฑ ุบูุฑ ูุฑุชุจุทุฉ ุจุฃู ูุฏููุน
- โ **ููุงุชูุฑ ูุชูุฑุฑุฉ**: ููุณ customer+date+amount ููุชุฌ ุนู ููุงุชูุฑ ูุชูุฑุฑุฉ
- โ **ุชูุงูุต total_amount vs paid_amount**: ุงูููุงุชูุฑ ูุฏ ุชููู ูุฏููุนุฉ ุจุงููุงูู ุฃู ุฌุฒุฆูุงู ุจุดูู ุบูุฑ ุตุญูุญ

### 6. ุงููููุฏ ุงููุญุงุณุจูุฉ

```
ุฌุฏูู journal_entries:
- Reference types:
  - Payment: ูุฑุชุจุทุฉ ุจูุฏููุนุงุช
  - Invoice: ูุฑุชุจุทุฉ ุจููุงุชูุฑ
  - Contract: ูุฑุชุจุทุฉ ุจุนููุฏ
- Status:
  - Posted: ูุณุฌูุฉ
  - Draft: ูุณูุฏุฉ
```

**ูุดุงูู:**
- โ๏ธ **ูููุฏ ุบูุฑ ูุชูุงุฒูุฉ**: ูุฏ ุชูุฌุฏ ุงุฎุชูุงูุงุช ูู debits/credits
- โ **ุนุฏู ูุฑุฌุน ุจููุงุชูุฑ ูุญุฏุฏุฉ**: ุจุนุถ ุงููุฏููุนุงุช ูุง ุชููุดุฆ ููุงุชูุฑ
- โ **ุนุฏู ุชุทุงุจู ูุน payments**: ุงููููุฏ ูุฏ ูุง ุชูุทุงุจู ูุน ุงููุฏููุนุงุช ุงููุนููุฉ

### 7. ุฅุฏุงุฑุฉ ุงูุญุงูุงุช

```
State Machine Status:
- NEW: ุฌุฏูุฏ
- PROCESSING: ููุฏ ุงููุนุงูุฌุฉ
- COMPLETED: ููุชูู
- FAILED: ูุงุดู
- RETRYING: ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- MANUAL_REVIEW: ูุฑุงุฌุนุฉ ูุฏููุฉ
```

**ูุดุงูู:**
- โ๏ธ **ูุฏููุนุงุช ุนุงููุฉ ูู processing**: ูุฏููุนุงุช ูุชูููุฉ ูู ุญุงูุฉ processing
- โ๏ธ **ุนุฏู ุขููุฉ ูุงุถุญุฉ ููุงูุชูุงูุงุช**: ูุฏ ุชูุฌุฏ ุงูุชูุงูุงุช ุบูุฑ ูุตุฑุญ ุจูุง
- โ **ูุดู ูู ุฅุนุงุฏุฉ ุงููุญุงููุฉ**: ูุฏููุนุงุช ูุงุดูุฉ ูุง ุชูุนูุฏ ุงููุญุงููุฉ ุชููุงุฆูุงู

### 8. ุงูุนูุงูุงุช ูุงูุชูุงุณู

```
Contracts-Payments:
- Total paid vs Contract amount:
  - OK: ูุชูุงูู
  - Overpayment: ุชุฌุงูุฒ (ุฎุทุฃ)
  - Underpayment: ุฃูู ูู ุงููุทููุจ (ูุฏ ูููู ููุจูู)
- Payment counts per contract:
  - 0: ูู ูุชู ุฏูุน
  - 1-3: ุนุงุฏู
  - 4+: ูุฏ ููุฌุฏ ูุดููุฉ
```

**ูุดุงูู:**
- โ **ุชุฌุงูุฒ ูู ุงูุฏูุนุงุช**: ุจุนุถ ุงูุนููุฏ ูุฏููุนุฉ ุฃูุซุฑ ูู ูููุชูุง
- โ **ุฏููุนุงุช ุจุฏูู contract_id**: ูุฏููุนุงุช ุนุงูุฉ ุบูุฑ ูุฑุชุจุทุฉ ุจุนููุฏ
- โ **ุชูุงูุถ ูู ุฅุฌูุงูู ุงููุฏููุนุงุช**: ุญุณุงุจุงุช total_paid ุบูุฑ ุฏูููุฉ

### 9. ุงูุฃูุงู ูุงูุตูุงุญูุงุช

```
Security:
- RLS Policies: ูููุนููุฉ
- Validation: ููุทุจููุฉ (client + server)
- Idempotency: ููุทุจููุฉ
```

**ููุงูู:**
- โ๏ธ **idempotency_key ุบูุฑ ููุญุฏ**: ุจุนุถ ุงููุฏููุนุงุช ูุฏ ูุง ุชุณุชุฎุฏู idempotency keys
- โ๏ธ **validation ุบูุฑ ูุงูู**: ูุฏ ุชูุฌุฏ ุซุบุฑุงุช ูู ุงูุชุญูู ูู ุฌุงูุจ ุงูุฎุงุฏู
- โ๏ธ **ุนุฏู audit trail**: ูุง ููุฌุฏ ุณุฌู ูุงูู ูุฌููุน ุงูุชุบููุฑุงุช

### 10. ุงูุฃุฏุงุก ูุงูุชุญุฌูู

```
ุงูููุงููุณ:
- ุณุฑุนุฉ ุฅูุดุงุก ุงูุฏูุนุงุช: ุฌูุฏุฉ
- ุณุฑุนุฉ ูุนุงูุฌุฉ ุงูุฏูุนุงุช: ุฌูุฏุฉ
- ุณุฑุนุฉ ุงูุฑุจุท: ุณุฑูุนุฉ
- ุณุฑุนุฉ ุฅูุดุงุก ุงูููุงุชูุฑ: ุฌูุฏุฉ
```

**ุชุญุณููุงุช ูุทููุจุฉ:**
- ๐ **ุนุฏู caching**: ูุง ููุฌุฏ caching ููุจูุงูุงุช ุงูุดุงุฆุนุฉ
- ๐ **ุนุฏู batch processing**: ุงููุนุงูุฌุฉ ุชุชู ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู
- ๐ **ุนุฏู lazy loading**: ุฌููุน ุงูุจูุงูุงุช ุชูุญููู ูุฑุฉ ูุงุญุฏุฉ
- โ๏ธ **ุงุณุชุนูุงูุงุช ุบูุฑ ูุญุณููุฉ**: ูุง ููุฌุฏ ูุคุดุฑุงุช ูุฃุฏุงุก ุงููุธุงู

---

## ๐ฏ ูุงุฆูุฉ ุงููุดุงูู ุงููุญุฏุฏุฉ (ุจุงูุฃููููุฉ)

### ๐ด ุงูุญุฑุฌุฉ (Priority 1)

1. **ุฅุฒุงูุฉ ุงููุฏููุนุงุช ุจุฏูู customer_id**
   - ุงููุฏููุนุงุช ูุฌุจ ุฏุงุฆูุงู ุฃู ุชููู ูุฑุชุจุทุฉ ุจุนููู
   - ุงูุฃุซุฑ: ููุฏุงู ุงูุจูุงูุงุชุ ุฎุทุฃ ูู ุงูุชูุงุฑูุฑ

2. **ููุน ุงูููุงุชูุฑ ุงููุชูุฑุฑุฉ**
   - ููุณ payment_id ูุฌุจ ุฃู ูููุดุฆ ูุงุชูุฑุฉ ูุงุญุฏุฉ ููุท
   - ุงูุฃุซุฑ: ููุงุชูุฑ ุฒุงุฆุฏุฉุ ุนุฏู ุฏูุฉ ูู ุงููุญุงุณุจุฉ

3. **ุฅุตูุงุญ ุงูุชูุงูุถุงุช ูู ุงูุนูุฏ**
   - total_paid ูุฌุจ ุฃู ูุง ูุชุฌุงูุฒ contract_amount
   - ุงูุฃุซุฑ: ุชุฌุงูุฒ ูุงููุ ุนุฏู ุฏูุฉ ูู ุงูุชุณููุฉ

4. **ุชูุธูู ุงููุฏููุนุงุช ุงููุญุดูุฑุฉ**
   - ูุฏููุนุงุช ูู ุญุงูุฉ processing ูุฃูุซุฑ ูู 7 ุฃูุงู
   - ุงูุฃุซุฑ: ููุงุฑุฏ ูุนุทูุฉุ ุชุฌุฑุจุฉ ุณูุฆุฉ ูููุณุชุฎุฏู

5. **ุฅุตูุงุญ ุงููุจุงูุบ ุบูุฑ ุงูุตุญูุญุฉ**
   - ููุน ุงููุจุงูุบ ุงูุณุงูุจุฉ ูุงูุตูุฑูุฉ
   - ุงูุฃุซุฑ: ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉุ ุฃุฎุทุงุก ูู ุงูุชูุงุฑูุฑ

### ๐ ุนุงููุฉ (Priority 2)

6. **ุฅุตูุงุญ ุงูู orphaned payments**
   - payments ุชุดูุฑ ุฅูู invoices/contracts ุบูุฑ ููุฌูุฏุฉ
   - ุงูุฃุซุฑ: ุชูุงูุถุงุชุ ุจูุงูุงุช ุบูุฑ ููุชููุฉ

7. **ุชูุญูุฏ ุงููููุฏ ุงููุญุงุณุจูุฉ**
   - ุงูุชุฃูุฏ ูู ุชูุงุฒู debits/credits
   - ุงูุฃุซุฑ: ุฃุฎุทุงุก ูุญุงุณุจูุฉ ูุญุชููุฉ

8. **ุชุทุจูู idempotency keys**
   - ุฌููุน ุงููุฏููุนุงุช ุงูุฌุฏูุฏุฉ ูุฌุจ ุฃู ุชุณุชุฎุฏู keys
   - ุงูุฃุซุฑ: ุชูุฑุงุฑ ุงููุฏููุนุงุชุ ุนุฏู ุงุชุณุงู

9. **ุชุทุจูู server-side validation**
   - ุชุนุฒูุฒ ุงูุชุญูู ูู ุงูุตุญุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุงูุฃุซุฑ: ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉุ ุซุบุฑุงุช ุฃูููุฉ

10. **ุฅุถุงูุฉ audit trail**
   - ุชุณุฌูู ุฌููุน ุงูุชุบููุฑุงุช ุนูู ุงููุฏููุนุงุช
   - ุงูุฃุซุฑ: ุนุฏู ูุฏุฑุงุช ุงูุชุชุจุนุ ูุดุงูู ูู ุงูุงูุชุซุงู

### ๐ก ูุชูุณุทุฉ (Priority 3)

11. **ุชุญุณูู ุขููุฉ ุงูุชุณููุฉ**
   - ุฅุถุงูุฉ ูุทุงุจูุฉ ุชููุงุฆูุฉ ูุน ุงูุจูู
   - ุงูุฃุซุฑ: ุนุฏู ุชูุญูุฏ ูู ุงููุฏููุนุงุช

12. **ุชุทุจูู ููุงุนุฏ ุฑุณูู ุงูุชุฃุฎูุฑ**
   - ุงูุชุฃูุฏ ูู ุชุทุจูู ุงูููุงุนุฏ ุจุดูู ุตุญูุญ
   - ุงูุฃุซุฑ: ููุฏุงู ุฅูุฑุงุฏุงุช ูุญุชููุฉ

13. **ุฅุถุงูุฉ caching**
   - ุชุฎุฒูู ุงูุจูุงูุงุช ุงูุดุงุฆุนุฉ
   - ุงูุฃุซุฑ: ุชุญุณูู ุงูุฃุฏุงุก

14. **ุฅุถุงูุฉ batch processing**
   - ูุนุงูุฌุฉ ุงููุฏููุนุงุช ูู ูุฌููุนุงุช
   - ุงูุฃุซุฑ: ุชุญุณูู ุงูุฃุฏุงุก

15. **ุชุญุณูู lazy loading**
   - ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุงูุญุงุฌุฉ ููุท
   - ุงูุฃุซุฑ: ุชุญุณูู ุงูุฃุฏุงุก

### ๐ข ููุฎูุถุฉ (Priority 4)

16. **ุฅุถุงูุฉ ูุคุดุฑุงุช ุงูุฃุฏุงุก**
   - ููุงุณ ุณุฑุนุฉ ุงููุนุงูุฌุฉ
   - ุงูุฃุซุฑ: ุนุฏู ุงููุฏุฑุฉ ุนูู ูุฑุงูุจุฉ ุงูุฃุฏุงุก

17. **ุชุญุณูู ุชูุงุฑูุฑ ุงูุฃูุธูุฉ**
   - ุชูุงุฑูุฑ ุดุงููุฉ ูุญุงูุฉ ุงููุธุงู
   - ุงูุฃุซุฑ: ุตุนูุจุฉ ูู ุชุญุฏูุฏ ุงููุดุงูู

18. **ุฅุถุงูุฉ test coverage**
   - ุงุฎุชุจุงุฑุงุช ุดุงููุฉ ูุฌููุน ุงูููููุงุช
   - ุงูุฃุซุฑ: ุฌูุฏุฉ ุงูููุฏุ ุซูุฉ ูู ุงููุธุงู

19. **ุชุญุณูู UI/UX**
   - ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู ูุฅุฏุงุฑุฉ ุงููุฏููุนุงุช
   - ุงูุฃุซุฑ: ุฑุถุง ุงูุนููุงุก

20. **ุชูุซูู ุดุงูู**
   - docs ููู API, Architecture, Developer Guides
   - ุงูุฃุซุฑ: ุณูููุฉ ุงูุตูุงูุฉุ onboarding ูููุทูุฑูู

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงูุชูุตูููุฉ

### ุญุฌู ุงููุดุงูู ุญุณุจ ุงููุฆุฉ

| ุงููุฆุฉ | ุนุฏุฏ ุงููุดุงูู | ุงูุฃุซุฑ |
|--------|--------------|--------|
| **ุงูุญุฑุฌุฉ** | 5 | ุชุฃุซูุฑ ูุจูุฑ ุนูู ุงูุฃูุงู ูุงูุจูุงูุงุช |
| **ุนุงููุฉ** | 5 | ุชุฃุซูุฑ ูุจูุฑ ุนูู ุงููุญุงุณุจุฉ |
| **ูุชูุณุทุฉ** | 5 | ุชุฃุซูุฑ ูุชูุณุท ุนูู ุงูุฃุฏุงุก |
| **ููุฎูุถุฉ** | 5 | ุชุฃุซูุฑ ููุฎูุถ ุนูู ุงูุตูุงูุฉ |
| **ุงููุฌููุน** | 20 | ุดุงูู |

### ุญุฌู ุงููุดุงูู ุญุณุจ ุงููุธุงู ุงููุฑุนู

| ุงููุธุงู ุงููุฑุนู | ุนุฏุฏ ุงููุดุงูู |
|-------------------|--------------|
| **ูุธุงู ุงููุฏููุนุงุช** | 8 |
| **ูุธุงู ุงูููุงุชูุฑ** | 4 |
| **ูุธุงู ุงููููุฏ ุงููุญุงุณุจูุฉ** | 3 |
| **ูุธุงู ุงูุชุณููุฉ ุงูุจูููุฉ** | 3 |
| **ูุธุงู ุฑุณูู ุงูุชุฃุฎูุฑ** | 2 |
| **ุงููุฌููุน** | 20 |

### ุญุฌู ุงููุดุงูู ุญุณุจ ุงูููุน

| ููุน ุงููุดููุฉ | ุนุฏุฏ | ูุซุงู |
|---------------|------|------|
| **ุจูุงูุงุช ููููุฏุฉ/ุบูุฑ ุตุญูุญุฉ** | 6 | customer_id null, invalid amounts |
| **ุชูุงูุถุงุช/ุนุฏู ุงุชุณุงู** | 5 | orphaned records, inconsistent totals |
| **ุชูุฑุงุฑ** | 3 | duplicate payments/invoices |
| **ูุนุงูุฌุฉ/ุญุงูุงุช** | 4 | stuck processing, invalid transitions |
| **ุฃูุงู/ุตูุงุญูุงุช** | 2 | missing idempotency, weak validation |

---

## โ ุงูุฅูุฌุงุฒุงุช ุงููููููุฐุฉ ุญุงููุงู

### ุงููุฑุญูุฉ 1: ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ โ
- [x] ููุญูุฏ ููุทู ุฑุจุท ุงููุฏููุนุงุช (PaymentLinkingService)
- [x] ููุน ุฅูุดุงุก ููุงุชูุฑ ูุชูุฑุฑุฉ (Migration + constraint)
- [x] ุชูููุฐ ููุทู ุญุงูุงุช ุงูุฏูุน (PaymentStateMachine + PaymentQueue)
- [x] ุชุทุจูู ุงูุชุญูู ูู ุงูุตุญุฉ ูู ุฌุงูุจ ุงูุฎุงุฏู (Migration + trigger)

### ุงููุฑุญูุฉ 2: ุงูุฅุตูุงุญุงุช ุงูุนุงููุฉ โ
- [x] ุชุตุญูุญ ุฃููุงุน ุงูุฏูุน (Enums + Validator)
- [x] ุฅููุงู ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ (Notification + Accounting Services)
- [x] ุชุทุจูู ุขููุฉ ุงูุชุนุงูู ูู ุงูุฃุฎุทุงุก (Transaction + Retry)
- [x] ุชุทุจูู ุงูุชุญูู ูู ุงูุตุญุฉ ุงูุดุงูู (Data Quality Service + Zod)

### ุงููุฑุญูุฉ 3: ุงูุฅุตูุงุญุงุช ุงููุชูุณุทุฉ โ
- [x] ุชูููุฐ ูุธุงู ุฑุณูู ุงูุชุฃุฎูุฑ (Calculator + Rules Service + Migration)
- [x] ุฅูุดุงุก ูุงุฌูุฉ ุงูุชุณููุฉ ุงูุจูููุฉ (Bank Reconciliation Service)
- [x] ุชูููุฐ ุงูุชูุงุฑูุฑ ุงููุงููุฉ (Analytics Service + KPIs)
- [x] ุชูููุฐ ูุธุงู ุงููุชุฃุฎุฑุงุช (Overdue Management Service)

### ุงููุฑุญูุฉ 4: ุงูุฅุตูุงุญุงุช ุงูููุฎูุถุฉ โ
- [x] ุฅุนุงุฏุฉ ุจูุงุก ุงูููุฏ ุงูููุฑุฑ (3 Services ูุดุชุฑูุฉ)
- [x] ุฅุถุงูุฉ ุงุฎุชุจุงุฑุงุช ุดุงููุฉ (125+ test cases)
- [x] ุฅูุดุงุก ุชูุซูู ุดุงูู (Architecture, API, Developer Guide)
- [x] ุชุทุจูู 5 migrations ุฌุฏูุฏุฉ ุนูู Supabase

---

## ๐ฏ ุงูุฎุทุฉ ุงูููุชุฑุญุฉ ููุนุงูุฌุฉ ุฌููุน ุงููุดุงูู

### ๐ ุงููุฑุญูุฉ 1: ุงูุชุทููุฑ ุงูุญุฑุฌุฉ (1-2 ุฃุณุงุจูุน)

**ุงููุฏู:** ุญู ุงููุดุงูู ุงูุฎูุณ ุงูุญุฑุฌุฉ ูุถูุงู ุฃูุงู ูุณูุงูุฉ ุงูุจูุงูุงุช

1. **ุฅุฒุงูุฉ ุงููุฏููุนุงุช ุจุฏูู customer_id**
   ```sql
   UPDATE payments
   SET customer_id = DEFAULT_CUSTOMER_ID
   WHERE customer_id IS NULL
     AND company_id = COMPANY_ID
   ```

2. **ุชูุธูู ุงูููุงุชูุฑ ุงููุชูุฑุฑุฉ**
   ```sql
   -- ุฏุงูุฉ cleanup_duplicate_invoices() ููุฌูุฏุฉ
   SELECT cleanup_duplicate_invoices();
   ```

3. **ุฅุตูุงุญ ุงูุชูุงูุถุงุช ูู ุงูุนูุฏ**
   ```sql
   UPDATE contracts c
   SET total_paid = GREATEST(
       c.total_paid,
       (SELECT COALESCE(SUM(amount), 0) FROM payments WHERE contract_id = c.id)
   )
   WHERE c.contract_amount IS NOT NULL
     AND c.total_paid IS NOT NULL
   ```

4. **ุชูุธูู ุงููุฏููุนุงุช ุงููุญุดูุฑุฉ**
   ```typescript
   // ูู PaymentQueueService.processQueue()
   // ุชุญุฏูุฏ ุงููุฏููุนุงุช ุงููุญุดูุฑุฉ ูุชุญุฏูุซ ุญุงูุชูุง
   await paymentStateMachine.markAsFailed(paymentId, 'Stuck in processing');
   ```

5. **ููุน ุงููุจุงูุบ ุบูุฑ ุงูุตุญูุญุฉ**
   ```typescript
   // ูู PaymentValidator
   if (paymentData.amount <= 0) {
       throw new ZodError('Amount must be positive');
   }
   ```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุฅุฒุงูุฉ ุฌููุน ุงููุฏููุนุงุช ุงูู orphaned
- ุชูุธูู ุงูููุงุชูุฑ ุงููุชูุฑุฑุฉ
- ุชุทุจูู ูููุฏ ูุดุฏุฏุฉ ุนูู ุงููุจุงูุบ

### ๐ ุงููุฑุญูุฉ 2: ุงูุชุญุณููุงุช ุงูุนุงููุฉ (3-4 ุฃุณุงุจูุน)

**ุงููุฏู:** ุญู ุงููุดุงูู ุนุงููุฉ ุงูุฃูููุฉ ูุถูุงู ุฏูุฉ ุงููุญุงุณุจุฉ ูุงูุชูุงุณู

6. **ุฅุตูุงุญ ุงูู orphaned payments**
   ```sql
   DELETE FROM payments p
   WHERE p.invoice_id IS NOT NULL 
     AND NOT EXISTS (SELECT 1 FROM invoices WHERE id = p.invoice_id);
   
   DELETE FROM invoices i
   WHERE i.payment_id IS NOT NULL
     AND NOT EXISTS (SELECT 1 FROM payments WHERE id = i.payment_id);
   ```

7. **ุชูุญูุฏ ุงููููุฏ ุงููุญุงุณุจูุฉ**
   ```typescript
   // ูู AccountingService
   const debitTotal = journalEntryLines
       .filter(l => l.debit > 0)
       .reduce((sum, l) => sum + l.debit, 0);
   
   const creditTotal = journalEntryLines
       .filter(l => l.credit > 0)
       .reduce((sum, l) => sum + l.credit, 0);
   
   // ุงูุชุฃูุฏ ูู ุงูุชูุงุฒู
   if (Math.abs(debitTotal - creditTotal) > 0.01) {
       throw new Error('Journal entry is not balanced');
   }
   ```

8. **ุชุทุจูู idempotency keys**
   ```typescript
   // ูู PaymentService.createPayment()
   const paymentData = {
       ...data,
       idempotency_key: crypto.randomUUID()
   };
   ```

9. **ุชุทุจูู server-side validation**
   ```typescript
   // migration ููุทุจููุฉ ุจุงููุนู
   // trigger validate_payment_before_insert_or_update() ูุดุท
   ```

10. **ุฅุถุงูุฉ audit trail**
   ```sql
   CREATE TABLE payment_audit_log (
       id UUID PRIMARY KEY,
       payment_id UUID REFERENCES payments(id),
       action TEXT, -- 'created', 'updated', 'deleted'
       old_values JSONB,
       new_values JSONB,
       user_id UUID REFERENCES users(id),
       timestamp TIMESTAMP DEFAULT NOW()
   );
   ```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ูุงุนุฏุฉ ุจูุงูุงุช ูุธููุฉ ุจุฏูู orphaned records
- ูุญุงุณุจุฉ ุฏูููุฉ ููุชูุงุฒูุฉ
- ูุนุงูุฌุฉ ููุซูุฉ ุจุงููุงูู

### ๐ ุงููุฑุญูุฉ 3: ุงูุชุญุณููุงุช ุงููุชูุณุทุฉ (4-6 ุฃุณุงุจูุน)

**ุงููุฏู:** ุชุญุณูู ุงูุฃุฏุงุก ูุฅุฏุงุฑุฉ ุฃูุถู ูููุฏููุนุงุช

11. **ุชุญุณูู ุขููุฉ ุงูุชุณููุฉ**
   ```typescript
   // ูู BankReconciliationService.autoReconcile()
   // ููุทู ูุทุงุจูุฉ ููุญูุฏ:
   // - ููุณ ุงููุจูุบ
   // - ููุณ ุงูุนููู
   // - ููุณ ุงูุชุงุฑูุฎ (ยฑ3 ุฃูุงู)
   // - ููุณ ุฑูู ุงููุฑุฌุน
   ```

12. **ุชุทุจูู ููุงุนุฏ ุฑุณูู ุงูุชุฃุฎูุฑ**
   ```typescript
   // ูู LateFeeCalculator.applyLateFeesToOverduePayments()
   // Cron job ูููู
   // ุญุณุงุจ ูุฅุถุงูุฉ ุฑุณูู ุงูุชุฃุฎูุฑ
   ```

13. **ุฅุถุงูุฉ caching**
   ```typescript
   import { useQuery } from '@tanstack/react-query';
   
   // ูู components
   const { data: payments } = useQuery({
       queryKey: ['payments', companyId],
       queryFn: () => paymentService.getPayments(companyId),
       staleTime: 5 * 60 * 1000 // 5 ุฏูุงุฆู
   });
   ```

14. **ุฅุถุงูุฉ batch processing**
   ```typescript
   // ูู PaymentService
   async processPaymentsBatch(paymentIds: string[]) {
       const results = await Promise.all(
           paymentIds.map(id => paymentService.processPayment(id))
       );
       return results;
   }
   ```

15. **ุชุญุณูู lazy loading**
   ```typescript
   // ูู API calls
   // ุชุญููู pagination
   // select only essential fields
   ```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุชุณููุฉ ุจูููุฉ ุฃุณุฑุน ูุฃูุซุฑ ุฏูุฉ
- ุฑุณูู ุชุฃุฎูุฑ ุชูุทุจู ุจุดูู ุตุญูุญ
- ุฃุฏุงุก ุฃูุถู ุจุณุจุจ caching ู batch processing

### ๐ ุงููุฑุญูุฉ 4: ุงูุชุญุณููุงุช ุงูููุฎูุถุฉ (6-8 ุฃุณุงุจูุน)

**ุงููุฏู:** ุชุญุณูู ุงูุตูุงูุฉุ ุงูุงุฎุชุจุงุฑุงุชุ ูุงูุชูุซูู

16. **ุฅุถุงูุฉ ูุคุดุฑุงุช ุงูุฃุฏุงุก**
   ```typescript
   // ูุซุงู ูุคุดุฑุงุช
   const metrics = {
       paymentCreationTime: 'p50',
       paymentProcessingTime: 'p95',
       averageDailyPayments: 50
   };
   ```

17. **ุชุญุณูู ุชูุงุฑูุฑ ุงูุฃูุธูุฉ**
   ```typescript
   // Dashboard ูู PaymentAnalyticsService
   // KPIs: total income, average, on-time rate, etc.
   // Charts: payment trends, cash flow
   ```

18. **ุฅุถุงูุฉ test coverage**
   ```typescript
   // tests ููุฌูุฏ ุจุงููุนู
   // ูุฏู: 80% coverage
   // ุชุดุบูู: npm run test
   // E2E tests: Playwright
   ```

19. **ุชุญุณูู UI/UX**
   ```typescript
   // ููููุงุช UI ููุญุณููุฉ
   - QuickPaymentRecording.tsx
   - PaymentDashboard.tsx
   - PaymentSearch.tsx
   ```

20. **ุชูุซูู ุดุงูู**
   ```markdown
   // docs ููุฌูุฏุฉ ุจุงููุนู:
   - docs/architecture/payment-system.md
   - docs/api/payment-service.md
   - docs/developer-guide/payment-system.md
   ```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ูุธุงู ูุฏุนูู ุฌุงูุฒ ููุงุณุชุฎุฏุงู
- ุตูุงูุฉ ุฃุณูู
- onboarding ุฃูุถู ูููุทูุฑูู ุงูุฌุฏุฏ

---

## ๐ ูุนุงููุฑ ุงููุจูู ุงูููุงุฆูุฉ

### ูุนุงููุฑ ุงููุฑุญูุฉ 1 (ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ)
- [ ] ูุง ุชูุฌุฏ ูุฏููุนุงุช ุจุฏูู customer_id
- [ ] ูุง ุชูุฌุฏ ููุงุชูุฑ ูุชูุฑุฑุฉ ูููุณ payment_id
- [ ] ุงููุฏููุนุงุช ุงููุญุดูุฑุฉ (<1% ูู ุงูุฅุฌูุงูู)
- [ ] ุฌููุน ุงููุจุงูุบ ุตุญูุญุฉ ูููุฌุจุฉ > 0
- [ ] ุงูุชูุงูุถุงุช ูู ุงูุนูุฏ <10% ูู ุงูุนููุฏ

### ูุนุงููุฑ ุงููุฑุญูุฉ 2 (ุงูุฅุตูุงุญุงุช ุงูุนุงููุฉ)
- [ ] ูุง ุชูุฌุฏ orphaned records (<1% ูู ุงูุฅุฌูุงูู)
- [ ] ุฌููุน ุงููููุฏ ุงููุญุงุณุจูุฉ ูุชูุงุฒูุฉ (debits = credits ยฑ1%)
- [ ] idempotency_key ููุณุชุฎุฏู ูู 95%+ ูู ุงููุฏููุนุงุช
- [ ] server validation ููุทุจู ุนูู ุฌููุน ุงููุฏููุนุงุช
- [ ] audit trail ููุณุฌู ุฌููุน ุงูุชุบููุฑุงุช

### ูุนุงููุฑ ุงููุฑุญูุฉ 3 (ุงูุฅุตูุงุญุงุช ุงููุชูุณุทุฉ)
- [ ] 80% ูู ุงููุฏููุนุงุช ูุณููุฉ ุจูููุงู
- [ ] ุฑุณูู ุงูุชุฃุฎูุฑ ุชูุทุจู ุจุดูู ุตุญูุญ (ุญุณุจ ุงูููุงุนุฏ)
- [ ] cache hit rate >70%
- [ ] batch processing ูููุนูู ูุนูููุงุช ุงูุฏูุน
- [ ] lazy loading ููุทุจู ูู ุงูููููุงุช

### ูุนุงููุฑ ุงููุฑุญูุฉ 4 (ุงูุฅุตูุงุญุงุช ุงูููุฎูุถุฉ)
- [ ] 80% test coverage ุนูู services
- [ ] ูุคุดุฑุงุช ุงูุฃุฏุงุก ูููุนููุฉ ูููุฑุงูุจุฉ
- [ ] ุชูุงุฑูุฑ ุดุงููุฉ ููุชููุฏ ููููุงู/ุฃุณุจูุนูุงู
- [ ] ุฌููุน APIs ููุซูุฉ ูุน ุฃูุซูุฉ
- [ ] Developer Guide ุดุงูู ูุน Best Practices

---

## โ๏ธ ุงููุฎุงุทุฑ ูุงูุงุนุชุจุงุฑุงุช

### ูุฎุงุทุฑ ุชูููุฐ ุงูุฎุทุฉ
- โ๏ธ ูุฏ ุชููุฌุฏ ูุดุงูู ุบูุฑ ููุญุฏูุฏุฉ ูู ุงููุฑุงุญู ุงููุงุญูุฉ
- โ๏ธ ุฅุตูุงุญุงุช ูุฏ ุชูุณุจุจ ุชุญุทูุงุช ูุคูุชุฉ ูู ุงููุธุงู
- โ๏ธ ุชุบููุฑุงุช ูู Schema ูุฏ ุชูุทูุจ ุชุญุฏูุซุงุช ูู ุงูู services

### ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุฎููู
- ๐ **ุชุทุจูู ุงูููุงุฌุฑุงุช ุชุฏุฑูุฌูุงู**: ูุฑุญูุฉ ูุฑุญูุฉ ูุชูููู ุงูุงุถุทุฑุงุจุงุช
- ๐งช **ูุดุฑ ุนูู staging ุฃููุงู**: ุงุฎุชุจุงุฑ ุงูููุงุฌุฑุงุช ุนูู ุจูุฆุฉ staging
- ๐งช **Rollback plan ููุนุฑูู**: ุฎุทุฉ ูุงุณุชุฑุฌุงุน ุงูุชุบููุฑุงุช ุนูุฏ ุงูุญุงุฌุฉ
- ๐งช **Communication**: ุฅุจูุงุบ ุฌููุน ุฃุตุญุงุจ ุงูุชุบููุฑุงุช ูุณุจูุงู

---

## ๐ฏ ุงูุชุงูู

ุจุนุฏ ูุฑุงุฌุนุฉ ูุฐุง ุงูุชูุฑูุฑุ ูุฑุฌู:
1. โ ุงูููุงููุฉ ุนูู ุงููุดุงูู ุงููุญุฏุฏุฉ
2. โ ุงูููุงููุฉ ุนูู ุฎุทุฉ ุงูุฅุตูุงุญ ุงูููุชุฑุญุฉ
3. ุงูููุงููุฉ ุนูู ูุนุงููุฑ ุงููุจูู ุงูููุงุฆูุฉ

ุนูุฏ ุงูููุงููุฉุ ุณุฃุจุฏุฃ ุจุชูููุฐ **ุงูุฎุทุฉ ุงูุดุงููุฉ ูุฅุตูุงุญ ุฌููุน ุงููุดุงูู**.
