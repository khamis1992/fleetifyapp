# ููููุฉ ุงุญุชุณุงุจ ุฅุฌูุงูู ูููุฉ ุงูุนูุฏ

## ๐ ุงููุนุงุฏูุฉ ุงูุฃุณุงุณูุฉ

### 1๏ธโฃ ุญุณุงุจ ุงูุฏูุนุฉ ุงูุดูุฑูุฉ (Monthly Payment)

```
ุงูุฏูุนุฉ ุงูุดูุฑูุฉ = (ุงูุฅูุฌุงุฑ ุงูุดูุฑู + ุฑุณูู ุงูุชุฃููู + ุฑุณูู ุงูุฎุฏูุฉ) + ุงูุถุฑูุจุฉ
```

**ุงูุชูุตูู:**
```typescript
subtotal = monthly_rate + insurance_fees + service_fees
tax = subtotal ร tax_rate
total_monthly = subtotal + tax
```

**ูุซุงู:**
- ุงูุฅูุฌุงุฑ ุงูุดูุฑู: 3,000 ุฑ.ู
- ุฑุณูู ุงูุชุฃููู: 200 ุฑ.ู
- ุฑุณูู ุงูุฎุฏูุฉ: 100 ุฑ.ู
- ูุนุฏู ุงูุถุฑูุจุฉ: 0% (ูุทุฑ ูุง ุชูุฑุถ ุถุฑูุจุฉ ุนูู ุงูุฅูุฌุงุฑ)

```
subtotal = 3,000 + 200 + 100 = 3,300 ุฑ.ู
tax = 3,300 ร 0 = 0 ุฑ.ู
total_monthly = 3,300 + 0 = 3,300 ุฑ.ู
```

### 2๏ธโฃ ุญุณุงุจ ุฅุฌูุงูู ูููุฉ ุงูุนูุฏ (Total Contract Value)

```
ุฅุฌูุงูู ูููุฉ ุงูุนูุฏ = ุงูุฏูุนุฉ ุงูุดูุฑูุฉ ร ุนุฏุฏ ุงูุฃุดูุฑ
```

**ุงูุชูุตูู:**
```typescript
contract_duration_months = differenceInMonths(end_date, start_date) + 1
total_contract_value = total_monthly ร contract_duration_months
```

**ูุซุงู:**
- ุชุงุฑูุฎ ุงูุจุฏุงูุฉ: 2024-01-01
- ุชุงุฑูุฎ ุงูููุงูุฉ: 2024-12-31
- ุนุฏุฏ ุงูุฃุดูุฑ: 12 ุดูุฑ
- ุงูุฏูุนุฉ ุงูุดูุฑูุฉ: 3,300 ุฑ.ู

```
total_contract_value = 3,300 ร 12 = 39,600 ุฑ.ู
```

## ๐ ุงูุชุญูู ูู ุงูุนูุฏ C-ALF-0066

ููุชุญูู ูู ุตุญุฉ ุญุณุงุจ ุฅุฌูุงูู ูููุฉ ุงูุนูุฏุ ูุญุชุงุฌ ุฅูู:

### ุงูุจูุงูุงุช ุงููุทููุจุฉ:
1. **ุงูุฅูุฌุงุฑ ุงูุดูุฑู** (`monthly_rate` ุฃู `monthly_amount`)
2. **ุฑุณูู ุงูุชุฃููู** (`insurance_fees`)
3. **ุฑุณูู ุงูุฎุฏูุฉ** (`service_fees`)
4. **ูุนุฏู ุงูุถุฑูุจุฉ** (`tax_rate`)
5. **ุชุงุฑูุฎ ุงูุจุฏุงูุฉ** (`start_date`)
6. **ุชุงุฑูุฎ ุงูููุงูุฉ** (`end_date`)

### ุฎุทูุงุช ุงูุชุญูู:

#### ุงูุฎุทูุฉ 1: ุญุณุงุจ ุงูุฏูุนุฉ ุงูุดูุฑูุฉ
```
ุงูุฏูุนุฉ ุงูุดูุฑูุฉ = (ุงูุฅูุฌุงุฑ + ุงูุชุฃููู + ุงูุฎุฏูุฉ) + ุงูุถุฑูุจุฉ
```

#### ุงูุฎุทูุฉ 2: ุญุณุงุจ ุนุฏุฏ ุงูุฃุดูุฑ
```
ุนุฏุฏ ุงูุฃุดูุฑ = ุงููุฑู ุจูู ุชุงุฑูุฎ ุงูููุงูุฉ ูุงูุจุฏุงูุฉ + 1
```

#### ุงูุฎุทูุฉ 3: ุญุณุงุจ ุงูุฅุฌูุงูู
```
ุฅุฌูุงูู ูููุฉ ุงูุนูุฏ = ุงูุฏูุนุฉ ุงูุดูุฑูุฉ ร ุนุฏุฏ ุงูุฃุดูุฑ
```

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. ุญุณุงุจ ุนุฏุฏ ุงูุฃุดูุฑ
- ูุชู ุงุณุชุฎุฏุงู `differenceInMonths()` ูู ููุชุจุฉ `date-fns`
- ูุชู ุฅุถุงูุฉ `+1` ูุชุถููู ุงูุดูุฑ ุงูุฃุฎูุฑ
- **ูุซุงู:** ูู 2024-01-01 ุฅูู 2024-12-31 = 12 ุดูุฑ (ูููุณ 11)

### 2. ุงูุฑุณูู ุงูุฅุถุงููุฉ
- **ุฑุณูู ุงูุชุฃููู:** ุชูุถุงู ุฅูู ูู ุฏูุนุฉ ุดูุฑูุฉ
- **ุฑุณูู ุงูุฎุฏูุฉ:** ุชูุถุงู ุฅูู ูู ุฏูุนุฉ ุดูุฑูุฉ
- **ุงูุถุฑูุจุฉ:** ุชูุญุณุจ ุนูู ุงููุฌููุน ุงููุฑุนู (ุงูุฅูุฌุงุฑ + ุงูุฑุณูู)

### 3. ุงูุญุงูุงุช ุงูุฎุงุตุฉ
- **ุนููุฏ ูุตูุฑุฉ ุงูุฃุฌู:** ุฅุฐุง ูุงู ุงูุนูุฏ ุฃูู ูู ุดูุฑุ ูุชู ุงุญุชุณุงุจ ุดูุฑ ูุงุญุฏ ุนูู ุงูุฃูู
- **ุนููุฏ ููุชููุฉ:** ูุชู ุญุณุงุจ ุฌููุน ุงูุฃุดูุฑ ุญุชู ุชุงุฑูุฎ ุงูููุงูุฉ
- **ุนููุฏ ููุบุงุฉ:** ูุชู ุญุณุงุจ ุงูุฃุดูุฑ ุงููุนููุฉ ููุท

## ๐๏ธ ุงูููุฏ ุงููุณุคูู

### ุงูููู: `src/lib/contract-calculations.ts`

**ุฏุงูุฉ ุญุณุงุจ ุงูุฏูุนุฉ ุงูุดูุฑูุฉ:**
```typescript
export function calculateMonthlyPayment(contract: Contract): MonthlyPaymentResult {
  const { monthly_rate, financial_terms, currency } = contract;
  const { insurance_fees, service_fees, tax_rate } = financial_terms;

  const subtotal = monthly_rate + insurance_fees + service_fees;
  const tax = subtotal * tax_rate;
  const total = subtotal + tax;

  return { subtotal, tax, total, currency, breakdown };
}
```

**ุฏุงูุฉ ุญุณุงุจ ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช:**
```typescript
export function calculateTotalRevenue(contract: Contract): TotalRevenueResult {
  const startDate = new Date(contract.start_date);
  const endDate = new Date(contract.end_date);

  const monthlyPaymentResult = calculateMonthlyPayment(contract);
  const contractDurationMonths = Math.max(1, differenceInMonths(endDate, startDate) + 1);
  const totalRevenue = monthlyPaymentResult.total * contractDurationMonths;

  return {
    monthlyRevenue: monthlyPaymentResult.total,
    totalRevenue,
    contractDurationMonths,
  };
}
```

## โ ููููุฉ ุงูุชุญูู ูู ุงูุนูุฏ

### ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู:
1. ุงูุชุญ ุตูุญุฉ ุชูุงุตูู ุงูุนูุฏ
2. ุชุญูู ูู ุงูููู ุงูุชุงููุฉ:
   - ุงูุฅูุฌุงุฑ ุงูุดูุฑู
   - ุฑุณูู ุงูุชุฃููู
   - ุฑุณูู ุงูุฎุฏูุฉ
   - ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ูุงูููุงูุฉ
3. ุงุญุณุจ ูุฏููุงู ุจุงุณุชุฎุฏุงู ุงููุนุงุฏูุฉ ุฃุนูุงู
4. ูุงุฑู ุงููุชูุฌุฉ ูุน "ุฅุฌูุงูู ูููุฉ ุงูุนูุฏ" ุงููุนุฑูุถ

### ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
SELECT 
  contract_number,
  monthly_amount,
  start_date,
  end_date,
  -- ุญุณุงุจ ุนุฏุฏ ุงูุฃุดูุฑ
  EXTRACT(YEAR FROM AGE(end_date, start_date)) * 12 + 
  EXTRACT(MONTH FROM AGE(end_date, start_date)) + 1 as months,
  -- ุญุณุงุจ ุงูุฅุฌูุงูู
  monthly_amount * (
    EXTRACT(YEAR FROM AGE(end_date, start_date)) * 12 + 
    EXTRACT(MONTH FROM AGE(end_date, start_date)) + 1
  ) as calculated_total
FROM contracts
WHERE contract_number = 'C-ALF-0066';
```

## ๐ง ุฅุตูุงุญ ุงููุดููุฉ

ุฅุฐุง ูุงูุช ุงููููุฉ ุบูุฑ ุตุญูุญุฉุ ุชุญูู ูู:

1. **ุงูุฅูุฌุงุฑ ุงูุดูุฑู:** ูู ูู ุตุญูุญุ
2. **ุงูุชูุงุฑูุฎ:** ูู ุชุงุฑูุฎ ุงูุจุฏุงูุฉ ูุงูููุงูุฉ ุตุญูุญุงูุ
3. **ุงูุฑุณูู ุงูุฅุถุงููุฉ:** ูู ุฑุณูู ุงูุชุฃููู ูุงูุฎุฏูุฉ ูุญุณูุจุฉุ
4. **ุนุฏุฏ ุงูุฃุดูุฑ:** ูู ุงูุญุณุงุจ ูุดูู ุงูุดูุฑ ุงูุฃูู ูุงูุฃุฎูุฑุ

### ูุซุงู ุนูู ุฎุทุฃ ุดุงุฆุน:
```
โ ุฎุทุฃ: ุนุฏู ุฅุถุงูุฉ +1 ูุนุฏุฏ ุงูุฃุดูุฑ
ูู 2024-01-01 ุฅูู 2024-12-31
differenceInMonths = 11 ุดูุฑ (ุฎุทุฃ!)

โ ุตุญูุญ: ุฅุถุงูุฉ +1
ูู 2024-01-01 ุฅูู 2024-12-31
differenceInMonths + 1 = 12 ุดูุฑ (ุตุญูุญ!)
```
