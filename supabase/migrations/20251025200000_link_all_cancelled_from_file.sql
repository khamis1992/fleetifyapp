-- ===============================
-- Link ALL Remaining Cancelled Contracts
-- Generated from insert_customers.sql
-- ===============================

DO $$
DECLARE
  v_company_id UUID := '24bc0b21-4e2d-4413-9842-31719a3669f4';
  v_contract_data RECORD;
  v_vehicle_id UUID;
  v_customer_id UUID;
  v_contract_id UUID;
  v_updated_contracts INTEGER := 0;
  v_created_customers INTEGER := 0;
  v_updated_customers INTEGER := 0;
  v_skipped_no_vehicle INTEGER := 0;
  v_skipped_no_contract INTEGER := 0;
BEGIN
  RAISE NOTICE 'Processing cancelled contracts...';
  
  CREATE TEMP TABLE temp_contract_data (
    contract_number TEXT,
    plate TEXT,
    customer_name TEXT,
    phone TEXT
  );
  
  INSERT INTO temp_contract_data VALUES
    ('LTO2024139', '7036', 'issam abdallah', '97430777645'),
    ('LTO20249', '749762', 'MEHRAN TABIB TABIB HUSSAIN', '97433648377'),
    ('Ret-2018184', '711464', 'snoonu snoonu', '97433211272'),
    ('LTO202453', '7071', 'AHMED BEN DHAOU', '97466607498'),
    ('MR2024182', '7078', 'haythem souissi', '97471310005'),
    ('Ret-2018200', '2774', 'snoonu snoonu', '97433211272'),
    ('LTO2024141', '7060', 'bannour rekaia', '97430743344'),
    ('LTO202422', '2771', 'AHMED ABBAS ELDAWO ELHASHMI', '97470476000'),
    ('MR202481', '10853', 'frank williams', '97430488852'),
    ('LTO2024339', '706150', 'marwen safsafi', '97471886388'),
    ('276', '706150', 'hassan sharif', '97430033188'),
    ('MR2024155', '749762', 'abdelghani abboud', '97430504430'),
    ('AGR-202504-412264', '381247', 'احمد جمعة', '97430060107'),
    ('LTO2024322', '7063', 'said chenouf', '97455992530'),
    ('LTO202429', '2767', 'Mohammed ali Fetoui', '97433779853'),
    ('MR202473', '754705', 'faisal iqbal', '97430158700'),
    ('Ret-2018189', '2772', 'snoonu snoonu', '97433211272'),
    ('MR202464', '7078', 'shahid rehman', '97466050616'),
    ('LTO2024108', '856589', 'sajjad gul', '97430092501'),
    ('AGR-202504-408522', '2767', 'عبد الغفور درار', '97477122519'),
    ('MR2024181', '7057', 'MOHAMED AMINE SALEM', '97471105390'),
    ('LTO202490', '563829', 'haytham zarrouk', '97466406305'),
    ('Ret-2018185', '893408', 'snoonu snoonu', '97433211272'),
    ('LTO2024310', '8203', 'kaies ayari', '97430109102'),
    ('Ret-2018220', '10174', 'snoonu snoonu', '97433211272'),
    ('Ret-2018219', '9902', 'snoonu snoonu', '97433211272'),
    ('AGR-202504-399591', '2782', 'شرفي عبد الله', '97477517797'),
    ('LTO202428', '4017', 'SOUFIANE BESSAOUDI', '97450792055'),
    ('AGR-938047-996', '862165', 'محمد عبد الله سلمان', '97455554627'),
    ('LTO202427', '5889', 'AYMEN HAMADI', '97430305808'),
    ('Ret-2018223', '646507', 'snoonu snoonu', '97433211272'),
    ('LTO2024100', '847601', 'tarak tunisia', '97430200442'),
    ('LTO202426', '4016', 'Nacer Lahcene', '97455064714'),
    ('LTO2024252', '721440', 'mahdi yousif', '97433670129'),
    ('Ret-2018218', '10189', 'snoonu snoonu', '97433211272'),
    ('LTO2024316', '749762', 'yahia sakhri', '97450447989'),
    ('In201893', '761292', 'abdelazim pro', '97433344021'),
    ('MR202485', '10849', 'raphael denu', '97430316583'),
    ('LTO2024341', '7036', 'issam abdallah', '97430777645'),
    ('LTO2024130', '7056', 'EIHAB ABDALLA', '97474488904'),
    ('LTO2024126', '8209', 'MAMOUN AHMED', '97430034843'),
    ('AGR-202504-421999', '10853', 'عبد الحميد عترون', '97450643428'),
    ('LTO202411', '4014', 'MUHAMMAD ALI KHALID', '97450584650'),
    ('Ret-2018210', '816508', 'snoonu snoonu', '97433211272'),
    ('LTO2024288', '2634', 'ahmed fadil', '97455935204'),
    ('AGR-202504-414082', '10851', 'اسلام عثمان محمدين', '97455025546'),
    ('MR202487', '741277', 'eric naiko', '97430636173'),
    ('Ret-2018199', '856878', 'snoonu snoonu', '97433211272'),
    ('MR2024234', '9902', 'MOHAMED AMINE SALEM', '97471105390'),
    ('AGR-202504-406129', '856718', 'حسان بو علاق', '66553638'),
    ('MR202470', '7062', 'imran farhad', '97477292398'),
    ('LTO20245', '8210', 'ZAINUDEEN MOHAMED IZADEEN', '97455020544'),
    ('LTO2024299', '563829', 'marwen safsafi', '97471886388'),
    ('AGR-202504-417240', '10671', 'ياسر الصادق القاسم', '97455990635'),
    ('AGR-202502-0418', '10174', 'كبيروم العرجاوي ولدكيدان', '30796407'),
    ('MR2024146', '10064', 'saidi ababa', '97455945485'),
    ('LTO202441', '7054', 'SAYED I.A ELSAYED', '97455058031'),
    ('LTO2024321', '10664', 'mounir lechelache', '97470883509'),
    ('AGR-202504-409871', '7054', 'محمد جاسم صالح', '97466684460'),
    ('LTO202495', '862169', 'OSAMA GRESS', '70381387'),
    ('LTO2024119', '21860', 'MOTAZ ABOSHABA', '97439932355'),
    ('MR202475', '7038', 'tamer el sayed', '97430067536'),
    ('LTO20246', '185485', 'Elsadigh Salih Ibrahim Diab', '97470075544'),
    ('LTO2024287', '2778', 'ahmed babiker ahmed', '97430933229'),
    ('AGR-202504-417839', '7042', 'إبراهيم يعقوب', '97430882244'),
    ('AGR-202504-420819', '8208', 'عصام احمداحمد', '97466276263'),
    ('LTO202438', '9902', 'ALI SALIM MZITA', '97455089148'),
    ('LTO2024240', '7058', 'aliyu umar', '97466424774'),
    ('LTO2024144', '7054', 'soufiane allaoua', '97466197941'),
    ('LTO2024128', '754705', 'tarek rahali', '97430762577'),
    ('LTO2024314', '5893', 'mohamed amine chouchene', '97431435988'),
    ('Ret-2018187', '7063', 'snoonu snoonu', '97433211272'),
    ('AGR-202504-398252', '21860', 'محمد العويني', '668168169'),
    ('LTO2024324', '10849', 'elthagafi awad elseed ,ohamed hamid', '97433285933'),
    ('LTO2024276', '8209', 'saeed al-hebabi', '97433333971'),
    ('LTO2024279', '817009', 'AHMED BEN DHAOU', '97466607498'),
    ('AGR-202504-407328', '7034', 'عمار الشيخ', '97433386066'),
    ('LTO202412', '8212', 'RECEP KART', '97474462697'),
    ('LTO202435', '10854', 'HOUSSIN HENI', '97433111067'),
    ('LTO202447', '752724', 'Mohamed Hathroubi', '97470713088'),
    ('MR202461', '10667', 'mohamed shikh', '97470075026'),
    ('LTO202449', '862165', 'AHMED ABBAS ELDAWO ELHASHMI', '97470476000'),
    ('LTO202439', '8207', 'HAMZA ZIDI', '97466440580'),
    ('AGR-202504-412862', '185573', 'إيهاب عبد الله', '97431009664'),
    ('LTO2024291', '381247', 'abdulla al-shahri', '97433933920'),
    ('AGR-202504-419022', '856589', 'يحيى عبد الرحمان', '97430757943'),
    ('LTO2024151', '2783', 'chrisus arinaitwe', '97474459955'),
    ('AGR-202504-416046', '8209', 'هشام عبد العظيم', '97431009664'),
    ('LTO2024266', '5900', 'mohamed abdalla', '97470083881'),
    ('LTO2024148', '2773', 'hechem mejri', '97470209573'),
    ('251', '7054', 'mohamed boumahni', '97470890200'),
    ('LTO2024300', '7058', 'mohamed amine chouchene', '97431435988'),
    ('LTO202445', '847059', 'Badredine Khalfi', '97477754754'),
    ('MR202467', '10670', 'omer omer', '97450575500'),
    ('LTO202457', '5898', 'Mukhtar Ali Anayat UR RAHMAN', '97477884251'),
    ('LTO202410', '17216', 'ABDELAZIZ JERFEL', '97433767961'),
    ('LTO2024284', '7069', 'ISSAM MZOUGHI', '97474700503'),
    ('Ret-2018206', '856715', 'snoonu snoonu', '97433211272'),
    ('LTO2024153', '335485', 'AHMED AKKAR', '97433326546'),
    ('LTO20244', '5901', 'HOSSEM DHAHRI', '97471375054'),
    ('LTO2024133', '7040', 'OLALEYE ALO', '97477998806'),
    ('LTO2024125', '10172', 'ANWAR MOHAMED', '97470561365'),
    ('Ret-2018198', '521207', 'snoonu snoonu', '97433211272'),
    ('LTO2024107', '848014', 'ravi ravi', '97433336834'),
    ('LTO2024319', '2784', 'ABUOBIDA BABIKER MOHAMED AHMED SIDDIG', '97455653223'),
    ('In2018175', '856878', 'faisal iqbal', '97430158700'),
    ('LTO2024282', '754436', 'SIHEM BEN AHMED', '97430177100'),
    ('LTO2024264', '7058', 'ATEF MANSOUR', '97474446588'),
    ('LTO202497', '846508', 'MAHDI HOSNI', '97430180684'),
    ('LTO2024254', '7062', 'mahmoud hassanein', '97466404489'),
    ('AGR-635810-055', '9902', 'زين العابدين ادريس', '97470897519'),
    ('LTO2024303', '7057', 'jabir desta', '97477069310'),
    ('In2018181', '10853', 'MUHAMMAD GUL', '97451145953'),
    ('LTO2024143', '7043', 'ahmed MASGHOUNI', '97433340971'),
    ('MR2024115', '521207', 'awuah baffour', '97433326932'),
    ('LTO2024268', '856925', 'ATEF MANSOUR', '97474446588'),
    ('AGR-202504-424367', '7040', 'محمد إبراهيم', '97450506797'),
    ('Ret-2018222', '711464', 'snoonu snoonu', '97433211272'),
    ('MR202460', '2768', 'mohamed nawaz', '97455496356'),
    ('LTO2024103', '9255', 'ala eddine hsin', '97477456439'),
    ('LTO2024296', '862165', 'HANENE JELASSI', '97450533032'),
    ('LTO2024330', '21849', 'AHMED BEN DHAOU', '97466607498'),
    ('AGR-954526-295', '2776', 'سيف الدولة عيسى', '97474033341'),
    ('Ret-2018129', '721440', 'mohamed shikh', '97470075026'),
    ('AGR-202502-0416', '2778', 'يوسف سقام', '33721869'),
    ('LTO2024242', '5898', 'nabil fargalla', '97431184659'),
    ('LTO2024106', '847987', 'ravi ravi', '97433336834'),
    ('In2018176', '10664', 'emmanuel darko', '97471581990'),
    ('Ret-2018209', '746956', 'snoonu snoonu', '97433211272'),
    ('LTO202432', '5891', 'ZINELABIDINE BADRA', '97431207465'),
    ('LTO2024145', '5900', 'ABDULRAHMAN ALGHAIATHI', '97455771800'),
    ('In2018224', '9905', 'faisal iqbal', '97430158700'),
    ('LTO202436', '7064', 'Mohammed Muslim', '97455958782'),
    ('Ret-2018215', '7053', 'snoonu snoonu', '97433211272'),
    ('MR202474', '10176', 'zied fares', '97450115847'),
    ('LTO2024261', '7072', 'YOUSSEF KHALILI', '97472119703'),
    ('MR202466', '10174', 'hosni maatallah', '97470059300'),
    ('LTO202458', '7074', 'MONCEF SAIBI', '97433784834'),
    ('Ret-2018202', '8207', 'snoonu snoonu', '97433211272'),
    ('MR2024122', '10851', 'SOUFIANE BESSAOUDI', '97450792055'),
    ('MR2024302', '749762', 'saeed al-hebabi', '97433333971'),
    ('Ret-2018195', '2770', 'snoonu snoonu', '97433211272'),
    ('LTO20247', '185513', 'Elsadigh Salih Ibrahim Diab', '97470075544'),
    ('LTO2024155', '7054', 'oussama` bouguerra', '97470209653'),
    ('AGR-202504-414676', '856878', 'مؤمن علي سعيد', '97474024205'),
    ('LTO2024105', '847941', 'ravi ravi', '97433336834'),
    ('LTO2024156', '5899', 'ahmed babker', '97433081277'),
    ('LTO202421', '2777', 'Suman Kumar shah', '97471302739'),
    ('LTO2024278', '751340', 'MOURAD BARHOUMI', '97430566445'),
    ('LTO2024304', '646507', 'achraf saadaoui', '97455165658'),
    ('LTO2024263', '7053', 'MAHDI HAMID', '97430138501'),
    ('LTO2024149', '7037', 'mokhtar alil', '97477907750'),
    ('In2018159', '10854', 'awuah baffour', '97433326932'),
    ('LTO2024251', '10174', 'KIBROM AREGAWI WELDEKIDAN', '97430796407'),
    ('LTO202448', '8206', 'Abdemoniem ismail mahmoud Mohamed', '97477884170'),
    ('Ret-2018204', '7073', 'snoonu snoonu', '97433211272'),
    ('LTO2024265', '856878', 'GIRISHKUMAR KARTHIKEYAN', '97433389695'),
    ('LTO2024248', '2772', 'ismail mohamed', '97430400511'),
    ('AGR-055405-212', '7063', 'مهند حمود الظاهر', '97430623322'),
    ('LTO2024270', '10197', 'ahmed elwasila', '97450118063'),
    ('MR202498', '10189', 'MOHAMED AMINE SALEM', '97471105390'),
    ('Ret-2018205', '7039', 'snoonu snoonu', '97433211272'),
    ('MR202483', '751340', 'prince nkansah', '50131833'),
    ('In2018160', '10668', 'shadrack saky', '97455076981'),
    ('LTO202491', '893411', 'radhwan mdini', '97430004696'),
    ('Ret-2018217', '381247', 'snoonu snoonu', '97433211272'),
    ('LTO2024297', '556199', 'yosr chamkhi', '97431008858'),
    ('MR2024232', '10669', 'ABDELJALIL HATTACH', '97450623375'),
    ('MR2024102', '821873', 'OASIM HALDER', '97450088482'),
    ('LTO2024140', '5895', 'amir ben fredj', '97466172920'),
    ('LTO2024320', '5894', 'mohammed houssem dib', '97472034609'),
    ('AGR-202504-403859', '2779', 'مختار عليل', '97477227716'),
    ('LTO2024247', '548682', 'QFORCE SECURITY SERVICE', '97450446192'),
    ('AGR-810033-532', '8205', 'dtrgfgdfg', '2345654'),
    ('308', '381247', 'mustafa almustafa', '97470555993'),
    ('Ret-2018216', '648144', 'snoonu snoonu', '97433211272'),
    ('LTO2024315', '739649', 'mohamed ncibi', '97466918182'),
    ('AGR-463481-549', '4014', 'محمد علي سليم', '97430797703'),
    ('LTO2024138', '7040', 'RAFIK BELKACEM', '31215469'),
    ('LTO202455', '10856', 'AYMEN NASRA', '97450171785'),
    ('AGR-202504-418432', '5891', 'موسى حيمر', '97471503673'),
    ('LTO2024243', '9999', 'mohamed elnakhli', '97433781937'),
    ('MR202468', '7039', 'abrar zaib', '97439989880'),
    ('LTO202492', '722134', 'mouheb ouni', '97430059056'),
    ('LTO2024285', '857051', 'CHIHEB HEDHLI', '97430586471'),
    ('LTO2024293', '2774', 'saber dhibi', '97451076544'),
    ('LTO2024338', '2779', 'ahmed abdalla mahmoud abdalla mahmoud abdalla', '97466230309'),
    ('LTO2024118', '9891', 'DEO SSENYANJA', '97455984233'),
    ('LTO2024342', '7065', 'azhari hakim khalid hakim', '9745578515'),
    ('LTO2024147', '548682', 'salah masaad', '97466104053'),
    ('Ret-2018225', '893409', 'snoonu snoonu', '97433211272'),
    ('Ret-2018228', '725473', 'snoonu snoonu', '97433211272'),
    ('MR2024236', '2770', 'syed jan', '97471027960'),
    ('AGR-202504-411671', '5894', 'عبد اللله العلواني', '97470897519'),
    ('Ret-2018221', '822389', 'snoonu snoonu', '97433211272'),
    ('LTO2024326', '8208', 'MOHAMMAD ADNAN SWAID', '97431103801'),
    ('In2018167', '10850', 'MOHAMMED ULLAH', '97477579524'),
    ('AGR-202504-403263', '21849', 'فادي السعيدي', '97466043445'),
    ('LTO2024333', '10664', 'achraf saadaoui', '97455165658'),
    ('LTO20248', '846485', 'HOSSEM DHAHRI 2', '97431115657'),
    ('MR202463', '570468', 'abdelkader abdelkader', '97471108770'),
    ('Ret-2018213', '646507', 'snoonu snoonu', '97433211272'),
    ('LTO2024305', '7041', 'mohamed ahmed', '97455304449'),
    ('Ret-201896', '739649', 'abduaziz almhauod', '70598989'),
    ('Ret-2018212', '11473', 'snoonu snoonu', '97433211272'),
    ('Ret-2018196', '7072', 'snoonu snoonu', '97433211272'),
    ('LTO2024273', '10665', 'AHMED EDRISS', '97477013644'),
    ('AGR-202504-410464', '2774', 'هاني براهمي', '97466521616'),
    ('LTO202418', '7075', 'Mohammad Haitham ettahar elhaddi mohamad', '97450446192'),
    ('LTO202446', '2776', 'Salih abdullah mohamed Ahmad', '97455339605'),
    ('MR2024274', '2766', 'walid hassan', '97477439393'),
    ('AGR-202502-0422', '2767', 'عبدالغفور درار', '77122519'),
    ('Ret-2018193', '556199', 'snoonu snoonu', '97433211272'),
    ('Ret-2018190', '7067', 'snoonu snoonu', '97433211272'),
    ('LTO2024124', '847099', 'AMIR EL MAHDI', '97433734751'),
    ('LTO2024257', '9905', 'ahmed elwasila', '97450118063'),
    ('LTO2024136', '7041', 'alaeddine dabech', '97471146699'),
    ('LTO2024331', '751340', 'mohamed ncibi', '97466918182'),
    ('In2018180', '749403', 'SAIF ramzan', '97431466795'),
    ('In2018161', '10666', 'emmanuel darko', '97471581990'),
    ('LTO2024295', '856589', 'sabri mbarki', '97455133110'),
    ('AGR-202504-397268', '2778', 'يوسف سقام', '33721869'),
    ('AGR-202504-400949', '10668', 'عبد المنعم', '97470184904'),
    ('LTO2024135', '5897', 'ABDALLA ABDALLA', '97433079976'),
    ('LTO2024334', '7063', 'hakim kouas', '97466230309'),
    ('MR2024123', '10858', 'DEO SSENYANJA', '97455984233'),
    ('LTO2024327', '2770', 'tarek boutemedjet', '97455039533'),
    ('LTO2024258', '2783', 'ABDELLATIF ELHADAD', '97477710585'),
    ('319', '7058', 'MOHAMED CHOUCHENE', '97455146823'),
    ('LTO2024269', '648144', 'muhammad mahmood', '97470715743'),
    ('Ret-2018203', '2777', 'snoonu snoonu', '97433211272'),
    ('LTO2024340', '5890', 'ABDELAZIZ JERFEL', '97433767961'),
    ('LTO202459', '2780', 'Yassine Serhani', '97474778109'),
    ('AGR-202504-405141', '8212', 'حسن محمد الفكي', '97450055884'),
    ('LTO2024301', '821873', 'ahmed ali mohamed bakhit', '97477160274'),
    ('LTO202430', '8205', 'Hamza Serunga', '97450795709'),
    ('LTO2024272', '7074', 'tarek rahali', '97430762577'),
    ('Ret-2018214', '335750', 'snoonu snoonu', '97433211272'),
    ('LTO2024267', '8208', 'hamze hussein', '97471348615'),
    ('AGR-202504-413489', '7056', 'علم الدين جمعة', '97466188278'),
    ('LTO2024323', '754436', 'hakim kouas', '97466230309'),
    ('LTO2024309', '821873', 'ahmed MASGHOUNI', '97433340971'),
    ('LTO2024313', '9905', 'marwen safsafi', '97471886388'),
    ('247', '8207', 'MOHAMMED ABDALLAH', '97450200224'),
    ('LTO2024232', '8212', 'ABDUL AZIZ WAIGA', '97433347242'),
    ('LTO202417', '8213', 'Abdelrahim Mohamed', '97431310330'),
    ('Ret-2018192', '2769', 'snoonu snoonu', '97433211272'),
    ('LTO2024115', '7068', 'YASSER SOLIMAN', '97477354490'),
    ('AGR-202504-415263', '893409', 'عبد الصمد بن عزوز', '97433478097'),
    ('LTO2024292', '721894', 'mahamoud maan dabboussi', '97450869246'),
    ('LTO202413', '721894', 'HAMIDA BOUZIANE', '97470053425'),
    ('AGR-202504-419607', '556199', 'سفيان صالح', '97450770260'),
    ('MR202462', '7042', 'osmane mohamed', '97450628032'),
    ('LTO2024178', '817009', 'KAMIL ALTAHIR', '97470294015'),
    ('AGR-202504-409278', '7059', 'عمر مراىحي', '97431299557'),
    ('LTO202424', '2774', 'mokhtar alil', '97477907750'),
    ('LTO2024280', '7043', 'HAMZA YANES', '97455260218'),
    ('LTO202451', '5896', 'ABDELJALIL HATTACH', '97450623375'),
    ('Ret-2018226', '185573', 'snoonu snoonu', '97433211272'),
    ('AGR-202504-416649', '8213', 'مصطفى  ساتي', '97471826567'),
    ('LTO2024132', '2779', 'AYMEN NASRA', '97450171785'),
    ('LTO2024253', '725473', 'mohammed awad', '97450325578'),
    ('LTO2024337', '2769', 'waddah elobaid', '97471953163'),
    ('LTO2024233', '893411', 'radhwan mdini', '97430004696'),
    ('In2018182', '754436', 'sead logomo', '97430228791'),
    ('MR202486', '335485', 'richard asiedu', '66906353'),
    ('LTO2024112', '5894', 'ahmad salah', '97431003131'),
    ('LTO2024120', '2769', 'baligh ben amor', '97433418142'),
    ('LTO202450', '7077', 'ADAM SALIH G. MOHAMED', '97450066411'),
    ('AGR-283909-351', '756104', 'يحيى احمد عبدالرحمن', '97430757943'),
    ('LTO202423', '7058', 'Sofiene Ben salah', '97450770260'),
    ('Ret-2018194', '5894', 'snoonu snoonu', '97433211272'),
    ('LTO202433', '8203', 'Mouheb Gandouzi', '97451201321'),
    ('LTO2024246', '335750', 'QFORCE SECURITY SERVICE', '97450446192'),
    ('In2018168', '10849', 'aurangzeb din', '97430654309'),
    ('LTO2024109', '9890', 'Abdelrahim Mohamed', '97431310330'),
    ('LTO2024111', '5899', 'mohammad ismail', '97477572739'),
    ('MR202469', '5893', 'ameer zaib', '97455631990'),
    ('AGR-202502-0430', '856718', 'حسان بو علاق', '66553638'),
    ('LTO202440', '7070', 'MUHAMMAD S.M.M KHALIFA', '97430811517'),
    ('338', '2777', 'mohanad aldaher', '97430623322'),
    ('In2018158', '10855', 'lukman dramani', '97433963041'),
    ('LTO202419', '7069', 'Mazyad Saab', '97470099200'),
    ('AGR-202504-411066', '2768', 'عبد العزيز علي', '97470342655'),
    ('LTO2024332', '2778', 'ABDELAZIZ JERFEL', '97433767961'),
    ('139', '5893', 'omar hmem', '97459993757'),
    ('AGR-202504-407921', '2773', 'يوسف قابل', '97471155135'),
    ('AGR-202502-0420', '7038', 'ثامر محمد ', '30067536'),
    ('Ret-2018197', '7071', 'snoonu snoonu', '97433211272'),
    ('Ret-2018201', '2768', 'snoonu snoonu', '97433211272'),
    ('LTO2024117', '5890', 'mohamed noomani', '97470301442'),
    ('LTO2024277', '185573', 'emad bhagil', '97459920777'),
    ('AGR-202504-406726', '5896', 'مختارالامين', '97450129848'),
    ('LTO202416', '4018', 'Abdelrahim Mohamed', '97431310330'),
    ('MR202488', '7065', 'lukman dramani', '97433963041'),
    ('LTO2024245', '7056', 'MOHAMED AHMED', '97433374204'),
    ('MR202465', '7043', 'amjid wadan', '97466265370'),
    ('LTO2024152', '857051', 'HANY HUSHAM', '97477660012'),
    ('AGR-047661-681', '2773', 'مجدي بخيت', '97450246458'),
    ('AGR-202504-420218', '4016', 'سامي عبد الله', '97430534902'),
    ('In2018227', '7078', 'tarak tunisia', '97430200442'),
    ('LTO2024114', '9894', 'tarak hamlet', '97430058936'),
    ('LTO2024317', '11473', 'imed ayari', '97466071051'),
    ('288', '893410', 'AMMAR GHOZY', '97430403800'),
    ('LTO2024262', '7067', 'ADIL ABDELKARIM', '97430108811'),
    ('In2018171', '741277', 'zafar ullah badshah', '97466463832'),
    ('LTO202414', '7034', 'Ghazi Emmad ben meddeb', '97433600885'),
    ('AGR-222397-636', '862165', 'محمد عبد الله سلمان', '97455554627'),
    ('In2018169', '749762', 'RIZWAN BAHADAR', '97470732908'),
    ('In2018170', '746956', 'MUHAMMAD GUL', '97451145953'),
    ('LTO2024271', '10189', 'ahmed elwasila', '97450118063'),
    ('LTO2024312', '4016', 'ahmed ali mawlod abdalla', '97471189859'),
    ('AGR-592533-558', '7041', 'احمد عبدالله محمد', '97470692014'),
    ('LTO202415', '8214', 'Zyed Yahmadi', '97430330103'),
    ('MR202477', '749403', 'shadrack saky', '97455076981'),
    ('AGR-202504-402280', '856715', 'فادي السعيدي', '97466043445'),
    ('LTO202494', '10197', 'KOSAY HAMMAMI', '97477860733'),
    ('AGR-202504-424958', '2766', 'محمد محمد احمد', '97470007983'),
    ('LTO2024113', '893410', 'mokhtar alil', '97477907750'),
    ('LTO2024235', '2773', 'amir ben fredj', '97466172920'),
    ('In2018166', '10669', 'awol ibrahim', '97433102862'),
    ('AGR-202502-0426', '21860', 'محمد العويني', '668168169'),
    ('In2018115', '746956', 'prince boateng', '97471581990'),
    ('MR202489', '754436', 'samuel yeboah', '97455470224'),
    ('MR202482', '10855', 'josef ado', '66929795'),
    ('LTO202443', '8208', 'Mohammad ibrar Abdul hanan', '97470505396'),
    ('MR202479', '10064', 'emmanuel darko', '97471581990'),
    ('LTO2024289', '2769', 'mahmoud jassem alsaleh', '71061952'),
    ('LTO2024237', '8208', 'hany mohamed', '97474498604'),
    ('LTO202437', '676281', 'Hamza BADOU', '97431179706'),
    ('LTO2024244', '856715', 'EIHAB ABDALLA', '97474488904'),
    ('In2018172', '749403', 'sead logomo', '97430228791'),
    ('LTO2024239', '10669', 'mohamed yousif', '97430383077'),
    ('Ret-2018208', '706150', 'snoonu snoonu', '97433211272'),
    ('LTO2024294', '756104', 'ahmed arsheen', '97451066888'),
    ('LTO202454', '856925', 'VARUN KUMAR C CHAUHAN', '97439912483'),
    ('Ret-2018229', '751340', 'snoonu snoonu', '97433211272'),
    ('AGR-202504-423180', '7039', 'عبد الله برهام', '97430945601'),
    ('AGR-202504-422586', '10858', 'قسورة عبد الرحيم', '97471109995'),
    ('LTO2024104', '847932', 'ravi ravi', '97433336834'),
    ('330', '7062', 'yahia sakhri', '97450447989'),
    ('LTO202434', '8204', 'Haq Nawaz Rahim Bakhsh', '97433048081'),
    ('LTO2024335', '7074', 'mahmoud jassem alsaleh', '71061952'),
    ('MR202476', '819027', 'clement gyamerah', '97433418726'),
    ('LTO2024230', '722134', 'hamdi thabet', '97477763707'),
    ('LTO2024134', '7062', 'olusegun onadairo', '97455521186'),
    ('LTO20242', '857045', 'AMARA KHARROUBI', '97430122896'),
    ('AGR-202502-0424', '5891', 'مؤسى حيمر', '71503673'),
    ('LTO2024256', '648144', 'mohamed abdalla', '97470083881'),
    ('LTO202442', '846560', 'WALID CHOURABI', '97431308631'),
    ('LTO202431', '7061', 'Abdulhanna abulhashem', '97455222976'),
    ('LTO2024116', '5898', 'ALI ABBAS', '97450405018'),
    ('LTO2024290', '906077', 'saddam el falah', '97455031297'),
    ('Ret-2018207', '893410', 'snoonu snoonu', '97433211272'),
    ('LTO2024150', '8204', 'HABIB KHELIFI', '97466205223'),
    ('LTO2024306', '862169', 'tarek boutemedjet', '97455039533'),
    ('In2018173', '570468', 'mubarek golcha', '97470539031'),
    ('LTO2024298', '754436', 'kaies ayari', '97430109102'),
    ('AGR-202504-421408', '2771', 'ماهر مهيري', '97470220390'),
    ('Ret-2018191', '2781', 'snoonu snoonu', '97433211272'),
    ('MR202484', '816508', 'foster ngo', '97430637515'),
    ('LTO2024238', '817009', 'hamze hussein', '97471348615'),
    ('AGR-950558-871', '9902', 'زين العابدين ادريس', '97470897519'),
    ('LTO2024308', '10064', 'wassim chatmen', '97433226604'),
    ('LTO2024325', '711289', 'mohamed ahmed', '97455304449'),
    ('LTO20243', '21849', 'MEDHAT BAKRY', '97433766022'),
    ('LTO202452', '9999', 'KHALIL CHMENGUI', '97460099391'),
    ('MR202472', '7056', 'almunzer ali', '97430529501'),
    ('In2018157', '10858', 'prince boateng', '97471581990'),
    ('LTO2024250', '7078', 'ABUELMAALI ISMAIL', '97466981255'),
    ('LTO202420', '7066', 'Awad el karim Abdelmonim', '97466947604'),
    ('Ret-2018211', '721440', 'snoonu snoonu', '97433211272'),
    ('MR2024121', '10854', 'Sofiene Ben salah', '97450770260'),
    ('LTO2024283', '862165', 'fatima akka', '97471202018'),
    ('MR2024110', '7057', 'riaz khan', '97430692099'),
    ('LTO202444', '7072', 'Saif ur rehman mohammad Ramzan', '97431466795'),
    ('LTO2024311', '4016', 'mohamed hassen omer mohamed', '97450131342'),
    ('Ret-2018183', '2782', 'snoonu snoonu', '97433211272'),
    ('LTO202499', '7035', 'HICHEM ABDERAHIM', '97433787589'),
    ('LTO2024101', '7076', 'issam hamdani', '97430666450'),
    ('LTO2024142', '7035', 'MOJEEB AMIN', '97477909052'),
    ('LTO202425', '557098', 'ANOUER MATHLOUTHI', '97430532292'),
    ('LTO2024260', '751340', 'MOHAMED KAMEL OSMAN ABDALLA', 'nan'),
    ('Ret-2018188', '10666', 'snoonu snoonu', '97433211272'),
    ('AGR-302522-016', '7057', 'بسام فتحي اللوز', '97470882208'),
    ('LTO2024177', '5888', 'atef sghairi', '97477024940'),
    ('AGR-202504-404457', '2775', 'أنور جنبيني', '97451476442'),
    ('MR202471', '7041', 'abdul basit khan', '97431492385'),
    ('LTO2024281', '21860', 'saeed al-hebabi', '97433333971'),
    ('LTO2024255', '10672', 'ganga chaudhary', '97477179042'),
    ('LTO202456', '21875', 'SAID HILALI', '97466653585'),
    ('Ret-2018186', '10171', 'snoonu snoonu', '97433211272');
  
  FOR v_contract_data IN
    SELECT DISTINCT contract_number, plate, customer_name, phone
    FROM temp_contract_data
  LOOP
    SELECT id INTO v_vehicle_id FROM vehicles 
    WHERE plate_number = v_contract_data.plate AND company_id = v_company_id LIMIT 1;
    
    IF v_vehicle_id IS NULL THEN
      v_skipped_no_vehicle := v_skipped_no_vehicle + 1;
      CONTINUE;
    END IF;
    
    SELECT id INTO v_customer_id FROM customers 
    WHERE phone = v_contract_data.phone AND company_id = v_company_id LIMIT 1;
    
    IF v_customer_id IS NULL THEN
      BEGIN
        WITH next_code AS (
          SELECT COALESCE(MAX(CAST(SUBSTRING(customer_code FROM 'IND-25-([0-9]+)') AS INTEGER)), 0) + 1 as code
          FROM customers WHERE company_id = v_company_id AND customer_code LIKE 'IND-25-%'
        )
        INSERT INTO customers (company_id, customer_type, first_name, phone, customer_code, created_at, updated_at)
        SELECT v_company_id, 'individual', v_contract_data.customer_name, v_contract_data.phone,
               'IND-25-' || LPAD(code::TEXT, 4, '0'), NOW(), NOW()
        FROM next_code RETURNING id INTO v_customer_id;
        v_created_customers := v_created_customers + 1;
      EXCEPTION WHEN unique_violation THEN
        SELECT id INTO v_customer_id FROM customers WHERE phone = v_contract_data.phone AND company_id = v_company_id LIMIT 1;
      END;
    ELSE
      UPDATE customers SET first_name = v_contract_data.customer_name, updated_at = NOW() WHERE id = v_customer_id;
      v_updated_customers := v_updated_customers + 1;
    END IF;
    
    SELECT id INTO v_contract_id FROM contracts
    WHERE contract_number = v_contract_data.contract_number AND company_id = v_company_id 
    AND status IN ('cancelled', 'under_review') LIMIT 1;
    
    IF v_contract_id IS NOT NULL THEN
      UPDATE contracts SET vehicle_id = v_vehicle_id, customer_id = v_customer_id, 
      license_plate = v_contract_data.plate, updated_at = NOW() WHERE id = v_contract_id;
      v_updated_contracts := v_updated_contracts + 1;
      
      UPDATE vehicles SET status = 'available', updated_at = NOW()
      WHERE id = v_vehicle_id AND status != 'rented';
    ELSE
      v_skipped_no_contract := v_skipped_no_contract + 1;
    END IF;
    
    IF v_updated_contracts % 50 = 0 THEN
      RAISE NOTICE 'Processed % contracts...', v_updated_contracts;
    END IF;
  END LOOP;
  
  DROP TABLE temp_contract_data;
  
  RAISE NOTICE '';
  RAISE NOTICE '========== Complete ==========';
  RAISE NOTICE 'Contracts Updated: %', v_updated_contracts;
  RAISE NOTICE 'Customers Created: %', v_created_customers;
  RAISE NOTICE 'Customers Updated: %', v_updated_customers;
  RAISE NOTICE 'Skipped (no vehicle): %', v_skipped_no_vehicle;
  RAISE NOTICE 'Skipped (no contract): %', v_skipped_no_contract;
END $$;
