<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل اتفاقية الأقساط - KW Rent Flow</title>
    
    <!-- Google Fonts - Arabic Optimized -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&family=Tajawal:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Flowbite -->
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.0.0/dist/flowbite.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Import Theme */
        @import url('./vehicle_installments_theme.css');
        
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', 'Tajawal', system-ui, -apple-system, sans-serif !important;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            direction: rtl;
            text-align: right;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Cairo', sans-serif !important;
            font-weight: 700 !important;
        }
        
        /* Custom CSS Variables with HSL format */
        :root {
            --background: 0 0% 96%;
            --background-soft: 0 0% 94%;
            --foreground: 0 0% 15%;
            --card: 0 0% 100%;
            --card-foreground: 0 0% 15%;
            --card-hover: 0 0% 98%;
            --primary: 0 70% 45%;
            --primary-foreground: 0 0% 100%;
            --primary-dark: 0 70% 35%;
            --primary-light: 0 70% 55%;
            --primary-glow: 0 70% 45% / 0.2;
            --secondary: 0 0% 85%;
            --secondary-foreground: 0 0% 15%;
            --muted: 0 0% 92%;
            --muted-foreground: 0 0% 45%;
            --accent: 25 90% 92%;
            --accent-foreground: 0 0% 15%;
            --accent-light: 25 90% 95%;
            --success: 142 56% 42%;
            --success-foreground: 0 0% 100%;
            --success-light: 142 56% 95%;
            --warning: 25 85% 55%;
            --warning-foreground: 0 0% 100%;
            --warning-light: 25 85% 95%;
            --destructive: 0 65% 51%;
            --destructive-foreground: 0 0% 100%;
            --destructive-light: 0 65% 95%;
            --info: 210 100% 60%;
            --info-light: 210 100% 95%;
            --border: 0 0% 85%;
            --input: 0 0% 98%;
            --ring: 0 70% 45%;
        }
        
        /* Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes badgePulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.9;
            }
        }
        
        .animate-slide-up {
            animation: slideInUp 500ms ease-out forwards;
        }
        
        .animate-fade-in {
            animation: fadeIn 400ms ease-out forwards;
        }
        
        .animate-badge-pulse {
            animation: badgePulse 2s ease-in-out infinite;
        }
        
        /* Stagger delays */
        .delay-100 { animation-delay: 100ms; opacity: 0; }
        .delay-200 { animation-delay: 200ms; opacity: 0; }
        .delay-300 { animation-delay: 300ms; opacity: 0; }
        .delay-400 { animation-delay: 400ms; opacity: 0; }
        .delay-500 { animation-delay: 500ms; opacity: 0; }
        
        /* Card Styles */
        .info-card {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 hsl(0 0% 0% / 0.1);
        }
        
        .installment-card {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: 0.75rem;
            padding: 1.25rem;
            transition: all 250ms ease-out;
            box-shadow: 0 1px 2px 0 hsl(0 0% 0% / 0.05);
        }
        
        .installment-card:hover {
            background: hsl(var(--card-hover));
            box-shadow: 0 4px 6px -1px hsl(0 0% 0% / 0.1);
        }
        
        .installment-card.overdue {
            border-color: hsl(var(--destructive) / 0.3);
        }
        
        /* Button Styles */
        .btn-back {
            background: transparent;
            color: hsl(var(--muted-foreground));
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid hsl(var(--border));
            cursor: pointer;
            transition: all 200ms ease-out;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }
        
        .btn-back:hover {
            background: hsl(var(--muted));
            color: hsl(var(--foreground));
        }
        
        .btn-primary {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
            padding: 0.5rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 200ms ease-out;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .btn-primary:hover {
            background: hsl(var(--primary-light));
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px hsl(var(--primary) / 0.3);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        /* Badge Styles */
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .badge-success {
            background: hsl(var(--success-light));
            color: hsl(var(--success));
            border: 1px solid hsl(var(--success) / 0.2);
        }
        
        .badge-warning {
            background: hsl(var(--warning-light));
            color: hsl(var(--warning));
            border: 1px solid hsl(var(--warning) / 0.2);
        }
        
        .badge-destructive {
            background: hsl(var(--destructive-light));
            color: hsl(var(--destructive));
            border: 1px solid hsl(var(--destructive) / 0.2);
        }
        
        .badge-info {
            background: hsl(var(--info-light));
            color: hsl(var(--info));
            border: 1px solid hsl(var(--info) / 0.2);
        }
        
        .badge-muted {
            background: hsl(var(--muted));
            color: hsl(var(--muted-foreground));
            border: 1px solid hsl(var(--border));
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
            animation: fadeIn 200ms ease-out;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: hsl(var(--card));
            border-radius: 0.75rem;
            padding: 1.5rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px hsl(0 0% 0% / 0.1), 0 8px 10px -6px hsl(0 0% 0% / 0.1);
            animation: slideInUp 300ms ease-out;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: hsl(var(--foreground));
        }
        
        .form-input {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid hsl(var(--border));
            border-radius: 0.5rem;
            background: hsl(var(--input));
            color: hsl(var(--foreground));
            font-size: 0.875rem;
            transition: all 150ms ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 3px hsl(var(--ring) / 0.1);
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        /* Utility Classes */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        
        .icon {
            width: 1.25rem;
            height: 1.25rem;
            stroke-width: 2;
        }
        
        .icon-sm {
            width: 1rem;
            height: 1rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .info-card {
                padding: 1rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <div class="container" style="padding-top: 2rem; padding-bottom: 3rem;">
        
        <!-- Header with Back Button -->
        <header style="margin-bottom: 2rem;" class="animate-fade-in">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                <button class="btn-back" onclick="window.location.href='vehicle_installments_1.html'">
                    <i data-lucide="arrow-right" class="icon-sm"></i>
                    <span>العودة</span>
                </button>
            </div>
            <div>
                <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.25rem; color: hsl(var(--foreground));">
                    تفاصيل اتفاقية الأقساط
                </h1>
                <p style="color: hsl(var(--muted-foreground)); font-size: 0.95rem;">
                    AGR-2024-001
                </p>
            </div>
        </header>
        
        <!-- Info Cards Grid -->
        <section style="margin-bottom: 2rem;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
                
                <!-- Agreement Info Card -->
                <div class="info-card animate-slide-up delay-100">
                    <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1.25rem; color: hsl(var(--foreground));">
                        معلومات الاتفاقية
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.25rem;">
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">رقم الاتفاقية</span>
                            <p style="font-weight: 600; color: hsl(var(--foreground));">AGR-2024-001</p>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">الحالة</span>
                            <span class="badge badge-success">
                                <i data-lucide="check-circle" class="icon-sm"></i>
                                نشط
                            </span>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">التاجر</span>
                            <p style="font-weight: 600; color: hsl(var(--foreground));">محمد أحمد السالم</p>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">المركبة</span>
                            <p style="font-weight: 600; color: hsl(var(--foreground));">ABC-1234 - Toyota Camry 2024</p>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">تاريخ الاتفاقية</span>
                            <p style="font-weight: 600; color: hsl(var(--foreground));">01/01/2024</p>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">فترة الأقساط</span>
                            <p style="font-weight: 600; color: hsl(var(--foreground));">01/02/2024 - 01/01/2025</p>
                        </div>
                    </div>
                    <div style="margin-top: 1.25rem; padding-top: 1.25rem; border-top: 1px solid hsl(var(--border));">
                        <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.5rem;">ملاحظات</span>
                        <p style="color: hsl(var(--foreground)); line-height: 1.6;">اتفاقية تقسيط لشراء مركبة تويوتا كامري موديل 2024</p>
                    </div>
                </div>
                
                <!-- Financial Details Card -->
                <div class="info-card animate-slide-up delay-200">
                    <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1.25rem; color: hsl(var(--foreground));">
                        التفاصيل المالية
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.25rem;">
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">المبلغ الإجمالي</span>
                            <p style="font-size: 1.25rem; font-weight: 700; color: hsl(var(--foreground));">200,000 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">ر.س</span></p>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">الدفعة المقدمة</span>
                            <p style="font-size: 1.25rem; font-weight: 700; color: hsl(var(--foreground));">50,000 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">ر.س</span></p>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">مبلغ القسط</span>
                            <p style="font-size: 1.25rem; font-weight: 700; color: hsl(var(--foreground));">12,500 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">ر.س</span></p>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">عدد الأقساط</span>
                            <p style="font-size: 1.25rem; font-weight: 700; color: hsl(var(--foreground));">12 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">قسط</span></p>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">معدل الفائدة</span>
                            <p style="font-size: 1.25rem; font-weight: 700; color: hsl(var(--foreground));">5%</p>
                        </div>
                        <div>
                            <span style="display: block; font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">المبلغ المتبقي</span>
                            <p style="font-size: 1.25rem; font-weight: 700; color: hsl(var(--warning));">100,000 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">ر.س</span></p>
                        </div>
                    </div>
                </div>
                
            </div>
        </section>
        
        <!-- Installments Schedule Table -->
        <section>
            <div class="info-card animate-slide-up delay-300">
                <div style="margin-bottom: 1.5rem;">
                    <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.25rem; color: hsl(var(--foreground));">
                        جدول الأقساط
                    </h2>
                    <p style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
                        تفاصيل جميع الأقساط ومواعيد استحقاقها
                    </p>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    
                    <!-- Installment 1 - Paid -->
                    <div class="installment-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
                            <div style="display: flex; gap: 1rem; align-items: start; flex: 1;">
                                <div style="padding: 0.5rem; background: hsl(var(--success-light)); border-radius: 0.5rem; flex-shrink: 0;">
                                    <i data-lucide="check-circle" class="icon" style="color: hsl(var(--success));"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                                        <span style="font-weight: 700; color: hsl(var(--foreground));">القسط رقم 1</span>
                                        <span class="badge badge-success">مدفوع</span>
                                    </div>
                                    <div style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.25rem;">
                                        تاريخ الاستحقاق: 01/02/2024
                                    </div>
                                    <div style="font-size: 0.875rem; color: hsl(var(--success));">
                                        <i data-lucide="check" class="icon-sm" style="display: inline; vertical-align: middle;"></i>
                                        تاريخ الدفع: 01/02/2024
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: left; flex-shrink: 0;">
                                <div style="font-size: 1.125rem; font-weight: 700; color: hsl(var(--foreground));">
                                    12,500 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">ر.س</span>
                                </div>
                                <div style="font-size: 0.875rem; color: hsl(var(--success));">
                                    مدفوع: 12,500 ر.س
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Installment 2 - Overdue -->
                    <div class="installment-card overdue">
                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
                            <div style="display: flex; gap: 1rem; align-items: start; flex: 1;">
                                <div style="padding: 0.5rem; background: hsl(var(--destructive-light)); border-radius: 0.5rem; flex-shrink: 0;">
                                    <i data-lucide="alert-circle" class="icon" style="color: hsl(var(--destructive));"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                                        <span style="font-weight: 700; color: hsl(var(--foreground));">القسط رقم 2</span>
                                        <span class="badge badge-destructive animate-badge-pulse">متأخر</span>
                                    </div>
                                    <div style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
                                        تاريخ الاستحقاق: 01/03/2024
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: left; flex-shrink: 0;">
                                <div style="font-size: 1.125rem; font-weight: 700; color: hsl(var(--foreground)); margin-bottom: 0.5rem;">
                                    12,500 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">ر.س</span>
                                </div>
                                <button class="btn-primary" onclick="openPaymentModal(2, 12500)">
                                    <i data-lucide="credit-card" class="icon-sm"></i>
                                    تسجيل دفعة
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Installment 3 - Pending -->
                    <div class="installment-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
                            <div style="display: flex; gap: 1rem; align-items: start; flex: 1;">
                                <div style="padding: 0.5rem; background: hsl(var(--warning-light)); border-radius: 0.5rem; flex-shrink: 0;">
                                    <i data-lucide="calendar" class="icon" style="color: hsl(var(--warning));"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                                        <span style="font-weight: 700; color: hsl(var(--foreground));">القسط رقم 3</span>
                                        <span class="badge badge-warning">معلق</span>
                                    </div>
                                    <div style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
                                        تاريخ الاستحقاق: 01/04/2024
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: left; flex-shrink: 0;">
                                <div style="font-size: 1.125rem; font-weight: 700; color: hsl(var(--foreground)); margin-bottom: 0.5rem;">
                                    12,500 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">ر.س</span>
                                </div>
                                <button class="btn-primary" onclick="openPaymentModal(3, 12500)">
                                    <i data-lucide="credit-card" class="icon-sm"></i>
                                    تسجيل دفعة
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Installment 4 - Partially Paid -->
                    <div class="installment-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
                            <div style="display: flex; gap: 1rem; align-items: start; flex: 1;">
                                <div style="padding: 0.5rem; background: hsl(var(--info-light)); border-radius: 0.5rem; flex-shrink: 0;">
                                    <i data-lucide="credit-card" class="icon" style="color: hsl(var(--info));"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                                        <span style="font-weight: 700; color: hsl(var(--foreground));">القسط رقم 4</span>
                                        <span class="badge badge-info">مدفوع جزئياً</span>
                                    </div>
                                    <div style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
                                        تاريخ الاستحقاق: 01/05/2024
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: left; flex-shrink: 0;">
                                <div style="font-size: 1.125rem; font-weight: 700; color: hsl(var(--foreground));">
                                    12,500 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">ر.س</span>
                                </div>
                                <div style="font-size: 0.875rem; color: hsl(var(--info)); margin-bottom: 0.5rem;">
                                    مدفوع: 6,000 ر.س
                                </div>
                                <button class="btn-primary" onclick="openPaymentModal(4, 6500)">
                                    <i data-lucide="credit-card" class="icon-sm"></i>
                                    تسجيل دفعة
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Installments 5-12 - Pending -->
                    <div class="installment-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem; flex-wrap: wrap;">
                            <div style="display: flex; gap: 1rem; align-items: start; flex: 1;">
                                <div style="padding: 0.5rem; background: hsl(var(--muted)); border-radius: 0.5rem; flex-shrink: 0;">
                                    <i data-lucide="calendar-clock" class="icon" style="color: hsl(var(--muted-foreground));"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                                        <span style="font-weight: 700; color: hsl(var(--foreground));">الأقساط رقم 5 - 12</span>
                                        <span class="badge badge-muted">معلقة</span>
                                    </div>
                                    <div style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
                                        8 أقساط متبقية
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: left; flex-shrink: 0;">
                                <div style="font-size: 1.125rem; font-weight: 700; color: hsl(var(--foreground));">
                                    100,000 <span style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">ر.س</span>
                                </div>
                                <div style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
                                    إجمالي المبلغ المتبقي
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </section>
        
    </div>
    
    <!-- Payment Modal -->
    <div id="paymentModal" class="modal-overlay" onclick="closeModalOnOverlay(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">
                <div>
                    <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.25rem;">تسجيل دفعة قسط</h3>
                    <p style="font-size: 0.875rem; color: hsl(var(--muted-foreground));">
                        تسجيل دفعة للقسط رقم <span id="installmentNumber">-</span>
                    </p>
                </div>
                <button onclick="closePaymentModal()" style="background: none; border: none; cursor: pointer; color: hsl(var(--muted-foreground)); padding: 0.25rem;">
                    <i data-lucide="x" class="icon"></i>
                </button>
            </div>
            
            <form onsubmit="handlePayment(event)">
                <div class="form-group">
                    <label for="paymentAmount" class="form-label">مبلغ الدفعة</label>
                    <input type="number" id="paymentAmount" class="form-input" step="0.01" required placeholder="أدخل مبلغ الدفعة">
                    <p style="font-size: 0.75rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">
                        المبلغ المستحق: <span id="dueAmount">0</span> ر.س
                    </p>
                </div>
                
                <div class="form-group">
                    <label for="paymentDate" class="form-label">تاريخ الدفعة</label>
                    <input type="date" id="paymentDate" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label for="paymentReference" class="form-label">مرجع الدفعة</label>
                    <input type="text" id="paymentReference" class="form-input" placeholder="رقم الشيك، مرجع التحويل، إلخ">
                </div>
                
                <div class="form-group">
                    <label for="paymentNotes" class="form-label">ملاحظات</label>
                    <textarea id="paymentNotes" class="form-input form-textarea" placeholder="ملاحظات إضافية"></textarea>
                </div>
                
                <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" class="btn-back" onclick="closePaymentModal()">
                        إلغاء
                    </button>
                    <button type="submit" class="btn-primary">
                        <i data-lucide="check" class="icon-sm"></i>
                        تسجيل الدفعة
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Initialize Lucide Icons & Scripts -->
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Set today's date as default
        document.getElementById('paymentDate').valueAsDate = new Date();
        
        // Open payment modal
        function openPaymentModal(installmentNumber, dueAmount) {
            document.getElementById('installmentNumber').textContent = installmentNumber;
            document.getElementById('dueAmount').textContent = dueAmount.toLocaleString('ar-SA');
            document.getElementById('paymentAmount').value = dueAmount;
            document.getElementById('paymentModal').classList.add('active');
            
            // Re-initialize icons
            setTimeout(() => lucide.createIcons(), 50);
        }
        
        // Close payment modal
        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            // Reset form
            document.querySelector('form').reset();
            document.getElementById('paymentDate').valueAsDate = new Date();
        }
        
        // Close modal when clicking on overlay
        function closeModalOnOverlay(event) {
            if (event.target.id === 'paymentModal') {
                closePaymentModal();
            }
        }
        
        // Handle payment form submission
        function handlePayment(event) {
            event.preventDefault();
            
            const formData = {
                installmentNumber: document.getElementById('installmentNumber').textContent,
                amount: document.getElementById('paymentAmount').value,
                date: document.getElementById('paymentDate').value,
                reference: document.getElementById('paymentReference').value,
                notes: document.getElementById('paymentNotes').value
            };
            
            console.log('Payment submitted:', formData);
            
            // Show success message (in real app, this would be an API call)
            alert('تم تسجيل الدفعة بنجاح!');
            
            closePaymentModal();
            
            // In real app, reload data here
            // location.reload();
        }
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closePaymentModal();
            }
        });
        
        // Re-initialize icons after page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        });
    </script>
</body>
</html>

