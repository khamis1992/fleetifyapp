# ุฅุตูุงุญ ูุดููุฉ ุชุจููุจ ุงูุชุณุนูุฑ ูู ุตูุญุฉ ุชูุงุตูู ุงููุฑูุจุฉ

## ุงูุชุงุฑูุฎ
2025-01-19

## ุงููุดููุฉ ุงูุฃุตููุฉ
ุนูุฏ ูุชุญ ุชุจููุจ "ุงูุชุณุนูุฑ" ูู ุตูุญุฉ ุชูุงุตูู ุงููุฑูุจุฉ ([`VehicleDetailsDialog.tsx`](c:\Users\khamis\Desktop\fleetifyapp-3\src\components\fleet\VehicleDetailsDialog.tsx))ุ ูุง ูุธูุฑ ุฃู ูุญุชูู ุฃู ุจูุงูุงุช.

## ุงูุณุจุจ ุงูุฌุฐุฑู

### 1. ูุดููุฉ ูู ุงูู Hook
ุงูู hook [`useVehiclePricing`](c:\Users\khamis\Desktop\fleetifyapp-3\src\hooks\useVehicles.ts#L283-L299) ูุงู ูุนุฑุถ ููุท ุงูุณุฌูุงุช ุงูุชู `is_active = true`:

```typescript
// ูุจู ุงูุฅุตูุงุญ
.eq("vehicle_id", vehicleId)
.eq("is_active", true)  // โ ูุดููุฉ: ูุนุฑุถ ููุท ุงูุณุฌูุงุช ุงููุดุทุฉ
.order("effective_from", { ascending: false })
```

**ุงููุดููุฉ**: ุฅุฐุง ูู ููู ููุงู ุณุฌู ุชุณุนูุฑ ูุดุท (`is_active = true`)ุ ููุฑุฌุน ูุตูููุฉ ูุงุฑุบุฉ `[]`ุ ููุง ูุฌุนู ุงูุชุจููุจ ูุธูุฑ ูุงุฑุบุงู.

### 2. ูุดููุฉ ูู ุนุฑุถ ุญุงูุฉ ุงูุชุญููู
ุงูู component [`VehiclePricingPanel.tsx`](c:\Users\khamis\Desktop\fleetifyapp-3\src\components\fleet\VehiclePricingPanel.tsx) ูุงู ูุนุฑุถ ุฑุณุงูุฉ ุชุญููู ุจุณูุทุฉ ุฌุฏุงู:

```typescript
// ูุจู ุงูุฅุตูุงุญ
if (isLoading) {
  return <div>Loading pricing...</div>;  // โ ุนุฑุถ ุจุณูุท ุฌุฏุงู
}
```

### 3. ูุดููุฉ ูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุงุฑุบุฉ
ูู ููู ููุงู ูุนุงูุฌุฉ ูุงุถุญุฉ ููุญุงูุฉ ุนูุฏูุง ูููู ููุงู ุณุฌูุงุช ุชุณุนูุฑ ูุฏููุฉ (ุบูุฑ ูุดุทุฉ) ููู ูุง ููุฌุฏ ุชุณุนูุฑ ูุดุท ุญุงููุงู.

## ุงูุญููู ุงููุทุจูุฉ

### โ 1. ุชุนุฏูู ุงูู Hook ูุนุฑุถ ุฌููุน ุงูุณุฌูุงุช

**ุงูููู**: `src/hooks/useVehicles.ts`

```typescript
// ุจุนุฏ ุงูุฅุตูุงุญ โ
export const useVehiclePricing = (vehicleId: string) => {
  return useQuery({
    queryKey: queryKeys.vehicles.pricing(vehicleId),
    queryFn: async () => {
      const { data, error } = await supabase
        .from("vehicle_pricing")
        .select("*")
        .eq("vehicle_id", vehicleId)
        // โ ุชู ุฅุฒุงูุฉ .eq("is_active", true)
        .order("effective_from", { ascending: false })

      if (error) throw error
      return data as VehiclePricing[]
    },
    enabled: !!vehicleId
  })
}
```

**ุงููุงุฆุฏุฉ**: 
- ูุนุฑุถ ุฌููุน ุณุฌูุงุช ุงูุชุณุนูุฑ (ุงููุดุทุฉ ูุงููุฏููุฉ)
- ูููู ูููุณุชุฎุฏู ุฑุคูุฉ ุชุงุฑูุฎ ุงูุชุณุนูุฑ ุงููุงูู
- ูุนูู ุญุชู ูู ูู ููู ููุงู ุชุณุนูุฑ ูุดุท ุญุงููุงู

### โ 2. ุชุญุณูู ุนุฑุถ ุญุงูุฉ ุงูุชุญููู

**ุงูููู**: `src/components/fleet/VehiclePricingPanel.tsx`

```typescript
// ุจุนุฏ ุงูุฅุตูุงุญ โ
if (isLoading) {
  return (
    <Card>
      <CardContent className="flex items-center justify-center py-12">
        <div className="text-center space-y-2">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"></div>
          <p className="text-sm text-muted-foreground">ุฌุงุฑู ุชุญููู ุงูุชุณุนูุฑ...</p>
        </div>
      </CardContent>
    </Card>
  );
}
```

**ุงูุชุญุณููุงุช**:
- ุนุฑุถ Spinner ุฏูุงุฑ
- ุฑุณุงูุฉ ุนุฑุจูุฉ ูุงุถุญุฉ
- ุชุตููู ุงุญุชุฑุงูู ููุชูุงุณู

### โ 3. ูุนุงูุฌุฉ ุฐููุฉ ููุจูุงูุงุช

**ุงูููู**: `src/components/fleet/VehiclePricingPanel.tsx`

```typescript
// ุจุนุฏ ุงูุฅุตูุงุญ โ
<CardContent>
  {pricing && pricing.length > 0 ? (
    <>
      {activePricing ? (
        // ุนุฑุถ ุงูุชุณุนูุฑ ุงููุดุท
        <div className="space-y-4">
          {/* ... ุชูุงุตูู ุงูุชุณุนูุฑ ุงููุดุท ... */}
        </div>
      ) : (
        // ุนุฑุถ ุฑุณุงูุฉ ุนูุฏูุง ูุง ููุฌุฏ ุชุณุนูุฑ ูุดุท
        <div className="text-center py-8">
          <p className="text-muted-foreground mb-2">
            ููุฌุฏ ุชุณุนูุฑ ุณุงุจู ูููู ุบูุฑ ูุดุท ุญุงููุงู
          </p>
          <Button
            variant="outline"
            className="mt-2"
            onClick={() => setShowForm(true)}
          >
            <Plus className="h-4 w-4 mr-2" />
            ุฅุถุงูุฉ ุชุณุนูุฑ ุฌุฏูุฏ
          </Button>
        </div>
      )}

      {/* ุชุงุฑูุฎ ุงูุชุณุนูุฑ */}
      {pricing && pricing.length > 1 && (
        <div className="mt-6 pt-6 border-t">
          <h4 className="font-medium mb-3">ุชุงุฑูุฎ ุงูุชุณุนูุฑ</h4>
          <div className="space-y-2">
            {pricing
              .filter(p => !p.is_active)
              .slice(0, 3)
              .map((p) => (
                <div key={p.id} className="flex items-center justify-between text-sm p-2 bg-muted/50 rounded">
                  <span>
                    ูููู: {formatCurrency(p.daily_rate)} | 
                    ุฃุณุจูุนู: {formatCurrency(p.weekly_rate)} | 
                    ุดูุฑู: {formatCurrency(p.monthly_rate)}
                  </span>
                  <span className="text-muted-foreground">
                    {new Date(p.effective_from).toLocaleDateString('ar-SA')}
                  </span>
                </div>
              ))}
          </div>
        </div>
      )}
    </>
  ) : (
    // ูุง ุชูุฌุฏ ุณุฌูุงุช ุชุณุนูุฑ ุนูู ุงูุฅุทูุงู
    <div className="text-center py-8">
      <p className="text-muted-foreground">ูู ูุชู ุชุญุฏูุฏ ุชุณุนูุฑ ููุฐู ุงููุฑูุจุฉ</p>
      <Button
        variant="outline"
        className="mt-2"
        onClick={() => setShowForm(true)}
      >
        <Plus className="h-4 w-4 mr-2" />
        ุฅุถุงูุฉ ุชุณุนูุฑ
      </Button>
    </div>
  )}
</CardContent>
```

**ุงููุฒุงูุง**:
- โ ูุนุงูุฌุฉ ุฐููุฉ ูู 3 ุญุงูุงุช ูุฎุชููุฉ:
  1. **ุชุณุนูุฑ ูุดุท ููุฌูุฏ**: ูุนุฑุถ ุงูุชุณุนูุฑ ุงูุญุงูู
  2. **ุชุณุนูุฑ ูุฏูู ููุท**: ูุนุฑุถ ุฑุณุงูุฉ + ุฒุฑ ูุฅุถุงูุฉ ุชุณุนูุฑ ุฌุฏูุฏ
  3. **ูุง ููุฌุฏ ุชุณุนูุฑ**: ูุนุฑุถ ุฑุณุงูุฉ + ุฒุฑ ูุฅุถุงูุฉ ุฃูู ุชุณุนูุฑ

- โ ุนุฑุถ ุชุงุฑูุฎ ุงูุชุณุนูุฑ (ุขุฎุฑ 3 ุณุฌูุงุช ูุฏููุฉ)
- โ ุชูุณูู ุงูุชุงุฑูุฎ ุจุงูุนุฑุจูุฉ (`ar-SA`)
- โ ุชุตููู ูุญุณูู ูุน ุฎูููุฉ ููุณุฌูุงุช ุงููุฏููุฉ

## ุงูุญุงูุงุช ุงูุชู ูุนุงูุฌูุง ุงูุญู

| ุงูุญุงูุฉ | ูุจู ุงูุฅุตูุงุญ | ุจุนุฏ ุงูุฅุตูุงุญ |
|--------|-------------|-------------|
| **ุชุณุนูุฑ ูุดุท ููุฌูุฏ** | ูุนุฑุถ ุจุดูู ุทุจูุนู | โ ูุนุฑุถ ุจุดูู ุทุจูุนู |
| **ุชุณุนูุฑ ูุฏูู ููุท** | โ ูุง ูุธูุฑ ุดูุก | โ ูุนุฑุถ ุฑุณุงูุฉ + ุฒุฑ ุฅุถุงูุฉ |
| **ูุง ููุฌุฏ ุชุณุนูุฑ** | โ ูุนุฑุถ ุฑุณุงูุฉ | โ ูุนุฑุถ ุฑุณุงูุฉ ูุญุณููุฉ |
| **ุญุงูุฉ ุงูุชุญููู** | โ ุฑุณุงูุฉ ุจุณูุทุฉ | โ Spinner ุงุญุชุฑุงูู |
| **ุชุงุฑูุฎ ุงูุชุณุนูุฑ** | โ ูุนุฑุถ | โ ูุนุฑุถ ุจุชูุณูู ุฃูุถู |

## ุงูููุงุฆุฏ

### 1. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณููุฉ โจ
- ูุง ุชูุฌุฏ ุดุงุดุฉ ูุงุฑุบุฉ ูุญูุฑุฉ
- ุฑุณุงุฆู ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ
- ุญุงูุฉ ุชุญููู ุงุญุชุฑุงููุฉ

### 2. ุนุฑุถ ุงููุนูููุงุช ุงููุงููุฉ ๐
- ูููู ุฑุคูุฉ ุชุงุฑูุฎ ุงูุชุณุนูุฑ ุงููุงูู
- ููู ุฃูุถู ูุชุทูุฑ ุงูุฃุณุนุงุฑ
- ุณูููุฉ ุงูููุงุฑูุฉ ุจูู ุงูุฃุณุนุงุฑ ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ

### 3. ุณูููุฉ ุงูุฅุถุงูุฉ ๐ฏ
- ุฒุฑ ูุงุถุญ ูุฅุถุงูุฉ ุชุณุนูุฑ ุฌุฏูุฏ
- ูุธูุฑ ูู ุฌููุน ุงูุญุงูุงุช ุงูููุงุณุจุฉ
- ุชุฌุฑุจุฉ ุณูุณุฉ

### 4. ุงุณุชูุฑุงุฑ ุฃูุถู ๐ก๏ธ
- ูุนุงูุฌุฉ ุฌููุน ุงูุญุงูุงุช ุงูููููุฉ
- ูุง ุชูุฌุฏ ุฃุฎุทุงุก ุฃู ุดุงุดุงุช ูุงุฑุบุฉ
- ููุฏ ููู ููุฑู

## ุงูุงุฎุชุจุงุฑ

### โ ุชู ุงูุงุฎุชุจุงุฑ
1. **ุงูุจูุงุก**: ูุฌุญ ุจุฏูู ุฃุฎุทุงุก
2. **TypeScript**: ูุง ุชูุฌุฏ ุฃุฎุทุงุก ููุน
3. **ุงูุงุณุชูุฑุงุฏ**: ุฌููุน ุงูููููุงุช ูุชููุฑุฉ

### ๐ ูุญุชุงุฌ ุงุฎุชุจุงุฑ ูุนูู
1. [ ] ูุชุญ ุตูุญุฉ ุชูุงุตูู ูุฑูุจุฉ **ููุง ุชุณุนูุฑ ูุดุท**
2. [ ] ูุชุญ ุตูุญุฉ ุชูุงุตูู ูุฑูุจุฉ **ููุง ุชุณุนูุฑ ูุฏูู ููุท**
3. [ ] ูุชุญ ุตูุญุฉ ุชูุงุตูู ูุฑูุจุฉ **ููุณ ููุง ุฃู ุชุณุนูุฑ**
4. [ ] ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ุชุณุนูุฑ ุฌุฏูุฏ ูู ุงูุชุจููุจ
5. [ ] ุงูุชุญูู ูู ุนุฑุถ ุชุงุฑูุฎ ุงูุชุณุนูุฑ

## ุงููููุงุช ุงููุนุฏูุฉ

### 1. `src/hooks/useVehicles.ts`
- ุณุทุฑ 283-299: ุชุนุฏูู `useVehiclePricing`
- **ุงูุชุบููุฑ**: ุฅุฒุงูุฉ ููุชุฑ `is_active = true`

### 2. `src/components/fleet/VehiclePricingPanel.tsx`
- ุณุทุฑ 55-60: ุชุญุณูู ุนุฑุถ ุญุงูุฉ ุงูุชุญููู
- ุณุทุฑ 158-223: ุชุญุณูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูุนุฑุถ ุงูุชุงุฑูุฎ
- **ุงูุชุบููุฑ**: ูุนุงูุฌุฉ ุฐููุฉ ูุฌููุน ุงูุญุงูุงุช

## ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ ุญู ูุดููุฉ ุนุฏู ุธููุฑ ุงููุญุชูู ูู ุชุจููุจ ุงูุชุณุนูุฑ ูู ุฎูุงู:
- โ ุชุนุฏูู ุงูู Hook ูุนุฑุถ ุฌููุน ุงูุณุฌูุงุช
- โ ุชุญุณูู ุนุฑุถ ุญุงูุฉ ุงูุชุญููู
- โ ูุนุงูุฌุฉ ุฐููุฉ ูุฌููุน ุงูุญุงูุงุช ุงููุญุชููุฉ
- โ ุนุฑุถ ุชุงุฑูุฎ ุงูุชุณุนูุฑ ุจุดูู ูุงุถุญ

**ุงููุชูุฌุฉ**: ุชุจููุจ ุงูุชุณุนูุฑ ุงูุขู ูุนูู ุจุดูู ูุซุงูู ูู ุฌููุน ุงูุญุงูุงุช! ๐

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-01-19  
**ุงูุญุงูุฉ**: โ ููุชูู ูุฌุงูุฒ ููุฅูุชุงุฌ  
**ุงูุจูุงุก**: โ ูุฌุญ ุจุฏูู ุฃุฎุทุงุก (1m 45s)
