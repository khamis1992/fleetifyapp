import { useMemo } from 'react';
import contractTemplate from '../../.claude/final_contract_ai_format.json';

/**
 * Hook ูุชูููุฏ ุงูุนูุฏ ุงูุฑุณูู ูู ุงููุงูุจ
 * ูููุฃ ุงูุจูุงูุงุช ุชููุงุฆูุงู ูู ูุนูููุงุช ุงูุนููู ูุงููุฑูุจุฉ ูุงูุนูุฏ
 */
export function useContractTemplate(contractData: {
  contract?: any;
  customer?: any;
  vehicle?: any;
}) {
  return useMemo(() => {
    const { contract, customer, vehicle } = contractData;

    if (!contract || !customer) {
      return null;
    }

    // ูุณุฎุฉ ูู ุงููุงูุจ
    const filledTemplate = JSON.parse(JSON.stringify(contractTemplate));

    // ููุก ูุนูููุงุช ุงูุนูุฏ ุงูุฃุณุงุณูุฉ
    if (contract.contract_number) {
      filledTemplate.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุฑูู_ุงูุนูุฏ = contract.contract_number;
    }
    if (contract.contract_date) {
      filledTemplate.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุชุงุฑูุฎ_ุงูุนูุฏ = formatDate(contract.contract_date);
    }
    if (contract.status) {
      filledTemplate.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุญุงูุฉ_ุงูุนูุฏ = getStatusArabic(contract.status);
    }

    // ููุก ูุนูููุงุช ุงููุณุชุฃุฌุฑ (ุงูุทุฑู ุงูุซุงูู)
    if (customer.customer_type === 'individual') {
      const fullName = [customer.first_name_ar, customer.last_name_ar].filter(Boolean).join(' ');
      filledTemplate.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุงูุงุณู_ุงููุงูู = fullName || customer.first_name || '';
    } else {
      filledTemplate.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุงูุงุณู_ุงููุงูู = customer.company_name_ar || customer.company_name || '';
    }

    filledTemplate.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุฑูู_ุงููููุฉ = customer.civil_id || customer.commercial_registration || '';
    filledTemplate.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุงูุนููุงู = customer.address_ar || customer.address || '';
    filledTemplate.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุฑูู_ุงูุฌูุงู = customer.phone || '';
    filledTemplate.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุงูุฌูุณูุฉ = customer.nationality_ar || customer.nationality || '';
    filledTemplate.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุฑูู_ุฑุฎุตุฉ_ุงูููุงุฏุฉ = customer.driver_license_number || '';

    // ููุก ุชูุงุตูู ุงููุฑูุจุฉ
    if (vehicle) {
      filledTemplate.ุชูุงุตูู_ุงููุฑูุจุฉ.ุงูููุน = vehicle.make || '';
      filledTemplate.ุชูุงุตูู_ุงููุฑูุจุฉ.ุงูููุฏูู = vehicle.model || '';
      filledTemplate.ุชูุงุตูู_ุงููุฑูุจุฉ.ุฑูู_ุงูููุญุฉ = vehicle.plate_number || '';
      filledTemplate.ุชูุงุตูู_ุงููุฑูุจุฉ.ุฑูู_ุงููููู = vehicle.vin || '';
      filledTemplate.ุชูุงุตูู_ุงููุฑูุจุฉ.ุณูุฉ_ุงูุตูุน = vehicle.year?.toString() || '';
    }

    // ููุก ุงูุดุฑูุท ุงููุงููุฉ
    if (contract.start_date) {
      filledTemplate.ุงูุดุฑูุท_ุงููุงููุฉ.ูุฏุฉ_ุงูุนูุฏ.ุชุงุฑูุฎ_ุงูุจุฏุงูุฉ = formatDate(contract.start_date);
    }
    if (contract.end_date) {
      filledTemplate.ุงูุดุฑูุท_ุงููุงููุฉ.ูุฏุฉ_ุงูุนูุฏ.ุชุงุฑูุฎ_ุงูููุงูุฉ_ุงููุชููุน = formatDate(contract.end_date);
    }

    // ุญุณุงุจ ูุฏุฉ ุงูุนูุฏ ุจุงูุฃุดูุฑ
    if (contract.start_date && contract.end_date) {
      const startDate = new Date(contract.start_date);
      const endDate = new Date(contract.end_date);
      const monthsDiff = Math.round((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24 * 30));
      filledTemplate.ุงูุดุฑูุท_ุงููุงููุฉ.ูุฏุฉ_ุงูุนูุฏ.ุงููููุฉ = monthsDiff.toString();
    }

    if (contract.monthly_amount) {
      filledTemplate.ุงูุดุฑูุท_ุงููุงููุฉ.ูููุฉ_ุงูุฅูุฌุงุฑ_ุงูุดูุฑู.ุงููุจูุบ = contract.monthly_amount;
    }

    if (contract.contract_amount) {
      filledTemplate.ุงูุดุฑูุท_ุงููุงููุฉ.ุฅุฌูุงูู_ูููุฉ_ุงูุนูุฏ.ุงููุจูุบ = contract.contract_amount;
    }

    return filledTemplate;
  }, [contractData]);
}

/**
 * Hook ูุงุณุชุฎุฑุงุฌ ุงูุจููุฏ ุงูุฑุฆูุณูุฉ ููุนุฑุถ
 */
export function useContractMainClauses(template: any) {
  return useMemo(() => {
    if (!template) return [];

    return [
      {
        title: 'ูุนูููุงุช ุงูุนูุฏ',
        icon: '๐',
        items: [
          { label: 'ุฑูู ุงูุนูุฏ', value: template.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุฑูู_ุงูุนูุฏ },
          { label: 'ุชุงุฑูุฎ ุงูุนูุฏ', value: template.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุชุงุฑูุฎ_ุงูุนูุฏ },
          { label: 'ุญุงูุฉ ุงูุนูุฏ', value: template.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุญุงูุฉ_ุงูุนูุฏ }
        ]
      },
      {
        title: 'ุงูุทุฑู ุงูุฃูู (ุงููุคุฌุฑ)',
        icon: '๐ข',
        items: [
          { label: 'ุงุณู ุงูุดุฑูุฉ', value: template.ุงูุทุฑู_ุงูุฃูู_ุงููุคุฌุฑ.ุงุณู_ุงูุดุฑูุฉ },
          { label: 'ุงูุณุฌู ุงูุชุฌุงุฑู', value: template.ุงูุทุฑู_ุงูุฃูู_ุงููุคุฌุฑ.ุงูุณุฌู_ุงูุชุฌุงุฑู },
          { label: 'ุงูููุซู ุงููุงูููู', value: template.ุงูุทุฑู_ุงูุฃูู_ุงููุคุฌุฑ.ุงูููุซู_ุงููุงูููู.ุงูุงุณู }
        ]
      },
      {
        title: 'ุงูุทุฑู ุงูุซุงูู (ุงููุณุชุฃุฌุฑ)',
        icon: '๐ค',
        items: [
          { label: 'ุงูุงุณู ุงููุงูู', value: template.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุงูุงุณู_ุงููุงูู },
          { label: 'ุฑูู ุงููููุฉ', value: template.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุฑูู_ุงููููุฉ },
          { label: 'ุฑูู ุงูุฌูุงู', value: template.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุฑูู_ุงูุฌูุงู }
        ]
      },
      {
        title: 'ุงููุฑูุจุฉ',
        icon: '๐',
        items: [
          { label: 'ุงูููุน ูุงูููุฏูู', value: `${template.ุชูุงุตูู_ุงููุฑูุจุฉ.ุงูููุน} ${template.ุชูุงุตูู_ุงููุฑูุจุฉ.ุงูููุฏูู}` },
          { label: 'ุฑูู ุงูููุญุฉ', value: template.ุชูุงุตูู_ุงููุฑูุจุฉ.ุฑูู_ุงูููุญุฉ },
          { label: 'ุณูุฉ ุงูุตูุน', value: template.ุชูุงุตูู_ุงููุฑูุจุฉ.ุณูุฉ_ุงูุตูุน }
        ]
      },
      {
        title: 'ุงูุดุฑูุท ุงููุงููุฉ',
        icon: '๐ฐ',
        items: [
          { label: 'ูุฏุฉ ุงูุนูุฏ', value: `${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุฏุฉ_ุงูุนูุฏ.ุงููููุฉ} ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุฏุฉ_ุงูุนูุฏ.ุงููุญุฏุฉ}` },
          { label: 'ุงูุฅูุฌุงุฑ ุงูุดูุฑู', value: `${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูููุฉ_ุงูุฅูุฌุงุฑ_ุงูุดูุฑู.ุงููุจูุบ} ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูููุฉ_ุงูุฅูุฌุงุฑ_ุงูุดูุฑู.ุงูุนููุฉ}` },
          { label: 'ุฅุฌูุงูู ูููุฉ ุงูุนูุฏ', value: `${template.ุงูุดุฑูุท_ุงููุงููุฉ.ุฅุฌูุงูู_ูููุฉ_ุงูุนูุฏ.ุงููุจูุบ} ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ุฅุฌูุงูู_ูููุฉ_ุงูุนูุฏ.ุงูุนููุฉ}` },
          { label: 'ูุจูุบ ุงูุชุฃููู', value: `${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุจูุบ_ุงูุชุฃููู.ุงููุจูุบ} ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุจูุบ_ุงูุชุฃููู.ุงูุนููุฉ}` }
        ]
      },
      {
        title: 'ุงูุบุฑุงูุงุช ูุงูุนููุจุงุช',
        icon: 'โ๏ธ',
        items: [
          { label: 'ุบุฑุงูุฉ ุงูุชุฃุฎูุฑ ุงูููููุฉ', value: `${template.ุงูุบุฑุงูุงุช_ูุงูุนููุจุงุช.ุบุฑุงูุฉ_ุงูุชุฃุฎูุฑ_ูู_ุงูุฏูุน.ุงููุจูุบ_ุงููููู} ุฑ.ู` },
          { label: 'ุฑุณูู ุฅุฏุงุฑูุฉ', value: `${template.ุงูุบุฑุงูุงุช_ูุงูุนููุจุงุช.ุบุฑุงูุฉ_ุงูุชุฃุฎูุฑ_ูู_ุงูุฏูุน.ุฑุณูู_ุฅุฏุงุฑูุฉ_ุซุงุจุชุฉ} ุฑ.ู` },
          { label: 'ุงูุดุฑุท ุงูุฌุฒุงุฆู', value: `${template.ุงูุดุฑุท_ุงูุฌุฒุงุฆู.ุงููุจูุบ} ${template.ุงูุดุฑุท_ุงูุฌุฒุงุฆู.ุงูุนููุฉ}` }
        ]
      }
    ];
  }, [template]);
}

/**
 * ุฏุงูุฉ ูุณุงุนุฏุฉ ูุชูุณูู ุงูุชุงุฑูุฎ
 */
function formatDate(dateString: string): string {
  if (!dateString) return '';
  
  const date = new Date(dateString);
  const options: Intl.DateTimeFormatOptions = { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  };
  
  return date.toLocaleDateString('en-US', options);
}

/**
 * ุฏุงูุฉ ูุณุงุนุฏุฉ ูุชุฑุฌูุฉ ุญุงูุฉ ุงูุนูุฏ
 */
function getStatusArabic(status: string): string {
  const statusMap: Record<string, string> = {
    'active': 'ูุดุท',
    'draft': 'ูุณูุฏุฉ',
    'under_review': 'ููุฏ ุงููุฑุงุฌุนุฉ',
    'expired': 'ููุชูู',
    'suspended': 'ูุนูู',
    'cancelled': 'ููุบู',
    'renewed': 'ูุฌุฏุฏ'
  };
  
  return statusMap[status] || status;
}

/**
 * Hook ููุญุตูู ุนูู ุงูุนูุฏ ุจุตูุบุฉ ูุตูุฉ ูุงููุฉ ููุทุจุงุนุฉ
 */
export function useContractFullText(template: any): string {
  return useMemo(() => {
    if (!template) return '';

    let text = `
ุนูุฏ ุฅูุฌุงุฑ ุณูุงุฑุฉ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุฑูู ุงูุนูุฏ: ${template.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุฑูู_ุงูุนูุฏ}
ุชุงุฑูุฎ ุงูุนูุฏ: ${template.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุชุงุฑูุฎ_ุงูุนูุฏ}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงูุทุฑู ุงูุฃูู (ุงููุคุฌุฑ):
${template.ุงูุทุฑู_ุงูุฃูู_ุงููุคุฌุฑ.ุงุณู_ุงูุดุฑูุฉ}
ุงูุณุฌู ุงูุชุฌุงุฑู: ${template.ุงูุทุฑู_ุงูุฃูู_ุงููุคุฌุฑ.ุงูุณุฌู_ุงูุชุฌุงุฑู}
ุงูููุฑ: ${template.ุงูุทุฑู_ุงูุฃูู_ุงููุคุฌุฑ.ุงูููุฑ}
ููุซู ุจู: ${template.ุงูุทุฑู_ุงูุฃูู_ุงููุคุฌุฑ.ุงูููุซู_ุงููุงูููู.ุงูุงุณู} (${template.ุงูุทุฑู_ุงูุฃูู_ุงููุคุฌุฑ.ุงูููุซู_ุงููุงูููู.ุงูุตูุฉ})

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงูุทุฑู ุงูุซุงูู (ุงููุณุชุฃุฌุฑ):
ุงูุงุณู: ${template.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุงูุงุณู_ุงููุงูู}
ุฑูู ุงููููุฉ: ${template.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุฑูู_ุงููููุฉ}
ุงูุนููุงู: ${template.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุงูุนููุงู}
ุงูุฌูุงู: ${template.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุฑูู_ุงูุฌูุงู}
ุงูุฌูุณูุฉ: ${template.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุงูุฌูุณูุฉ}
ุฑุฎุตุฉ ุงูููุงุฏุฉ: ${template.ุงูุทุฑู_ุงูุซุงูู_ุงููุณุชุฃุฌุฑ.ุฑูู_ุฑุฎุตุฉ_ุงูููุงุฏุฉ}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุชูุงุตูู ุงููุฑูุจุฉ:
ุงูููุน: ${template.ุชูุงุตูู_ุงููุฑูุจุฉ.ุงูููุน}
ุงูููุฏูู: ${template.ุชูุงุตูู_ุงููุฑูุจุฉ.ุงูููุฏูู}
ุฑูู ุงูููุญุฉ: ${template.ุชูุงุตูู_ุงููุฑูุจุฉ.ุฑูู_ุงูููุญุฉ}
ุฑูู ุงููููู: ${template.ุชูุงุตูู_ุงููุฑูุจุฉ.ุฑูู_ุงููููู}
ุณูุฉ ุงูุตูุน: ${template.ุชูุงุตูู_ุงููุฑูุจุฉ.ุณูุฉ_ุงูุตูุน}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงูุดุฑูุท ุงููุงููุฉ:
โข ูุฏุฉ ุงูุนูุฏ: ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุฏุฉ_ุงูุนูุฏ.ุงููููุฉ} ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุฏุฉ_ุงูุนูุฏ.ุงููุญุฏุฉ}
  ูู: ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุฏุฉ_ุงูุนูุฏ.ุชุงุฑูุฎ_ุงูุจุฏุงูุฉ}
  ุฅูู: ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุฏุฉ_ุงูุนูุฏ.ุชุงุฑูุฎ_ุงูููุงูุฉ_ุงููุชููุน}

โข ุงูุฅูุฌุงุฑ ุงูุดูุฑู: ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูููุฉ_ุงูุฅูุฌุงุฑ_ุงูุดูุฑู.ุงููุจูุบ} ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูููุฉ_ุงูุฅูุฌุงุฑ_ุงูุดูุฑู.ุงูุนููุฉ}
โข ุฅุฌูุงูู ูููุฉ ุงูุนูุฏ: ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ุฅุฌูุงูู_ูููุฉ_ุงูุนูุฏ.ุงููุจูุบ} ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ุฅุฌูุงูู_ูููุฉ_ุงูุนูุฏ.ุงูุนููุฉ}
โข ูุจูุบ ุงูุชุฃููู: ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุจูุบ_ุงูุชุฃููู.ุงููุจูุบ} ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุจูุบ_ุงูุชุฃููู.ุงูุนููุฉ}
  (${template.ุงูุดุฑูุท_ุงููุงููุฉ.ูุจูุบ_ุงูุชุฃููู.ุงูููุน})

โข ุทุฑููุฉ ุงูุฏูุน: ${template.ุงูุดุฑูุท_ุงููุงููุฉ.ุทุฑููุฉ_ุงูุฏูุน.ุงูุชูููุช}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงูุบุฑุงูุงุช ูุงูุนููุจุงุช:

1. ุบุฑุงูุฉ ุงูุชุฃุฎูุฑ ูู ุงูุฏูุน:
   โข ${template.ุงูุบุฑุงูุงุช_ูุงูุนููุจุงุช.ุบุฑุงูุฉ_ุงูุชุฃุฎูุฑ_ูู_ุงูุฏูุน.ุงููุจูุบ_ุงููููู} ุฑูุงู ูุทุฑู/ููู
   โข ุฑุณูู ุฅุฏุงุฑูุฉ ุซุงุจุชุฉ: ${template.ุงูุบุฑุงูุงุช_ูุงูุนููุจุงุช.ุบุฑุงูุฉ_ุงูุชุฃุฎูุฑ_ูู_ุงูุฏูุน.ุฑุณูู_ุฅุฏุงุฑูุฉ_ุซุงุจุชุฉ} ุฑูุงู ูุทุฑู
   โข ุงูุญุฏ ุงูุฃูุตู: ${template.ุงูุบุฑุงูุงุช_ูุงูุนููุจุงุช.ุบุฑุงูุฉ_ุงูุชุฃุฎูุฑ_ูู_ุงูุฏูุน.ุงูุญุฏ_ุงูุฃูุตู_ุจุงูุฃูุงู} ููู

2. ุบุฑุงูุฉ ุงูุชุฃุฎูุฑ ูู ุฅุฑุฌุงุน ุงููุฑูุจุฉ:
   โข ${template.ุงูุบุฑุงูุงุช_ูุงูุนููุจุงุช.ุบุฑุงูุฉ_ุงูุชุฃุฎูุฑ_ูู_ุฅุฑุฌุงุน_ุงููุฑูุจุฉ.ุงููุจูุบ_ุงููููู} ุฑูุงู ูุทุฑู/ููู

3. ุบุฑุงูุฉ ุงูุงุณุชุฎุฏุงู ุบูุฑ ุงููุตุฑุญ:
   โข ${template.ุงูุบุฑุงูุงุช_ูุงูุนููุจุงุช.ุบุฑุงูุฉ_ุงูุงุณุชุฎุฏุงู_ุบูุฑ_ุงููุตุฑุญ.ุงููุจูุบ} ุฑูุงู ูุทุฑู + ูุณุฎ ููุฑู

4. ุงูุดุฑุท ุงูุฌุฒุงุฆู:
   โข ${template.ุงูุดุฑุท_ุงูุฌุฒุงุฆู.ุงููุจูุบ} ${template.ุงูุดุฑุท_ุงูุฌุฒุงุฆู.ุงูุนููุฉ}
   โข ูุทุจู ูู ุญุงูุฉ: ุงูุฅุฎูุงู ุจุงูุงูุชุฒุงูุงุช ุงูุชุนุงูุฏูุฉ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงููุงููู ุงูุญุงูู ูุงูุงุฎุชุตุงุต ุงููุถุงุฆู:
โข ุงููุงููู ุงูุญุงูู: ${template.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุงููุงููู_ุงูุญุงูู}
โข ุงูุงุฎุชุตุงุต ุงููุถุงุฆู: ${template.ูุนูููุงุช_ุงูุนูุฏ_ุงูุฃุณุงุณูุฉ.ุงูุงุฎุชุตุงุต_ุงููุถุงุฆู}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    `.trim();

    return text;
  }, [template]);
}

