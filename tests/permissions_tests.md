# ุงุฎุชุจุงุฑุงุช ุงูุตูุงุญูุงุช (Permissions Tests)

## FleetifyApp - Security & Permissions Testing Guide

**ุงูุชุงุฑูุฎ**: 13 ููููุจุฑ 2025  
**ุงููุฏู**: ุงุฎุชุจุงุฑ ูุธุงู ุงูุตูุงุญูุงุช (RBAC) ุจุดูู ุดุงูู

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ](#ูุธุฑุฉ-ุนุงูุฉ)
2. [ุงูุฃุฏูุงุฑ ุงููุฏุนููุฉ](#ุงูุฃุฏูุงุฑ-ุงููุฏุนููุฉ)
3. [ุงุฎุชุจุงุฑุงุช ุงูุตูุญุงุช](#ุงุฎุชุจุงุฑุงุช-ุงูุตูุญุงุช)
4. [ุงุฎุชุจุงุฑุงุช ุงูุฃุฒุฑุงุฑ](#ุงุฎุชุจุงุฑุงุช-ุงูุฃุฒุฑุงุฑ)
5. [ุงุฎุชุจุงุฑุงุช ูุญุงููุงุช ุงูุชูุงุนุจ](#ุงุฎุชุจุงุฑุงุช-ูุญุงููุงุช-ุงูุชูุงุนุจ)
6. [ุงููุชุงุฆุฌ ุงููุชููุนุฉ](#ุงููุชุงุฆุฌ-ุงููุชููุนุฉ)

---

## ูุธุฑุฉ ุนุงูุฉ

### ุงูุฃุฏูุงุฑ ุงููุฏุนููุฉ (7 ุฃุฏูุงุฑ)

| # | ุงูุฏูุฑ | ุงููุตู | ุงูุตูุงุญูุงุช |
|---|------|-------|-----------|
| 1 | **Super Admin** | ุตูุงุญูุงุช ูุงููุฉ ุนุงูููุฉ | ุฌููุน ุงูุตูุงุญูุงุช |
| 2 | **Company Admin** | ุฅุฏุงุฑุฉ ูุงููุฉ ููุดุฑูุฉ | ุฌููุน ุตูุงุญูุงุช ุงูุดุฑูุฉ |
| 3 | **Company Manager** | ุฅุฏุงุฑุฉ ูุชูุฏูุฉ ููุดุฑูุฉ | ูุนุธู ุงูุตูุงุญูุงุช |
| 4 | **Manager** | ุฅุฏุงุฑุฉ ูุณู | ุตูุงุญูุงุช ูุญุฏูุฏุฉ |
| 5 | **Employee** | ููุธู ุนุงุฏู | ุนุฑุถ ููุท |
| 6 | **Accountant** | ูุญุงุณุจ | ูุงููุฉ ูุงููุฉ |
| 7 | **Viewer** | ูุดุงูุฏ | ุนุฑุถ ููุท |

---

## ุงุฎุชุจุงุฑุงุช ุงูุตูุญุงุช

### Test 1: ุตูุญุฉ Super Admin Users

**ุงููุณุงุฑ**: `/super-admin/users`  
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ**: `manage_all_users`

| ุงูุฏูุฑ | ุงููุตูู ุงููุชููุน | ุงููุชูุฌุฉ |
|------|----------------|---------|
| Super Admin | โ ูููู ุงููุตูู | |
| Company Admin | โ ููููุน | |
| Company Manager | โ ููููุน | |
| Manager | โ ููููุน | |
| Employee | โ ููููุน | |
| Accountant | โ ููููุน | |
| Viewer | โ ููููุน | |

**ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ**:
1. ุชุณุฌูู ุงูุฏุฎูู ุจูู ุฏูุฑ
2. ูุญุงููุฉ ุงููุตูู ููุตูุญุฉ
3. ุงูุชุญูู ูู ุงูุฑุณุงูุฉ: "ููุณ ูุฏูู ุตูุงุญูุฉ ูููุตูู ููุฐู ุงูุตูุญุฉ"

---

### Test 2: ุตูุญุฉ HR UserManagement

**ุงููุณุงุฑ**: `/hr/user-management`  
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ**: `manage_users`

| ุงูุฏูุฑ | ุงููุตูู ุงููุชููุน | ุงููุชูุฌุฉ |
|------|----------------|---------|
| Super Admin | โ ูููู ุงููุตูู | |
| Company Admin | โ ูููู ุงููุตูู | |
| Company Manager | โ ูููู ุงููุตูู | |
| Manager | โ ููููุน | |
| Employee | โ ููููุน | |
| Accountant | โ ููููุน | |
| Viewer | โ ููููุน | |

---

### Test 3: ุตูุญุฉ AdvancedSettings

**ุงููุณุงุฑ**: `/settings/advanced`  
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ**: `manage_settings`

| ุงูุฏูุฑ | ุงููุตูู ุงููุชููุน | ุงููุชูุฌุฉ |
|------|----------------|---------|
| Super Admin | โ ูููู ุงููุตูู | |
| Company Admin | โ ูููู ุงููุตูู | |
| Company Manager | โ ููููุน | |
| Manager | โ ููููุน | |
| Employee | โ ููููุน | |
| Accountant | โ ููููุน | |
| Viewer | โ ููููุน | |

---

## ุงุฎุชุจุงุฑุงุช ุงูุฃุฒุฑุงุฑ

### Test 4: ุฒุฑ ุญุฐู ุงูุนูุฏ

**ุงููููุน**: `ContractCard.tsx`  
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ**: `delete_contracts`

| ุงูุฏูุฑ | ุงูุธููุฑ ุงููุชููุน | ุงููุชูุฌุฉ |
|------|----------------|---------|
| Super Admin | โ ูุธูุฑ | |
| Company Admin | โ ูุธูุฑ | |
| Company Manager | โ ูุธูุฑ | |
| Manager | โ ูุฎูู | |
| Employee | โ ูุฎูู | |
| Accountant | โ ูุฎูู | |
| Viewer | โ ูุฎูู | |

**ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ**:
1. ูุชุญ ุตูุญุฉ ุงูุนููุฏ
2. ุงูุชุญูู ูู ุธููุฑ/ุฅุฎูุงุก ุงูุฒุฑ
3. ูุญุงููุฉ ุงูููุฑ (ุฅุฐุง ุธูุฑ)

---

### Test 5: ุฒุฑ ููุงููุฉ ุงูุนูุฏ

**ุงููููุน**: `ContractApprovalWorkflow.tsx`  
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ**: `approve_contracts`

| ุงูุฏูุฑ | ุงูุธููุฑ ุงููุชููุน | ุงููุชูุฌุฉ |
|------|----------------|---------|
| Super Admin | โ ูุธูุฑ | |
| Company Admin | โ ูุธูุฑ | |
| Company Manager | โ ูุธูุฑ | |
| Manager | โ ูุฎูู | |
| Employee | โ ูุฎูู | |
| Accountant | โ ูุฎูู | |
| Viewer | โ ูุฎูู | |

---

### Test 6: ุฒุฑ ุญุฐู ุงูููุธู

**ุงููููุน**: `DeleteEmployeeConfirmDialog.tsx`  
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ**: `delete_employees`

| ุงูุฏูุฑ | ุงูุธููุฑ ุงููุชููุน | ุงููุชูุฌุฉ |
|------|----------------|---------|
| Super Admin | โ ูุธูุฑ | |
| Company Admin | โ ูุธูุฑ | |
| Company Manager | โ ูุธูุฑ | |
| Manager | โ ูุฎูู | |
| Employee | โ ูุฎูู | |
| Accountant | โ ูุฎูู | |
| Viewer | โ ูุฎูู | |

---

### Test 7: ุฒุฑ ุญุฐู ุฌูุงุนู ููุนููุฏ

**ุงููููุน**: `BulkDeleteContractsDialog.tsx`  
**ุงูุตูุงุญูุฉ ุงููุทููุจุฉ**: `delete_contracts`

| ุงูุฏูุฑ | ุงูุธููุฑ ุงููุชููุน | ุงููุชูุฌุฉ |
|------|----------------|---------|
| Super Admin | โ ูุธูุฑ | |
| Company Admin | โ ูุธูุฑ | |
| Company Manager | โ ูุธูุฑ | |
| Manager | โ ูุฎูู | |
| Employee | โ ูุฎูู | |
| Accountant | โ ูุฎูู | |
| Viewer | โ ูุฎูู | |

---

## ุงุฎุชุจุงุฑุงุช ูุญุงููุงุช ุงูุชูุงุนุจ

### Test 8: ูุญุงููุฉ ุงููุตูู ูุตูุญุฉ ูุญููุฉ ุนุจุฑ URL ูุจุงุดุฑ

**ุงููุฏู**: ุงูุชุญูู ูู ุฃู ุงูุญูุงูุฉ ุชุนูู ุญุชู ูุน ุงููุตูู ุงููุจุงุดุฑ

**ุงูุฎุทูุงุช**:
1. ุชุณุฌูู ุงูุฏุฎูู ูู Employee
2. ูุชุงุจุฉ URL ูุจุงุดุฑ: `/super-admin/users`
3. ุงูุถุบุท Enter

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ ุฑุณุงูุฉ "ููุณ ูุฏูู ุตูุงุญูุฉ"

---

### Test 9: ูุญุงููุฉ ุชูููุฐ ุนูููุฉ ูุญููุฉ ุนุจุฑ API

**ุงููุฏู**: ุงูุชุญูู ูู ุญูุงูุฉ API

**ุงูุฎุทูุงุช**:
1. ูุชุญ Developer Tools (F12)
2. ูุญุงููุฉ ุงุณุชุฏุนุงุก API ุญุฐู ุนูุฏ:
```javascript
await supabase
  .from('contracts')
  .delete()
  .eq('id', 'contract-id')
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ RLS ูููุน ุงูุนูููุฉ

---

### Test 10: ูุญุงููุฉ ุนุฑุถ ุฒุฑ ูุญูู ุนุจุฑ ุชุนุฏูู DOM

**ุงููุฏู**: ุงูุชุญูู ูู ุฃู ุงูุญูุงูุฉ ููุณุช ููุท ุนูู ูุณุชูู UI

**ุงูุฎุทูุงุช**:
1. ุชุณุฌูู ุงูุฏุฎูู ูู Viewer
2. ูุชุญ Developer Tools
3. ูุญุงููุฉ ุฅุธูุงุฑ ุฒุฑ ูุญุฐูู ุนุจุฑ ุชุนุฏูู CSS
4. ุงูููุฑ ุนูู ุงูุฒุฑ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ ุงูุนูููุฉ ุชูุดู ุนูู ูุณุชูู API/RLS

---

## ุงุฎุชุจุงุฑุงุช ุงูุตูุงุญูุงุช ุงููุงููุฉ

### Test 11: ุตูุงุญูุงุช Accountant

**ุงููุฏู**: ุงูุชุญูู ูู ุฃู Accountant ูุฏูู ุตูุงุญูุงุช ูุงููุฉ ููุท

| ุงูุนูููุฉ | ุงูุตูุงุญูุฉ ุงููุชููุนุฉ | ุงููุชูุฌุฉ |
|---------|-------------------|---------|
| ุนุฑุถ ุงูููุงุชูุฑ | โ ูููู | |
| ุฅูุดุงุก ูุงุชูุฑุฉ | โ ูููู | |
| ุญุฐู ูุงุชูุฑุฉ | โ ูููู | |
| ุงุนุชูุงุฏ ูุงุชูุฑุฉ | โ ูููู | |
| ุนุฑุถ ุงูุฏูุนุงุช | โ ูููู | |
| ุฅูุดุงุก ุฏูุนุฉ | โ ูููู | |
| ุญุฐู ุฏูุนุฉ | โ ูููู | |
| ุญุฐู ุนูุฏ | โ ููููุน | |
| ุญุฐู ููุธู | โ ููููุน | |
| ุญุฐู ูุฑูุจุฉ | โ ููููุน | |

---

## ุงุฎุชุจุงุฑุงุช ุนุฒู ุงูุจูุงูุงุช ุจูู ุงูุดุฑูุงุช

### Test 12: ุนุฒู ุงูุจูุงูุงุช (Company Isolation)

**ุงููุฏู**: ุงูุชุญูู ูู ุฃู ูู ุดุฑูุฉ ุชุฑู ุจูุงูุงุชูุง ููุท

**Setup**:
- Company A: user_a@companya.com
- Company B: user_b@companyb.com

**ุงูุฎุทูุงุช**:
1. ุชุณุฌูู ุงูุฏุฎูู ูู user_a (Company A)
2. ุนุฑุถ ุงูุนููุฏ
3. ุงูุชุญูู ูู ุนุฏู ุธููุฑ ุนููุฏ Company B

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ ุนููุฏ Company A ููุท

---

### Test 13: Super Admin ูุฑู ุฌููุน ุงูุจูุงูุงุช

**ุงููุฏู**: ุงูุชุญูู ูู ุฃู Super Admin ูุฑู ุฌููุน ุงูุจูุงูุงุช

**ุงูุฎุทูุงุช**:
1. ุชุณุฌูู ุงูุฏุฎูู ูู Super Admin
2. ุนุฑุถ ุงูุนููุฏ
3. ุงูุชุญูู ูู ุธููุฑ ุนููุฏ ุฌููุน ุงูุดุฑูุงุช

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ ุนููุฏ ุฌููุน ุงูุดุฑูุงุช

---

## ุงุฎุชุจุงุฑุงุช Audit Log

### Test 14: ุชุณุฌูู ุงูุนูููุงุช ุงูุญุณุงุณุฉ

**ุงููุฏู**: ุงูุชุญูู ูู ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ูู Audit Log

**ุงูุฎุทูุงุช**:
1. ุชุณุฌูู ุงูุฏุฎูู ูู Company Admin
2. ุญุฐู ุนูุฏ
3. ูุชุญ ุตูุญุฉ Audit Logs
4. ุงูุชุญูู ูู ูุฌูุฏ ุณุฌู ููุนูููุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ ุณุฌู ููุฌูุฏ ูุน ุฌููุน ุงูุชูุงุตูู

---

## ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### ููุฎุต ุงูุงุฎุชุจุงุฑุงุช

| ุงููุฆุฉ | ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช | ุงููุชูุฌุฉ ุงููุชููุนุฉ |
|------|----------------|------------------|
| ุงุฎุชุจุงุฑุงุช ุงูุตูุญุงุช | 3 | ุฌููุนูุง PASS |
| ุงุฎุชุจุงุฑุงุช ุงูุฃุฒุฑุงุฑ | 4 | ุฌููุนูุง PASS |
| ูุญุงููุงุช ุงูุชูุงุนุจ | 3 | ุฌููุนูุง PASS |
| ุงูุตูุงุญูุงุช ุงููุงููุฉ | 1 | PASS |
| ุนุฒู ุงูุจูุงูุงุช | 2 | ุฌููุนูุง PASS |
| Audit Log | 1 | PASS |
| **ุงูุฅุฌูุงูู** | **14** | **ุฌููุนูุง PASS** |

---

## ููููุฉ ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช

### 1. ุงุฎุชุจุงุฑุงุช ูุฏููุฉ (Manual Testing)

```bash
# 1. ุชุณุฌูู ุงูุฏุฎูู ุจูู ุฏูุฑ
# 2. ุงุชุจุงุน ุงูุฎุทูุงุช ูู ูู ุงุฎุชุจุงุฑ
# 3. ุชุณุฌูู ุงููุชุงุฆุฌ ูู ุงูุฌุฏูู
# 4. ุงูุชุญูู ูู ุงููุชุงุฆุฌ ุงููุชููุนุฉ
```

### 2. ุงุฎุชุจุงุฑุงุช RLS (Database)

```bash
# ุชุดุบูู ุณูุฑูุจุช SQL
psql -h <host> -U <user> -d <database> -f tests/rls_security_tests.sql
```

### 3. ุงุฎุชุจุงุฑุงุช ุขููุฉ (Automated - ูุณุชูุจูุงู)

```bash
# ุจุงุณุชุฎุฏุงู Vitest
npm run test:permissions

# ุจุงุณุชุฎุฏุงู Playwright
npm run test:e2e:permissions
```

---

## ุชูุฑูุฑ ุงููุชุงุฆุฌ

### ูููุฐุฌ ุชูุฑูุฑ

```markdown
# ุชูุฑูุฑ ุงุฎุชุจุงุฑุงุช ุงูุตูุงุญูุงุช

**ุงูุชุงุฑูุฎ**: [DATE]
**ุงููุฎุชุจุฑ**: [NAME]

## ุงููุชุงุฆุฌ

| # | ุงูุงุฎุชุจุงุฑ | ุงููุชูุฌุฉ | ููุงุญุธุงุช |
|---|----------|---------|---------|
| 1 | Super Admin Users Page | PASS/FAIL | |
| 2 | HR UserManagement Page | PASS/FAIL | |
| 3 | AdvancedSettings Page | PASS/FAIL | |
| ... | ... | ... | ... |

## ุงูููุฎุต

- **ุงูุฅุฌูุงูู**: 14 ุงุฎุชุจุงุฑ
- **ูุฌุญ**: X
- **ูุดู**: Y
- **ุงููุณุจุฉ**: Z%

## ุงูุชูุตูุงุช

[ุฃู ุชูุตูุงุช ุฃู ููุงุญุธุงุช]
```

---

## ููุงุญุธุงุช ูููุฉ

### ูุจู ุงูุงุฎุชุจุงุฑ
1. โ ุชุฃูุฏ ูู ุชูุนูู RLS ุนูู ุฌููุน ุงูุฌุฏุงูู
2. โ ุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช ุงุฎุชุจุงุฑ ููู ุดุฑูุฉ
3. โ ุชุฃูุฏ ูู ูุฌูุฏ ูุณุชุฎุฏููู ุจุฌููุน ุงูุฃุฏูุงุฑ
4. โ ุชุฃูุฏ ูู ุชุทุจูู ุฌููุน ุงูุตูุงุญูุงุช

### ุฃุซูุงุก ุงูุงุฎุชุจุงุฑ
1. โ ุณุฌู ุฌููุน ุงููุชุงุฆุฌ
2. โ ุงูุชูุท screenshots ูููุดุงูู
3. โ ุณุฌู ุฃู ุณููู ุบูุฑ ูุชููุน
4. โ ุงุฎุชุจุฑ ุนูู ูุชุตูุญุงุช ูุฎุชููุฉ

### ุจุนุฏ ุงูุงุฎุชุจุงุฑ
1. โ ุฑุงุฌุน ุงููุชุงุฆุฌ
2. โ ุฃุตูุญ ุฃู ูุดุงูู
3. โ ุฃุนุฏ ุงูุงุฎุชุจุงุฑ
4. โ ูุซู ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ

---

## ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ

### 1. ุณูุฑูุจุช ุฅูุดุงุก ูุณุชุฎุฏููู ุงุฎุชุจุงุฑ

```sql
-- ุฅูุดุงุก ูุณุชุฎุฏููู ุจุฌููุน ุงูุฃุฏูุงุฑ
INSERT INTO users (email, company_id, role) VALUES
  ('superadmin@test.com', NULL, 'super_admin'),
  ('admin@companya.com', 'company-a-id', 'company_admin'),
  ('manager@companya.com', 'company-a-id', 'company_manager'),
  ('dept_manager@companya.com', 'company-a-id', 'manager'),
  ('employee@companya.com', 'company-a-id', 'employee'),
  ('accountant@companya.com', 'company-a-id', 'accountant'),
  ('viewer@companya.com', 'company-a-id', 'viewer');
```

### 2. ุณูุฑูุจุช ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

```javascript
// ูู Console
const checkPermission = async (permission) => {
  const { data } = await supabase
    .from('user_permissions')
    .select('*')
    .eq('user_id', user.id)
    .eq('permission', permission);
  console.log(`Permission ${permission}:`, data.length > 0);
};

// ุงุฎุชุจุงุฑ
await checkPermission('delete_contracts');
await checkPermission('manage_users');
```

---

## ุงููุฑุงุฌุน

- [PERMISSIONS_IMPLEMENTATION_GUIDE.md](../PERMISSIONS_IMPLEMENTATION_GUIDE.md)
- [roles.ts](../src/lib/roles.ts)
- [permissions.ts](../src/lib/permissions.ts)
- [enable_rls_security.sql](../enable_rls_security.sql)

---

**ุชู ุจุญูุฏ ุงููู** โจ
