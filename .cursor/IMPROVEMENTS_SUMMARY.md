# تحسينات سكريبت تحديث البيانات من JSON

## التحسينات المُضافة

### 1. تحسين مطابقة الأسماء العربية
- ✅ معالجة أفضل للمسافات الزائدة
- ✅ مطابقة محسّنة للأسماء الكاملة (أول + آخر)
- ✅ نظام تسجيل (scoring) للمطابقات الجزئية
- ✅ زيادة عدد السجلات المُفحوصة من 50 إلى 200

### 2. تحسين معالجة أرقام الهواتف
- ✅ إزالة البادئات "974" و "00" تلقائياً
- ✅ مقارنة ذكية للأرقام (تجاهل الاختلافات في التنسيق)
- ✅ تحديث تلقائي للعملاء الذين لديهم `000000000`

### 3. إنشاء العملاء المفقودين تلقائياً
- ✅ إنشاء تلقائي للعملاء غير الموجودين في قاعدة البيانات
- ✅ تحديد تلقائي للغة الاسم (عربي/إنجليزي)
- ✅ تقسيم الاسم تلقائياً إلى أول وآخر
- ✅ استخدام company_id الافتراضي

### 4. تحسينات أخرى
- ✅ معالجة أفضل للأخطاء
- ✅ تقارير مفصلة أكثر
- ✅ تخطي السجلات غير الصالحة تلقائياً

## كيفية الاستخدام

```bash
# 1. التأكد من متغيرات البيئة
export NEXT_PUBLIC_SUPABASE_URL="your-url"
export SUPABASE_SERVICE_ROLE_KEY="your-key"

# 2. تشغيل السكريبت
npx tsx scripts/update-customers-contracts-from-json.ts
```

## ما الذي يتم تحديثه

### العملاء:
- ✅ **إنشاء العملاء المفقودين** مع بياناتهم من ملف JSON
- ✅ **تحديث أرقام الهواتف** للعملاء الموجودين
- ✅ **تحديث خاص** للعملاء الذين لديهم `000000000`

### المركبات:
- ✅ **تحديث أرقام اللوحات** إذا كانت مختلفة

### العقود:
- ✅ **تحديث تواريخ البدء** (`start_date`)
- ✅ **تحديث المبالغ الشهرية** (`monthly_amount`)
- ✅ **تحديث ربط المركبات** (`vehicle_id`, `license_plate`)

## التقرير

بعد التنفيذ، سيتم إنشاء ملف `.cursor/update-report.json` يحتوي على:
- عدد العملاء المُنشأين
- عدد العملاء المُحدثين
- عدد المركبات المُحدثة
- عدد العقود المُحدثة
- قائمة بالبيانات غير المطابقة

## ملاحظات مهمة

- السكريبت يحدد تلقائياً company_id الافتراضي
- السكريبت يحدد تلقائياً اللغة (عربي/إنجليزي) للأسماء
- السكريبت يتعامل مع أرقام الهواتف بصيغ مختلفة (974, 00, بدون بادئة)
- يتم تخطي السجلات غير الصالحة تلقائياً

