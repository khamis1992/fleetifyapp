# โ ุชูุฑูุฑ ุงูุชุญูู ูู ูุธุงู ุฅุฑุณุงู ุชุฐููุฑุงุช ุงููุงุชุณุงุจ

**ุงูุชุงุฑูุฎ:** 3 ููููุจุฑ 2025  
**ุงููุดุฑูุน:** FleetifyApp (qwhunliohlkkahbspfiu)  
**ุงูุฑูู ุงูุชุฌุฑูุจู:** +96566707063

---

## ๐ ุญุงูุฉ ุงููุธุงู

### โ Edge Function
- **ุงูุงุณู:** `send-whatsapp-reminders`
- **ุงูุญุงูุฉ:** โ ACTIVE (ููุนู)
- **ุงูุฅุตุฏุงุฑ:** 2
- **ุขุฎุฑ ุชุญุฏูุซ:** 3 ููููุจุฑ 2025

### โ Cron Job
- **ุงูุงุณู:** `process-whatsapp-reminders`
- **ุงูุญุงูุฉ:** โ ACTIVE (ููุนู)
- **ุงูุฌุฏููุฉ:** ูู 5 ุฏูุงุฆู (`*/5 * * * *`)
- **ุงููุตูู:** โ ุตุญูุญ (ูุณุชุฎุฏู anon key ุงูุตุญูุญ)

### โ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุฅุฌูุงูู ุงูุชุฐููุฑุงุช:** 5 ูู ุญุงูุฉ `queued`
- **ุงูุชุฐููุฑ ุงูุชุฌุฑูุจู:** โ ุชู ุฅูุดุงุคู ุจูุฌุงุญ
  - ุงูุฑูู: `+96566707063`
  - ุงูุนููู: KHAMIS AL JABOR
  - ุงูุญุงูุฉ: `queued`
  - ุงูุชุงุฑูุฎ: 3 ููููุจุฑ 2025

### โ ุงูุณุฌูุงุช (Logs)
- **ุขุฎุฑ ุงุณุชุฏุนุงุก:** โ ูุฌุญ (HTTP 200)
- **ุงูููุช:** ~8.5 ุซูุงูู
- **ุงูููุท:** ูุนูู ุจุดูู ุทุจูุนู

---

## ๐งช ุงูุฑุณุงูุฉ ุงูุชุฌุฑูุจูุฉ

ุชู ุฅูุดุงุก ุชุฐููุฑ ุชุฌุฑูุจู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ:

```json
{
  "phone_number": "+96566707063",
  "customer_name": "KHAMIS AL JABOR",
  "message_template": "ูุฑุญุจุงู ๐\n\nูุฐู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ ูู ูุธุงู FleetifyApp ูุฅุฑุณุงู ุชุฐููุฑุงุช ุงููุงุชุณุงุจ.\n\nโ ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ!\n\nุดูุฑุงู ูุงุณุชุฎุฏุงูู ูุธุงููุง.",
  "status": "queued",
  "scheduled_date": "2025-11-03",
  "scheduled_time": "09:00:00"
}
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ูุชุบูุฑุงุช ุงูุจูุฆุฉ (Environment Variables)
โ๏ธ **ุชุญุฐูุฑ:** ูุฌุจ ุงูุชุฃูุฏ ูู ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงูุชุงููุฉ ูู Supabase Dashboard:
- `ULTRAMSG_INSTANCE_ID`
- `ULTRAMSG_TOKEN`

**ููููุฉ ุงูุฅุนุฏุงุฏ:**
1. ุงุฐูุจ ุฅูู Supabase Dashboard
2. Edge Functions โ `send-whatsapp-reminders`
3. Settings โ Secrets
4. ุฃุถู ุงููุชุบูุฑุงุช ุงูุชุงููุฉ:
   - `ULTRAMSG_INSTANCE_ID`: ูุนุฑู ุญุณุงุจู ูู Ultramsg
   - `ULTRAMSG_TOKEN`: ุฑูุฒ API ุงูุฎุงุต ุจู ูู Ultramsg

### 2. ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุงูุชุฌุฑูุจูุฉ

ุชู ุงุณุชุฏุนุงุก Edge Function ููุนุงูุฌุฉ ุงูุชุฐููุฑุงุช ูู ุญุงูุฉ `queued`. 

**ุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ:**

#### ุฃ) ุงูุงูุชุธุงุฑ ุงูุชููุงุฆู (Cron Job)
- Cron Job ูุนูู ูู 5 ุฏูุงุฆู ุชููุงุฆูุงู
- ุณูุนุงูุฌ ุงูุชุฐููุฑ ุงูุชุฌุฑูุจู ุฎูุงู ุงูุฏูุงุฆู ุงูุฎูุณ ุงููุงุฏูุฉ
- ูุง ุญุงุฌุฉ ูุฃู ุฅุฌุฑุงุก ุฅุถุงูู

#### ุจ) ุงูุงุณุชุฏุนุงุก ุงููุฏูู (Manual Invoke)
ููููู ุงุณุชุฏุนุงุก Edge Function ูุฏููุงู ุนุจุฑ:

**1. Supabase Dashboard:**
   - Edge Functions โ `send-whatsapp-reminders`
   - Invoke Function โ Send Request

**2. ุฃู ุนุจุฑ Terminal:**
```bash
curl -X POST "https://qwhunliohlkkahbspfiu.supabase.co/functions/v1/send-whatsapp-reminders" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ANON_KEY" \
  -d "{}"
```

**3. ุฃู ุงุฎุชุจุงุฑ ูุจุงุดุฑ (Test Mode):**
```bash
curl -X POST "https://qwhunliohlkkahbspfiu.supabase.co/functions/v1/send-whatsapp-reminders" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ANON_KEY" \
  -d '{
    "test": true,
    "phone": "+96566707063",
    "message": "ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ"
  }'
```

---

## ๐ ุฎุทูุงุช ุงูุชุญูู ุงูููุงุฆูุฉ

1. โ **Edge Function:** ููุนู ููุนูู
2. โ **Cron Job:** ููุนู ููุนูู ูู 5 ุฏูุงุฆู
3. โ **ูุงุนุฏุฉ ุงูุจูุงูุงุช:** ุงูุชุฐููุฑ ุงูุชุฌุฑูุจู ููุฌูุฏ
4. โ๏ธ **ูุชุบูุฑุงุช ุงูุจูุฆุฉ:** ูุฌุจ ุงูุชุญูู ูู ุฅุนุฏุงุฏูุง
5. โณ **ุงูุงูุชุธุงุฑ:** Cron Job ุณูุนุงูุฌ ุงูุชุฐููุฑ ุฎูุงู 5 ุฏูุงุฆู

---

## ๐ ุงูุชุญูู ูู ุงููุชูุฌุฉ

ุจุนุฏ ุฅุฑุณุงู ุงูุฑุณุงูุฉุ ููููู ุงูุชุญูู ูู:

1. **ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```sql
SELECT 
  id,
  phone_number,
  customer_name,
  status,
  sent_at,
  error_message
FROM reminder_schedules
WHERE phone_number = '+96566707063'
ORDER BY created_at DESC
LIMIT 1;
```

2. **ูู ุณุฌู reminder_history:**
```sql
SELECT 
  id,
  action,
  success,
  phone_number,
  error_message,
  created_at
FROM reminder_history
WHERE phone_number LIKE '%66707063%'
ORDER BY created_at DESC
LIMIT 5;
```

3. **ูู ุณุฌูุงุช Edge Function:**
   - Supabase Dashboard โ Edge Functions โ `send-whatsapp-reminders` โ Logs

---

## โ ุงูุฎูุงุตุฉ

โ **ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ!**

- Edge Function ููุนู ููุญุฏูุซ
- Cron Job ูุนูู ุชููุงุฆูุงู
- ุงูุชุฐููุฑ ุงูุชุฌุฑูุจู ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ๏ธ **ูุฌุจ ุงูุชุฃูุฏ ูู ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ (ULTRAMSG_INSTANCE_ID ู ULTRAMSG_TOKEN)**

**ุงูุฎุทูุฉ ุงูุชุงููุฉ:** ุงูุชุญูู ูู ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูู Supabase Dashboardุ ุซู ุงูุงูุชุธุงุฑ ุญุชู ูููู Cron Job ุจูุนุงูุฌุฉ ุงูุชุฐููุฑ (ุฎูุงู 5 ุฏูุงุฆู ูุญุฏ ุฃูุตู).

---

**ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ:** 3 ููููุจุฑ 2025  
**ุจูุงุณุทุฉ:** Supabase MCP

