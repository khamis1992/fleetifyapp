# โ ุชุญุฏูุซ ุงููุธุงู ููุณุชุฎุฏู Ultramsg API ุจุดูู ุตุญูุญ

## ๐ ููุฎุต

ุชู ุชุญุฏูุซ Edge Function `send-whatsapp-reminders` ูุถูุงู ุงูุชุทุงุจู ุงููุงูู ูุน ูุซุงุฆู Ultramsg API ุงูุฑุณููุฉ:
**API Reference:** https://docs.ultramsg.com/api/post/messages/chat

---

## โ ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ

### 1. ุชูุณูู ุฑูู ุงููุงุชู ุงูุฏููู
- โ ุฅุถุงูุฉ ุนูุงูุฉ `+` ุงููุทููุจุฉ ุญุณุจ ุงูููุงุตูุงุช
- โ ูุนุงูุฌุฉ ุชูุณููุงุช ูุฎุชููุฉ: `00`, `974`, ุฅูุฎ
- โ ุชุญูู ูู ุงูุชูุณูู ูุจู ุงูุฅุฑุณุงู

### 2. ุงูุชุญูู ูู ุทูู ุงูุฑุณุงูุฉ
- โ ุงูุญุฏ ุงูุฃูุตู: 4096 ุญุฑู (ุญุณุจ ูุซุงุฆู Ultramsg)
- โ ูุทุน ุชููุงุฆู ููุฑุณุงุฆู ุงูุทูููุฉ

### 3. ุชุญุณูู ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ
- โ ุชุญููู JSON ุขูู
- โ ุฏุนู ุนุฏุฉ ุฃุดูุงู ูู ุงุณุชุฌุงุจุงุช ุงููุฌุงุญ
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ

### 4. ุชุญุณูู ุงูุณุฌูุงุช
- โ ุณุฌูุงุช ููุตูุฉ ููู ุฎุทูุฉ
- โ ุชุณููู ุนูููุฉ ุงูุชุดุฎูุต

---

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ

### โ `supabase/functions/send-whatsapp-reminders/index.ts`
- ุชุญุฏูุซ ุฏุงูุฉ `sendWhatsAppMessage()` ูุงุชุจุงุน ููุงุตูุงุช Ultramsg API
- ุฅุตูุงุญ ุชูุณูู ุฑูู ุงููุงุชู (`+` ูุทููุจ)
- ุฅุถุงูุฉ ุงูุชุญูู ูู ุทูู ุงูุฑุณุงูุฉ
- ุชุญุณูู ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ

---

## ๐ ุงูุชุญูู ูู ุงูุชุทุงุจู

### โ API Endpoint
```
POST https://api.ultramsg.com/{{instance_id}}/messages/chat
```

### โ Request Body Parameters
| Parameter | Status | Notes |
|-----------|--------|-------|
| `token` | โ | ููุฌูุฏ ููุทููุจ |
| `to` | โ | ุชูุณูู ุฏููู ูุน `+` (ูุซุงู: `+97412345678`) |
| `body` | โ | UTF-8/UTF-16ุ ุฃูุตู ุทูู 4096 ุญุฑู |

### โ Headers
```
Content-Type: application/json โ
```

---

## ๐ ุฎุทูุงุช ุงููุดุฑ

### 1. ูุดุฑ Edge Function ุงููุญุฏุซ
```bash
cd C:\Users\khamis\Desktop\fleetifyapp-3
npx supabase functions deploy send-whatsapp-reminders
```

### 2. ุงูุชุญูู ูู Environment Variables
ูู Supabase Dashboard โ Edge Functions โ Secrets:
```
ULTRAMSG_INSTANCE_ID=your_instance_id
ULTRAMSG_TOKEN=your_token
```

### 3. ุงุฎุชุจุงุฑ ุงููุธููุฉ
```bash
# ุงุฎุชุจุงุฑ ุฑุณุงูุฉ ูุงุญุฏุฉ
curl -X POST "https://YOUR_PROJECT.supabase.co/functions/v1/send-whatsapp-reminders" \
  -H "Authorization: Bearer YOUR_ANON_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "test": true,
    "phone": "97412345678",
    "message": "ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ โ"
  }'
```

---

## ๐ ุฃูุซูุฉ ุงูุชูุณูู ุงููุฏุนููุฉ

### ุฃุฑูุงู ุงูููุงุชู
```
โ "97412345678"     โ "+97412345678"
โ "0097412345678"   โ "+97412345678"
โ "+97412345678"    โ "+97412345678"
โ "12345678"        โ "+12345678" (ุฅุฐุง ูุงู >= 8)

โ "123"             โ ูุดู (ูุตูุฑ ุฌุฏุงู)
โ "abc123"          โ ูุดู (ุฃุญุฑู ุบูุฑ ุตุงูุญุฉ)
```

### ุงูุฑุณุงุฆู
```
โ "ูุฑุญุจุงู ๐\n\nุชุฐููุฑ: ูุงุชูุฑุชู ูุณุชุญูุฉ."
โ UTF-8 ู UTF-16 ูุน ุฏุนู emoji
โ ุณูููุทุน ุชููุงุฆูุงู ุฅุฐุง ูุงู > 4096 ุญุฑู
```

---

## ๐ฏ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

### โ ููุชูู
- [x] ุชูุณูู ุฑูู ุงููุงุชู ุงูุฏููู ูุน `+`
- [x] ุงูุชุญูู ูู ุทูู ุงูุฑุณุงูุฉ (โค 4096)
- [x] ูุนุงูุฌุฉ ุงุณุชุฌุงุจุฉ ูุญุณููุฉ
- [x] ุณุฌูุงุช ููุตูุฉ
- [x] ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ

### โ ูุชูุงูู ูุน ูุซุงุฆู Ultramsg
- [x] API Endpoint ุตุญูุญ
- [x] Request Body Parameters ุตุญูุญุฉ
- [x] Headers ุตุญูุญุฉ
- [x] ุชูุณูู ุฑูู ุงููุงุชู ุตุญูุญ
- [x] ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ ุตุญูุญุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ุงููุฑู ุจูู ุงูุญููู:

1. **WhatsApp Web (`whatsappWebSender.ts`):**
   - โ ูุนูู ููุฑุงู ุจุฏูู ุฅุนุฏุงุฏุงุช
   - โ ููุชุญ ุชุจููุจุงุช WhatsApp Web
   - โ๏ธ ุบูุฑ ููุงุณุจ ูุนุฏุฏ ูุจูุฑ ูู ุงูุฑุณุงุฆู (100+)
   - ๐ ุฑูู ุจุฏูู `+` (ููุท ุฃุฑูุงู)

2. **Ultramsg API (Edge Function):**
   - โ ููุงุณุจ ูุนุฏุฏ ูุจูุฑ ูู ุงูุฑุณุงุฆู
   - โ ุฅุฑุณุงู ุชููุงุฆู ูุงูู
   - โ ูุชุทูุจ ุฅุนุฏุงุฏ (Ultramsg + Edge Function + Cron Job)
   - ๐ ุฑูู ูุน `+` (ุชูุณูู ุฏููู)

---

## ๐ ุงููุฑุงุฌุน

- **Ultramsg API Documentation:** https://docs.ultramsg.com/api/post/messages/chat
- **ุชุญุฏูุซุงุช ุงูุชุทุงุจู:** `.cursor/ULTRAMSG_API_COMPLIANCE_ุงูุชุญุฏูุซุงุช.md`
- **ุฏููู ุงูุฅุนุฏุงุฏ:** `.cursor/SETUP_WHATSAPP_STEP_BY_STEP.md`

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** 3 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุชูู ููุชูุงูู ูุน ูุซุงุฆู Ultramsg API  
**ุฌุงูุฒ ูููุดุฑ:** โ ูุนู

