# تحليل مشكلة: لماذا يظهر 22 عقد فقط في صفحة التنبيهات؟

## المشكلة
- **العقود النشطة في قاعدة البيانات:** 173 عقد
- **عقود بأرقام هواتف صحيحة:** 91 عقد
- **العقود المؤهلة في صفحة التنبيهات:** 22 عقد فقط ❌

## السبب الجذري

### 1. Pagination (التقسيم لصفحات)
في `useContractsData`:
```typescript
// Apply pagination
if (filters?.page || filters?.pageSize) {
  const from = (page - 1) * pageSize;
  const to = from + pageSize - 1;
  query = query.range(from, to);
}
```

**الأثر:** إذا كان `pageSize = 50` و `page = 1`، يتم جلب **50 عقد فقط** من قاعدة البيانات.

### 2. التصفية في Frontend
في `SendRemindersDialog`:
```typescript
const eligibleContracts = contracts.filter(c => {
  const phone = getCustomerPhone(c);
  const isActive = isActiveContract(c);
  return phone && phone.trim() !== '' && phone !== '000000000' && isActive;
});
```

**الأثر:** من الـ 50 عقد المُجلبة، فقط الذين لديهم أرقام هواتف صحيحة يتم عرضهم.

### 3. النتيجة
50 عقد (مُجلبة) → تصفية أرقام الهواتف → **22 عقد فقط مؤهلة**

## الإحصائيات الفعلية

| المؤشر | العدد |
|--------|------|
| **إجمالي العقود النشطة** | 173 |
| **عقود بأرقام هواتف صحيحة** | 91 ✅ |
| **عقود بأرقام `000000000`** | 82 ❌ |
| **العقود المُجلبة (pagination)** | 50 |
| **العقود المؤهلة (بعد التصفية)** | 22 |

## الحل

### الخيار 1: جلب جميع العقود النشطة (موصى به)
- تعديل `SendRemindersDialog` لجلب جميع العقود النشطة بدون pagination
- استخدام query منفصل لجلب فقط العقود ذات الأرقام الصحيحة

### الخيار 2: زيادة pageSize
- زيادة `pageSize` إلى 200 أو أكثر
- **المشكلة:** حل مؤقت، قد لا يعمل مع أعداد كبيرة

### الخيار 3: إنشاء Hook منفصل
- إنشاء `useActiveContractsForReminders` يجلب جميع العقود النشطة
- بدون pagination أو تصفية

## الحل المقترح (الخيار 1)

سأقوم بتعديل `SendRemindersDialog` لجلب جميع العقود النشطة ذات الأرقام الصحيحة مباشرة من قاعدة البيانات، بدلاً من الاعتماد على العقود المُمررة من صفحة Contracts.

