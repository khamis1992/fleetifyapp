# ๐ฏ ููุฎุต ุชุญุณููุงุช ุตูุญุฉ CRM

## ๐ ุงูุชุงุฑูุฎ: 6 ููููุจุฑ 2025

---

## โ ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. โ๏ธ **ูุดููุฉ ุงูุฏูุฌ - ุตูุญุฉ ุฏุงุฎู ุตูุญุฉ**
**ุงููุดููุฉ:** ูุงูุช ุงูุตูุญุฉ ุชุญุชูู ุนูู Header ูุฃุฒุฑุงุฑ ุฎุงุตุฉ ุจูุง ููุง ูุณุจุจ ุชูุฑุงุฑ ูุน ุงูู AppLayout ุงูุฑุฆูุณู

**ุงูุญู:**
- โ ุญุฐู ุงูู Header ุงููุงูู (Menu button, Bell notification, etc.)
- โ ุงุณุชุจุฏุงูู ุจู Page Title ุจุณูุท ููุธูู
- โ ุฅุฒุงูุฉ ุฌููุน ุงูุนูุงุตุฑ ุงูููุฑุฑุฉ

**ุงูููุฏ ุงููุฏูู:**
```tsx
<header className="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
  <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div className="flex justify-between items-center h-16">
      <Button variant="ghost" size="icon">
        <Menu className="w-6 h-6 text-gray-700" />
      </Button>
      <Button variant="ghost" size="icon" className="relative">
        <Bell className="w-6 h-6 text-gray-700" />
      </Button>
    </div>
  </div>
</header>
```

**ุงูููุฏ ุงูุฌุฏูุฏ:**
```tsx
<div className="bg-white border-b border-gray-200 mb-6">
  <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <h1 className="text-2xl font-bold text-gray-900">ุฅุฏุงุฑุฉ ุงูุนููุงุก ูุงููุชุงุจุนุงุช</h1>
    <p className="text-sm text-gray-500 mt-1">ูุธุงู ุฅุฏุงุฑุฉ ุนูุงูุงุช ุงูุนููุงุก (CRM)</p>
  </div>
</div>
```

---

### 2. ๐ฅ **ููุชุฑุฉ ุงูุนููุงุก - ุนุฑุถ ุงูุนููุฏ ุงููุดุทุฉ ููุท**
**ุงููุดููุฉ:** ูุงูุช ุงูุตูุญุฉ ุชุนุฑุถ ุฌููุน ุงูุนููุงุก ุงููุดุทูู ุจุบุถ ุงููุธุฑ ุนู ุญุงูุฉ ุนููุฏูู

**ุงูุญู:**
- โ ุชุนุฏูู ุงูู Query ูุฌูุจ ุงูุนููุงุก ุงูุฐูู ูุฏููู ุนููุฏ ูุดุทุฉ ููุท
- โ ุงุณุชุฎุฏุงู `!inner` join ููุชุฃูุฏ ูู ูุฌูุฏ ุนูุฏ ูุดุท

**ุงูููุฏ ุงููุฏูู:**
```tsx
const { data, error } = await supabase
  .from('customers')
  .select(`id, customer_code, ...`)
  .eq('company_id', companyId)
  .eq('is_active', true)
```

**ุงูููุฏ ุงูุฌุฏูุฏ:**
```tsx
const { data, error } = await supabase
  .from('customers')
  .select(`
    id,
    customer_code,
    first_name_ar,
    last_name_ar,
    phone,
    email,
    company_id,
    is_active,
    created_at,
    contracts!inner (
      id,
      status
    )
  `)
  .eq('company_id', companyId)
  .eq('is_active', true)
  .eq('contracts.status', 'active')  // โ ุงูููุชุฑ ุงูุฌุฏูุฏ
```

---

### 3. ๐ **ุชุณุฌูู ุชููุงุฆู ููููุงููุงุช**
**ุงููุดููุฉ:** ุนูุฏ ุงูุถุบุท ุนูู "ุงุชุตุงู ุงูุขู" ูุงู ููุชุญ ุชุทุจูู ุงููุงุชู ููุท ุจุฏูู ุชุณุฌูู

**ุงูุญู:**
- โ ุฅูุดุงุก ุฏุงูุฉ `handleCallNow()` ุชุณุฌู ููุงุญุธุฉ ุชููุงุฆูุฉ
- โ ุงูููุงุญุธุฉ ุชุญุชูู ุนูู ุงูุชุงุฑูุฎ ูุงูููุช
- โ ุฅุดุนุงุฑ ูููุณุชุฎุฏู ูุน ุฒุฑ "ุชุนุฏูู ุงูุขู"

**ุงูููุฏ ุงูุฌุฏูุฏ:**
```tsx
const handleCallNow = async (customer: Customer) => {
  if (!companyId) return;

  try {
    // Create automatic note
    const { data: newNote, error } = await supabase
      .from('customer_notes')
      .insert({
        customer_id: customer.id,
        company_id: companyId,
        note_type: 'phone',
        title: 'ููุงููุฉ ูุงุชููุฉ',
        content: `ุชู ุฅุฌุฑุงุก ููุงููุฉ ูุงุชููุฉ ูุน ุงูุนููู ูู ${format(new Date(), 'dd/MM/yyyy')} ุงูุณุงุนุฉ ${format(new Date(), 'HH:mm')}\n\n[ูุฑุฌู ุฅุถุงูุฉ ุชูุงุตูู ุงูููุงููุฉ ูุงูุงุชูุงูุงุช...]`,
        is_important: true, // Mark as important so user remembers to edit it
      })
      .select()
      .single();

    if (error) throw error;

    // Initiate the phone call
    window.location.href = `tel:${customer.phone}`;

    // Show toast with edit option
    toast({
      title: 'โ ุชู ุชุณุฌูู ุงูููุงููุฉ',
      description: 'ุชู ุฅูุดุงุก ููุงุญุธุฉ ุชููุงุฆูุฉ. ูุฑุฌู ุฅุถุงูุฉ ุชูุงุตูู ุงูููุงููุฉ.',
      action: (
        <Button
          size="sm"
          variant="outline"
          onClick={() => {
            setEditingNoteId(newNote.id);
            setEditingNoteContent(newNote.content);
            setExpandedCustomer(customer.id);
          }}
        >
          ุชุนุฏูู ุงูุขู
        </Button>
      ),
    });
  } catch (error) {
    console.error('Error creating call note:', error);
    toast({
      title: 'ุฎุทุฃ',
      description: 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุณุฌูู ุงูููุงููุฉ',
      variant: 'destructive',
    });
  }
};
```

---

### 4. โ๏ธ **ุฅููุงููุฉ ุชุนุฏูู ุงูููุงุญุธุงุช**
**ุงููุดููุฉ:** ูู ููู ููุงู ุทุฑููุฉ ูุชุนุฏูู ุงูููุงุญุธุฉ ุจุนุฏ ุฅูุดุงุฆูุง

**ุงูุญู:**
- โ ุฅุถุงูุฉ ุฒุฑ "ุชุนุฏูู" ุจุฌูุงุฑ ูู ููุงุญุธุฉ
- โ Textarea ูุชุนุฏูู ุงููุญุชูู inline
- โ ุฃุฒุฑุงุฑ "ุญูุธ" ู "ุฅูุบุงุก"
- โ ุฏุงูุฉ `handleUpdateNote()` ูุญูุธ ุงูุชุนุฏููุงุช

**ูุงุฌูุฉ ุงูุชุนุฏูู:**
```tsx
{!isEditing ? (
  <p className="text-sm text-gray-700 whitespace-pre-wrap">{followUp.content}</p>
) : (
  <div className="space-y-2">
    <Textarea
      rows={5}
      value={editingNoteContent}
      onChange={(e) => setEditingNoteContent(e.target.value)}
      className="text-sm resize-none"
      placeholder="ุฃุถู ุชูุงุตูู ุงูููุงููุฉ..."
    />
    <div className="flex gap-2 justify-end">
      <Button
        size="sm"
        variant="outline"
        onClick={() => {
          setEditingNoteId(null);
          setEditingNoteContent('');
        }}
      >
        ุฅูุบุงุก
      </Button>
      <Button
        size="sm"
        className="bg-green-600 hover:bg-green-700"
        onClick={() => handleUpdateNote(followUp.id, editingNoteContent)}
      >
        <CheckCircle className="w-3 h-3 ml-1" />
        ุญูุธ ุงูุชุนุฏููุงุช
      </Button>
    </div>
  </div>
)}
```

**ุฏุงูุฉ ุงูุชุญุฏูุซ:**
```tsx
const handleUpdateNote = async (noteId: string, newContent: string) => {
  if (!newContent.trim()) {
    toast({
      title: 'ุฎุทุฃ',
      description: 'ูุฑุฌู ุฅุฏุฎุงู ูุญุชูู ุงูููุงุญุธุฉ',
      variant: 'destructive',
    });
    return;
  }

  try {
    const { error } = await supabase
      .from('customer_notes')
      .update({
        content: newContent,
        is_important: false, // Remove importance flag after editing
      })
      .eq('id', noteId);

    if (error) throw error;

    toast({
      title: 'โ ุชู ุงูุชุญุฏูุซ',
      description: 'ุชู ุชุญุฏูุซ ุงูููุงุญุธุฉ ุจูุฌุงุญ',
    });

    setEditingNoteId(null);
    setEditingNoteContent('');
  } catch (error) {
    console.error('Error updating note:', error);
    toast({
      title: 'ุฎุทุฃ',
      description: 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญุฏูุซ ุงูููุงุญุธุฉ',
      variant: 'destructive',
    });
  }
};
```

---

## ๐จ ุชุญุณููุงุช ุฅุถุงููุฉ

### Badge "ูุญุชุงุฌ ุชุนุฏูู"
```tsx
{followUp.is_important && (
  <Badge variant="outline" className="bg-orange-50 text-orange-600 border-orange-200 text-xs">
    ูุญุชุงุฌ ุชุนุฏูู
  </Badge>
)}
```

### State Management
```tsx
const [editingNoteId, setEditingNoteId] = useState<string | null>(null);
const [editingNoteContent, setEditingNoteContent] = useState('');
```

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุงููุตูู ููุตูุญุฉ:
```
/customers/crm
```

### 2. ุณููุงุฑูู ุงูุงุณุชุฎุฏุงู ุงููุงูู:

#### **ุงูุฎุทูุฉ 1:** ุงูุจุญุซ ุนู ุนููู
- ุงุณุชุฎุฏู ุงูุจุญุซ ูู ุงูุฃุนูู
- ุฃู ุงุณุชุฎุฏู ุงูููุงุชุฑ (ุนููุฏ ูุดุทุฉุ ูุฑูุจุฉ ูู ุงูุงูุชูุงุกุ ุฅูุฎ)

#### **ุงูุฎุทูุฉ 2:** ุงูุงุชุตุงู ุจุงูุนููู
1. ุงุถุบุท ุนูู ุฒุฑ "ุงุชุตุงู ุงูุขู" ๐ข
2. ุณูุชู:
   - ูุชุญ ุชุทุจูู ุงููุงุชู ุชููุงุฆูุงู
   - ุฅูุดุงุก ููุงุญุธุฉ ุชููุงุฆูุฉ ุจุงูููุช ูุงูุชุงุฑูุฎ
   - ุนุฑุถ ุฅุดุนุงุฑ ูุน ุฒุฑ "ุชุนุฏูู ุงูุขู"

#### **ุงูุฎุทูุฉ 3:** ุชุนุฏูู ุงูููุงุญุธุฉ ุจุนุฏ ุงูููุงููุฉ
**ุทุฑููุฉ 1:** ูู ุงูุฅุดุนุงุฑ
- ุงุถุบุท ุนูู ุฒุฑ "ุชุนุฏูู ุงูุขู" ูู ุงูุฅุดุนุงุฑ

**ุทุฑููุฉ 2:** ูู Timeline
1. ุงุถุบุท ุนูู "ุนุฑุถ ุงูุณุฌู"
2. ุงุจุญุซ ุนู ุงูููุงุญุธุฉ (ุณุชููู ุนูููุง badge "ูุญุชุงุฌ ุชุนุฏูู")
3. ุงุถุบุท ุนูู ุฒุฑ "ุชุนุฏูู" ุจุฌุงูุจ ุงูููุงุญุธุฉ
4. ุนุฏูู ุงููุญุชูู
5. ุงุถุบุท "ุญูุธ ุงูุชุนุฏููุงุช"

#### **ุงูุฎุทูุฉ 4:** ุฅุถุงูุฉ ุชูุงุตูู ุงูููุงููุฉ
```
ูุซุงู:
ุชู ุฅุฌุฑุงุก ููุงููุฉ ูุงุชููุฉ ูุน ุงูุนููู ูู 06/11/2025 ุงูุณุงุนุฉ 14:30

โ ุชู ุงูุงุชูุงู ุนูู:
- ุชุฌุฏูุฏ ุงูุนูุฏ ููุฏุฉ ุณูุฉ ุฅุถุงููุฉ
- ุฒูุงุฏุฉ ุงููููุฉ ุงูุฅูุฌุงุฑูุฉ ุจูุณุจุฉ 5%
- ููุนุฏ ุชูููุน ุงูุนูุฏ ุงูุฌุฏูุฏ: 15/11/2025

๐ ููุงุญุธุงุช:
- ุงูุนููู ุฑุงุถู ุนู ุงูุฎุฏูุฉ
- ุทูุจ ุตูุงูุฉ ูููุฑูุจุฉ ูุจู ุงูุชุฌุฏูุฏ
- ูุญุชุงุฌ ูุงุชูุฑุฉ ุถุฑูุจูุฉ ููุนูุฏ ุงูุฌุฏูุฏ
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงููุญุณูุฉ

ุงูุตูุญุฉ ุงูุขู ุชุนุฑุถ:
- โ **ุงูุนููุงุก ุงููุดุทูู:** ููุท ูู ูุฏููู ุนููุฏ ูุดุทุฉ
- โ **ููุงููุงุช ุงูููู:** ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ูู ููุงููุฉ
- โ **ูุชุงุจุนุงุช ูุนููุฉ:** ุชุดูู ุงูููุงุญุธุงุช ุงูุชู ุชุญุชุงุฌ ุชุนุฏูู
- โ **ููุชููุฉ ูุฐุง ุงูุดูุฑ:** ุงูููุงุญุธุงุช ุงูููุชููุฉ

---

## ๐ฏ ุงูููุงุฆุฏ

### ูููุณุชุฎุฏู:
1. โ **ุชูููุฑ ุงูููุช:** ุชุณุฌูู ุชููุงุฆู ููููุงููุงุช
2. โ **ุนุฏู ูุณูุงู ุงูุชูุงุตูู:** ุชุฐููุฑ ููุฑู ุจุชุนุฏูู ุงูููุงุญุธุฉ
3. โ **ุณูููุฉ ุงูุชุนุฏูู:** ุฅููุงููุฉ ุงูุชุนุฏูู ูู ุฃู ููุช
4. โ **ูุงุฌูุฉ ูุธููุฉ:** ุจุฏูู ุชูุฑุงุฑ ุฃู ุนูุงุตุฑ ูุฒุนุฌุฉ

### ูููุธุงู:
1. โ **ุณุฌู ูุงูู:** ูู ููุงููุฉ ูุณุฌูุฉ ุชููุงุฆูุงู
2. โ **ุชุชุจุน ุฏููู:** ูุนุฑูุฉ ูุชู ุชู ุงูุงุชุตุงู ุจูู ุนููู
3. โ **ุชูุงุฑูุฑ ุฃูุถู:** ุจูุงูุงุช ุฏูููุฉ ุนู ุนุฏุฏ ุงูููุงููุงุช
4. โ **ุฃุฏุงุก ูุญุณู:** ููุชุฑุฉ ุฐููุฉ ููุนููุงุก

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### `src/pages/customers/CustomerCRM.tsx`
- โ ุญุฐู Header ุงูููุฑุฑ
- โ ุชุนุฏูู Query ููุนููุงุก
- โ ุฅุถุงูุฉ `handleCallNow()`
- โ ุฅุถุงูุฉ `handleUpdateNote()`
- โ ุฅุถุงูุฉ ูุงุฌูุฉ ุงูุชุนุฏูู ูู Timeline
- โ ุฅุถุงูุฉ State ููุชุนุฏูู

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ูุจู ุงูุชุญุณููุงุช:
โ ุตูุญุฉ ุฏุงุฎู ุตูุญุฉ (header ููุฑุฑ)
โ ุฌููุน ุงูุนููุงุก ูุธูุฑูู (ุญุชู ุจุฏูู ุนููุฏ ูุดุทุฉ)
โ ุฒุฑ "ุงุชุตุงู ุงูุขู" ููุชุญ ุงููุงุชู ููุท
โ ูุง ูููู ุชุนุฏูู ุงูููุงุญุธุงุช

### ุจุนุฏ ุงูุชุญุณููุงุช:
โ ุตูุญุฉ ูุฏูุฌุฉ ุจุดูู ูุซุงูู ูุน ุงููุธุงู
โ ููุท ุงูุนููุงุก ูุน ุนููุฏ ูุดุทุฉ
โ ุชุณุฌูู ุชููุงุฆู ููููุงููุงุช ูุน ุงูุชุงุฑูุฎ ูุงูููุช
โ ุฅููุงููุฉ ุชุนุฏูู ุงูููุงุญุธุงุช ูู ุฃู ููุช
โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุงุญุชุฑุงููุฉ

---

## ๐ ุงูุฑูุงุจุท ุฐุงุช ุงูุตูุฉ

- ุตูุญุฉ ุงูุนููุงุก: `/customers`
- ุตูุญุฉ CRM: `/customers/crm`
- ุฅุฏุงุฑุฉ ุงูุนููุฏ: `/contracts`

---

**ุชู ุงูุชุญุฏูุซ:** 6 ููููุจุฑ 2025
**ุงูุฅุตุฏุงุฑ:** 2.0
**ุงูุญุงูุฉ:** โ ููุชูู ููุฎุชุจุฑ

